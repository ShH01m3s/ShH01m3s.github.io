<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>macOS Logs - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-ttp 🔍">
      <a href="/docs/ttp">
        <span>TTP 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-artefacts db 🏺">
      <a href="/docs/artefacts">
        <span>Artefacts DB 🏺</span>
      </a>
    </li>
    
    <li class="menu-item-attacks db ⚔️">
      <a href="/docs/attacks">
        <span>Attacks DB ⚔️</span>
      </a>
    </li>
    
    <li class="menu-item-tools db 🛠️">
      <a href="/docs/tools">
        <span>Tools DB 🛠️</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-ttp 🔍">
      <a href="/docs/ttp">
        <span>TTP 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-artefacts db 🏺">
      <a href="/docs/artefacts">
        <span>Artefacts DB 🏺</span>
      </a>
    </li>
    
    <li class="menu-item-attacks db ⚔️">
      <a href="/docs/attacks">
        <span>Attacks DB ⚔️</span>
      </a>
    </li>
    
    <li class="menu-item-tools db 🛠️">
      <a href="/docs/tools">
        <span>Tools DB 🛠️</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/artefacts/apple/"> 👈🏼 Back to </br> 🍏 🐧 UNIX Artefacts </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#macos">macOS</a>
      <ul>
        <li><a href="#syslog">Syslog</a></li>
        <li><a href="#nslog">NSlog</a></li>
        <li><a href="#fsevents">Fsevents</a>
          <ul>
            <li><a href="#querying-interesting-data">Querying Interesting Data</a></li>
            <li><a href="#010-editor-template">010 Editor Template</a></li>
            <li><a href="#turning-off-logging">Turning Off Logging</a></li>
            <li><a href="#problems">Problems</a></li>
            <li><a href="#-trash-activity">🗑 Trash activity</a></li>
            <li><a href="#unified-logs">Unified logs</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#linux">Linux</a>
      <ul>
        <li><a href="#varlog-"><code>/var/log</code> 🐧</a></li>
        <li><a href="#sysmon">Sysmon</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">macOS Logs</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      

      
      

      
    </div>
    
    <b>Created:</b> 01.06.2023
    <br />

    

  </header>


  <div class="content" itemprop="articleBody">
    <h2 id="macos">macOS</h2>
<h3 id="syslog">Syslog</h3>
<p><strong>syslog</strong>. Since macOS Sierra (10.12, 2016) Apple has redesigned its log system. Unix logs were replaced (syslog, for example). By the way, <code>syslog</code> was replaced as well on iOS (see <a href="/docs/dfir/host/mobile/ios/ios-logs">here</a>). Some still exist: <code>daily.out</code>, cups, <code>install.log</code>. 🛑 More about logs for iOS and macOS here.</p>
<p>🛑 More about fervents here.</p>
<p>New unified log path in 2 directories:</p>
<ul>
<li><code>/var/db/diagnistics</code></li>
<li><code>/var/db/uuidtext</code></li>
</ul>
<p>According to <a href="https://developer.apple.com/documentation/os/logging">Apple docs</a>, NSLog now doesn&rsquo;t write to syslog, therefore I didn&rsquo;t find a <code>syslog.sock</code> or <code>syslog</code> file itself.</p>
<blockquote>
<p>Important</p>
<p>The unified logging system is available in iOS 10. and later, macOS 10.12 and later, tvOS 10.0 and later, and watchOS 3.0 and later. This system supersedes the Apple System Logger (ASL) and Syslog APIs.</p>
</blockquote>
<p>That&rsquo;s why now with newer devices you can&rsquo;t view logs with</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">socat - UNIX-CONNECT:/var/run/lockdown/syslog.sock
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># gives an error</span>
</span></span><span class="line"><span class="cl">socat<span class="o">[</span>2520<span class="o">]</span> E connect<span class="o">(</span>5, <span class="nv">LEN</span><span class="o">=</span><span class="m">31</span> <span class="nv">AF</span><span class="o">=</span><span class="m">1</span> <span class="s2">&#34;/var/run/lockdown/syslog.sock&#34;</span>, 31<span class="o">)</span>: No such file or directory
</span></span></code></pre></div><p>ondeviceconsole tool won&rsquo;t help either, since it uses the same socket (see <a href="https://github.com/eswick/ondeviceconsole/blob/master/main.m">main.c</a>):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define SOCKET_PATH &#34;/var/run/lockdown/syslog.sock&#34;
</span></span></span></code></pre></div><p>There is a socket file <code>syslog</code> (checked by trying to <code>cp</code> it), but using the above techniques with it didn&rsquo;t work.</p>
<h3 id="nslog">NSlog</h3>
<p>With newer versions of iOS the Oslog API is used. To see the logs, use <code>oslog</code> utility from Cydia repository or <code>Passionfruit</code> multitool. Can pipe to grep to filter output.</p>
<h3 id="fsevents">Fsevents</h3>
<p>Directory events only 10.5-10.6. File events since 10.7. Each record is assigned a name which is constucted the following way: <code>hex(last_event_id + 1)</code>. Lots of zeroes appended at the beginning of the file name. Example: <code>000000000112f2d8</code>.</p>
<p><img src="fsevents_example1.png" alt="fsevents_example1"></p>
<blockquote>
<p>⚠️ Records are stored alphabetically, not chronologically!!! By alphabetically I mean sorted by file/dir full path.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">/.fseventsd <span class="c1"># root of the system partition</span>
</span></span></code></pre></div><p>Like <code>$UsnJrnl</code> for Windows. Contains lots of logs gzip-compressed archive files. Magic number: <code>1SLD</code> or <code>2SLD</code> in an uncompressed file marks a page.</p>
<p>Log entries contain file ids which is useful for sequencing files and events. Since there are dozens of entries, it&rsquo;s better to filter them. &ldquo;Renamed&rdquo; can mean the file was moved on the same volume.</p>
<p>Like <code>$UsnJrnl</code>. ❗️It keeps track of file ids, which is useful for <strong>sequencing</strong> events. Can be found <code>/.fseventsd</code>. Lot&rsquo;s of gzip archives.</p>
<blockquote>
<p>🧪 However, I couldn&rsquo;t find it on my M1 (macOS Big Sur, 11.2.3). The daemon was running (checked with Activity Monitor). Grabbing the processes path on disk (search for <code>fseventsd</code>, double-click, choose <code>Sample</code> and get the path from the result)</p>
<p>👌 I have found it here: <code>./System/Volumes/Data/.fseventsd</code>. On iOS - <code>/private/var/.fseventsd</code>, for System: <code>/.fseventsd</code> and Developer Patch at <code>/DeveloperPatch/.fseventsd</code>.</p>
</blockquote>
<p><img src="fseventsd-path.png" alt="fseventsd-path"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">  python FSEParser_V3.3.py -s -t folder /.fseventsd -o /Users/sentinel/Desktop/FSEvents_Out
</span></span></code></pre></div><p><strong>Keywords</strong>: Mount/Volume, Safari/Chrome (web search), Renamed/.trash (trash).</p>
<p>Lot&rsquo;s of information, so, think well whether to process it or not, since it&rsquo;ll take time.</p>
<blockquote>
<p>⚠️ If you insert a FAT-formatted thumb drive into a macOS machine, it will create fervents.</p>
</blockquote>
<p>Mount, Unmount, Volume. See <a href="/docs/dfir/host/apple/apple-fsevents">here</a> to know more about this artefact. Directory events only 10.5-10.6. File events since 10.7. Each record is assigned a name which is constucted the following way: <code>hex(last_event_id + 1)</code>. Lots of zeroes appended at the beginning of the file name. Example: <code>000000000112f2d8</code>. Can be found in either of these locations:</p>
<ul>
<li><code>/.fseventsd</code></li>
<li><code>./System/Volumes/Data/.fseventsd</code></li>
<li>On iOS - <code>/private/var/.fseventsd</code>, for System: <code>/.fseventsd</code> and Developer Patch at <code>/DeveloperPatch/.fseventsd</code>.</li>
</ul>
<p><code>python FSEParser_V3.3.py -s -t folder /.fseventsd -o /Users/sentinel/Desktop/FSEvents_Out	</code>. More about FSEvents might be seen here [<a href="http://www.osdfcon.org/presentations/2017/Ibrahim-Understanding-MacOS-File-Ststem-Events-with-FSEvents-Parser.pdf">10</a>]. Thanks to Nicole Ibrahim from OSDFCon, we have this filetype reverse engineered and documented. At least, v1.</p>
<blockquote>
<p>😭 Getting an error when trying to run <code>FSEventsParser</code> on a M1. No excpetion when running it on an Intel machine though.
😊 ✅ My solution was to run a windows version on a VM. Worked fine.</p>
</blockquote>
<p>Mount activity: DMGs, External devices or Shared network drives.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">SELECT
</span></span><span class="line"><span class="cl">*, _ROWID_ &#34;NAVICAT_ROWID&#34;
</span></span><span class="line"><span class="cl">FROM
</span></span><span class="line"><span class="cl">&#34;fsevents&#34;
</span></span><span class="line"><span class="cl">WHERE
</span></span><span class="line"><span class="cl">&#34;mask&#34; LIKE &#39;%mount%&#39;
</span></span></code></pre></div><p>Internet activity (websites visited)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">SELECT
</span></span><span class="line"><span class="cl">*, _ROWID_ &#34;NAVICAT_ROWID&#34;
</span></span><span class="line"><span class="cl">FROM
</span></span><span class="line"><span class="cl">&#34;fsevents&#34;
</span></span><span class="line"><span class="cl">WHERE
</span></span><span class="line"><span class="cl">&#34;filename&#34; LIKE
</span></span><span class="line"><span class="cl">&#39;Users/%/Library/Caches/Metadata/Safari/History/%&#39;
</span></span><span class="line"><span class="cl">OR &#34;filename&#34; LIKE &#39;Users/%/Library/Application
</span></span><span class="line"><span class="cl">Support/Google/Chrome/Default/Local Storage/%&#39;
</span></span></code></pre></div><p>User folders activity</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">SELECT
</span></span><span class="line"><span class="cl">*, _ROWID_ &#34;NAVICAT_ROWID&#34;
</span></span><span class="line"><span class="cl">FROM
</span></span><span class="line"><span class="cl">&#34;fsevents&#34;
</span></span><span class="line"><span class="cl">WHERE
</span></span><span class="line"><span class="cl">&#34;filename&#34; LIKE &#39;Users/%/Documents/%’
</span></span><span class="line"><span class="cl">OR &#34;filename&#34; LIKE &#39;Users/%/Downloads/%’
</span></span><span class="line"><span class="cl">OR &#34;filename&#34; LIKE &#39;Users/%/Desktop/%&#39;
</span></span></code></pre></div><p><code>FSEventsParser</code>. More about FSEvents might be seen here [<a href="http://www.osdfcon.org/presentations/2017/Ibrahim-Understanding-MacOS-File-Ststem-Events-with-FSEvents-Parser.pdf">10</a>]. Thanks to Nicole Ibrahim from OSDFCon, we have this filetype reverse engineered and documented. At least, v1.</p>
<blockquote>
<p>😭 Getting an error when trying to run <code>FSEventsParser</code> on a M1. No excpetion when running it on an Intel machine though.
😊 ✅ My solution was to run a windows version on a VM. Worked fine.
✍🏻 Another solution is to use mac_apt.py</p>
</blockquote>
<p><code>mac_apt.py</code>. Requires python to be installed. Consists of: extract_apfs_fs, ios_apt, mac_apt_artifact_only, mac_apt_mounted_sys_data and mac_apt.</p>
<p>Usage example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python mac_apt_artifact_only.py SCREENTIME -i <span class="s2">&#34;/Users/username/Documents/RMAdminStore-Local.sqlite&#34;</span> -o <span class="s2">&#34;/Users/username/Documents/&#34;</span>
</span></span></code></pre></div><h4 id="querying-interesting-data">Querying Interesting Data</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">_ROWID_</span><span class="w"> </span><span class="s2">&#34;NAVICAT_ROWID&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="s2">&#34;fsevents&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="s2">&#34;filename&#34;</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;Users/%/.Trash/%&#39;</span><span class="w">
</span></span></span></code></pre></div><h4 id="010-editor-template">010 Editor Template</h4>
<p>I&rsquo;m writing a template for parsing these files. However, the v2 seems to be a little different from the v1, which was described in the presentation mentioned above. Below is the structure of a file header + single page for v1.</p>
<blockquote>
<p>🔬 v2 might need more research from my part.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">//------------------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="c1">//--- 010 Editor v11.0.1 Binary Template
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//      File: 
</span></span></span><span class="line"><span class="cl"><span class="c1">//   Authors: 
</span></span></span><span class="line"><span class="cl"><span class="c1">//   Version: 
</span></span></span><span class="line"><span class="cl"><span class="c1">//   Purpose: 
</span></span></span><span class="line"><span class="cl"><span class="c1">//  Category: 
</span></span></span><span class="line"><span class="cl"><span class="c1">// File Mask: 
</span></span></span><span class="line"><span class="cl"><span class="c1">//  ID Bytes: 
</span></span></span><span class="line"><span class="cl"><span class="c1">//   History: 
</span></span></span><span class="line"><span class="cl"><span class="c1">//------------------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">SetForeColor</span><span class="p">(</span> <span class="n">cRed</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">char</span>     <span class="n">header</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="n">SetForeColor</span><span class="p">(</span> <span class="n">cNone</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span>     <span class="n">unknown</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">SetForeColor</span><span class="p">(</span> <span class="n">cYellow</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span>     <span class="n">pagesize</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">SetForeColor</span><span class="p">(</span> <span class="n">cPurple</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">string</span>  <span class="n">full_path1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">uint64</span> <span class="n">event_id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">reason_flags</span><span class="p">;</span>
</span></span></code></pre></div><p>The structure is however quite trivial. Following the header of 4 bytes and 4 bytes of some undocumented mysterious value, there are 4 bytes defining page size, the full path of the file and the event id of the event.</p>
<blockquote>
<p>❓ May be it&rsquo;s better to write a script for 010 Editor?</p>
</blockquote>
<h4 id="turning-off-logging">Turning Off Logging</h4>
<p>From Apple&rsquo;s official documentation:</p>
<blockquote>
<p>In some cases, the contents of a volume are sufficiently secret that it is not appropriate to log them. To disable logging on a per-volume basis (for creating a backup volume, for example), you must do the following:</p>
<ul>
<li><input disabled="" type="checkbox"> Create a <code>.fseventsd</code> directory at the top level of the volume.</li>
<li><input disabled="" type="checkbox"> Create an empty <code>no_log</code> file in that directory.</li>
</ul>
<p>So if your volume is mounted at <code>/Volumes/MyDisk</code>, you would create an empty file called <code>/Volumes/MyDisk/.fseventsd/no_log</code>.</p>
</blockquote>
<h4 id="problems">Problems</h4>
<p><strong>Problem #1.</strong> When the USB drive or another external media is not safely removed (by ejecting it properly, not just viciously unplugging it like a sword 🗡 from the corps by some primeval man from the Middle Ages), the fsevents will have no time to write to the file. If the device was unplugged too soon, this may also result in lost events (even if the sword analogy could not be applied here). If the FS on the device is incompatible, the same result you&rsquo;ll get.</p>
<p><strong>Problem #2.</strong> When several operations were performed on the same file or directory, there is only one record for that in the logs. I presume, as long as these events are sufficiently sparsed in memory, the get to different buffers, thus to different files and this would be the only way to observe changes.</p>
<blockquote>
<p>🧪 How long does it take for a fsevent buffer in memory to fill up?</p>
</blockquote>
<p><strong>Problem #3.</strong> They can be turned off. But that would require sufficient knowledge of logging system on macOS. Most users of macOS are not forensics experts, I presume. Not even hackers. Though there are many of them&hellip; However, even those are not experts in macOS.</p>
<p><strong>Problem #4.</strong> Fsevents logs do not keep timestamps. See the rightmost column. How&rsquo;s that likely, that all of these events have the EXACT same timestamp? Not very. That&rsquo;s <code>source_modified_time</code>. To overcome this limitation Ibrahim [<a href="http://www.osdfcon.org/presentations/2017/Ibrahim-Understanding-MacOS-File-Ststem-Events-with-FSEvents-Parser.pdf">1</a>] recommends using temporal data from the names of logs.</p>
<blockquote>
<p>🧪 Not quite sure what he meant by that&hellip; .</p>
</blockquote>
<blockquote>
<p>🧪 I presume, that&rsquo;s the date and time when the log files were created. Or is this the date and time when <code>FSEventsParser</code> was performing its duties?</p>
</blockquote>
<p><img src="timestamps.png" alt="timestamps"></p>
<h4 id="-trash-activity">🗑 Trash activity</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">SELECT
</span></span><span class="line"><span class="cl">*, _ROWID_ &#34;NAVICAT_ROWID&#34;
</span></span><span class="line"><span class="cl">FROM
</span></span><span class="line"><span class="cl">&#34;fsevents&#34;
</span></span><span class="line"><span class="cl">WHERE
</span></span><span class="line"><span class="cl">&#34;filename&#34; LIKE &#39;Users/%/.Trash/%&#39;
</span></span></code></pre></div><h4 id="unified-logs">Unified logs</h4>
<p><code>/private/var/db/diagnostics</code></p>
<h2 id="linux">Linux</h2>
<h3 id="varlog-"><code>/var/log</code> 🐧</h3>
<p><code>/etc/rsyslog.conf</code> - see the log owners, what specific logs are logging and where the additional configurations are stored.</p>
<p><code>cd rsyslog.d &amp;&amp; less 50-default.conf</code> - to see additional configurations: what specific logs are logging, how they are called and where to find them.</p>
<p><code>sudo less syslog</code> - most of the system logs.</p>
<p><code>auth.log</code> - authorisation messages</p>
<p><code>kern.log</code> - kernel messages</p>
<p>To configure what is being logged, how and when, go to <code>/etc/audit</code>. <code>apt-cache search auditd</code> (if it&rsquo;s not installed). <code>nano audit.rules</code> files to open. Config example:</p>
<ol>
<li><code>-w /etc/shadow</code> to keep track of the users added/deleted/modified. <code>w</code> - watch file:
<ol>
<li><code>-p</code> - watch for permission;</li>
<li><code>wa</code> - look for writes;</li>
<li><code>-k &lt;name&gt;</code> - give the name of this log entries.</li>
</ol>
</li>
<li><code>a always,exit</code> - look for actions:
<ol>
<li>generate alerts <code>always</code>;</li>
<li>look for specific syscall <code>-S clock_settime</code>;</li>
<li><code>-k &lt;name</code> - give the name of this log entries, for example, <code>timechange</code>.</li>
</ol>
</li>
</ol>
<p>To start auditing, run the daemon: <code>service auditd start</code>. The results are stored in <code>/etc/audit.log</code>.</p>
<h3 id="sysmon">Sysmon</h3>
<p>eBPF -&gt; <code>sysinternalsEBPF</code> (based on <code>libbpf</code>). eBPF allows programs to run in a sandbox within OS. Microsoft has customised it and <code>sysinternalsEBPF</code> was created to monitor security events on Linux.
<a href="https://github.com/Sysinternals/SysmonForLinux">https://github.com/Sysinternals/SysmonForLinux</a>, eForensics Magazine, Linux Forensics and Security, Enhance Visibility And detection On Linux With Sysmon, by Sergio Figueiredo.</p>
<h2 id="references">References</h2>
<details>
    <summary>Expand&hellip;</summary>
    <p><a href="https://xakep.ru/2021/09/16/linux-audit/">https://xakep.ru/2021/09/16/linux-audit/</a>
[<a href="http://www.osdfcon.org/presentations/2017/Ibrahim-Understanding-MacOS-File-Ststem-Events-with-FSEvents-Parser.pdf">1</a>] OSDFCon, Introduction to FSEvents</p>
<p>[<a href="https://developer.apple.com/library/archive/documentation/Darwin/Conceptual/FSEvents_ProgGuide/FileSystemEventSecurity/FileSystemEventSecurity.html">2</a>] Preventing File System Event Storage, official Apple docs</p>

</details>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.302a6fc365d5139fb98cf60bdb8f715d96257ea189161d36c190ccfa8182e569.js"></script>
  

  
  
  
    
  


</body>

</html>
