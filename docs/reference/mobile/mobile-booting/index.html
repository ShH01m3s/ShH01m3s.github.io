<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Booting Of Mobile Devices - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.9d91cbb32c96c334ae7b38c3d99d30727e0836e1182125cc5f007d215f0b9e59.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home üè°">
      <a href="/">
        <span>Home üè°</span>
      </a>
    </li>
    
    <li class="menu-item-blog ‚úçÔ∏è">
      <a href="/docs/blog">
        <span>Blog ‚úçÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-forensics üîç and incident response ü•∑">
      <a href="/docs/dfir">
        <span>Forensics üîç and Incident Response ü•∑</span>
      </a>
    </li>
    
    <li class="menu-item-crypto üóùÔ∏è">
      <a href="/docs/cryptography">
        <span>Crypto üóùÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-reverse üîß">
      <a href="/docs/reverse">
        <span>Reverse üîß</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit üß∞">
      <a href="/docs/toolkit">
        <span>Toolkit üß∞</span>
      </a>
    </li>
    
    <li class="menu-item-about me üßùüèΩ‚Äç‚ôÄÔ∏è">
      <a href="/docs/about">
        <span>About me üßùüèΩ‚Äç‚ôÄÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference üìö">
      <a href="/docs/notes">
        <span>Tech Reference üìö</span>
      </a>
    </li>
    
    <li class="menu-item-notes üìù">
      <a href="/docs/notes">
        <span>Notes üìù</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home üè°">
      <a href="/">
        <span>Home üè°</span>
      </a>
    </li>
    
    <li class="menu-item-blog ‚úçÔ∏è">
      <a href="/docs/blog">
        <span>Blog ‚úçÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-forensics üîç and incident response ü•∑">
      <a href="/docs/dfir">
        <span>Forensics üîç and Incident Response ü•∑</span>
      </a>
    </li>
    
    <li class="menu-item-crypto üóùÔ∏è">
      <a href="/docs/cryptography">
        <span>Crypto üóùÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-reverse üîß">
      <a href="/docs/reverse">
        <span>Reverse üîß</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit üß∞">
      <a href="/docs/toolkit">
        <span>Toolkit üß∞</span>
      </a>
    </li>
    
    <li class="menu-item-about me üßùüèΩ‚Äç‚ôÄÔ∏è">
      <a href="/docs/about">
        <span>About me üßùüèΩ‚Äç‚ôÄÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference üìö">
      <a href="/docs/notes">
        <span>Tech Reference üìö</span>
      </a>
    </li>
    
    <li class="menu-item-notes üìù">
      <a href="/docs/notes">
        <span>Notes üìù</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/reference/mobile/"> Back to Mobile Analysis Reference üìö Section üëàüèº </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#ios">iOS</a>
      <ul>
        <li><a href="#booting-of-application-processor">Booting of Application Processor</a></li>
        <li><a href="#bootrom">BootROM</a></li>
        <li><a href="#booting-of-secure-enclave">Booting of Secure Enclave</a></li>
      </ul>
    </li>
    <li><a href="#android">Android</a>
      <ul>
        <li><a href="#booting-process">Booting Process</a></li>
      </ul>
    </li>
    <li><a href="#other">Other</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
 </div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Booting Of Mobile Devices</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      <div class="article-category">domain: 
          
              
          <a class="category-link" href="/domain/general">general </a>
          
      </div> <br />
      
      <div class="article-category">doctype:
          
            
              
                <i class="fa fa-graduation-cap"></i>
              
          <a class="platform-link" href="/doctype/article">article</a>
          
      </div> <br /><br/>
      
      
      
      
      <div class="article-category">
          
            
            
            
            
              <i class="fas fa-mobile"></i>
            
            
          <a class="platform-link" href="/platforms/ios">ios</a>
          
            
            
            
            
              <i class="fas fa-mobile"></i>
            
            
          <a class="platform-link" href="/platforms/android">android</a>
          
      </div> <br />
      

      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <h2 id="ios">iOS</h2>
<p>When an iDevice is started, two separate booting processes are taking place: booting of Application Processor and booting of Secure Enclave.</p>
<h3 id="booting-of-application-processor">Booting of Application Processor</h3>
<p>Meaning, without Secure Enclave.</p>
<p>During each stage the current code checks the integrity of the following one. The stages are:</p>
<ul>
<li><input disabled="" type="checkbox"> BootROM</li>
<li><input disabled="" type="checkbox"> LLB</li>
<li><input disabled="" type="checkbox"> iBoot</li>
<li><input disabled="" type="checkbox"> Kernel</li>
</ul>
<h3 id="bootrom">BootROM</h3>
<ul>
<li><input checked="" disabled="" type="checkbox"> BootROM</li>
<li><input disabled="" type="checkbox"> LLB</li>
<li><input disabled="" type="checkbox"> iBoot</li>
<li><input disabled="" type="checkbox"> Kernel</li>
</ul>
<p>BootROM is an immutable code (i.e. it can&rsquo;t be changes for it&rsquo;s hardcoded on the chip during manufacturing). Therefore, since it can&rsquo;t be changed, it&rsquo;s implicitly trusted by other parts of the system. It&rsquo;s called <strong>root of trust</strong>.BooROM contains root certificates of Apple that are used to check the integrity of the code that follows. This portion is read-only. If there is a vulnerability in this code, Apple won&rsquo;t be able to fix it, since they will need to revise hardware. There are two BootROMs: old (before 2009) and new (after 2009). The first one has 0x24000 Segment Overflow that allowed a jailbreak. <a href="https://www.theiphonewiki.com/wiki/Bootrom">Read</a> about different BootROM versions.</p>
<h3 id="booting-of-secure-enclave">Booting of Secure Enclave</h3>
<h2 id="android">Android</h2>
<h3 id="booting-process">Booting Process</h3>
<p><img src="images/chart2.jpeg" alt="chart2"></p>
<p><strong>Step 1: Power On and System Startup</strong>. When we press the power button, the Boot ROM code starts executing from a pre-defined location which is hardwired in ROM. Boot ROM is an unchangeable small piece of code. It loads the Bootloader into RAM and starts executing.</p>
<p>**Step 2: Bootloader. **The bootloader is a small program which runs before Android (kernel) does. This is NOT part of the Android operating system. The bootloader is the place where manufacturer puts their locks and restrictions. So, it‚Äôs vendor specific. It‚Äôs not dependent on the OS version (Android 7 or 3 or something else). It‚Äôs something like BIOS on the PC.</p>
<blockquote>
<p>üìù <strong>NB!</strong> This piece of code is usually overwritten or patched to enable rooting. Sometimes it‚Äôs locked by vendors (Samsung, Google HTC, Xiami or etc). To unlock, you need to enable Developer‚Äôs mode and unlock OEM in Developer Settings.</p>
</blockquote>
<p><strong>The first stage.</strong> Bootloader detects external RAM and loads a program which helps on the second stage.<strong>The second stage</strong>. Bootloader setups the network, memory, etc, which requires to run kernel. The bootloader is able to provide configuration parameters or inputs to the kernel for specific purposes. The bootloader can be found at:</p>
<p><code>&lt;android source&gt;/bootable/bootloader/legacy/usbloader</code></p>
<p>This legacy loader contains 2 important files:</p>
<ul>
<li><strong>Init.s</strong> :: Initializes stacks, zeros the BSS segments and call_main() in main.c</li>
<li><strong>Main.c</strong> :: Initializes hardware (clocks, board, keyboard, console) and creates linux tags.</li>
</ul>
<p><strong>Step 3: Kernel</strong>. Since Android is based on Linux, Android kernel starts in a similar way as the Linux kernel. As the kernel launches, it starts to setup cache, protected memory, scheduling and loads drivers. When the kernel finishes the system setup, it looks for ‚Äúinit‚Äù in the system files (not the init mentioned above, for bootloader).</p>
<p><strong>Android vs Linux kerne</strong></p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td>Android specific interprocess communication mechanism and remote method invocation system</td>
<td style="text-align:left">binder</td>
</tr>
<tr>
<td>New shared memory allocator, similar to POSIX SHM but with a different behavior and sporting a simpler file-based API</td>
<td style="text-align:left">ashmem (Android Shared Memory)</td>
</tr>
<tr>
<td>&ldquo;Process memory allocator&rdquo;: It is used to manage large (1-16+ MB) physically contigous regions of memory shared between userspace and kernel drivers</td>
<td style="text-align:left">pmem</td>
</tr>
<tr>
<td>This is the kernel support for the logcat command</td>
<td style="text-align:left">logger</td>
</tr>
<tr>
<td>used for power management files. It holds the machine awake on a per-event basis until wakelock is released.</td>
<td style="text-align:left">wakelocks</td>
</tr>
<tr>
<td>kills processes as available memory becomes low</td>
<td style="text-align:left">oom handling</td>
</tr>
<tr>
<td>lets user space tell the kernel when it would like to wake up</td>
<td style="text-align:left">alarm manager</td>
</tr>
<tr>
<td>Allows to save kernel printk messages to a buffer in RAM, so that after a kernel panic they can be viewed in the next kernel invocation</td>
<td style="text-align:left">RAM_CONSOLE</td>
</tr>
<tr>
<td></td>
<td style="text-align:left">USB gadget driver for ADB</td>
</tr>
<tr>
<td></td>
<td style="text-align:left">yaffs2 flash filesystem</td>
</tr>
</tbody>
</table>
<p><strong>Step 4: init process</strong>.</p>
<p>Init is the very first process, we can say it is a root process, or the grandfather of all processes. The init process has two responsibilities:</p>
<ol>
<li>Mounts directories like <code>/sys</code>, <code>/dev</code> or <code>/proc</code></li>
<li>Runs <code>init.rc</code> script</li>
</ol>
<p><code>init</code> process can be found at <code>/init :: &lt;android source&gt;/system/core/init</code></p>
<p><code>init.rc</code> file can be found at <code> &lt;android source&gt;/system/core/rootdir/</code></p>
<p>Android has specific format and rules for init.rc files. More information about these rules can be found <a href="https://community.nxp.com/docs/DOC-102537">here</a>. At the end of this stage, you see the Android logo in your screen.</p>
<p><strong>Step 5: Zygote and Dalvik</strong></p>
<p>In Java, we know that a separate Virtual Machine (not sandbox, but JVM) instance will pop up in memory per app, but in the case of Android, the VM should run as quick as possible for an app. But what happens if you have several apps thus launching several instances of the Dalvik (VM)? It would consume an immense amount of memory.</p>
<p>To overcome this problem, the Android OS has a system called ‚Äú<strong>Zygote</strong>‚Äù. The Zygote enables code sharing across the Dalvik VM, achieving a lower memory footprint and minimal startup time. Zygote is a virtual machine process that starts at system boot. The Zygote preloads and initializes core library classes.</p>
<p>The Zygote loading process:</p>
<ol>
<li>Load <strong>Zygote Init class</strong>:<br>
<code>&lt;android source&gt;/frameworks/base/core/java/com/android/internal/os/ZygoteInit.java</code></li>
<li><code>registerZygoteSocket()</code>. It registers a server socket for zygote command connections.</li>
<li><code>preloadClasses()</code>. Is a simple text file that contains a list of classes that need to be preloaded, you can find the file at <code>&lt;android source&gt;/framework/base</code></li>
<li><code>preloadResources()</code>. Everything that is included in the android.R file will be loaded with this method (themes and layouts).</li>
</ol>
<p>At this time, you can see the boot animation.</p>
<p><strong>Step 6: System service</strong></p>
<p>After the above steps are completed, Zygote launches the system services. It forks a new process to launch the system services:</p>
<table>
<thead>
<tr>
<th>Core services</th>
<th>Other services</th>
</tr>
</thead>
<tbody>
<tr>
<td>Starting power manager</td>
<td>Starting status bar service</td>
</tr>
<tr>
<td>Creating the Activity Manager</td>
<td>Starting hardware service</td>
</tr>
<tr>
<td>Starting telephony registry</td>
<td>Starting NetStat service</td>
</tr>
<tr>
<td>Starting package manager</td>
<td>Starting connectivity service</td>
</tr>
<tr>
<td>Set activity manager service as system process</td>
<td>Starting Notification Manager</td>
</tr>
<tr>
<td>Starting context manager</td>
<td>Starting DeviceStorageMonitor service</td>
</tr>
<tr>
<td>Starting system contact providers</td>
<td>Starting Location Manager</td>
</tr>
<tr>
<td>Starting battery service</td>
<td>Starting Search Service</td>
</tr>
<tr>
<td>Starting alarm manager</td>
<td>Starting Clipboard Service</td>
</tr>
<tr>
<td>Starting sensor service</td>
<td>Starting checkin service</td>
</tr>
<tr>
<td>Starting window manager</td>
<td>Starting Wallpaper service</td>
</tr>
<tr>
<td>Starting Bluetooth service</td>
<td>Starting Audio Service</td>
</tr>
<tr>
<td>Starting mount service</td>
<td>Starting HeadsetObserver</td>
</tr>
<tr>
<td></td>
<td>Starting AdbSettingsObserver</td>
</tr>
</tbody>
</table>
<p>Voila, the booting process is completed!</p>
<p><strong>For analyzing the booting process on Linux host</strong>:</p>
<p><code>adb logcat ‚Äìd ‚Äìb events | grep ‚Äúboot‚Äùadb logcat ‚Äìd | grep preload</code></p>
<p><strong>For analyzing the booting process in PowerShell on Windows host:</strong></p>
<p><code>adb logcat ‚Äìd ‚Äìb events | Select-String -Pattern ‚Äúboot‚Äùadb logcat ‚Äìd | Select-String -Pattern preload</code></p>
<h2 id="other">Other</h2>
<h2 id="references">References</h2>
<p>[<a href="https://community.nxp.com/t5/i-MX-Processors-Knowledge-Base/The-Android-Booting-process/ta-p/1129182">1</a>] Booting scheme of an Android device</p>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.1237ff71925bb8625c97a9af8db4c54525258bedfd7c47493daaff723bea755e.js"></script>
  

  
  
  
    
  


</body>

</html>
