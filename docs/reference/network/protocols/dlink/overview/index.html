<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“š Overview - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.1a33f69c6ba75de251d7b8d58122c5ac0bd7166d83faea6fe23125361208be38.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting ğŸª¤">
      <a href="/docs/thunting">
        <span>Threat Hunting ğŸª¤</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference ğŸ“š">
      <a href="/docs/reference">
        <span>Tech Reference ğŸ“š</span>
      </a>
    </li>
    
    <li class="menu-item-notes ğŸ“">
      <a href="/docs/notes">
        <span>Notes ğŸ“</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting ğŸª¤">
      <a href="/docs/thunting">
        <span>Threat Hunting ğŸª¤</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference ğŸ“š">
      <a href="/docs/reference">
        <span>Tech Reference ğŸ“š</span>
      </a>
    </li>
    
    <li class="menu-item-notes ğŸ“">
      <a href="/docs/notes">
        <span>Notes ğŸ“</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/reference/network/protocols/dlink/"> ğŸ‘ˆğŸ¼ Back to </br> ğŸ“š Data Link Layer Protocols </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#vlan">VLAN</a></li>
    <li><a href="#routing-tables">Routing tables</a></li>
    <li><a href="#four-causes-of-troubles">Four causes of troubles</a></li>
    <li><a href="#collisions">Collisions</a></li>
    <li><a href="#devices">Devices</a>
      <ul>
        <li><a href="#hubs-and-repeaters">Hubs and Repeaters</a></li>
        <li><a href="#coax-cable">COAX Cable</a></li>
        <li><a href="#switch">Switch</a>
          <ul>
            <li><a href="#step-1-address-learning">Step 1 Address Learning</a></li>
            <li><a href="#step-2-forwarding-and-filtering">Step 2 Forwarding and Filtering</a></li>
            <li><a href="#step-3-loop-avoidance-optional">Step 3 Loop avoidance (optional)</a></li>
            <li><a href="#types-of-the-switches">Types of the switches</a></li>
          </ul>
        </li>
        <li><a href="#bridge">Bridge</a></li>
      </ul>
    </li>
    <li><a href="#promiscous-mode">Promiscous mode</a></li>
    <li><a href="#arp-protocol">ARP Protocol</a></li>
    <li><a href="#attacks">Attacks</a>
      <ul>
        <li><a href="#sniffing">Sniffing</a></li>
        <li><a href="#stp-mangling">STP-mangling</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">ğŸ“š Overview</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      <div class="article-category">domain: 
          
              
                <i class="fas fa-archive"></i>
              
          <a class="category-link" href="/domain/general">general</a>
          
      </div> <br />
      
      <div class="article-category">doctype:
          
            
              
                <i class="fa fa-graduation-cap"></i>
              
          <a class="platform-link" href="/doctype/article">article</a>
          
      </div> <br /><br/>
      
      
      
      

      
      

      
      <div class="article-tag">
          <i class="fas fa-tag"></i>
          
          
          <a class="tag-link" href="/tags/network" rel="tag">network</a>
          
           ,  
          <a class="tag-link" href="/tags/protocol" rel="tag">protocol</a>
          
      </div> 
      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <p><em>This is a protocol of TCP/IP suite, Data Link Layer. The first layer after physical layer is a data link layer and the protocol in use here is Ethernet II. Other protocols of this layer (not TCP/IP): . Network devices, protocols and attacks of the Data Link layer use a <strong>frame</strong> as a unit of information. The devices of this layer know nothing about IP addresses or TCP/UDP ports. They wouldn&rsquo;t know what to do with them since the protocols&rsquo; headers only contain MAC addresses.  MAC addresses is all they know and care about.</em></p>
<p>Each device in the network is recognized and identified by two basic pieces of information: IP address, MAC address. The service that is talking from that particular machine is recognized by TCP/UDP port and Application data (at the top of the OSI model).</p>
<h2 id="vlan">VLAN</h2>
<p>VLANs (broadcast domains) provide a way to separate LANs on the same switch. VLANs don&rsquo;t share broadcasts.</p>
<h2 id="routing-tables">Routing tables</h2>
<p>There are two different types of routes: local routes (directly connected to a switch or router) and those that use the default gateway. If a message is being sent to a computer that is identified in the computer&rsquo;s routing table, direct type of connection would be established. A gateway forwards messages coming from, or going to, external networks. Routing tables are maintained by all devices that are network connected (switches, routers, PCs, laptops etc). When Address Resolution Protocol (ARP) needs to send a message to a location that is outside its broadcast domain, it sends the message to the MAC address of the default gateway.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">netstat -nr <span class="c1"># Mac or Windows</span>
</span></span><span class="line"><span class="cl">ip route show <span class="c1"># router</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tracepath
</span></span><span class="line"><span class="cl">traceroute
</span></span><span class="line"><span class="cl">tracert
</span></span></code></pre></div><h2 id="four-causes-of-troubles">Four causes of troubles</h2>
<ol>
<li>Collisions</li>
<li>Signal reflection</li>
<li>Electrical noise</li>
<li>Hard Malfunctions</li>
</ol>
<h2 id="collisions">Collisions</h2>
<p>There are two types of collisions: early and late.</p>
<h2 id="devices">Devices</h2>
<h3 id="hubs-and-repeaters">Hubs and Repeaters</h3>
<p>These are the devices of physical layer, but I&rsquo;m mentioning them here because it might be confusing. Well, at least, I&rsquo;ve found it to be confusing. They don&rsquo;t read anything actually, their sole purpose is to send the data forward. Each device is connected to some port of a hub or repeater. When there is some data arriving to a hub, it&rsquo;s sent over to all connected hosts. It&rsquo;s like broadcasting. However, if the packet was not for your MAC, the PC&rsquo;s network card will reject it. Unless you have a sniffing library and tool to actually see them. That why if the hacker is connected to a hub, repeater ot COAX cable they will see all the traffic. Which is not the case with a switch.</p>
<p>The computers (nodes) connect to the hub using Unshielded Twisted Pair cable (UTP).</p>
<h3 id="coax-cable">COAX Cable</h3>
<p>A cable has two terminating resistors (50 Ohm) so that the data is not reflected back. 1 segment of such a cable can be at most 185 meters and have 30 PCs connected to it.</p>
<h3 id="switch">Switch</h3>
<p>Unlike a <a href="">hub</a>, a switch diffirentiates between the packets and forwards the packets according to the MACs specified in the frame. They keep track of MACs and corresponding switch ports in a MAC filtering table (can hold upto 8000 MAC addresses) once they learn these MACs. Use ASIC&rsquo;s (Application Specific Integrated Curcuits). They are faster than routers, cause they don&rsquo;t analyse IP layer =&gt; 1 thing less to do, 1 second faster ğŸ˜¸. So they work at wire speed.</p>
<p><strong>Steps</strong>:</p>
<ul>
<li>Learn the addresses</li>
<li>Forward and filter decisions</li>
<li>Loop avoidance</li>
</ul>
<h4 id="step-1-address-learning">Step 1 Address Learning</h4>
<p>When the switch is new in the district and doesn&rsquo;t know anyone yet, it looks pretty much the same as an ordinary hub (see <a href="">here</a>). But unlike a hub this switch has a notebook ğŸ““ (empty yet) and a pen ğŸ–Š . It&rsquo;s called <em>the MAC filtering table</em>. The switch ğŸ§‘â€ğŸ’¼is sitting still until someone comes up with a request. It&rsquo;s sitting in a big building with lots of cubicles (very long time ago that was what it looked like when someone wanted to make a call to another city). For the switch ğŸ§‘â€ğŸ’¼all these cubicles are assigned a number.</p>
<p>For example, PC1 ğŸ–¥ with MAC address <code>aa:aa:aa:aa:aa:aa</code> comes by and asks to send a frame to PC6 ğŸ–¥ with MAC <code>bb:bb:bb:bb:bb:bb</code>. The switch doesn&rsquo;t know who is who yet. He says:</p>
<p>- Hey, PC1 ğŸ–¥  with MAC address <code>aa:aa:aa:aa:aa:aa</code>. Nice to meet you. I will write your MAC in my notebook ğŸ““ and you go and wait in the cubicle number <code>1</code>. I&rsquo;ll let you know the response as soon as I get it.</p>
<p>- OK, - says PC1 ğŸ–¥  and enters a cubicle <code>1</code>.</p>
<p>The switch now puts <code>1</code> in front of PC1&rsquo;s MAC address. Now, the job of the switch ğŸ§‘â€ğŸ’¼is to find PC6 with MAC <code>bb:bb:bb:bb:bb:bb</code> and assign a cubicle to it as well.</p>
<p><em>How can it achieve that?</em></p>
<p>The first option is to to ask every machine in the neighbourhood until it finally finds its fellow, using, for example, something like ARP protocol but for Data Link layer. But this would take <code>O(n)</code> time for <code>n</code> machines. The more machines are in the district, the more time is needed to asks everyone. The worst case is when the machine needed is the last asked (that&rsquo;s why <code>O(n)</code>).</p>
<p>The second option is the one actually being used. The switch ğŸ§‘â€ğŸ’¼sends this frame from PC1 to <strong>every</strong>  machine in the neighbourhood (yes, it&rsquo;s a violation of confidentiality&hellip;). It&rsquo;s called <em>broadcasting</em>. Whoever responds - is PC6.</p>
<p><img src="images/1.png" alt="img"></p>
<p>The switch ğŸ§‘â€ğŸ’¼now puts down its MAC (<code>bb:bb:bb:bb:bb:bb</code>) and assigns it to the cubilcle #<code>4</code> .</p>
<p><img src="images/2.png" alt="img"></p>
<p>PC6 ğŸ–¥ goes to the cubicle <code>4</code>, reads the frame from PC1 and sends a response. Now the switch checks against his doodle (which indicate that PC1 is in the cubicle <code>1</code>) and delievers the response to the cubicle <code>1</code> where PC1 is still waiting ğŸ–¥  (and <del>not</del> picking up his nose â“).</p>
<p><img src="https://media.giphy.com/media/xT0xeuS2LbEKg71qfe/giphy.gif" alt="img"></p>
<p>From now on all frames between PC1 and PC6 will be forwarded without prior flooding and violating the confidentiality.</p>
<p><img src="images/3.png" alt="img"></p>
<h4 id="step-2-forwarding-and-filtering">Step 2 Forwarding and Filtering</h4>
<p>The destination is known, forward to the correct port. If the destination is not known yet, find out and assing a port to that address.</p>
<h4 id="step-3-loop-avoidance-optional">Step 3 Loop avoidance (optional)</h4>
<p>For redundant switches (additional switches to provide redundancy in case one fails). STP (spanning tree protocol provides protection for such cases). STP finds redundant links and shuts them down.</p>
<p><strong>Broadcast storm</strong>.</p>
<p>First, what&rsquo;s a <strong>MAC</strong>? MAC - it&rsquo;s an identifier of the machine on the network. It&rsquo;s specified in a frame (a message one PC sends to another) for the network devices managing the delivery of these messages to know, where to send this message and for the receiver to know this is meant for him. While IPs (upper layers of OSI) can be shared among several devices, MACs can not.</p>
<p>Secondly, what&rsquo;s a <strong>broadcast</strong>? It means <em>&ldquo;Tell everyone&rdquo;</em>. To specify that this message is destined for everyone, a machine puts MAC address <code>FF:FF:FF:FF:FF:FF</code> (it was agreed by the techies community) in the frame header. When a network device (router, switch, bridge etc) receives a frame with this <strong>precise</strong> MAC address, it knows it should forward it to everyone connected to this network. When a PC&rsquo;s NIC (network card) gets such a frame, it reads it as if it were sent to its own MAC. So, PC&rsquo;s NIC will read only frames with its own MAC and with <code>FF:FF:FF:FF:FF:FF</code> (if it&rsquo;s not running in the promiscuous mode).</p>
<p>If you only have one switch ğŸ‘¨â€ğŸ¨, it may go ill ğŸ¤§ and stop working. The whole network will then go down. It&rsquo;s not a desired behaviour and needs to be though of. So, we add a second switch to the network ğŸ‘¨â€ğŸ³ . Sounds great? Well, it is if your switch supports STP, but what happens if it doesn&rsquo;t?</p>
<p>Let&rsquo;s assume the following infrastructure:</p>
<p><img src="images/4.png" alt="img"></p>
<p>There are two cables. One connecting PC1 ğŸ’» ,2ğŸ’» and 3ğŸ’», another - PC4 ğŸ–¥ ,5ğŸ–¥ and 6ğŸ–¥. All of these PC&rsquo;s are in the same LAN (they know each other pretty well and receive the same broadcast messages) and the cables are connected with two switches: the switch #1 ğŸ‘¨â€ğŸ¨ and the switch #2 ğŸ‘¨â€ğŸ³ . Both switches have their first ports connected to the upper cable (#1) with the green PCs 1,2,3 and their second ports to the lower cable (#2) with the purple PCs 4,5,6.</p>
<p>For some reason, PC1 ğŸ’» decides to send a broadcast &ldquo;<em>Hey, guys! Check out this beautiful spam letter!</em>&rdquo; (see the blue arrow #1 in the picture below):</p>
<p><img src="images/5.png" alt="img"></p>
<p><em>So, what happens next? Where is the problem with this?</em></p>
<p>This message reaches the first port of the switch #1 ğŸ‘¨â€ğŸ¨. The switch #1 ğŸ‘¨â€ğŸ¨ forwards this message to all purple PC&rsquo;s.  This messages runs happily along the wire, being delievered to the PCs of the second cable and also to the second port of the switch #2 ğŸ‘¨â€ğŸ³. Observe the green dashed arrow #2 on the picture below. By now, the switch #1 ğŸ‘¨â€ğŸ¨ , the switch #2 ğŸ‘¨â€ğŸ³ and each of the pink PCs have received this message only once (see the red counter in front of each on the picture below). So, each of the PCs on the network (except, of course, PC1 who sent this spam and obviuosly finds it interesting) is facepalming ğŸ¤¦â€â™€ for the first time.</p>
<p><img src="images/5.png" alt="img"></p>
<p>The switch #2 ğŸ‘¨â€ğŸ³ is very responsible and forwards this message back to the realm of the green PCs (where this message has originally been sent from). Now, this ridiculous message is sent along the wire #1 and reaches PC1 (which has sent it), PC2 and PC3 and also the first port of the brother-switch #1 ğŸ‘¨â€ğŸ¨. This is what the blue dashed arrow #3 shows on the picture below. It&rsquo;s just started smelling very bad ğŸ‘ƒ &hellip; .</p>
<p><img src="images/6.png" alt="img"></p>
<p>The switch #1 ğŸ‘¨â€ğŸ¨ re-sends this broadcast to the purple PCs connected to its port #2. The switch #2 ğŸ‘¨â€ğŸ³ receives it as well (see the pink dashed arrow #4 on the picture above) and re-sends it to its first port. From the first port it is then sent to the green PCs 1,2,3 and the first port of the switch #1 ğŸ‘¨â€ğŸ¨ . This is what the arrow #5 shows on the picture above. By now, the switch #1 and each of the green PCs has received this message three times, the switch #2 and each of the purple PCs has received this stupid message twice.</p>
<p>Now, re-read paragraphs 1 and 2, the re-read again and again and again&hellip;  ğŸ˜„. This goes on and on infinitely&hellip;. Each time the switch #1 ğŸ‘¨â€ğŸ¨ receives this broadcast, it re-sends it to the purple PCs and the switch #2 ğŸ‘¨â€ğŸ³. Everytime the switch #2 ğŸ‘¨â€ğŸ³, in turn, receives this message, it re-sends it to the green PCs and the switch #1 ğŸ‘¨â€ğŸ¨. Facepalming is not that funny anymore and all the digital guys start feeling uncomfortable and scared ğŸ˜±. The both switches at the same time are ğŸ¤·â€â™‚ ğŸ¤·â€â™‚ and keep doing somethin suspicious. The worst thing is that the switches are so busy doing something  weird and useless, that they don&rsquo;t have time to actually do the serious and important stuff ğŸ¤ .</p>
<p>That&rsquo;s what&rsquo;s called a <strong>broadcast storm</strong>. In the real world dwelled with people, once someone receives the message twice, he or she usually says <em>&ldquo;I&rsquo;ve already heard that&rdquo;</em>. This saves him or her from further bothering. That&rsquo;s why STP (<strong>S</strong>panning <strong>T</strong>ree <strong>P</strong>rotocol) was invented for for network devices.</p>
<h4 id="types-of-the-switches">Types of the switches</h4>
<p><strong>Store &amp; Forward</strong></p>
<p>The most popular mode and the one which has the highest latency. In this mode the whole frame is stored in a buffer and checked for errors before forwarding. Because of this additional work, the latency gets higher.</p>
<p>According to <a href="http://www.firewall.cx/networking-topics/general-networking/236-switches-bridges.html">firewall.cx</a>, this table represents min RAM needed for this mode on the switch not to cause you troubles:</p>
<table>
<thead>
<tr>
<th style="text-align:left">NUMBER OF PORTS</th>
<th style="text-align:left">MINIMUM RAM</th>
<th style="text-align:left">PREFERRED RAM</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">5</td>
<td style="text-align:left">256 Kb</td>
<td style="text-align:left">512 Kb</td>
</tr>
<tr>
<td style="text-align:left">8</td>
<td style="text-align:left">512 Kb</td>
<td style="text-align:left">1-2 Mb</td>
</tr>
<tr>
<td style="text-align:left">16</td>
<td style="text-align:left">2 Mb</td>
<td style="text-align:left">4-6 Mb</td>
</tr>
<tr>
<td style="text-align:left">24</td>
<td style="text-align:left">4 Mb</td>
<td style="text-align:left">6-8 Mb</td>
</tr>
</tbody>
</table>
<p><strong>Cut-through</strong></p>
<p>Second popular option. Only reads the frame until the destination MAC is detected. Doesn&rsquo;t check for errors.</p>
<p><strong>Fragment free</strong></p>
<p>Reads the first 64 bytes only (min frame size). The reason for this is because almost all collisions will happen within the first 64 bytes of a frame. Not very popular.</p>
<p>Problems with switches:</p>
<p>Network loops (resolved with spanning tree protocols), might not improve traffic with broad- and multicast. Cannot connect geographically dispersed networks.</p>
<h3 id="bridge">Bridge</h3>
<p>Bridges are pretty much the same, but have a few differences:</p>
<ul>
<li>Bridges are software based, while switches are hardware based because they use an ASICs chip to help them make filtering decisions â“</li>
<li>Bridges can only have one spanning-tree instance per bridge, while switches can have many â“</li>
<li>Bridges can only have upto 16 ports, while a switch can have hundreds. Why? â“</li>
</ul>
<h2 id="promiscous-mode">Promiscous mode</h2>
<p>NIC (network card) can operate in this mode and process all packets that it recieves. The packet&rsquo;s destination is determined by MAC address, however, I&rsquo;m putting this here for reference.</p>
<h2 id="arp-protocol">ARP Protocol</h2>
<p>This is not a protocol of a data link layer of TCP/IP stack. It&rsquo;s not on any layer per se. However, I&rsquo;m putting this paragraph here because ARP is needed for filling in Ethernet header details.</p>
<h2 id="attacks">Attacks</h2>
<h3 id="sniffing">Sniffing</h3>
<p>What&rsquo;s sniffing?</p>
<p>CAM (Content Addressable Memory) - switch keeps a record of all MACs of connected devices and their assigned virtual ports on that switch in a table:</p>
<table>
<thead>
<tr>
<th>MAC</th>
<th>Switch port</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>1111:1111:0000:2222</code></td>
<td><code>12</code></td>
</tr>
</tbody>
</table>
<p><strong>Flooding with 1 MAC</strong>. Send lots of ARP reply to constantly update 1 entry (race condition). Whenever the MAC in CAM table is substututed with the attacker&rsquo;s MAC, the responses will be redirected to the attacker. As soon as the victim sends a new request to some server through the switch, its MAC overwrites the attacker&rsquo;s. So it looks like a battle for 1 &ldquo;seat&rdquo;.</p>
<p><strong>Flooding with different random MACs</strong>. Turning switch into a hub by flooding it with lots of ARP reply sending lots of random addresses and overflowing the CAM table. Uncapable of coping with such a flood, the switch is turned into a hub.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># flood with random MACs</span>
</span></span><span class="line"><span class="cl">macof -i eth1 -n10 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># targeted flooding</span>
</span></span><span class="line"><span class="cl">macof -i eth1 -d 192.168.1.1
</span></span></code></pre></div><p><strong>Span port</strong>. This is an option that can be turned on in the switch&rsquo;s configs. Each request and response is copies and sent to the span port as well. Sometimes, switches only allow listening on the span port.</p>
<p>CISCO config example</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">monitor session <span class="m">1</span> <span class="nb">source</span> interface fastethernet 0/1
</span></span><span class="line"><span class="cl">- <span class="nb">source</span> port <span class="k">for</span> monitoring
</span></span><span class="line"><span class="cl">monitor session <span class="m">1</span> destination interface fastethernet 0/24
</span></span><span class="line"><span class="cl">- destination port 
</span></span></code></pre></div><p><strong>ARP poisoning</strong>. This attack poisons an ARP cache of a target machine. If attacker succeeds in overwriting an ARP entry for the default gateway with its own MAC, all traffic will be redirectied to the attacker.</p>
<p>ARP cache is not the same as CAM table.</p>
<p><img src="images/1.png" alt="1"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># flood Bob (192.168.1.4) with ARP replies stating that the attacker has 192.168.1.1</span>
</span></span><span class="line"><span class="cl">arpspoof -i eth0 -t 192.168.1.4 192.168.1.1
</span></span><span class="line"><span class="cl"><span class="c1"># ARP cache of 192.168.1.4 is now as follows: cc:cc:cc:cc:cc:cc = 192.168.1.1.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># flood the GW i.e. gateway (192.168.1.1) with ARP replies stating that the attacker has 192.168.1.4</span>
</span></span><span class="line"><span class="cl">arpspoof -i eth0 -t 192.168.1.1 192.168.1.4
</span></span><span class="line"><span class="cl"><span class="c1"># ARP cache of 192.168.1.1 is now as follows: cc:cc:cc:cc:cc:cc = 192.168.1.4.</span>
</span></span></code></pre></div><p><strong>MAC spoofing</strong>. Change the attacker&rsquo;s original MAC to the victim&rsquo;s locally. For example, in the registry on a Windows machine:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">HKEY_LOCAL_MACHINE<span class="se">\S</span>YSTEM<span class="se">\C</span>urrentControlSet<span class="se">\C</span>ontrol<span class="se">\C</span>lass<span class="se">\4</span>d36e972-e325-11ce-bfc1-08002be103d8 SMAC
</span></span></code></pre></div><p>Or in the command line (Linux):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># disconnect from wlan1</span>
</span></span><span class="line"><span class="cl">ifconfig wlan1 down 
</span></span><span class="line"><span class="cl"><span class="c1"># or</span>
</span></span><span class="line"><span class="cl">ip link <span class="nb">set</span> wlan1 down
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># * optionally</span>
</span></span><span class="line"><span class="cl"><span class="c1"># find MAC for specific vendor</span>
</span></span><span class="line"><span class="cl">macchanger -l 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># change mac for wlan1</span>
</span></span><span class="line"><span class="cl">macchanger -r wlan1
</span></span><span class="line"><span class="cl">macchanger -m aa:bb:cc:dd:ee:ff
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># connect to wlan1 with the new MAC</span>
</span></span><span class="line"><span class="cl">ifconfig wlan1 up
</span></span><span class="line"><span class="cl"><span class="c1"># or </span>
</span></span><span class="line"><span class="cl">ip link <span class="nb">set</span> wlan1 up
</span></span></code></pre></div><p><strong>IRDR spoofing</strong>. Send spoofed ICMP Router Discover Protocol advertising GW (gateway) to start routing through for victims.</p>
<h3 id="stp-mangling">STP-mangling</h3>
<p>â“â“â“â“</p>
<p>Attacker is elected as the new root bridge of the spanning tree:</p>
<ol>
<li>forge BPDUs (Bridge Protocol Data Unit) with high priority assuming to be the new root</li>
<li>Broadcast STP Config/Topolgy Change ACK BPDUs to get his host elected as the new root bridge.</li>
</ol>
<p>Being the bridge root Eve can intercept all traffic.</p>
<p>How to detect - <a href="http://www.firewall.cx/general-topics-reviews/network-protocol-analyzers/1113-capsa-network-analyzer-discover-arp-attacks-flooding.html">http://www.firewall.cx/general-topics-reviews/network-protocol-analyzers/1113-capsa-network-analyzer-discover-arp-attacks-flooding.html</a></p>
<h2 id="references">References</h2>
<p>Firewall.cx</p>
<p>[1] About switches and bridges - <a href="http://www.firewall.cx/networking-topics/general-networking/236-switches-bridges.html">http://www.firewall.cx/networking-topics/general-networking/236-switches-bridges.html</a></p>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.302a6fc365d5139fb98cf60bdb8f715d96257ea189161d36c190ccfa8182e569.js"></script>
  

  
  
  
    
  


</body>

</html>
