<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📚 ICMP - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/reference/network/protocols/netlayer/"> 👈🏼 Back to </br> 📚 Network Layer Protocols </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#message-types">Message Types</a>
      <ul>
        <li><a href="#08-echo-reply-and-echo">0/8 Echo Reply and Echo</a></li>
        <li><a href="#3-destination-unreachable">3 Destination unreachable</a></li>
        <li><a href="#4-source-quench-message">4 Source Quench Message</a></li>
        <li><a href="#5-redirect">5 Redirect</a></li>
        <li><a href="#11-time-exceeded-message">11 Time Exceeded Message</a></li>
      </ul>
    </li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">📚 ICMP</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      

      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <p>ICMP protocol is needed for troubleshooting.</p>
<p>For an TCP/IP stack here is what ICMP request looks like in a frame:</p>
<p><img src="icmp_request_packet.png" alt="icmp_request_packet"></p>
<p>Even though ICMP belongs itself to the network layer.</p>
<p>If there is some problem during any requst (HTTP, FTP or any other request on any other layer), ICMP error response might be sent. Its type can help in troubleshooting.</p>
<h2 id="message-types">Message Types</h2>
<p>Each message type will have a different header.</p>
<h3 id="08-echo-reply-and-echo">0/8 Echo Reply and Echo</h3>
<p>This message can be triggered with a <code>ping</code> command. It this case of type 0 (Echo reply) identifier will match that of the corresponding Echo&rsquo;s message (request). It&rsquo;s the only message type that is not seen in the normal traffic flow unless it&rsquo;s a <code>ping</code> command. Here is the header:</p>
<p><img src="type08.png" alt="type08"></p>
<p>I&rsquo;ve <code>ping</code>ed <code>firewall.cx</code> and here is the result, that can help mathcing this theoretical information to the real life example:</p>
<p><img src="ping_terminal.png" alt="ping_terminal"></p>
<p>First, DNS name must be resolved from <code>firewall.cx</code> to <code>162.254.144.167</code>. Then,  the requests sent. On Windows 4 packets are sent by default, on UNIX systems they just keep being sent until you stop it maually (<code>^C</code>).</p>
<p>Variable data in my case (macOS <code>ping</code>) is the following sequence of bytes:
<code>0030        08 09 0a 0b 0c 0d 0e 0f 10 11 12 13 14 15 0040   16 17 18 19 1a 1b 1c 1d 1e 1f 20 21 22 23 24 25 0050   26 27 28 29 2a 2b 2c 2d 2e 2f 30 31 32 33 34 35 0060   36 37</code> which is mostly garbage and ASCII chars from <code>!</code> to number <code>7</code>. I don&rsquo;t know what would that be for another machine.</p>
<h3 id="3-destination-unreachable">3 Destination unreachable</h3>
<p>Here is the header structure specific for this message type:</p>
<p><img src="type3.png" alt="type3"></p>
<table>
<thead>
<tr>
<th>Code</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>🍊 <em>Network unreachable</em>.  Gateway doesn&rsquo;t know, how to get to the network in question. May be something is wrong with the IP tables?</td>
</tr>
<tr>
<td>1</td>
<td>🍊 <em>Host unreachable</em>. Remote gateway doesn&rsquo;t know where the host is.</td>
</tr>
<tr>
<td>2</td>
<td>🍏 <em>Protocol unreachable</em>.</td>
</tr>
<tr>
<td>3</td>
<td>🍏 <em>Port unreachable</em>. Service listening on this port might be down. Port closed by client.</td>
</tr>
<tr>
<td>4</td>
<td>🍊 <em>Fragmentation needed</em>. However, DF is set.</td>
</tr>
<tr>
<td>5</td>
<td>🍊 <em>Source route failed</em>.</td>
</tr>
<tr>
<td>6</td>
<td><em>Network unknown</em>.</td>
</tr>
<tr>
<td>7</td>
<td><em>Host unknown</em>.</td>
</tr>
<tr>
<td>8</td>
<td>???</td>
</tr>
<tr>
<td>9</td>
<td><em>Network admin prohibited</em>.</td>
</tr>
<tr>
<td>10</td>
<td><em>Host admin prohibited</em>.</td>
</tr>
<tr>
<td>11</td>
<td>???</td>
</tr>
<tr>
<td>12</td>
<td>???</td>
</tr>
<tr>
<td>13</td>
<td><em>Communication admin prohibited</em>. Filtered by firewall.</td>
</tr>
</tbody>
</table>
<p>🍊 - can be received from a gateway.</p>
<p>🍏 - can be received from a host.</p>
<p>Internet header 32 bits + 62 bit of data. It means that the header that in the request (for troubleshooting).</p>
<p>It may be received, for example, if a DNS service is unavailable and DNS queries fail. When DNS fail, a Windows machine might fall back to NetBIOS.</p>
<h3 id="4-source-quench-message">4 Source Quench Message</h3>
<p>Generated only by the gateway or destination host when it can&rsquo;t keep up with the traffic. There are several reasons for this message to appear:</p>
<ol>
<li>Gateway or host doesn&rsquo;t have enough buffer to queue the datagram.</li>
<li>Datagrams arrive to fast.</li>
<li>The PC approaches its capacity limit.</li>
</ol>
<p><img src="type4.png" alt="type4"></p>
<p>Internet header 32 bits + 62 bit of data. It means that the header that in the request (for troubleshooting).</p>
<h3 id="5-redirect">5 Redirect</h3>
<p>Imagine you have a problem. For example, you&rsquo;ve broken your PC and there is none who could help. However, your spouse or a friend knows someone and calls him or her. The person on the phone ☎️ wants to speak directly to you since you are close and it&rsquo;s your PC anyway. That&rsquo;s roughly how it looks like in this situation.</p>
<p><img src="redirect.png" alt="redirect"></p>
<p>The header is slightly different from Type 4 and 3, but not drastically. Gateways to talk to is specified instead of unused 32 bits in the cases above.</p>
<p><img src="type5.png" alt="type5"></p>
<h3 id="11-time-exceeded-message">11 Time Exceeded Message</h3>
<p>For gateways and routers (code 0) and hosts (code 1).</p>
<p><img src="type11.png" alt="type11"></p>
<p>As you might remember, <strong>TTL field</strong> (see the screeshot from <code>ping</code> command) means <em>time to live</em>. But does <em>that</em> mean? To avoid any loops when two are just saying something over and over again in an endless loop, this field was intriduced. Originally it&rsquo;s set to some value (64 in the above case). Each hop (when the message is redirected by a host or gateway) this field is decremented by 1. So, there can be at most 64 hosts between the sender and the receiver. If there are more and TTL is out, message is discarded and ICMP Type 11 Code 0 is sent. This is usually a case for routers and gateways.</p>
<p><img src="https://media2.giphy.com/media/l4JyJjtCP9KkCF5T2/giphy.gif?cid=ecf05e472jzusziy7ao3qoskus8tjxe4zx48t579z4av1044&amp;rid=giphy.gif&amp;ct=g" alt="img"></p>
<p><strong>Fragmented flag of IP header</strong>.  If a host is reassembling datagrams and misses parts, it sends this message in return and discard what&rsquo;s already assembled and an ICMP message Type 11 Code 1 is sent in return.</p>
<p><img src="https://media0.giphy.com/media/iD7j8q3eH4Co9MHhmt/giphy.gif?cid=ecf05e47r4iqgpdzhi9o11bti325l3xna6ihxsd02ynf8lwf&amp;rid=giphy.gif&amp;ct=g" alt="img"></p>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.bafc052229b4b40bf03c477d31c5cdd9352ece8afbadf35ab97ed14495098fc9.js"></script>
  

  
  
  
    
  


</body>

</html>
