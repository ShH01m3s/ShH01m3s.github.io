<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Web Application basics - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting ğŸª¤">
      <a href="/docs/thunting">
        <span>Threat Hunting ğŸª¤</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference ğŸ“š">
      <a href="/docs/reference">
        <span>Tech Reference ğŸ“š</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting ğŸª¤">
      <a href="/docs/thunting">
        <span>Threat Hunting ğŸª¤</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference ğŸ“š">
      <a href="/docs/reference">
        <span>Tech Reference ğŸ“š</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/reference/network/"> ğŸ‘ˆğŸ¼ Back to </br> ğŸ“š Network </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#sop-vs-cors">SOP vs CORS</a>
      <ul>
        <li><a href="#sop">SOP</a></li>
        <li><a href="#relax-sop">Relax, SOP&hellip;</a></li>
        <li><a href="#cors">CORS</a></li>
        <li><a href="#hsts">HSTS</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Web Application basics</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      

      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <p><em>This is about &hellip; .</em></p>
<h2 id="sop-vs-cors">SOP vs CORS</h2>
<p><img src="images/anakin-vs-obivan.jpg" alt="img"></p>
<h3 id="sop">SOP</h3>
<p>Basically, SOP says &ldquo;You can&rsquo;t manipulate resources belonging to other websites, you must remain here at all times. Play with your toys only&rdquo;. It is some sort of a sandbox.</p>
<p>Let&rsquo;s have a look at an example. Let&rsquo;s take two websites: <code>bakerst221b.com</code> and <code>richmond65a.com</code>. The javascript on <code>bakerst221b.com</code> wants to have access to something on <code>richmond65a.com</code>. What does it have access to and what does it not have access to?</p>
<ol>
<li><strong>Cookies</strong> ğŸª -&gt; NO!!! Cookies are like temp keys. While temporary, these are still keys which can be used to open doors. Once the door is open, all sorts of nasty stuff can happen and we don&rsquo;t want that. That&rsquo;s the whole point why SOP was created in the first place. â—ï¸For the usability purposes, cookies can be accessed by other subdomains although it might pose some risks. In order to partially mitigate it, use <code>HttpOnly</code> flag when creating a cookie.</li>
<li><strong>Videos</strong> ğŸ¥.</li>
<li><strong>Pictures</strong> ğŸŒ‡.</li>
<li><strong>Another script</strong> ğŸ“.</li>
</ol>
<p><img src="images/sop1.png" alt="img"></p>
<p>Ok. The website <a href="https://bakerst221b.com">https://bakerst221b.com</a> can have videos, pictires and sctipts from the richmond website loaded on its page.</p>
<p><img src="images/sop2.png" alt="img"></p>
<p>But what&rsquo;s interesting, it still can&rsquo;t ACCESS them.</p>
<p><img src="images/sop3.png" alt="img"></p>
<h3 id="relax-sop">Relax, SOP&hellip;</h3>
<ol>
<li>Cookies can be accessed by subdomains (unless <code>HttpOnly</code> is set)</li>
<li><code>document.domain</code> is set to the same domain to show the browser it&rsquo;s ok, but only if both are parts of the same FQDN.</li>
<li>CORS.</li>
</ol>
<h3 id="cors">CORS</h3>
<p>What fun would it be if the rules didn&rsquo;t have some exceptions? CORS is basically as way to circumvent overly strict SOP and allow something to be accessed cross-origin.</p>
<p>When seeing some cross-origin request, user&rsquo;s browser first sends a preflight request to check if it&rsquo;s allowed to do so. And here is the biggest trick. There are simple and &ldquo;complex&rdquo; requests. When something happens WITHOUT javascript (html only), the requests generated are ALWAYS simple. That means that without javascript code one CAN&rsquo;T make a non-simple request. What do I call non-simple? Let&rsquo;s start with what&rsquo;s simple first.</p>
<ol>
<li><strong>Methods</strong>: <code>GET</code>, <code>HEAD</code> and <code>POST</code></li>
<li><strong>Headers</strong>: no custom headers (including those starting with <code>X-</code>)</li>
<li><strong>Content type</strong>: <code>application/x-www-form-urlencoded</code>, <code>multipart/form-data</code>, or <code>text/plain</code>.</li>
</ol>
<p>Note that ALL of the requierements above need to be satisfied. Non-simple are basically everything <strong>else</strong>. The reason why simple requests do not require a preflights is because they relatively safe. Since you can&rsquo;t set headers, change content-type or use other methods from plain html, and the request is constructed automatically by the browser, it&rsquo;s relatively safe. You might ask if cookies are sent this way.</p>
<p>The most important header is <code>Access-Control-Allow-Origin</code>, it says which origins can make the cross-origin requests. Another header to be mindful is <code>Access-Control-Allow-Credentials</code>, when set to <code>true</code>.</p>
<p>Here is an example of the request:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">OPTIONS /api/resource HTTP/1.1
</span></span><span class="line"><span class="cl">Host: example-server.com
</span></span><span class="line"><span class="cl">Origin: https://example-client.com
</span></span><span class="line"><span class="cl">Access-Control-Request-Method: PUT
</span></span><span class="line"><span class="cl">Access-Control-Request-Headers: X-Auth-Token
</span></span></code></pre></div><p>In the response, the server will tell the broser what&rsquo;s allowed and what&rsquo;s not:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">HTTP/1.1 <span class="m">200</span> OK
</span></span><span class="line"><span class="cl">Access-Control-Allow-Origin: https://example-client.com
</span></span><span class="line"><span class="cl">Access-Control-Allow-Methods: PUT, POST, GET, OPTIONS
</span></span><span class="line"><span class="cl">Access-Control-Allow-Headers: X-Auth-Token
</span></span><span class="line"><span class="cl">Access-Control-Max-Age: <span class="m">86400</span>
</span></span></code></pre></div><p>Say, I have a website <code>bakerst22b_evil.com</code>. On my website there is a link to richmond64.com. When the user clicks the link, it doesn&rsquo;t initiate CORS. However, this is a cross origin request. If <code>richmond64.com</code> has a CSRF there, it might be exploited. CORS won&rsquo;t protect from that.</p>
<p>Another scenario. On my website <code>bakerst22b_evil.com</code> there is a javascript code that want&rsquo;s to access a <code>richmond64.com</code> cookie ğŸª. It won&rsquo;t be able to because the user&rsquo;s browser won&rsquo;t allow it. The only way that <code>bakerst22b_evil.com</code> could access it, is if <code>richmond64.com</code> set its CORS header to the following:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Access-Control-Allow-Origin: * <span class="c1"># or</span>
</span></span><span class="line"><span class="cl">Access-Control-Allow-Origin: bakerst22b_evil.com <span class="c1"># or</span>
</span></span><span class="line"><span class="cl">Access-Control-Allow-Credentials: <span class="nb">true</span>
</span></span></code></pre></div><h3 id="hsts">HSTS</h3>
<p><code>Strict-Transport-Security</code> header is sent forcing the browser only use HTTPS and preventing any requests coming via HTTP.</p>
<h2 id="references">References</h2>
<details>
    <summary>Expand&hellip;</summary>
    <h3 id="portswigger-sop-article">Portswigger SOP article</h3>
<p><a href="https://portswigger.net/web-security/cors/same-origin-policy">https://portswigger.net/web-security/cors/same-origin-policy</a></p>
<h3 id="portswigger-cors-article">Portswigger CORS article</h3>
<p><a href="https://portswigger.net/web-security/cors">https://portswigger.net/web-security/cors</a></p>

</details>
  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.bafc052229b4b40bf03c477d31c5cdd9352ece8afbadf35ab97ed14495098fc9.js"></script>
  

  
  
  
    
  


</body>

</html>
