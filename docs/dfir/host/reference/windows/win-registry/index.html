<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Windows Registry - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.9d91cbb32c96c334ae7b38c3d99d30727e0836e1182125cc5f007d215f0b9e59.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-forensics ğŸ” and incident response ğŸ¥·">
      <a href="/docs/dfir">
        <span>Forensics ğŸ” and Incident Response ğŸ¥·</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-notes ğŸ“">
      <a href="/docs/notes">
        <span>Notes ğŸ“</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-forensics ğŸ” and incident response ğŸ¥·">
      <a href="/docs/dfir">
        <span>Forensics ğŸ” and Incident Response ğŸ¥·</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-notes ğŸ“">
      <a href="/docs/notes">
        <span>Notes ğŸ“</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/host/reference/windows/"> Back to Windows Basics ğŸ“š Section ğŸ‘ˆğŸ¼ </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#structure">Structure</a>
      <ul>
        <li><a href="#sam">SAM</a></li>
        <li><a href="#software">Software</a></li>
        <li><a href="#system">System</a></li>
        <li><a href="#nt-user">NT User</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
 </div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Windows Registry</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      <div class="article-category">domain: 
          
              
                <i class="fas fa-archive"></i>
              
          <a class="category-link" href="/domain/general">general</a>
          
      </div> <br />
      
      <div class="article-category">doctype:
          
            
              
                <i class="fa fa-graduation-cap"></i>
              
          <a class="platform-link" href="/doctype/article">article</a>
          
      </div> <br /><br/>
      
      
      
      
      <div class="article-category">
          
            
            
            
            
            
          <a class="platform-link" href="/platforms/win">win</a>
          
      </div> <br />
      

      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <p>Prior to Windows NT, <code>ini</code> files were used. These were substituted with Windows registry to keep initialization and configurations. Some changes are also logged by the registry.</p>
<blockquote>
<p>âš ï¸ If the OS was reinstalled, the registry is backed up (<code>windows.old</code>) [<a href="https://www.coursera.org/learn/windows-registry-forensics/lecture/j8uJp/software-file-subkeys-of-interest">5</a>]. However, Windows.old is almost totally deleted after 28 days [<a href="https://superuser.com/questions/1210451/what-does-windows-old-folder-contain">9</a>] .</p>
</blockquote>
<h2 id="structure">Structure</h2>
<p>Hives are the first &ldquo;folders&rdquo; under the root folder. For example, under the root folder HKEY_LOCALMACHINE there is a set of folders. These are hives (purple rectangle). All the folders inside are keys and subkeys (green rectangle).</p>
<p><img src="images/reg1.png" alt="reg1"></p>
<p>There are two types: system related files and user related. System related âš™ï¸:</p>
<ul>
<li>SAM</li>
<li>System</li>
<li>Security</li>
<li>Software</li>
<li>AmCache</li>
</ul>
<p>User related (specific to this user) ğŸ‘¨â€ğŸ’»:</p>
<ul>
<li>NT User.dat</li>
<li>User Class.dat</li>
</ul>
<p>When the OS boots up, it loads the handles to these hives into memory (<code>HK...</code> - handle key):</p>
<ul>
<li><code>HKEY_LOCAL_MACHINE</code> (HKLM)
<ul>
<li><code>HARDWARE</code> ğŸ‡</li>
</ul>
</li>
<li><code>HKEY_CLASSES_ROOT</code> (HKCR). Filled up at boot time with the data from <code>HKEY_LOCAL_MACHINE\Software\Classes</code> keys and data.</li>
<li><code>HKEY_CURRENT_CONFIG</code> (HKCC) ğŸ‡. It&rsquo;s a pointer to <code>HKEY_LOCAL_MACHINE\System\CurrentControlSet\HardwareProfiles\Current</code>.</li>
<li><code>HKEY_USERS</code> (HKU)</li>
<li><code>HKEY_CURRENT_USER</code> (HKCU) ğŸ‡ . Information pulled from <code>NTUset.dat</code>.</li>
</ul>
<p>Some of the settings can only be found on a live system (ğŸ‡). SAM hive and all of its subkeys will not be accessible.</p>
<p>âš ï¸ There is no <code>CurrentControlSet</code> on a dead-box. To determine which one of the <code>ControlSet</code>s is current, use <code>Select\Current</code> key (usually <code>1</code>, which means <code>ControlSet001</code>). <code>Last Known Goog</code> is usually <code>2</code> (which means <code>ControlSet002</code>), used for recovery purposes.</p>
<p>Non-live registry (missing some hives) can be accessed from a disk image for example. <code>C:\Windows\System32\config</code> contains 4 main hives: SAM, System, Security and Software. <code>C:\Windows\appcompat\Programs</code> contains <code>amcahce.hve</code>. User-related files mentioned above can be found at <code>C:\Users\%Username%\NTUser.dat</code> and <code>C:\Users\%Username%\AppData\Local\Microsoft\Windows\UsrClass.dat</code>. So, those mysterious <code>XXX.dat</code> files are actually a registry file.</p>
<h3 id="sam">SAM</h3>
<p>On disk it&rsquo;s located here: <code>C:\Windows\System32\config\SAM</code>. This file cannot be edited through the RegEdit unless admin grants you permissions (data marked with red is not accesssible unless the access is granted by admin):</p>
<p><img src="images/sam-hive-permissions.png" alt="sam-hive-permissions"></p>
<p>However, this file can be accessed on a dead-box system. âš ï¸ Also, this file only stores local creds, not domain or Microsoft account credentials!</p>
<p>SAM is a database of files, and it stores all the information about all the users: login information, password hashes, group information.</p>
<p>ğŸ›  Registry Explorer (Eric Zimmerman&rsquo;s tool) can collect all user from the SAM and Profile files and show them assembled. This data can be exported to Excel, for example.</p>
<h4 id="local-user-accounts">Local User Accounts</h4>
<p>For each user there will be a separate sub-key under <code>SAM\SAM\Domains\Account\Users</code>. The sub-keys names are actually RID of the user in hex. Each sub-key will have several values. Record <code>V</code> contains static information (username, password length etc), while record <code>F</code> contains constantly updated information like timestamps ğŸ•°:</p>
<ul>
<li>Last login is a little endian 8 byte value at <code>0x08-0x0f</code> offset.</li>
<li>Last password change time at offset <code>0x18-0x1f</code>, 8 bytes long.</li>
<li>Last failed logon time is at offset <code>0x28-0x2f</code>, 8 bytes.</li>
</ul>
<p>RID itself is stored here, in <code>F</code> record at offset <code>0x30-0x33</code> (little endian). Also, there is <code>PasswordRequired</code> (at <code>0x38</code>). There several possible values for this nibble (half byte): <code>0</code> - account active + pass required, <code>1</code> - account is not active, <code>4</code> - any policies do not apply to this account.</p>
<blockquote>
<p>ğŸ§ª I have <code>5</code> on my machine, what does it mean?</p>
</blockquote>
<p>Logon count is at <code>0x42-0x43</code> (two bytes).</p>
<p>The <code>V </code> value is more interesting. It contains usernames and hashes (NTLM). The user account name is at <code>0x1C0</code> offset (Unicode). What about the juicy stuff? I mean the password hashes. SAM file contains a 56-byte NTLM hash of the password, which is encrypted with a AES algo,  the key ğŸ”‘ is stored in a system file. To decrypt the password, you&rsquo;ll need both SAM <strong>and</strong> the system file. Password cracking methodology:</p>
<ul>
<li><input disabled="" type="checkbox"> Export SAM and SYSTEM hives from the forensic image/suspect machine.</li>
<li><input disabled="" type="checkbox"> Unencrypt the hash stored in the SAM file (ğŸ›  <code>mimikatz</code>).</li>
<li><input disabled="" type="checkbox"> Create a word list from the current case (may export from Autopsy, EnCase etc).</li>
<li><input disabled="" type="checkbox"> Run a dictionary ğŸ“– or brute-force attack ğŸ’ª against this NTLM hash (ğŸ› : <code>hashcat</code> ğŸˆâ€â¬› , <code>John the Ripper</code> ğŸ”ª, Cain and Able ğŸ”ª ğŸ).</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># decrypt the hashes:</span>
mimikatz
&gt; lsadump::sam /system:<span class="s2">&#34;path_to_SYSTEM&#34;</span> /SAM:<span class="s2">&#34;path_to_SAM&#34;</span>

<span class="c1"># crach the hash with hashcat</span>

</code></pre></div><p><strong>Other values stored in this sub-key</strong>. <code>ForcePasswordReset</code> speaks for itself and <code>SupplementalCredentials</code> do not. There also can be a <code>UserPasswordHint</code>, sometimes contains the actual password. It also contains RID, which can be changed in <a href="/docs/dfir/host/reference/windows/win-lsa#rid-hijacking">RID hijacking attack</a>. There is also a technique that allows resetting local account password by clearing <code>lmpw_len</code> (LM password hash length) and <code>ntpw_len</code> (NTLM password hash length) at <code>0x2c</code> and <code>0x30</code> respectively [<a href="http://www.ijfcc.org/vol5/455-F005.pdf">8</a>].</p>
<h4 id="microsoft-accounts">Microsoft Accounts</h4>
<p>Since Win8. Can be logged in if there is internet access. Profiles and settings are stored in the cloud â˜ï¸. Additional values are stored in SAM: <code>InternetUID</code> and <code>InternetUserName</code>. Both are unique to the user. <code>InternetUID</code> is a 16 byte Unicode string. <code>InternetUserName</code> - usually an email used as a login.</p>
<h4 id="domain-accounts">Domain Accounts</h4>
<p><strong>Key</strong> ğŸ”‘ : <code>Software\Microsoft\Windows NT\CurrentVersion\ProfileList</code>.</p>
<p>The key above will have a <code>ProfileImagePath</code>.</p>
<p>âš ï¸ SAM doesn&rsquo;t have any informaiton about domain accounts! See more info <a href="#software">in software section, domain accounts</a>.</p>
<h4 id="deleted-accounts">Deleted Accounts</h4>
<p>ğŸ›  Registry Explorer (Eric Zimmerman&rsquo;s tool) shows deleted accounts. If the data was not overwritten, we will be able to get the information.</p>
<hr>
<h3 id="software">Software</h3>
<p>System-wide information. All the below keys start with <code>Computer\HKEY_LOCAL_MACHINE\SOFTWARE\</code>. So, I&rsquo;ll only show relative path, not full for simplicity&rsquo;s sake. It contains configurations and information about software components of the system. On disk it&rsquo;s located here: <code>C:\Windows\System32\config\SOFTWARE</code>.</p>
<h4 id="installed-programs-and-applications">Installed programs and applications</h4>
<p><strong>Key</strong> ğŸ”‘: <code>Microsoft\Windows\CurrentVersion\Uninstall</code>. There can be some data for programs that do not exist on the system anymore. The last write time is when the application was installed.</p>
<p><strong>Key</strong> ğŸ”‘ <code>Microsoft\Windows\CurrentVersion\Appx\AppxAllUserStore</code> for installed Microsoft applications. Defines between those that were installed for a specific user or system-wide.</p>
<p><strong>Key</strong> ğŸ”‘: <code>Wiw6432Node</code> (<code>SYSTEM</code> hive root node) - those that run a 32-bit mode. Separate sub-keys for different versions of a program.</p>
<p><strong>Key</strong> ğŸ”‘: <code>Classes\Installer\Products</code> - installed using Miscrosoft installer (those with <code>msi</code> extension).</p>
<h4 id="os-information">OS Information</h4>
<p><strong>Key</strong> ğŸ”‘: <code>Microsift\Windows NT\CurrentVersion</code>. Value <code>InstallDate</code> - Install date, Unix, numeric value (for ğŸ›  Decode).</p>
<h4 id="network-information">Network Information</h4>
<p><strong>Key</strong> ğŸ”‘: <code>Microsoft\Windows NT\CurrentVersion\NetworkList</code> - Wireless information. <code>Profiles</code> - network info by GUID, data first and last connected. <code>Signatures</code> - gw MAC address; contains <code>Managed</code> (managed, like a domain) and <code>Unmanaged</code> (like a PC and home router). <code>Profile name</code> - SSID or server. <code>Description</code> - usually the same as <code>Profile name</code>. <code>Managed</code> - <code>1</code> (connection to a server) or <code>0</code> (wireless router). <code>Date Created</code> - . <code>Date last connected</code> - . Both are Windows 128-bit SYSTEM structure (ğŸ›  Decode).</p>
<p><strong>Key</strong> ğŸ”‘: <code>Clients\StartMenuInternet</code> - default browser. Open the sub-keys to see installed browsers and their information. Last write timestamp - when they were installed on the system.</p>
<h4 id="file-association">File association</h4>
<p><strong>Key</strong> ğŸ”‘: <code>Classes</code>. For each extension there is a <code>OpenWith</code> - suggestions, which program can be used. That&rsquo;s the file association itself. <code>OpenWithProgIDs</code> - user-selected.</p>
<p><strong>Key</strong> ğŸ”‘: <code>Microsoft\Windows\CurrentVersion\Applets</code>. Something that comes with Windows (built-in).</p>
<h4 id="login-info">Login info</h4>
<p><strong>Key</strong> ğŸ”‘: <code>Microsoft\Windows\CurrentVersion\Authentication\LogonUI</code> - last logged in user.</p>
<p><strong>Key</strong> ğŸ”‘: <code>Microsoft\Windows NT\CurrentVersion\Winlogon</code>. Manages the boot process, logging operations, loading profiles.</p>
<h4 id="attached-devices">Attached devices</h4>
<p><strong>Key</strong> ğŸ”‘: <code>Microsoft\Windows Portable Devices\Devices</code>. For USB and other devices connected. The sub-key name contains the device&rsquo;s serial number, name, disk ID (between <code>{}</code>), which is assigned by OS. This disk id can be used to track the device accross the system, for example, other registry values. But keep in mind, that not every USB device has a serial number. Dates and times - when the device was first inserted <em>after the last reboot</em>. <code>FriendlyName</code> - user-created name of the volume.</p>
<p><strong>Key</strong> ğŸ”‘: <code>Microsoft\Windows NT\CurrentVersion\EMDMgmt</code>. It was put as an extension of memory (aka ready boost). Checks to see if the USB device can be used to extend memory. Timestamps - when first inserted. Some entries are ending with some decimal number. These should be converted to hex and used to trace the device accross the system.</p>
<p><strong>Key</strong> ğŸ”‘: <code>Microsoft\Windows NT\CurrentVersion\Print\Printers</code> for printers connected. This subkey may also contains some SIDs. I don&rsquo;t quite understand yet, when this happens in general, but one case is when OneNote is used to share documets.</p>
<blockquote>
<p>âš ï¸ Use information about USB devices from <code>SYSTEM</code> hive to get more and validate this information.</p>
</blockquote>
<h4 id="autostart-locations">Autostart locations</h4>
<p><strong>Key</strong> ğŸ”‘:  <code>Microsoft\Windows\CurrentVersion\Run</code> and <code>Microsoft\Windows\CurrentVersion\RunOnce</code>.</p>
<p>There are two place for autoruns in <code>SOFTWARE</code> hive, both are system wide â“</p>
<h4 id="uninstalled-applications">Uninstalled applications</h4>
<p><strong>Key</strong> ğŸ”‘:  <code>Microsoft\Windows\CurrentVersion\Uninstall</code></p>
<h4 id="domain-accounts-1">Domain Accounts</h4>
<p><strong>Key</strong> ğŸ”‘ : <code>Software\Microsoft\Windows NT\CurrentVersion\ProfileList</code>.</p>
<p>The key above will have a <code>ProfileImagePath</code>.</p>
<p>SAM doesn&rsquo;t have any informaiton about domain accounts. For this information refer to the key above. Even though in case of a domain user there is no relevant information in SAM hive, you can still view the machine/domain ID in SAM and use it to determine whether the files were created on the local machine. For example, in the Recycle Bin.</p>
<hr>
<h3 id="system">System</h3>
<p>Contains the following information, listed below. System-wide information. All the below keys start with <code>Computer\HKEY_LOCAL_MACHINE\SOFTWARE\</code>. So, I&rsquo;ll only show relative path, not full for simplicity&rsquo;s sake. This hive contains information about the system, devices attached, services running. On disk it&rsquo;s located here: <code>C:\Windows\System32\config\SYSTEM</code>.</p>
<h4 id="current-control-set">Current control set</h4>
<p><strong>Key</strong> ğŸ”‘: <code>Computer\HKEY_LOCAL_MACHINE\System\Select\Current</code>.</p>
<p>There are two Controls Sets:  <code>1</code> main or <code>2</code> recovery. In order to determine, which ControlSet is in use at the moment (most likely <code>1</code>), see <code>Computer\HKEY_LOCAL_MACHINE\System\Select\Current</code>. Then, choose <code>ControlSet001</code> or <code>ControlSet002</code> to get the data that is the most relevant.</p>
<h4 id="computer-name">Computer name</h4>
<p><strong>Key</strong> ğŸ”‘: <code>Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\ComputerName\ComputerName</code> and <code>Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\ComputerName\ActiveComputerName</code></p>
<h4 id="last-shutdown-time">Last shutdown time</h4>
<p>Key ğŸ”‘: <code>Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\Windows\LastShutdownTime</code></p>
<p>A 64-bit little-endian value, Windows FileTime.</p>
<h4 id="crash-dump-setting">Crash dump setting</h4>
<p>Key ğŸ”‘: <code>Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\CrashControl\DumpFile</code> and <code>--\\--\MinidumpDir</code>.</p>
<p>Stores the location of <code>*.DMP</code>.</p>
<h4 id="services-set-to-run">Services set to run</h4>
<p>Key ğŸ”‘: <code>Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services</code></p>
<p>This is another Autorun location.</p>
<h4 id="is-page-file-cleared-at-shutdown">Is page file cleared at shutdown?</h4>
<p>Key ğŸ”‘:  <code>Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\Session Manager\Memory Management\ClearPageFileAtShutdown</code>.</p>
<p><code>1</code> - cleared, <code>0</code> - not cleared.</p>
<p><code>pagefile.sys</code> can store some data that&rsquo;s used or was used by RAM.</p>
<h4 id="prefetch-settings">Prefetch settings</h4>
<p>Key ğŸ”‘: <code>Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\Session Manager\Memory Management\</code></p>
<h4 id="last-access-file-time-settings">Last access file time settings</h4>
<h4 id="system-time">System time</h4>
<p>Key ğŸ”‘: <code>Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\TimeZoneInformation\TimeZoneKeyName</code></p>
<h4 id="usbs">USBs</h4>
<p>Key ğŸ”‘: <code>Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Enum\USBSTOR</code></p>
<p>Contains ever connected USBs with their serials and some additional information. <code>0064</code> - first installed, <code>0065</code> last installed, <code>0066</code> last arrival and <code>0067</code> last removal. To view <code>Properties</code> subkey admin ğŸ§‘â€ğŸ’¼ privileges are not enough for the live-registry. Install <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/psexec">psexec</a> and elevate to system by running the folling command from the <code>psexec</code> folder: <code> .\PsExec.exe -i -s -d powershell.exe</code>. In the PowerShell window that opens run <code>regedit</code>. Another key - <code>Computer\HKEY_LOCAL_MACHINE\SYSTEM\MountedDevices</code>. It&rsquo;s used to map devices to drive letters (not only USBs).</p>
<hr>
<h3 id="nt-user">NT User</h3>
<p>Key interesting for a forensic examiner are listed below. On disk located here:  <code>C:\Users\%Username%\NTUser.dat</code> and <code>C:\Users\%Username%\AppData\Local\Microsoft\Windows\UsrClass.dat</code>.</p>
<h4 id="recent-documents">Recent documents</h4>
<p><strong>Key</strong> ğŸ”‘: <code>NTUSER.DAT\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs</code></p>
<p>Contains the list of all recent documents as a bunch and also the same data sorted by extension. <code>MRUListEx</code> is list. It has a number of 4 byte values, each noting the sequence number of a document. It starts from the document&rsquo;s number that was accessed some time age (first in the list) and ends with the most recently used one. This key also has a list of recently accessed folders.</p>
<blockquote>
<p>âš ï¸ğŸ” I only had a short binary data stream under the <code>ViewStream</code> subkey.</p>
</blockquote>
<h4 id="typed-urls">Typed URLs</h4>
<p><strong>Key</strong> ğŸ”‘: <code>NTUSER.DAT\SOFTWARE\Microsoft\Internet Explorer\Typed URLs</code>. Timestamps are at <code>TypedURLsTimes</code>.</p>
<p>âš ï¸ for Internet Explorer only, holds up to 25 entries. Since it&rsquo;s used for InternetExplorer only and Internet Explorer is dying, most likely this artefact is &ldquo;fading in the past&rdquo;.</p>
<h4 id="user-assist">User assist</h4>
<p><strong>Key</strong> ğŸ”‘: <code>NTUSER.DAT\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User Assist</code>.</p>
<p>List of progs and applets that can be quicly started from the Start menu for usability, the most often used items. Shows a <code>focus count</code> for each entry. It means, how many time was the window switched to (that doesn&rsquo;t include the time when the program is first run). Shows the last time that the program was executed, focus time, run count.</p>
<p>At the start of each entry between <code>{}</code> is the code for a location within file system. Registry Explorer will substitute these automatically, since these GUIDs are predefined.</p>
<p>This what a full filled User Assist key looks like. <code>{CEBFF5CD-ACE2-4F4F-9178-9926F41749EA}</code> is for programs that were lauched using their image files directly. <code>{F4E57C4B-2036-45F0-A9AB-443BCFE33D9F}</code> is for those, started with a shortcut.</p>
<p><img src="images/user-assist1.png" alt="user-assist1"></p>
<p>The structure is quite simple:</p>
<ul>
<li>At <code>0x04</code> offset starts the number of executions (4 bytes).</li>
<li>At <code>0xC</code> offset starts the focus time (4 bytes)</li>
<li>At <code>0x3C</code> offset starts the Last Execution time (8 bytes), which is a Win64-bit little-endian value (for Decode ğŸ› ).</li>
</ul>
<blockquote>
<p>âš ï¸ ğŸ” I could not find this key on my Win10 VM.</p>
<p>âš ï¸ When the program was started via <code>lnk</code> file, the focus count will be <code>0</code>.</p>
</blockquote>
<h4 id="recent-apps">Recent Apps</h4>
<p>Key ğŸ”‘: <code>NTUSER.DAT\SOFTWARE\Microsoft\Windows\CurrentVersion\Search\RecentApps</code>.</p>
<p>Similar to User Assist. Also shows files and applications that were used through this application. This key consists of sub-keys that are marked with application&rsquo;s GUID. Some of them will have <code>Recent Items</code> sub-key (10 max), each has <code>Last Write Time</code> (Windows 64-bit, little-endian).</p>
<blockquote>
<p>âš ï¸ Not all Win10 machines will have this key.</p>
</blockquote>
<h4 id="jump-list-data">Jump List Data</h4>
<p>Key ğŸ”‘: <code>NTUSER.DAT\SOFTWARE\Microsoft\Windows\CurrentVersion\Search\JumplistData</code>.</p>
<p>Shows applications accessed.</p>
<h4 id="runrun-once">Run/Run once</h4>
<p><strong>Key</strong> ğŸ”‘: <code>NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Run</code>,<code>Computer\HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce</code>.</p>
<p>For that particular user. System-wide autoruns are stored in <code>HKLM_LOCAL_MACHINE\SOFTWARE</code>. The keys are ignored if the PC is started in a safe mode. âš ï¸ However, if the value in <code>RunOnce</code> is prefixed with an <strong>asterisk</strong> (*), it will run <strong>even</strong> in the <strong>safe mode</strong>!</p>
<h4 id="word-wheel-query">Word Wheel Query</h4>
<p><strong>Key</strong> ğŸ”‘:<code>NTUSER.DAT\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\WordWheelQuery</code> (Win7, search from the start menu), <code>NTUSER.DAT\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\SearchHistory\Microsoft.Windows.FileSearchApp</code> (Win8, search from the start menu), <code>Users\%USERNAME%\AppData\Local\Micorsoft\Windows\ConnectedSearch\History</code> (Win8.1, stored as individual <code>lnk</code> files, contains file date and times, items accessed from the charms bar (aka Start menu)), <code>NTUSER.DAT\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\WordWheelQuery</code> (Win10, searched from File Explorer).</p>
<blockquote>
<p>âš ï¸ On Windows 10 search terms that are typed into the charms bar are tracked by Cortana in a dedicated DB outside the registry.</p>
</blockquote>
<p>Search history of the Start menu and Windows Explorer (MRU order - <strong>m</strong>ost <strong>r</strong>ecently <strong>u</strong>sed), last accessed date, search terms typed by user.</p>
<p>ğŸ” I could not find this key on my Win10 VM.</p>
<blockquote>
<p>ğŸ§ª I could not find some of the above mentioned keys on my Win10 VM. I tried both <code>HKEY_LOCAL_MACHINE</code> and <code>HKEY_CURRENT_USER</code>.</p>
</blockquote>
<h4 id="comdlg32">ComDlg32</h4>
<p><strong>Key</strong> ğŸ”‘: <code>NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32</code>.</p>
<p><code>CIDSizeMRU</code>- Tracks applications globally. MRU start at zero. Timestamp for the most recent item only. <code>FirstFolder</code> -tracks the install locations of applications, full path to the app, but no exact file name. <code>OpenSavePidMRU</code> - tracks files that were saved with <code>Save As</code> dialog, or opened with <code>Open</code> dialog. Tracks autocomplete terms. <code>LastVisitedPidMRU</code> - tracks applications accessed in <code>OpenSavePidMRU</code>, tracks the location the file existed.</p>
<h4 id="typed-paths">Typed Paths</h4>
<p><strong>Key</strong> ğŸ”‘: <code>NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\TypedPaths</code>.</p>
<p>Files and directories that were accessed by typing address in File Explorer.</p>
<h4 id="office-mru">Office MRU</h4>
<p><strong>Key</strong> ğŸ”‘: <code>NTUSER.DAT\Software\Microsoft\Office\XX.X</code>.</p>
<p>You might see if there were several versions of Microsoft Office installed. Expanding Word|Excel|PowerPoint etc and looking at the entries, they have a <code>Txxxxxxxx</code> in the middle. That&rsquo;s time (Win64 big-endian, UTC).</p>
<h2 id="references">References</h2>
<p>[<a href="https://github.com/msuhanov/regf/blob/master/Windows%20registry%20file%20format%20specification.md#layered-keys">1</a>] Windows registry file format specification</p>
<p>Suhanov&rsquo;s blog: [<a href="https://dfir.ru/2020/10/03/exporting-registry-hives-from-a-live-system/">2</a>] Exporting registry hives from a live system, [<a href="https://dfir.ru/2020/08/15/containerized-registry-hives-in-windows/">3</a>] Containerized registry hives in Windows, [<a href="https://dfir.ru/2018/10/07/hiding-data-in-the-registry/">4</a>] Hiding data in the registry</p>
<p>[<a href="https://www.coursera.org/learn/windows-os-forensics/lecture/69m1C/registry-overview-and-history">5</a>] Coursera, Windows OS Forensics</p>
<p>[<a href="https://www.bleepingcomputer.com/news/microsoft/new-windows-10-vulnerability-allows-anyone-to-get-admin-privileges/">6</a>] Windows 10 vulnerability with the access to SAM</p>
<p>[<a href="http://www.ijfcc.org/vol5/455-F005.pdf">7</a>] Registry structure</p>
<p>[<a href="http://www.ijfcc.org/vol5/455-F005.pdf">8</a>] Analysis the Structure of SAM and Cracking Password Base on Windows Operating System, Jiang Du and Jiwei Li</p>
<p>[<a href="https://superuser.com/questions/1210451/what-does-windows-old-folder-contain">9</a>] What does Windows.old folder contain?</p>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.1237ff71925bb8625c97a9af8db4c54525258bedfd7c47493daaff723bea755e.js"></script>
  

  
  
  
    
  


</body>

</html>
