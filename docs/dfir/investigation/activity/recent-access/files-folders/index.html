<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“„ Document And Folder Artefacts - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.9d91cbb32c96c334ae7b38c3d99d30727e0836e1182125cc5f007d215f0b9e59.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-forensics ğŸ” and incident response ğŸ¥·">
      <a href="/docs/dfir">
        <span>Forensics ğŸ” and Incident Response ğŸ¥·</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference ğŸ“š">
      <a href="/docs/reference">
        <span>Tech Reference ğŸ“š</span>
      </a>
    </li>
    
    <li class="menu-item-notes ğŸ“">
      <a href="/docs/notes">
        <span>Notes ğŸ“</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-forensics ğŸ” and incident response ğŸ¥·">
      <a href="/docs/dfir">
        <span>Forensics ğŸ” and Incident Response ğŸ¥·</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference ğŸ“š">
      <a href="/docs/reference">
        <span>Tech Reference ğŸ“š</span>
      </a>
    </li>
    
    <li class="menu-item-notes ğŸ“">
      <a href="/docs/notes">
        <span>Notes ğŸ“</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/investigation/activity/recent-access/"> Back to File And Folder Activity Analysis Section ğŸ‘ˆğŸ¼ </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#windows">Windows</a>
      <ul>
        <li><a href="#recent-files">Recent Files</a></li>
        <li><a href="#file-association">File association</a></li>
        <li><a href="#recent-documents">Recent documents</a></li>
        <li><a href="#office-mru">Office MRU</a></li>
        <li><a href="#jump-list-data">Jump List Data</a></li>
        <li><a href="#shellbags">ShellBags</a></li>
      </ul>
    </li>
    <li><a href="#office">Office</a></li>
    <li><a href="#temp-file">Temp file</a></li>
    <li><a href="#ads">ADS</a>
      <ul>
        <li><a href="#how-to-create-an-ads">How to create an ADS</a></li>
        <li><a href="#how-to-check-a-directory-for-an-ads">How to check a directory for an ADS</a></li>
        <li><a href="#how-to-get-a-file-from-a-stream">How to get a file from a stream</a></li>
        <li><a href="#how-to-delete-the-stream">How to delete the stream</a></li>
      </ul>
    </li>
    <li><a href="#macos">macOS</a>
      <ul>
        <li><a href="#appstore-downloads">AppStore Downloads</a></li>
        <li><a href="#search">Search</a>
          <ul>
            <li><a href="#spotlight-shortcuts">Spotlight shortcuts</a></li>
            <li><a href="#finder-mru">Finder MRU</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
 </div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">ğŸ“„ Document And Folder Artefacts</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      <div class="article-category">domain: 
          
              
                <i class="fas fa-search"></i>
              
          <a class="category-link" href="/domain/forensics">forensics</a>
          
      </div> <br />
      
      <div class="article-category">doctype:
          
            
              
                <i class="fa fa-graduation-cap"></i>
              
          <a class="platform-link" href="/doctype/article">article</a>
          
      </div> <br /><br/>
      
      
      
      

      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <p>There are several ways to determine file type: extension, signatures and structure. The most reliable is the last one, since extentsions can be easily changed and signatures are not very reliable (polymorphic files). Some file types and signatures are listed <a href="https://peat-chameleon-e41.notion.site/386aa42a50a649d2aba6bdc30d2babcf?v=6274428e7e57479a9ae962f18ee3d847">here</a> and in the book <em>Digital Archaeology</em>. Magic numbers can be viewed on a UNIX machine: <code>/usr/share/file/magic.mgc</code> (compiled list of magic numbers), <code>/usr/share/file/magic</code> (default list of magic numbers), <code>/usr/share/file/magic.mime.mgc</code> (default compiled list), <code>/usr/share/file/magic.mime</code> (default list).  Use <code>file</code> command to determine file type.</p>
<p>Data about a file is stored in several locations: system metadata (generated by file system or doc management of the OS), substantive metadata (information that defines modifications to a document), embedded metadata (information embedded by the application that creates or edits the file), external metadata (separate doc, for example, a database).</p>
<h2 id="windows">Windows</h2>
<h3 id="recent-files">Recent Files</h3>
<p>Recent files (LNK) - <code>C:\Users\veronicazvereva\AppData\Roaming\Microsoft\Windows\Recent Files\</code> on Windows 11, <code>C:\Users\veronicazvereva\AppData\Roaming\Microsoft\Windows\Recent</code> Windows 10-. Captures the MAC times of the original file.</p>
<p>Last Accessed (filetime, NTFS timestamps) for a file is updated by FTK.</p>
<p>1.18 original file opened</p>
<p>several mins passed</p>
<h3 id="file-association">File association</h3>
<p><strong>Key</strong> ğŸ”‘: <code>Classes</code>. For each extension there is a <code>OpenWith</code> - suggestions, which program can be used. That&rsquo;s the file association itself. <code>OpenWithProgIDs</code> - user-selected.</p>
<p><strong>Key</strong> ğŸ”‘: <code>Software\Microsoft\Windows\CurrentVersion\Applets</code>. Something that comes with Windows (built-in).</p>
<h3 id="recent-documents">Recent documents</h3>
<p><strong>Key</strong> ğŸ”‘: <code>NTUSER.DAT\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs</code></p>
<p>Contains the list of all recent documents as a bunch and also the same data sorted by extension. <code>MRUListEx</code> is list. It has a number of 4 byte values, each noting the sequence number of a document. It starts from the document&rsquo;s number that was accessed some time age (first in the list) and ends with the most recently used one. This key also has a list of recently accessed folders.</p>
<blockquote>
<p>âš ï¸ğŸ” I only had a short binary data stream under the <code>ViewStream</code> subkey.</p>
</blockquote>
<h3 id="office-mru">Office MRU</h3>
<p><strong>Key</strong> ğŸ”‘: <code>NTUSER.DAT\Software\Microsoft\Office\XX.X</code>.</p>
<p>You might see if there were several versions of Microsoft Office installed. Expanding Word|Excel|PowerPoint etc and looking at the entries, they have a <code>Txxxxxxxx</code> in the middle. That&rsquo;s time (Win64 big-endian, UTC).</p>
<h3 id="jump-list-data">Jump List Data</h3>
<p>Key ğŸ”‘: <code>NTUSER.DAT\SOFTWARE\Microsoft\Windows\CurrentVersion\Search\JumplistData</code>.</p>
<p>Shows applications accessed.</p>
<h3 id="shellbags">ShellBags</h3>
<p><strong>Key</strong> ğŸ”‘ : <code>UsrClass\Local Settings\Software\Microsoft\Windows\Shell\BagMRU </code>. Values: <code>MRUListEx</code>, <code>NodeSlot</code>, <code>Subkeys</code>.</p>
<p><strong>Key</strong> ğŸ”‘ : <code>UsrClass\Local Settings\Software\Microsoft\Windows\Shell\Bags</code>. Values: <code>Shell</code>, will have folder&rsquo;s GUID.</p>
<p><code>volatility.exe -f memory.dmp --profile=Win7SP1x64 shellbags</code></p>
<p><code>Created On</code>: when the folder was created/moved/renamed. Last accessed and created are sometimes the same. Last modified is when the preferences were last changed (window resized, view options changed). Mind if itâ€™s utc or gmt. Also, this data might be updated with a little lag. <code>Last key write time</code> is the ShellBag&rsquo;s timestamp.</p>
<blockquote>
<p>âš ï¸ Shortcuts MAC times are not updated!</p>
<p>âš ï¸ Fat16 only records date. No time. So the <code>Last accessed</code> time for a fat16 formatted folder will be <code>00:00:00.000</code>. It&rsquo;s more usual for a USB removable media.</p>
</blockquote>
<p><code>Created On</code>, <code>Modified On</code> and <code>Last accessed on</code> are all FS timestamps â—ï¸â—ï¸â—ï¸ However, <code>Registry last write time</code> is its own timestamp and it seems to be updated even when no preferences were changed.</p>
<p>Track Windows folder settings (how the view is set), track zip files, folder access, even if information was deleted. Can also show folders on removable media. This data is a little bit confusing at first, but can be digested in a couple of minutes. One important thing to note is that both keys are interconnected. I&rsquo;ve used arrows, squares and circles to mark data corresponding to each for better visualization on the picture below. Sometimes, additional info for NTFS filesystem will be available (MFT record number) and file system type as well, not always however.</p>
<blockquote>
<p>âš ï¸ Proves that the user interacted with these folders if they are found in ShellBags but not on the system.</p>
<p>â“ How about when being hacked? A hacker might delete the folder.</p>
</blockquote>
<p>Right under <code>BagMRU</code> subkey, there is only one subkey (in this case, in case of shell bags, a folder): <code>0</code>.  <code>MRUListEx</code> contains a list of folders inside this one identified by sequence numbers. In our example there are only three subfolders (and, hence, values in the list) in this folder: <code>00 00 00 00</code>, just <code>0</code> in little-endian (green), <code>01 00 00 00</code>, just <code>1</code> in little-endian (orange) and <code>02 00 00 00</code>, just <code>2</code> in little-endian (purple). Above the <code>MRUListEx</code> there are three values in our case, each corresponding to the subfolder and containing a folder path and name. In the example below the <code>0</code> subfolder&rsquo;s value is expanded and marked with a green circle.</p>
<p>Each of these folders in the list will have a corresponding subkey inside our <code>0</code> subkey/folder (marked with arrows on the left).</p>
<p><img src="/Users/veronicazvereva/Documents/website/analyst/content/docs/dfir/investigation/configs/win-registry/images/shell-bag.png" alt="shell-bag"></p>
<p>So, we have a parent folder info, what folders it contains and the paths to them. Now, since ShellBags store folder settings, where are they? Under the second subkey, <code>Bags</code>. But since sequence numbers are used here as well, how do we find the folder we need? Are these sequence number the same as on the picture above? The answer is <em>no</em>. On the picture above numbering restarts from <code>0</code> for each folder&rsquo;s subfolders, so that each folder that has at least one subfolder, will have at least <code>0</code> value and a <code>0</code> subkey. However, the <code>Bags</code> subkeys numbers folders sequencially. Each subkey representing a folder in a <code>BagMRU</code> subkey we&rsquo;ve seen above, will have a value <code>NodeSlot</code>. This is a number it&rsquo;s identified by withing <code>Bags</code> subkey. See the below example for the folder <code>0</code>.</p>
<p><img src="/Users/veronicazvereva/Documents/website/analyst/content/docs/dfir/investigation/configs/win-registry/images/shell-bag2.png" alt="shell-bag2"></p>
<p>ğŸ›  ShellBagsExplorer (E. Zimmerman) is a tools that helps automating this process which is useful for larger amount of data.</p>
<p><img src="/Users/veronicazvereva/Documents/website/analyst/content/docs/dfir/investigation/configs/win-registry/images/shell-bag3.png" alt="shell-bag3"></p>
<p>The above is an example of the ShellBagsExplorer for my Windows 10 Parallels VM. Pretty user-friendly representation and lot&rsquo;s of valuable information. Note the folders on the very top: <code>\\Mac\vm</code>, <code>\\Mac\Home</code> and <code>\\Mac\AllFiles</code>. Someone who is using Paralells Windows 10 on Mac might note this at once, that this is a VM running on a Mac. Also, both <code>\\Mac\Home</code> and <code>\\Mac\AllFiles</code> are no longer available for Windows 10, but they were not deleted from the registry as you may see. That&rsquo;s because when folders are deleted, they are not deleted from here, at least not soon.</p>
<h2 id="office">Office</h2>
<p><em>General Properties</em> get information from OS metadata and <em>Statistics</em> tab for <code>word.exe</code> is for embedded metadata. If the timestamps are different is probably from a fatal system error. On reboot file was opened by recovery option which changed the embedded timestamps.</p>
<p>Also, some information can be hidden within embedded metadata. Just imagine, that most of the data for a tiny office document is the meta. ğŸ›  One of the tools to view <code>DocScrubber</code>. Office documents also have additional meta that reveals much about the document, for example, who edited it, user name, user initials, org name, comp name, doc location, previous authors, revision logs (Word, Excel), version logs (Word), template file name (Word, PowerPoint), hidden text (Word, Excel), GUIDs. If the file was renamed and then reopened, it&rsquo;s seen as a new file and editing clocks â° start over.</p>
<blockquote>
<p>ğŸ§¹ğŸ‘£ There are certains anti-forensics techniques that allow cleansing the file&rsquo;s metadata.</p>
</blockquote>
<p>Do not forget about autosaved docs (<code>asd</code>). Also, sometimes the <em>Track Changes</em> feature was enabled.</p>
<h2 id="temp-file">Temp file</h2>
<p>Some of the programs keep tmp files. <em>Digital Archaeology</em>, page 173 (Kindle, Mining the Temporary Files) has a table of some temp files for different applications on a Windows machine. Some of them will be deleted on OS shutdown, but can also be carved before overwritten anyway.</p>
<h2 id="ads">ADS</h2>
<p>Alternate data streams, see more <a href="/docs/dfir/forensic-investigation/reference/windows/win-ads">here</a>. Are there such streams for other OS? If yes, how to make them and discover them?</p>
<p>To ensure compatability between NTFS and HFS. Allows hiding files.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="n">C:</span><span class="p">\</span><span class="nb">type </span><span class="n">C:</span><span class="p">\</span><span class="n">mal</span><span class="p">.</span><span class="n">exe</span> <span class="p">&gt;</span> <span class="n">C:</span><span class="p">\</span><span class="n">readme</span><span class="p">.</span><span class="n">txt</span><span class="err">:</span><span class="n">naughty</span><span class="p">.</span><span class="n">exe</span>
<span class="nb">start </span><span class="n">readme</span><span class="p">.</span><span class="n">txt</span><span class="err">:</span><span class="n">naughty</span><span class="p">.</span><span class="n">exe</span>
<span class="n">C:</span><span class="p">\</span><span class="n">mklink</span> <span class="n">innocent</span><span class="p">.</span><span class="n">exe</span> <span class="n">readme</span><span class="p">.</span><span class="n">txt</span><span class="err">:</span><span class="n">naughty</span><span class="p">.</span><span class="n">exe</span>

<span class="c"># to run</span>
<span class="n">innocent</span><span class="p">.</span><span class="n">exe</span>
</code></pre></div><p>But <code>dir /r</code> - will display <strong>all</strong> streams. LNS and Sfind will hunt down such files. Also, when you copy files from and to a FAT partition - all residual files will be deleted.</p>
<p>On Windows machines (NTFS file system) it&rsquo;s possible to <em>&ldquo;append&rdquo;</em> a file to another file in such a way that this files is not visible with standard tools. This notion is called an <em>alternate data stream</em>. There are several problems that arise in this case:</p>
<ul>
<li>The <em>host</em> file&rsquo;s hash is not changed, because technically it is not a part of this file. To check - <code>fciv</code>.</li>
<li>The <em>host</em> file&rsquo;s size is not changed, again, because technically it is not a part of this file.</li>
<li>These files are not visible for the file system and therefore such tools as cmd, PowerShell, Explorer or others won&rsquo;t see them if don&rsquo;t know the magic ğŸª„ word. Even if you run <code>type filewithlitter.txt</code> you won&rsquo;t see the stream file&rsquo;s contents, only the original one&rsquo;s.</li>
</ul>
<h3 id="how-to-create-an-ads">How to create an ADS</h3>
<p><code>type litter.txt &gt; host.txt:litterhidden.txt</code></p>
<h3 id="how-to-check-a-directory-for-an-ads">How to check a directory for an ADS</h3>
<p><code>streams -s &lt;directory&gt;</code></p>
<h3 id="how-to-get-a-file-from-a-stream">How to get a file from a stream</h3>
<p>You need to know its name to be able to reference it:</p>
<p><code>notepad host.txt:litterhidden.txt</code></p>
<p>If you find a program file with an executable attached, it&rsquo;s almoust always means something malicious is at place. Sometimes, attackers might hide the extension. In this case the file size might be a good reason to dig deeper.</p>
<h3 id="how-to-delete-the-stream">How to delete the stream</h3>
<p><code>streams -s -d &lt;directory&gt;</code>. Quite dangerous since you might delete something good instead. Some system files are stored as streams for legitimate reasons. Why, btw?</p>
<h2 id="macos">macOS</h2>
<h3 id="appstore-downloads">AppStore Downloads</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">/Library/Receipts/InstallHistory.plist
</code></pre></div><h3 id="search">Search</h3>
<h4 id="spotlight-shortcuts">Spotlight shortcuts</h4>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">/Users/%username%/Library/Application Support/com.apple.spotlight.Shortcuts
</code></pre></div><h4 id="finder-mru">Finder MRU</h4>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">/Users/%username%/Library/Preferences/com.apple.finder.plist
</code></pre></div><h2 id="references">References</h2>
<p>[<a href="https://learning.oreilly.com/videos/digital-archaeology-livelessons/9780132853835/">1</a>] Digital Archaeology Live Lessons by [Michael W Graves](<a href="https://learning.oreilly.com/search/?query=author%3A%22Michael">https://learning.oreilly.com/search/?query=author%3A&quot;Michael</a> W Graves&quot;&amp;page=0)</p>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.1237ff71925bb8625c97a9af8db4c54525258bedfd7c47493daaff723bea755e.js"></script>
  

  
  
  
    
  


</body>

</html>
