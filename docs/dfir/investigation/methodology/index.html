<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏃‍♂️ Recent Activity Methodology - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
    <li class="menu-item-notes 📝">
      <a href="/docs/notes">
        <span>Notes 📝</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
    <li class="menu-item-notes 📝">
      <a href="/docs/notes">
        <span>Notes 📝</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/investigation/"> 👈🏼 Back to </br> 🔎 Incident Investigation </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#techniques">Techniques</a></li>
    <li><a href="#common-activity-indicators">Common Activity Indicators</a>
      <ul>
        <li><a href="#secondary-artefacts">Secondary artefacts</a></li>
        <li><a href="#primary-artefacts">Primary Artefacts</a></li>
      </ul>
    </li>
    <li><a href="#how-to-prove-compromise">How to prove compromise❓</a></li>
    <li><a href="#how-to-prove-intent-">How to prove intent ❓</a></li>
    <li><a href="#how-to-prove-user-awareness-">How to prove user awareness ❓</a></li>
    <li><a href="#user-activity">User Activity</a>
      <ul>
        <li><a href="#dummy--vs-poopy-"><strong>Dummy</strong> 😬 vs <strong>Poopy</strong> 💩</a></li>
        <li><a href="#sheep--vs-others---and-"><strong>Sheep</strong> 🐑 vs <strong>others</strong> 💩, 😬 and 🦓</a></li>
        <li><a href="#poopy--vs-donkey-"><strong>Poopy</strong> 💩 vs <strong>donkey</strong> 🦓</a></li>
        <li><a href="#poopy--and-donkey--vs-others--and-"><strong>Poopy</strong> 💩 and <strong>donkey</strong> 🦓 vs <strong>others</strong> 😬 and 🐑</a></li>
      </ul>
    </li>
    <li><a href="#configuration-changes">Configuration Changes</a>
      <ul>
        <li><a href="#getting-access">Getting Access</a></li>
        <li><a href="#avoiding-detection">Avoiding detection</a></li>
        <li><a href="#response">Response</a></li>
        <li><a href="#malware-assist">Malware Assist</a></li>
      </ul>
    </li>
    <li><a href="#malware-analysis">Malware Analysis</a>
      <ul>
        <li><a href="#persistence-mechanisms">Persistence Mechanisms</a></li>
        <li><a href="#malware-evasion-techniques">Malware Evasion Techniques</a></li>
      </ul>
    </li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">🏃‍♂️ Recent Activity Methodology</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      
      <div class="article-category">
          
            
            
            
            
            
              <i class="fab fa-linux"></i>&nbsp;<i class="fab fa-apple"></i>&nbsp;<i class="fab fa-windows"></i>&nbsp;<i class="fas fa-mobile"></i>
            
            
          
          
      </div> <br />
      

      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <p><em>Basically, all of the artefacts that are listed in the Investigation section fall under the category &ldquo;user activity&rdquo; one way or another. Even if some process spawned some other process, somewhere in the past the user interaction was still required. That&rsquo;s why I find it so hard to find the perfect categorization. I&rsquo;ve decided to devote this section to common strategies of how one would investigate user activity and which artefacts they would use at what point in time.</em></p>
<h2 id="techniques">Techniques</h2>
<p>There are a couple of techniques to use. This can be applied to everything: logs, dynamic malware analysis, user activity, folder activity, system events etc.</p>
<p>On of them is called &ldquo;<strong>Find Evil</strong>&rdquo; 👿. For this method you need to know a baseline. It helps to run some collection for a clean system to see what the baseline is for this OS/setup if you are unsure. Otherwise, by just looking at the data you might noticing something standing out, like a Windows core process spawned from the wrong direction or a HTTP traffic flowing back and forth from a <code>java.exe</code>. Another example, something like a sudden increased amount of requests to the server could be an indication of nefarious activity. Again, you need to know the baseline to be able to tell that something is wrong.</p>
<p>🛠 Typically, this kind of stuff (spikes) are picked up by the IDS/IPS/WAF systems quite neatly.</p>
<p>A little more sophisticated &ldquo;Find Evil&rdquo; technique is what I call <strong>behavioral analysis</strong>. For this method you need to think like an attacker as well as a normal user. For example, for a normal use the failed login process would look something like the following:</p>
<ul>
<li>First login attempt - error</li>
<li>Second login attempt - error</li>
<li>Third login attempt - error</li>
<li>Reset password</li>
<li>Login</li>
</ul>
<p>For a malicious user it would be something like (bruteforcing):</p>
<ul>
<li>First login attempt - error</li>
<li>Second login attempt - error</li>
<li>N-login attempt - account blocked</li>
<li>Sleep for N minutes</li>
<li>M-login attempt - error</li>
<li>etc</li>
</ul>
<p>For a malicious user attempting password spraying attack (when one password is used for different accounts), you are likely to something like the following:</p>
<ul>
<li>First login attempt - error</li>
<li>Second login attempt - error</li>
<li>Third login attempt - error</li>
<li>Stop (no successful login or password reset)</li>
</ul>
<p>Another technique is called <strong>frequency analysis</strong> 📊. Depending on the system, you&rsquo;d look either for something more or less frequent. It&rsquo;s hard to cover all the cases, but maybe a couple of examples will do the trick. For example, you have a webserver. Most of the time, with the normal traffic and no malicious activity there would be 200 status codes returned by the server. However, if an attacker performs a bruteforce attack against user accounts or IDOR probing, you would see a spike in the amount 403 (access denied) HTTP status code. If the attacker were to perform some directory busting, you would probably see a spike in 404.</p>
<p>🛠 SIEM/IDS + ML (machine learning engine) could help in identifying those &ldquo;unusual things&rdquo;. Some SIEM would allow making rules based on different log fields. So, for example, in the above scenario one could create a rule to alert the CSIRT if a 100 threshold for 404 HTTP status code returned is hit in 1 minute.</p>
<p>One more technique that I have been using I call <strong>pattern analysis</strong>. For this one needs to be VERY knowledgable about red teaming activities and current vulnerabilties. Not to overwhelm yourself with the vulnerabilties and exploits out there, filter the news and feeds to only show those that are relevant for your environment. For example, see only Apache Tomcat stuff, PHP and, for example, nginx + common web applicaiton vulnerabilties. Patterns for each vulnerabilty exploited would be different, of course. For example, for a SQLi it&rsquo;s something like a single quote (<code>'</code>) or <code>sleep</code> keyword (also could be an indicator of command line injection) or some other pattern like <code>'or%201=1--</code> or anything from <a href="https://github.com/payloadbox/sql-injection-payload-list">list</a> and even more. For common vulnerabilities you can find the list of payloads (patterns) online to get a general idea.</p>
<p>🛠 For post-incident analysys, I personally find it useful to use Excel/Numbers due to their advanced pivoting and filtering functionality. It&rsquo;s useful for both frequency and pattern analysis. This, however, will only work for offline analysis and only on the data that&rsquo;s not too overwhelming. SIEM tools can also be very handy for visualisation and filtering if you are familiar with the quering language.</p>
<p>So, it is useeful to know the red team operations and possible attacks for your infrastructure, as well as a normal user behaviour.</p>
<h2 id="common-activity-indicators">Common Activity Indicators</h2>
<p>Below is the list of the most common artefacts that could be used to determine user activity. Some of them are mobile specific.</p>
<p>I&rsquo;ve devided them into two main groups: primary and secondary. Primary artefacts are those that are specifically designed to provide this information. For example, you can view contacts via address book or read SMS messages.</p>
<p>Secondary artefacts are like data lakes: they aggreagate lots sort of information that might or might not contain something relevant. In requires wits and analysis in order to retrieve something useful from there if anything is there. For example, to determine if a person knows another person, you could see their contact list (which is the easiest way). However, not all connections are added there. So, you&rsquo;d probably refer to mailing activity as well. The last resort would be to see photos and videos in order to find a familiar face. There is small chance to also find this information in some notes. For example, &ldquo;I met Julia Roberts yesterday on the tube! Imagine that!&rdquo; Some artefacts are listed both under secondary and primary sections since for some purposes they might be secondary. For example, social media is basically a very sophisticated address book + messages system. However, there are feeds there as well and as with all messages in general you sometime find something relevant there. For instance, if you are not sure if the person did work this day and check their social media page where there was a photo from a bar posted at 2pm on Thursday (too early, ey!), you might be relatively sure that no, the person was no at work that time.</p>
<h3 id="secondary-artefacts">Secondary artefacts</h3>
<ul>
<li>Notes</li>
<li>Voice assistant&rsquo;s logs</li>
<li>Browser activity</li>
<li>Photos, videos (local, online)</li>
<li>Screen or voice recordings</li>
<li>Calendar events</li>
<li>Music</li>
<li>Gaming</li>
<li>Social media</li>
</ul>
<h3 id="primary-artefacts">Primary Artefacts</h3>
<ul>
<li>👥 Contacts and Connections
<ul>
<li>📖 Address book</li>
<li>💬 Messangers</li>
<li>💬 Social media</li>
<li>✉️ Mail</li>
<li>SMS/MMS</li>
<li>☎️ Call history (video, phone)</li>
</ul>
</li>
<li>🗺 Geo posisition
<ul>
<li>Device IP</li>
<li>Traffic (if logged)</li>
<li>Social communications metadata</li>
<li>Maps applications</li>
<li>VPNs used (logs if any)</li>
<li>Photos and videos</li>
<li>Documents saved/downloaded/deleted/modified</li>
<li>Calendar events</li>
<li>Web browsing</li>
<li>Screen or voice recordings</li>
</ul>
</li>
<li>Computer Activity
<ul>
<li>System logs (logs, prefetch, events etc)</li>
<li>Documents saved/downloaded/deleted/modified/renamed/copied</li>
<li>Folders traversed</li>
<li>USB and other external media attached</li>
<li>Processes running/terminated/spawned</li>
<li>Encryption/wiping software usage</li>
<li>Shortcuts, symbolic links and links</li>
<li>Configuration files (etc, plist, registry)</li>
<li>Network connections opened/closed</li>
</ul>
</li>
</ul>
<h2 id="how-to-prove-compromise">How to prove compromise❓</h2>
<p>Lot&rsquo;s of attacks involve account compromise. In some cases malware is not even needed. There are several arguments for the defence: <em>I didn&rsquo;t know</em>, <em>It was not me</em>, <em>It was a malware</em> and <em>It happened accidently</em>.</p>
<p>✍️ <strong>Suspicious logins?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> Should this user use this account?</li>
<li><input disabled="" type="checkbox"> Are they new to the computer?</li>
<li><input disabled="" type="checkbox"> If remote, does the account usually come from that computer?</li>
<li><input disabled="" type="checkbox"> Is the time expected?</li>
<li><input disabled="" type="checkbox"> Does the account have lots of failed logins? 👉 <em>A very strong indicator of compromise</em></li>
<li><input disabled="" type="checkbox"> A login during time when the user was absent 👉 <em>A very strong indicator of compromise</em></li>
</ul>
<p>✍️ <strong>Malware</strong>. There is a separate section for malware, but it can be a strong defense for some one claiming his or her account was compromised. But! ⚠️ Even if there is a malware found, it&rsquo;s essential to prove that it existed <strong>at the time</strong> that some investigated activity took place.</p>
<h2 id="how-to-prove-intent-">How to prove intent ❓</h2>
<p><em>❓  So, back to the question. How to prove that the user knows?</em></p>
<p>✍️ <strong>Suspicious activity?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> <strong>What searches were performed?</strong>
<ul>
<li><input disabled="" type="checkbox"> Search relevant to job role?</li>
<li><input disabled="" type="checkbox"> Search for malicious progs or techniques?</li>
<li><input disabled="" type="checkbox"> Was there an attempt to delete the evidence? For example, browser cache cleared <em>manually</em>, depends on this browser settings.</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Access resources</strong>.
<ul>
<li><input disabled="" type="checkbox"> Accessed malwebsite?</li>
<li><input disabled="" type="checkbox"> Network shares?</li>
<li><input disabled="" type="checkbox"> Mass copy? 👉 <em>Might be an indicator of data exfiltration.</em></li>
<li><input disabled="" type="checkbox"> Was it a result of a redirect (300 HTTP or header redirect, or pop-up) 👉 <em>May help the defending side if this can be proved.</em></li>
<li><input disabled="" type="checkbox"> File accessed soon after creation? 👉 <em>Might be an indicator of some automated task, or not&hellip;.</em>.</li>
<li><input disabled="" type="checkbox"> Was a file deleted/wiped? 👉 <em>File wiped is a strong indiator of intent.</em> 🛠 Directory Snoop can show that the file was wiped, not simply deleted. Not all wiping software clears the <code>$MFT</code> table.</li>
<li><input disabled="" type="checkbox"> What devices were attached?</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Remotely executed code</strong>. Remote host + username; interactive or cmd; time. Registry. Event logs for logins and Event login for remote processes.
<ul>
<li><input disabled="" type="checkbox"> Remote = local?</li>
<li><input disabled="" type="checkbox"> Expected?</li>
<li><input disabled="" type="checkbox"> Prog expected?</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Communications</strong>. Messangers, emails, social networking, forums, websites.
<ul>
<li><input disabled="" type="checkbox"> Determine all the mail clients used and use this information to find artefacts. ❗️❗️❗️❗️ Link to collection.</li>
<li><input disabled="" type="checkbox"> Relevant threads (<code>strings</code> + <code>grep</code> or DFIR framework).</li>
<li><input disabled="" type="checkbox"> IP in mail spoofed?</li>
</ul>
</li>
</ul>
<p>👣 User started processes (Event log, RunMRU, MUICache, UserAssist, AppCompatCache or Shimcache, BAM (Background activity monitor), RecentApps, RecentFilecache or AmCache, SRUM (system resource usage monitor), Windows Timeline, Prefetch).</p>
<p>👣 Terms and time when the search was performed. Web artifacts and saved previous searches.</p>
<p>👣 Includes Host (remote or local), path, time. (configs like history of browser; recently used files, process handles). FileExplorer&rsquo;s ShellBags (what folder was opened) and RunMRU,Application Most Recently Used Files, Web artifacts (cookies, history, db, cache), Memory (commands, remote desk info, paths), cont monitoring.</p>
<p>👣 Event logs, domain logs. The below question may help finding a malicious user (hacker) or malicious insider with intent. More <a href="/docs/dfir/forensic-investigation/4-accounts">here</a>.</p>
<p>👣 Mails. ❗️❗️❗️❗️ Link to collection.</p>
<h2 id="how-to-prove-user-awareness-">How to prove user awareness ❓</h2>
<p>✍️ It&rsquo;s often not enough just to find a file on a system. One needs to prove <strong>the intent</strong>. Remember to use more than one artifact whenever possible! For example, the user may be insisting that he or she did not download this file. But, if the browser was set to flush data every 7 days and the timestamps for the deleted file shows it was deleted an hour after it was deleted - this might raiser some reasonable doubt I think 🤔. Or, the file was wiped 🧹 (it&rsquo;s contents filled with <code>0</code>s). If one didn&rsquo;t know it existed, why delete it? Or there is no data on the PC indicating the use of the file, but it was continuously downloaded/uploaded according to the server logs. ⚠️ This, however, won&rsquo;t prove that there was no hacker in place!</p>
<h2 id="user-activity">User Activity</h2>
<p>Actually, as I read further an further, it seems that everything is about a user. But!</p>
<p>A user can be of several categories. I&rsquo;ll name each one as shortly as I can to refer to them in future. But I will describe them in more detail below.</p>
<p><strong>Legitimate user, who has done something bad by accident</strong>. Let&rsquo;s call him a <strong>dummy</strong> 😬. I&rsquo;ve been there, I once changed permissions to <code>Deny</code> for my admin account to disk <code>C</code> on Windows and could do nothing about it later. How stupid was it 🙈? My excuse is that I only started with PCs&hellip; .</p>
<p><strong>Legitimate user, who has done something bad by intent.</strong> Let&rsquo;s call this one a <strong>poopy</strong> 💩. Say, he or she feels highy underpaid and sells company&rsquo;s kitty plans to some evil dog hackers.</p>
<p><strong>A user created and used by a hacker.</strong> This one I will call a <strong>sheep</strong> 🐑  as in <em>A wolf in sheep&rsquo;s clothing</em>, since the attacker is trying mask itself as something good.  This one is not unusual, but I guess, easily determined by the sysadmin. However, there are some cases, when an attacker can change view permissions for his/her account on AD so that no one will see this user.</p>
<p><strong>A user created legitimately, but compromised by a hacker and doing something by intent.</strong> This one will be a <strong>donkey</strong> 🦓, as the attaker is using another account for his ride. I guess it&rsquo;s the most common when the hackers are in the picture.</p>
<p>And here are the questions we will have to answer during investigations, that can help in distinguishing between these types.</p>
<h3 id="dummy--vs-poopy-"><strong>Dummy</strong> 😬 vs <strong>Poopy</strong> 💩</h3>
<p><em>❓ How to prove that the person didn&rsquo;t do it on purpose, but by accident?</em></p>
<p>✍️ It&rsquo;s often not enough just to find a file on a system. One needs to prove <strong>the intent</strong>. Remember to use more than one artifact whenever possible! For example, the user may be insisting that he or she did not download this file. But, if the browser was set to flush data every 7 days and the timestamps for the deleted file shows it was deleted an hour after it was deleted - this might raiser some reasonable doubt think 🤔. Or, the file was wiped 🧹 (it&rsquo;s contents filled with <code>0</code>s). If one didn&rsquo;t know it existed, why delete it? Or there is no data on the PC indicating the use of the file, but it was continuously downloaded/uploaded according to the server logs. ⚠️ This, however, won&rsquo;t prove that there was no hacker in place!</p>
<h3 id="sheep--vs-others---and-"><strong>Sheep</strong> 🐑 vs <strong>others</strong> 💩, 😬 and 🦓</h3>
<p>✍️ <strong>Are there suspicious accounts?</strong> 👣 SAM reg hive (local and domain). Even if the account is deleted, then you can still spot it: user directory sometimes is retained and also check logs. The below question may help finding a malicious user (hacker). More <a href="/docs/dfir/forensic-investigation/accounts">here</a>.</p>
<ul>
<li><input disabled="" type="checkbox"> User Name does not match conventions for this organisation?</li>
<li><input disabled="" type="checkbox"> Weird priviledges</li>
<li><input disabled="" type="checkbox"> Scope (local or domain)</li>
<li><input disabled="" type="checkbox"> Creation time and date.</li>
</ul>
<h3 id="poopy--vs-donkey-"><strong>Poopy</strong> 💩 vs <strong>donkey</strong> 🦓</h3>
<p><em>❓ How to prove that the account was compromised?</em></p>
<p>Lot&rsquo;s of attacks involve account compromise. In some cases malware is not even needed. There are several arguments for the defence: <em>I didn&rsquo;t know</em>, <em>It was not me</em>, <em>It was a malware</em> and <em>It happened accidently</em>.</p>
<p>✍️ <strong>Suspicious logins?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> Should this user use this account?</li>
<li><input disabled="" type="checkbox"> Are they new to the computer?</li>
<li><input disabled="" type="checkbox"> If remote, does the account usually come from that computer?</li>
<li><input disabled="" type="checkbox"> Is the time expected?</li>
<li><input disabled="" type="checkbox"> Does the account have lots of failed logins? 👉 <em>A very strong indicator of compromise</em></li>
<li><input disabled="" type="checkbox"> A login during time when the user was absent 👉 <em>A very strong indicator of compromise</em></li>
</ul>
<p>✍️ <strong>Malware</strong>. There is a separate section for malware above ☝️, but it can be a strong defense for some one claiming his or her account was compromised. But! ⚠️ Even if there is a malware found, it&rsquo;s essential to prove that it existed at the time that some investigated activity took place.</p>
<h3 id="poopy--and-donkey--vs-others--and-"><strong>Poopy</strong> 💩 and <strong>donkey</strong> 🦓 vs <strong>others</strong> 😬 and 🐑</h3>
<p>✍️ <strong>Suspicious activity?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> <strong>What searches were performed?</strong>
<ul>
<li><input disabled="" type="checkbox"> Search relevant to job role?</li>
<li><input disabled="" type="checkbox"> Search for malicious progs or techniques?</li>
<li><input disabled="" type="checkbox"> Was there an attempt to delete the evidence? For example, browser cache cleared <em>manually</em>, depends on this browser settings.</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Access resources</strong>.
<ul>
<li><input disabled="" type="checkbox"> Accessed malwebsite?</li>
<li><input disabled="" type="checkbox"> Network shares?</li>
<li><input disabled="" type="checkbox"> Mass copy? 👉 <em>Might be an indicator of data exfiltration.</em></li>
<li><input disabled="" type="checkbox"> Was it a result of a redirect (300 HTTP or header redirect, or pop-up) 👉 <em>May help the defending side if this can be proved.</em></li>
<li><input disabled="" type="checkbox"> File accessed soon after creation? 👉 <em>Might be an indicator of some automated task, or not&hellip;.</em>.</li>
<li><input disabled="" type="checkbox"> Was a file deleted/wiped? 👉 <em>File wiped is a strong indiator of intent.</em> 🛠 Directory Snoop can show that the file was wiped, not simply deleted. Not all wiping software clears the <code>$MFT</code> table.</li>
<li><input disabled="" type="checkbox"> What devices were attached?</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Remotely executed code</strong>. Remote host + username; interactive or cmd; time. Registry. Event logs for logins and Event login for remote processes.
<ul>
<li><input disabled="" type="checkbox"> Remote = local?</li>
<li><input disabled="" type="checkbox"> Expected?</li>
<li><input disabled="" type="checkbox"> Prog expected?</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Communications</strong>. Messangers, emails, social networking, forums, websites.
<ul>
<li><input disabled="" type="checkbox"> Determine all the mail clients used and use this information to find artefacts. ❗️❗️❗️❗️ Link to collection.</li>
<li><input disabled="" type="checkbox"> Relevant threads (<code>strings</code> + <code>grep</code> or DFIR framework).</li>
<li><input disabled="" type="checkbox"> IP in mail spoofed?</li>
</ul>
</li>
</ul>
<p>👣 User started processes (Event log, RunMRU, MUICache, UserAssist, AppCompatCache or Shimcache, BAM (Background activity monitor), RecentApps, RecentFilecache or AmCache, SRUM (system resource usage monitor), Windows Timeline, Prefetch).</p>
<p>👣 Terms and time when the search was performed. Web artifacts and saved previous searches.</p>
<p>👣 Includes Host (remote or local), path, time. (configs like history of browser; recently used files, process handles). FileExplorer&rsquo;s ShellBags (what folder was opened) and RunMRU,Application Most Recently Used Files, Web artifacts (cookies, history, db, cache), Memory (commands, remote desk info, paths), cont monitoring.</p>
<p>👣 Event logs, domain logs. The below question may help finding a malicious user (hacker) or malicious insider with intent. More <a href="/docs/dfir/forensic-investigation/4-accounts">here</a>.</p>
<p>👣 Mails. ❗️❗️❗️❗️ Link to collection.</p>
<h2 id="configuration-changes">Configuration Changes</h2>
<p><em>🔎 What are we looking for? Remote access, detection prevention, response challenges, malware enablement.</em></p>
<p>Can be hard (no consistency). Are they different by accident or from malicous intent. Baseline reference (what the settings should be). Configs have only one place to set thing. Attacker motivation:</p>
<ul>
<li>Get access</li>
<li>Avoid detection</li>
<li>Make the response harder</li>
<li>Make malware to work</li>
</ul>
<h3 id="getting-access">Getting Access</h3>
<ol>
<li>has the remote access been enabled?</li>
<li>file sharing enabled?</li>
<li>config to launch different progs?</li>
</ol>
<h3 id="avoiding-detection">Avoiding detection</h3>
<p>Common anti-forensic techniques.</p>
<p>prevent detection (disable firewalls, anti-virus). Rootkits are in malware section.</p>
<ol>
<li>have any prevention tools been disabled?</li>
<li>installed mal certificates to trick prevention tools?</li>
<li>have many detection tools been disabled?</li>
</ol>
<p>Read more about the above techniques: <a href="https://isc.sans.edu/diary/Wipe+the+drive+Stealthy+Malware+Persistence+Mechanism+-+Part+1/15394">Wipe the drive! Stealthy Malware Persistence - Part 1</a> and <a href="https://isc.sans.edu/forums/diary/Wipe+the+drive+Stealthy+Malware+Persistence+Part+2/15406/">Wipe the drive! Stealthy Malware Persistence - Part 2</a>.</p>
<h3 id="response">Response</h3>
<p>Response harder (disable endpoint visibility, accounts (or reduce privs), reduce or disable logs, backups, volume shadow)</p>
<ol>
<li>Were any accs disabled?</li>
<li>Visibility tools disabled?</li>
<li>Settings to record less data
<ol>
<li>audit settings changed?</li>
<li>logs cleared</li>
<li>Backup disabled?</li>
</ol>
</li>
</ol>
<h3 id="malware-assist">Malware Assist</h3>
<p>Changes needed by malware? Change exe path, lib path, hosts file.</p>
<p>👣 <strong>On a Windows machine.</strong> Registry, Congif files (app specific or OS).</p>
<h2 id="malware-analysis">Malware Analysis</h2>
<p>I have a separate section devoted to malware analysis methodology, tips, etc - <a href="/docs/reverse/malware-analysis">here</a>.</p>
<p><em>🔍 What are we looking for?</em> Persistence / start-up mechanisms, running processes and remnants left.</p>
<p><strong>SANS Six-Part Methodology</strong>, used to identify malicious processses:</p>
<ul>
<li><input disabled="" type="checkbox"> Identify rogue processes</li>
<li><input disabled="" type="checkbox"> Analyze DLLs and handles</li>
<li><input disabled="" type="checkbox"> Review network artifacts</li>
<li><input disabled="" type="checkbox"> Look for code injection</li>
<li><input disabled="" type="checkbox"> Check for any signs of a rootkit</li>
<li><input disabled="" type="checkbox"> Dump suspicious process and drivers</li>
</ul>
<p>👣 <em>What A/V solution is being used?</em> 🦠 🛑 If it&rsquo;s Windows, there might be just Windows Defender or some third-party AV. Find the logs for this particular AV solution. More <a href="/docs/dfir/host/windows/windows-artifacts#av-logs">here</a> about this Windows artifact. As for macOS, it has a built-in gatekeeper which logs all these alerts and can even detect known malware. More <a href="/docs/dfir/host/apple/mac-artifacts#Quarantine-files">here</a> about this macOS artifact.</p>
<p>🛠 Cyber Triage (uses WinAPI), SleuthKit, volatility modules, yara rules, AVs, Registry Explorer (for Windows reg analysis).</p>
<p>There are two main points to use as a start point for malware search: common persistence mechanism for the system, network connections and RAM. Below is the cheatsheet to use in order to find suspicious files. Each of these indicators are not 100%, but you can add scores and then reverse engineer only those highly suspicious to save up time.</p>
<ul>
<li>
<p><input disabled="" type="checkbox"> ✍️ <strong>Where to look for malware signs</strong>. May be it was removed or it&rsquo;s stealthy. Or may be it&rsquo;ll be too hard. Things that are left behind. The same artifacts that with processes in general (User Activity). There must be some signs that the malware was started (like, startup locations), run (logs, dump, registry etc) and shutdown (process termination logs, crash dumps, remnants in RAM etc).</p>
</li>
<li>
<p><input disabled="" type="checkbox"> <strong>Persistence mechanisms</strong>. More about persistence mechanism in the below section.</p>
</li>
<li>
<p><input disabled="" type="checkbox"> <strong>RAM</strong>.</p>
</li>
<li>
<p><input disabled="" type="checkbox"> <strong>Network triage</strong>
- <input disabled="" type="checkbox"> Connections (opened, closed, attempted)
- <input disabled="" type="checkbox"> Filter out Internal addresses</p>
</li>
<li>
<p><input disabled="" type="checkbox"> Check the remote connections. External IPs reputations. 🛠 <code>hostintel</code>.</p>
<ul>
<li><input disabled="" type="checkbox"> Executables that launched these connections</li>
<li><input disabled="" type="checkbox"> Port-services mismatch or unusual ports or services</li>
<li><input disabled="" type="checkbox"> Frequency. How frequently is the host connecting to another machine? For how long? May be it is something legitimate. But if it&rsquo;s recent or/and not regular - might be an indicator.</li>
<li><input disabled="" type="checkbox"> Unusual. Unusual application names, paths, typos or pokerhand ports (<code>44488</code> <code>12345</code> or alike). Or may some gibberish names. Unusual protocols - <code>1</code> (ICMP) <code>6</code> (TCP) <code>70</code> (UDP). Look for the ports outside of these three.</li>
</ul>
</li>
<li>
<p><input disabled="" type="checkbox"> ✍️ <strong>Put a score to all suspicious files</strong></p>
<ul>
<li><input disabled="" type="checkbox"> Signed executable.</li>
<li><input disabled="" type="checkbox"> Strings.</li>
<li><input disabled="" type="checkbox"> 32 bit application.</li>
<li><input disabled="" type="checkbox"> Atypical location.</li>
<li><input disabled="" type="checkbox"> Suspicious time.</li>
<li><input disabled="" type="checkbox"> Suspicious name.</li>
<li><input disabled="" type="checkbox"> Signs of reconnaissance stage.</li>
<li><input disabled="" type="checkbox"> Runtime linking.</li>
<li><input disabled="" type="checkbox"> Packed executables.</li>
<li><input disabled="" type="checkbox"> Hash.</li>
<li><input disabled="" type="checkbox"> Byte-level signatures.</li>
<li><input disabled="" type="checkbox"> Name/Path.</li>
<li><input disabled="" type="checkbox"> Unexpected owners.</li>
<li><input disabled="" type="checkbox"> Hidden by WinAPI.</li>
<li><input disabled="" type="checkbox"> Process taken over.</li>
<li><input disabled="" type="checkbox"> On-disk and in-memory contents don&rsquo;t match.</li>
<li><input disabled="" type="checkbox"> Unusual behaviour.</li>
</ul>
</li>
<li>
<p><input disabled="" type="checkbox"> ✍️ Put the suspicious files down into your IR/forensics sheet.</p>
</li>
<li>
<p><input disabled="" type="checkbox"> ✍️ Check what processes, dlls, handles, files and network connection were used by the suspicious process.</p>
</li>
</ul>
<h3 id="persistence-mechanisms">Persistence Mechanisms</h3>
<ul>
<li><input disabled="" type="checkbox"> ✍️ Are there mal <strong>triggered</strong> programs? Path to progs launched, when triggered (login, startup, schedule), user priv (service), creating date (unreliable).
<ul>
<li><input disabled="" type="checkbox"> Normally there?</li>
<li><input disabled="" type="checkbox"> Suspicious location?</li>
<li><input disabled="" type="checkbox"> Times similar to the event</li>
<li><input disabled="" type="checkbox"> Legitimate signature? Is the issuer trusted or is it self-signed?</li>
<li><input disabled="" type="checkbox"> Do you find it on other machines withing the enterprise?</li>
<li><input disabled="" type="checkbox"> <code>autoruns -v &lt;options&gt; &gt; output.csv</code>, <code> autoruns -accepteula -a * -s[verify digital signatures] -h[show file hashes] -c[output csv] -vr[query virus total] &gt; output.csv</code>, <code>autoruns -accepteula -a * -s -h -c -vr &gt; output.csv</code></li>
</ul>
</li>
<li><input disabled="" type="checkbox"> ✍️ Are there mal accidentally run (<strong>trick launch</strong>)?</li>
<li><input disabled="" type="checkbox"> ✍️ Are there libs accidentally loaded?
<ul>
<li><input disabled="" type="checkbox"> <strong>LoadLibraryPathFile</strong> - set of folders for finding and resolving libraries.</li>
<li><input disabled="" type="checkbox"> The same folder as the exe.</li>
</ul>
</li>
</ul>
<p>🗒 <em>Explore common autorun and persistence locations in order to find the files that are automatically run at <strong>startup</strong>.</em></p>
<p>🗒 <em>Among these entried find suspicious ones.</em></p>
<h3 id="malware-evasion-techniques">Malware Evasion Techniques</h3>
<p>Malware is not going to just always sit there and sing 🎶. Below are common techniques. More detailed explanation is in cirresponding section.</p>
<ul>
<li><input disabled="" type="checkbox"> Service Hijacking and Replacement.</li>
<li><input disabled="" type="checkbox"> Process Injection. Stealthy. Trivial identification using RAM analysis tools.</li>
<li><input disabled="" type="checkbox"> Filename/Service Hijacking.</li>
<li><input disabled="" type="checkbox"> ADS.</li>
<li><input disabled="" type="checkbox"> WebShells and Beacons.</li>
<li><input disabled="" type="checkbox"> Firmware.</li>
<li><input disabled="" type="checkbox"> DLL Injeciton.</li>
<li><input disabled="" type="checkbox"> A/V Bypass.</li>
<li><input disabled="" type="checkbox"> Defense Manipulation.</li>
<li><input disabled="" type="checkbox"> Frequent Compilation.</li>
<li><input disabled="" type="checkbox"> Binary Padding.</li>
<li><input disabled="" type="checkbox"> Armoring. It&rsquo;s useful to avoid A/V, but it&rsquo;s very suspicious and easy to spot. Examples: packed malware, polymorphic.</li>
<li><input disabled="" type="checkbox"> Dormant Malware 💤.  <em>I&rsquo;ll think about that tomorrow. Tomorrow is another day.</em> (c, Gone With The Wind).</li>
<li><input disabled="" type="checkbox"> Signing Code with Valid Cert. Thawte and Verisign are responsible for issuing ceritifacates for malware.</li>
<li><input disabled="" type="checkbox"> Anti-Forensics/Timestomping. Timestomping is used to modify the timestamps of a file.</li>
<li><input disabled="" type="checkbox"> Rootkits.</li>
<li><input disabled="" type="checkbox"> &ldquo;Fileless&rdquo; Malware.</li>
</ul>
  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.bafc052229b4b40bf03c477d31c5cdd9352ece8afbadf35ab97ed14495098fc9.js"></script>
  

  
  
  
    
  


</body>

</html>
