<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ—’ Checklist - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.9d91cbb32c96c334ae7b38c3d99d30727e0836e1182125cc5f007d215f0b9e59.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-forensics ğŸ” and incident response ğŸ¥·">
      <a href="/docs/dfir">
        <span>Forensics ğŸ” and Incident Response ğŸ¥·</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference ğŸ“š">
      <a href="/docs/reference">
        <span>Tech Reference ğŸ“š</span>
      </a>
    </li>
    
    <li class="menu-item-notes ğŸ“">
      <a href="/docs/notes">
        <span>Notes ğŸ“</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-forensics ğŸ” and incident response ğŸ¥·">
      <a href="/docs/dfir">
        <span>Forensics ğŸ” and Incident Response ğŸ¥·</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference ğŸ“š">
      <a href="/docs/reference">
        <span>Tech Reference ğŸ“š</span>
      </a>
    </li>
    
    <li class="menu-item-notes ğŸ“">
      <a href="/docs/notes">
        <span>Notes ğŸ“</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/investigation/"> Back to ğŸ” Incident Investigation Section ğŸ‘ˆğŸ¼ </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#image-info">Image Info</a></li>
    <li><a href="#malware-analysis">Malware Analysis</a>
      <ul>
        <li><a href="#persistence-mechanisms">Persistence Mechanisms</a></li>
        <li><a href="#malware-evasion-techniques">Malware Evasion Techniques</a></li>
      </ul>
    </li>
    <li><a href="#user-activity">User Activity</a>
      <ul>
        <li><a href="#dummy--vs-poopy-"><strong>Dummy</strong> ğŸ˜¬ vs <strong>Poopy</strong> ğŸ’©</a></li>
        <li><a href="#sheep--vs-others---and-"><strong>Sheep</strong> ğŸ‘ vs <strong>others</strong> ğŸ’©, ğŸ˜¬ and ğŸ¦“</a></li>
        <li><a href="#poopy--vs-donkey-"><strong>Poopy</strong> ğŸ’© vs <strong>donkey</strong> ğŸ¦“</a></li>
        <li><a href="#poopy--and-donkey--vs-others--and-"><strong>Poopy</strong> ğŸ’© and <strong>donkey</strong> ğŸ¦“ vs <strong>others</strong> ğŸ˜¬ and ğŸ‘</a></li>
      </ul>
    </li>
    <li><a href="#configurations">Configurations</a>
      <ul>
        <li><a href="#getting-access">Getting Access</a></li>
        <li><a href="#avoiding-detection">Avoiding detection</a></li>
        <li><a href="#response">Response</a></li>
        <li><a href="#malware-assist">Malware Assist</a></li>
      </ul>
    </li>
    <li><a href="#how-to-prove-compromise">How to prove compromiseâ“</a></li>
    <li><a href="#how-to-prove-intent-">How to prove intent â“</a></li>
    <li><a href="#how-to-prove-user-awareness-">How to prove user awareness â“</a></li>
    <li><a href="#reference">Reference</a></li>
  </ul>
</nav>
 </aside>
 </div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">ğŸ—’ Checklist</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      <div class="article-category">domain: 
          
              
                <i class="fas fa-search"></i>
              
          <a class="category-link" href="/domain/forensics">forensics</a>
          
      </div> <br />
      
      <div class="article-category">doctype:
          
            
              
          <a class="platform-link" href="/doctype/methodology">methodology</a>
          
      </div> <br /><br/>
      
      
      
      

      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <p>First, have a template for an IR/forensics sheet. This can be done in Excel or other program alike. You can list all the evidence and hint and leads to follow there. It&rsquo;s better to specify the machine that contained that evidence, the command and program used to find it, path to the evidence, why you think it&rsquo;s suspicious etc. You may divide leads, host indicators, network indicators on separate sheets.</p>
<h2 id="image-info">Image Info</h2>
<p>Use <code>sleuthkit</code> to gather some information. <code>mmstat &lt;disk_or_image&gt;</code> shows volume type. I&rsquo;ve ran this command, but as I can conclude by the output, it&rsquo;s not volume type, but rather a partition schema. I wonder, if these are the same things. <code>mmls -t &lt;partition_schema&gt; &lt;disk_or_image&gt;</code> shows the disk layout including unallocated space. Actually, no need to pass <code>&lt;partition_schema&gt;</code>, it&rsquo;s determined by the tool. Hence, no need to run <code>mmstat</code>. From the <code>mmls</code> we need to note the partition offset to use it with outher tools. For example, <code>fsstat -o &lt;offset&gt; &lt;disk_or_image&gt;</code> shows very detailed information about a partition. The output depends on the file system. For Linux ğŸ§ partitions it&rsquo;ll show informationn about inodes etc. For NTFS - about NTFS metadata, for exFAT - FAT1 and Root directory. The same information but more detailed can be viewed with ğŸ›  Active@Disk Editor. To view deleted files: <code>fls -o &lt;offset&gt; &lt;disk_or_image&gt;</code>. To export a timeline from the volume - <code>fls -r -m &quot;/&quot; -o &lt;offset&gt; &lt;disk_or_image&gt; &gt; bodyfile.txt</code> (<code>-r</code> - recursive, <code>-m</code> - use <code>mactime</code> input format to use with another tool, <code>\</code> - mount point question mark â“). To create timeline, run <code>mactime.pl -b &lt;bodyfile&gt; -d &gt; timeline.csv</code> [<a href="">1</a>]. To specify timezone, add <code>-z</code> switch.</p>
<p>[<a href="">1</a>] Windows Forensics Cookbook</p>
<h2 id="malware-analysis">Malware Analysis</h2>
<p><em>ğŸ” What are we looking for?</em> Persistence / start-up mechanisms, running processes and remnants left.</p>
<p><strong>SANS Six-Part Methodology</strong>, used to identify malicious processses:</p>
<ul>
<li><input disabled="" type="checkbox"> Identify rogue processes</li>
<li><input disabled="" type="checkbox"> Analyze DLLs and handles</li>
<li><input disabled="" type="checkbox"> Review network artifacts</li>
<li><input disabled="" type="checkbox"> Look for code injection</li>
<li><input disabled="" type="checkbox"> Check for any signs of a rootkit</li>
<li><input disabled="" type="checkbox"> Dump suspicious process and drivers</li>
</ul>
<p>ğŸ‘£ <em>What A/V solution is being used?</em> ğŸ¦  ğŸ›‘ If it&rsquo;s Windows, there might be just Windows Defender or some third-party AV. Find the logs for this particular AV solution. More <a href="/docs/dfir/host/windows/windows-artifacts#av-logs">here</a> about this Windows artifact. As for macOS, it has a built-in gatekeeper which logs all these alerts and can even detect known malware. More <a href="/docs/dfir/host/apple/mac-artifacts#Quarantine-files">here</a> about this macOS artifact.</p>
<p>ğŸ›  Cyber Triage (uses WinAPI), SleuthKit, volatility modules, yara rules, AVs, Registry Explorer (for Windows reg analysis).</p>
<p>There are two main points to use as a start point for malware search: common persistence mechanism for the system, network connections and RAM. Below is the cheatsheet to use in order to find suspicious files. Each of these indicators are not 100%, but you can add scores and then reverse engineer only those highly suspicious to save up time.</p>
<ul>
<li>
<p><input disabled="" type="checkbox"> âœï¸ <strong>Where to look for malware signs</strong>. May be it was removed or it&rsquo;s stealthy. Or may be it&rsquo;ll be too hard. Things that are left behind. The same artifacts that with processes in general (User Activity). There must be some signs that the malware was started (like, startup locations), run (logs, dump, registry etc) and shutdown (process termination logs, crash dumps, remnants in RAM etc).</p>
<ul>
<li>
<p><input disabled="" type="checkbox"> <strong>Persistence mechanisms</strong>. More about persistence mechanism in the below section.</p>
</li>
<li>
<p><input disabled="" type="checkbox"> <strong>RAM</strong>.</p>
</li>
<li>
<p><input disabled="" type="checkbox"> <strong>Network triage</strong></p>
<ul>
<li>
<p><input disabled="" type="checkbox"> Connections (opened, closed, attempted)</p>
</li>
<li>
<p><input disabled="" type="checkbox"> Filter out Internal addresses</p>
</li>
<li>
<p><input disabled="" type="checkbox"> Check the remote connections. External IPs reputations. ğŸ›  <code>hostintel</code>.</p>
</li>
<li>
<p><input disabled="" type="checkbox"> Executables that launched these connections</p>
</li>
<li>
<p><input disabled="" type="checkbox"> Port-services mismatch or unusual ports or services</p>
</li>
<li>
<p><input disabled="" type="checkbox"> Frequency. How frequently is the host connecting to another machine? For how long? May be it is something legitimate. But if it&rsquo;s recent or/and not regular - might be an indicator.</p>
<p>Unusual. Unusual application names, paths, typos or pokerhand ports (<code>44488</code> <code>12345</code> or alike). Or may some gibberish names. Unusual protocols - <code>1</code> (ICMP) <code>6</code> (TCP) <code>70</code> (UDP). Look for the ports outside of these three.</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><input disabled="" type="checkbox"> âœï¸ <strong>Put a score to all suspicious files</strong></p>
<ul>
<li><input disabled="" type="checkbox"> Signed executable.</li>
<li><input disabled="" type="checkbox"> Strings.</li>
<li><input disabled="" type="checkbox"> 32 bit application.</li>
<li><input disabled="" type="checkbox"> Atypical location.</li>
<li><input disabled="" type="checkbox"> Suspicious time.</li>
<li><input disabled="" type="checkbox"> Suspicious name.</li>
<li><input disabled="" type="checkbox"> Signs of reconnaissance stage.</li>
<li><input disabled="" type="checkbox"> Runtime linking.</li>
<li><input disabled="" type="checkbox"> Packed executables.</li>
<li><input disabled="" type="checkbox"> Hash.</li>
<li><input disabled="" type="checkbox"> Byte-level signatures.</li>
<li><input disabled="" type="checkbox"> Name/Path.</li>
<li><input disabled="" type="checkbox"> Unexpected owners.</li>
<li><input disabled="" type="checkbox"> Hidden by WinAPI.</li>
<li><input disabled="" type="checkbox"> Process taken over.</li>
<li><input disabled="" type="checkbox"> On-disk and in-memory contents don&rsquo;t match.</li>
<li><input disabled="" type="checkbox"> Unusual behaviour.</li>
</ul>
</li>
<li>
<p><input disabled="" type="checkbox"> âœï¸ Put the suspicious files down into your IR/forensics sheet.</p>
</li>
<li>
<p><input disabled="" type="checkbox"> âœï¸ Check what processes, dlls, handles, files and network connection were used by the suspicious process.</p>
</li>
</ul>
<h3 id="persistence-mechanisms">Persistence Mechanisms</h3>
<ul>
<li><input disabled="" type="checkbox"> âœï¸ Are there mal <strong>triggered</strong> programs? Path to progs launched, when triggered (login, startup, schedule), user priv (service), creating date (unreliable).
<ul>
<li><input disabled="" type="checkbox"> Normally there?</li>
<li><input disabled="" type="checkbox"> Suspicious location?</li>
<li><input disabled="" type="checkbox"> Times similar to the event</li>
<li><input disabled="" type="checkbox"> Legitimate signature? Is the issuer trusted or is it self-signed?</li>
<li><input disabled="" type="checkbox"> Do you find it on other machines withing the enterprise?</li>
<li><input disabled="" type="checkbox"> <code>autoruns -v &lt;options&gt; &gt; output.csv</code>, <code>autoruns -accepteula -a * -s[verify digital signatures] -h[show file hashes] -c[output csv] -vr[query virus total] &gt; output.csv</code>, <code>autoruns -accepteula -a * -s -h -c -vr &gt; output.csv</code></li>
</ul>
</li>
<li><input disabled="" type="checkbox"> âœï¸ Are there mal accidentally run (<strong>trick launch</strong>)?
<ul>
<li><input disabled="" type="checkbox"> </li>
</ul>
</li>
<li><input disabled="" type="checkbox"> âœï¸ Are there libs accidentally loaded?
<ul>
<li><input disabled="" type="checkbox"> <strong>LoadLibraryPathFile</strong> - set of folders for finding and resolving libraries.</li>
<li><input disabled="" type="checkbox"> The same folder as the exe.</li>
</ul>
</li>
</ul>
<p>ğŸ—’ <em>Explore common autorun and persistence locations in order to find the files that are automatically run at <strong>startup</strong>.</em></p>
<p>ğŸ—’ <em>Among these entried find suspicious ones.</em></p>
<h3 id="malware-evasion-techniques">Malware Evasion Techniques</h3>
<p>Malware is not going to just always sit there and sing ğŸ¶. Below are common techniques. More detailed explanation is in cirresponding section.</p>
<ul>
<li><input disabled="" type="checkbox"> Service Hijacking and Replacement.</li>
<li><input disabled="" type="checkbox"> Process Injection. Stealthy. Trivial identification using RAM analysis tools.</li>
<li><input disabled="" type="checkbox"> Filename/Service Hijacking.</li>
<li><input disabled="" type="checkbox"> ADS.</li>
<li><input disabled="" type="checkbox"> WebShells and Beacons.</li>
<li><input disabled="" type="checkbox"> Firmware.</li>
<li><input disabled="" type="checkbox"> DLL Injeciton.</li>
<li><input disabled="" type="checkbox"> A/V Bypass.</li>
<li><input disabled="" type="checkbox"> Defense Manipulation.</li>
<li><input disabled="" type="checkbox"> Frequent Compilation.</li>
<li><input disabled="" type="checkbox"> Binary Padding.</li>
<li><input disabled="" type="checkbox"> Armoring. It&rsquo;s useful to avoid A/V, but it&rsquo;s very suspicious and easy to spot. Examples: packed malware, polymorphic.</li>
<li><input disabled="" type="checkbox"> Dormant Malware ğŸ’¤.  <em>I&rsquo;ll think about that tomorrow. Tomorrow is another day.</em> (c, Gone With The Wind).</li>
<li><input disabled="" type="checkbox"> Signing Code with Valid Cert. Thawte and Verisign are responsible for issuing ceritifacates for malware.</li>
<li><input disabled="" type="checkbox"> Anti-Forensics/Timestomping. Timestomping is used to modify the timestamps of a file.</li>
<li><input disabled="" type="checkbox"> Rootkits.</li>
<li><input disabled="" type="checkbox"> &ldquo;Fileless&rdquo; Malware.</li>
</ul>
<h2 id="user-activity">User Activity</h2>
<p>Actually, as I read further an further, it seems that everything is about a user. But!</p>
<p>A user can be of several categories. I&rsquo;ll name each one as shortly as I can to refer to them in future. But I will describe them in more detail below.</p>
<p><strong>Legitimate user, who has done something bad by accident</strong>. Let&rsquo;s call him a <strong>dummy</strong> ğŸ˜¬. I&rsquo;ve been there, I once changed permissions to <code>Deny</code> for my admin account to disk <code>C</code> on Windows and could do nothing about it later. How stupid was it ğŸ™ˆ? My excuse is that I only started with PCs&hellip; .</p>
<p><strong>Legitimate user, who has done something bad by intent.</strong> Let&rsquo;s call this one a <strong>poopy</strong> ğŸ’©. Say, he or she feels highy underpaid and sells company&rsquo;s kitty plans to some evil dog hackers.</p>
<p><strong>A user created and used by a hacker.</strong> This one I will call a <strong>sheep</strong> ğŸ‘  as in <em>A wolf in sheep&rsquo;s clothing</em>, since the attacker is trying mask itself as something good.  This one is not unusual, but I guess, easily determined by the sysadmin. However, there are some cases, when an attacker can change view permissions for his/her account on AD so that no one will see this user.</p>
<p><strong>A user created legitimately, but compromised by a hacker and doing something by intent.</strong> This one will be a <strong>donkey</strong> ğŸ¦“, as the attaker is using another account for his ride. I guess it&rsquo;s the most common when the hackers are in the picture.</p>
<p>And here are the questions we will have to answer during investigations, that can help in distinguishing between these types.</p>
<h3 id="dummy--vs-poopy-"><strong>Dummy</strong> ğŸ˜¬ vs <strong>Poopy</strong> ğŸ’©</h3>
<p><em>â“ How to prove that the person didn&rsquo;t do it on purpose, but by accident?</em></p>
<p>âœï¸ It&rsquo;s often not enough just to find a file on a system. One needs to prove <strong>the intent</strong>. Remember to use more than one artifact whenever possible! For example, the user may be insisting that he or she did not download this file. But, if the browser was set to flush data every 7 days and the timestamps for the deleted file shows it was deleted an hour after it was deleted - this might raiser some reasonable doubt think ğŸ¤”. Or, the file was wiped ğŸ§¹ (it&rsquo;s contents filled with <code>0</code>s). If one didn&rsquo;t know it existed, why delete it? Or there is no data on the PC indicating the use of the file, but it was continuously downloaded/uploaded according to the server logs. âš ï¸ This, however, won&rsquo;t prove that there was no hacker in place!</p>
<h3 id="sheep--vs-others---and-"><strong>Sheep</strong> ğŸ‘ vs <strong>others</strong> ğŸ’©, ğŸ˜¬ and ğŸ¦“</h3>
<p>âœï¸ <strong>Are there suspicious accounts?</strong> ğŸ‘£ SAM reg hive (local and domain). Even if the account is deleted, then you can still spot it: user directory sometimes is retained and also check logs. The below question may help finding a malicious user (hacker). More <a href="/docs/dfir/forensic-investigation/accounts">here</a>.</p>
<ul>
<li><input disabled="" type="checkbox"> User Name does not match conventions for this organisation?</li>
<li><input disabled="" type="checkbox"> Weird priviledges</li>
<li><input disabled="" type="checkbox"> Scope (local or domain)</li>
<li><input disabled="" type="checkbox"> Creation time and date.</li>
</ul>
<h3 id="poopy--vs-donkey-"><strong>Poopy</strong> ğŸ’© vs <strong>donkey</strong> ğŸ¦“</h3>
<p><em>â“ How to prove that the account was compromised?</em></p>
<p>Lot&rsquo;s of attacks involve account compromise. In some cases malware is not even needed. There are several arguments for the defence: <em>I didn&rsquo;t know</em>, <em>It was not me</em>, <em>It was a malware</em> and <em>It happened accidently</em>.</p>
<p>âœï¸ <strong>Suspicious logins?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> Should this user use this account?</li>
<li><input disabled="" type="checkbox"> Are they new to the computer?</li>
<li><input disabled="" type="checkbox"> If remote, does the account usually come from that computer?</li>
<li><input disabled="" type="checkbox"> Is the time expected?</li>
<li><input disabled="" type="checkbox"> Does the account have lots of failed logins? ğŸ‘‰ <em>A very strong indicator of compromise</em></li>
<li><input disabled="" type="checkbox"> A login during time when the user was absent ğŸ‘‰ <em>A very strong indicator of compromise</em></li>
</ul>
<p>âœï¸ <strong>Malware</strong>. There is a separate section for malware above â˜ï¸, but it can be a strong defense for some one claiming his or her account was compromised. But! âš ï¸ Even if there is a malware found, it&rsquo;s essential to prove that it existed at the time that some investigated activity took place.</p>
<h3 id="poopy--and-donkey--vs-others--and-"><strong>Poopy</strong> ğŸ’© and <strong>donkey</strong> ğŸ¦“ vs <strong>others</strong> ğŸ˜¬ and ğŸ‘</h3>
<p>âœï¸ <strong>Suspicious activity?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> <strong>What searches were performed?</strong>
<ul>
<li><input disabled="" type="checkbox"> Search relevant to job role?</li>
<li><input disabled="" type="checkbox"> Search for malicious progs or techniques?</li>
<li><input disabled="" type="checkbox"> Was there an attempt to delete the evidence? For example, browser cache cleared <em>manually</em>, depends on this browser settings.</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Access resources</strong>.
<ul>
<li><input disabled="" type="checkbox"> Accessed malwebsite?</li>
<li><input disabled="" type="checkbox"> Network shares?</li>
<li><input disabled="" type="checkbox"> Mass copy? ğŸ‘‰ <em>Might be an indicator of data exfiltration.</em></li>
<li><input disabled="" type="checkbox"> Was it a result of a redirect (300 HTTP or header redirect, or pop-up) ğŸ‘‰ <em>May help the defending side if this can be proved.</em></li>
<li><input disabled="" type="checkbox"> File accessed soon after creation? ğŸ‘‰ <em>Might be an indicator of some automated task, or not&hellip;.</em>.</li>
<li><input disabled="" type="checkbox"> Was a file deleted/wiped? ğŸ‘‰ <em>File wiped is a strong indiator of intent.</em> ğŸ›  Directory Snoop can show that the file was wiped, not simply deleted. Not all wiping software clears the <code>$MFT</code> table.</li>
<li><input disabled="" type="checkbox"> What devices were attached?</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Remotely executed code</strong>. Remote host + username; interactive or cmd; time. Registry. Event logs for logins and Event login for remote processes.
<ul>
<li><input disabled="" type="checkbox"> Remote = local?</li>
<li><input disabled="" type="checkbox"> Expected?</li>
<li><input disabled="" type="checkbox"> Prog expected?</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Communications</strong>. Messangers, emails, social networking, forums, websites.
<ul>
<li><input disabled="" type="checkbox"> Determine all the mail clients used and use this information to find artefacts. â—ï¸â—ï¸â—ï¸â—ï¸ Link to collection.</li>
<li><input disabled="" type="checkbox"> Relevant threads (<code>strings</code> + <code>grep</code> or DFIR framework).</li>
<li><input disabled="" type="checkbox"> IP in mail spoofed?</li>
</ul>
</li>
</ul>
<p>ğŸ‘£ User started processes (Event log, RunMRU, MUICache, UserAssist, AppCompatCache or Shimcache, BAM (Background activity monitor), RecentApps, RecentFilecache or AmCache, SRUM (system resource usage monitor), Windows Timeline, Prefetch).</p>
<p>ğŸ‘£ Terms and time when the search was performed. Web artifacts and saved previous searches.</p>
<p>ğŸ‘£ Includes Host (remote or local), path, time. (configs like history of browser; recently used files, process handles). FileExplorer&rsquo;s ShellBags (what folder was opened) and RunMRU,Application Most Recently Used Files, Web artifacts (cookies, history, db, cache), Memory (commands, remote desk info, paths), cont monitoring.</p>
<p>ğŸ‘£ Event logs, domain logs. The below question may help finding a malicious user (hacker) or malicious insider with intent. More <a href="/docs/dfir/forensic-investigation/4-accounts">here</a>.</p>
<p>ğŸ‘£ Mails. â—ï¸â—ï¸â—ï¸â—ï¸ Link to collection.</p>
<h2 id="configurations">Configurations</h2>
<p><em>ğŸ” What are we looking for? Remote access, detection prevention, response challenges, malware enablement.</em></p>
<p>Can be hard (no consistency). Are they different by accident or from malicous intent. Baseline reference (what the settings should be). Configs have only one place to set thing. Attacker motivation:</p>
<ul>
<li>Get access</li>
<li>Avoid detection</li>
<li>Make the response harder</li>
<li>Make malware to work</li>
</ul>
<h3 id="getting-access">Getting Access</h3>
<ol>
<li>has the remote access been enabled?</li>
<li>file sharing enabled?</li>
<li>config to launch different progs?</li>
</ol>
<h3 id="avoiding-detection">Avoiding detection</h3>
<p>Common anti-forensic techniques.</p>
<p>prevent detection (disable firewalls, anti-virus). Rootkits are in malware section.</p>
<ol>
<li>have any prevention tools been disabled?</li>
<li>installed mal certificates to trick prevention tools?</li>
<li>have many detection tools been disabled?</li>
</ol>
<p>Read more about the above techniques: <a href="https://isc.sans.edu/diary/Wipe+the+drive+Stealthy+Malware+Persistence+Mechanism+-+Part+1/15394">Wipe the drive! Stealthy Malware Persistence - Part 1</a> and <a href="https://isc.sans.edu/forums/diary/Wipe+the+drive+Stealthy+Malware+Persistence+Part+2/15406/">Wipe the drive! Stealthy Malware Persistence - Part 2</a>.</p>
<h3 id="response">Response</h3>
<p>Response harder (disable endpoint visibility, accounts (or reduce privs), reduce or disable logs, backups, volume shadow)</p>
<ol>
<li>Were any accs disabled?</li>
<li>Visibility tools disabled?</li>
<li>Settings to record less data
<ol>
<li>audit settings changed?</li>
<li>logs cleared</li>
<li>Backup disabled?</li>
</ol>
</li>
</ol>
<h3 id="malware-assist">Malware Assist</h3>
<p>Changes needed by malware? Change exe path, lib path, hosts file.</p>
<p>ğŸ‘£ <strong>On a Windows machine.</strong> Registry, Congif files (app specific or OS).</p>
<h2 id="how-to-prove-compromise">How to prove compromiseâ“</h2>
<p>Lot&rsquo;s of attacks involve account compromise. In some cases malware is not even needed. There are several arguments for the defence: <em>I didn&rsquo;t know</em>, <em>It was not me</em>, <em>It was a malware</em> and <em>It happened accidently</em>.</p>
<p>âœï¸ <strong>Suspicious logins?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> Should this user use this account?</li>
<li><input disabled="" type="checkbox"> Are they new to the computer?</li>
<li><input disabled="" type="checkbox"> If remote, does the account usually come from that computer?</li>
<li><input disabled="" type="checkbox"> Is the time expected?</li>
<li><input disabled="" type="checkbox"> Does the account have lots of failed logins? ğŸ‘‰ <em>A very strong indicator of compromise</em></li>
<li><input disabled="" type="checkbox"> A login during time when the user was absent ğŸ‘‰ <em>A very strong indicator of compromise</em></li>
</ul>
<p>âœï¸ <strong>Malware</strong>. There is a separate section for malware, but it can be a strong defense for some one claiming his or her account was compromised. But! âš ï¸ Even if there is a malware found, it&rsquo;s essential to prove that it existed <strong>at the time</strong> that some investigated activity took place.</p>
<h2 id="how-to-prove-intent-">How to prove intent â“</h2>
<p><em>â“  So, back to the question. How to prove that the user knows?</em></p>
<p>âœï¸ <strong>Suspicious activity?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> <strong>What searches were performed?</strong>
<ul>
<li><input disabled="" type="checkbox"> Search relevant to job role?</li>
<li><input disabled="" type="checkbox"> Search for malicious progs or techniques?</li>
<li><input disabled="" type="checkbox"> Was there an attempt to delete the evidence? For example, browser cache cleared <em>manually</em>, depends on this browser settings.</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Access resources</strong>.
<ul>
<li><input disabled="" type="checkbox"> Accessed malwebsite?</li>
<li><input disabled="" type="checkbox"> Network shares?</li>
<li><input disabled="" type="checkbox"> Mass copy? ğŸ‘‰ <em>Might be an indicator of data exfiltration.</em></li>
<li><input disabled="" type="checkbox"> Was it a result of a redirect (300 HTTP or header redirect, or pop-up) ğŸ‘‰ <em>May help the defending side if this can be proved.</em></li>
<li><input disabled="" type="checkbox"> File accessed soon after creation? ğŸ‘‰ <em>Might be an indicator of some automated task, or not&hellip;.</em>.</li>
<li><input disabled="" type="checkbox"> Was a file deleted/wiped? ğŸ‘‰ <em>File wiped is a strong indiator of intent.</em> ğŸ›  Directory Snoop can show that the file was wiped, not simply deleted. Not all wiping software clears the <code>$MFT</code> table.</li>
<li><input disabled="" type="checkbox"> What devices were attached?</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Remotely executed code</strong>. Remote host + username; interactive or cmd; time. Registry. Event logs for logins and Event login for remote processes.
<ul>
<li><input disabled="" type="checkbox"> Remote = local?</li>
<li><input disabled="" type="checkbox"> Expected?</li>
<li><input disabled="" type="checkbox"> Prog expected?</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Communications</strong>. Messangers, emails, social networking, forums, websites.
<ul>
<li><input disabled="" type="checkbox"> Determine all the mail clients used and use this information to find artefacts. â—ï¸â—ï¸â—ï¸â—ï¸ Link to collection.</li>
<li><input disabled="" type="checkbox"> Relevant threads (<code>strings</code> + <code>grep</code> or DFIR framework).</li>
<li><input disabled="" type="checkbox"> IP in mail spoofed?</li>
</ul>
</li>
</ul>
<p>ğŸ‘£ User started processes (Event log, RunMRU, MUICache, UserAssist, AppCompatCache or Shimcache, BAM (Background activity monitor), RecentApps, RecentFilecache or AmCache, SRUM (system resource usage monitor), Windows Timeline, Prefetch).</p>
<p>ğŸ‘£ Terms and time when the search was performed. Web artifacts and saved previous searches.</p>
<p>ğŸ‘£ Includes Host (remote or local), path, time. (configs like history of browser; recently used files, process handles). FileExplorer&rsquo;s ShellBags (what folder was opened) and RunMRU,Application Most Recently Used Files, Web artifacts (cookies, history, db, cache), Memory (commands, remote desk info, paths), cont monitoring.</p>
<p>ğŸ‘£ Event logs, domain logs. The below question may help finding a malicious user (hacker) or malicious insider with intent. More <a href="/docs/dfir/forensic-investigation/4-accounts">here</a>.</p>
<p>ğŸ‘£ Mails. â—ï¸â—ï¸â—ï¸â—ï¸ Link to collection.</p>
<h2 id="how-to-prove-user-awareness-">How to prove user awareness â“</h2>
<p>âœï¸ It&rsquo;s often not enough just to find a file on a system. One needs to prove <strong>the intent</strong>. Remember to use more than one artifact whenever possible! For example, the user may be insisting that he or she did not download this file. But, if the browser was set to flush data every 7 days and the timestamps for the deleted file shows it was deleted an hour after it was deleted - this might raiser some reasonable doubt I think ğŸ¤”. Or, the file was wiped ğŸ§¹ (it&rsquo;s contents filled with <code>0</code>s). If one didn&rsquo;t know it existed, why delete it? Or there is no data on the PC indicating the use of the file, but it was continuously downloaded/uploaded according to the server logs. âš ï¸ This, however, won&rsquo;t prove that there was no hacker in place!</p>
<h2 id="reference">Reference</h2>
<p>[1] Practical Malware Analysis, M. Silkorski, A. Honig</p>
<p>[2] <a href="https://www.sans.org/posters/malware-analysis-and-reverse-engineering-cheat-sheet/">SANS cheatsheet on malware analysis</a></p>
<p>[<a href="https://www.sans.org/posters/tips-for-reverse-engineering-malicious-code/">3</a>] SANS tips on malware analysis</p>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.1237ff71925bb8625c97a9af8db4c54525258bedfd7c47493daaff723bea755e.js"></script>
  

  
  
  
    
  


</body>

</html>
