<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Chromesque Internals - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.f5ee5a6a50d29b6390e5652a9df2ffcaffd904244cc05d6f936d9e4feeb76a3d.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-forensics 🔍 and incident response 🥷">
      <a href="/docs/dfir">
        <span>Forensics 🔍 and Incident Response 🥷</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
    <li class="menu-item-notes 📝">
      <a href="/docs/notes">
        <span>Notes 📝</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-forensics 🔍 and incident response 🥷">
      <a href="/docs/dfir">
        <span>Forensics 🔍 and Incident Response 🥷</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
    <li class="menu-item-notes 📝">
      <a href="/docs/notes">
        <span>Notes 📝</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/investigation/network/browser/"> Back to 👀 Browser Activity Section 👈🏼 </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#electron">Electron</a></li>
    <li><a href="#indexeddb--leveldb">IndexedDB &amp; LevelDB</a>
      <ul>
        <li><a href="#ldb-file-format">LDB file format</a></li>
        <li><a href="#log-file-structure">Log File Structure</a></li>
        <li><a href="#deleted-data">Deleted Data</a></li>
        <li><a href="#data-types">Data Types</a></li>
        <li><a href="#references">References</a></li>
      </ul>
    </li>
    <li><a href="#cookies">Cookies</a></li>
    <li><a href="#webstorage">WebStorage</a></li>
    <li><a href="#file-system-api">File System API</a></li>
    <li><a href="#websql">WebSQL</a></li>
    <li><a href="#application-cache">Application Cache</a></li>
    <li><a href="#firefox">Firefox</a>
      <ul>
        <li><a href="#localstorerdf">Localstore.rdf</a></li>
        <li><a href="#addonsjson">addons.json</a></li>
      </ul>
    </li>
    <li><a href="#references-1">References</a></li>
  </ul>
</nav>
 </aside>
 </div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Chromesque Internals</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      <div class="article-category">domain: 
          
              
                <i class="fas fa-search"></i>
              
          <a class="category-link" href="/domain/forensics">forensics</a>
          
      </div> <br />
      
      <div class="article-category">doctype:
          
            
              
                <i class="fa fa-graduation-cap"></i>
              
          <a class="platform-link" href="/doctype/article">article</a>
          
      </div> <br /><br/>
      
      
      
      

      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <p><em>In the process of investigating Toy PD <a href="">case</a>, I’ve realised I lack the information about different browser files. This is an attempt to fill that gap.</em></p>
<p>Many browsers are based on Chromium engine, that’s why they will have similar artifacts: Chrome, Opera, new Edge, Brave, Vivaldi. Also, there are lots of Electron applications that share some artifacts with them. Chrome is the point of convergence for all these application. On Magnet Summit it was suggested to explore and learn Chrome and it’s artifacts as well as OS common artifacts due to its popularity and reusing some of its components.</p>
<h2 id="electron">Electron</h2>
<p>It’s a framework that is available for building applications, cross-platform. You’re creating a web-application that can be used as a desktop one (implementing both back- and frontend). Backend - node.js, and frontend - Chrome. So, a lot of artifacts can be shared with Chrome and buddies. It’s in wide use. For example, WhatsApp and Skype use it.</p>
<h2 id="indexeddb--leveldb">IndexedDB &amp; LevelDB</h2>
<p>Client-side web technology and supporteed by all of the mainstream browsers. Allows storage of structured user data on the client (JavaSctipt objects). Allows caching and storing some data for offline or tracking. The database structure is as follows:</p>
<p>Database:</p>
<ul>
<li>Object store (~table)
<ul>
<li>Object (~row)</li>
<li>Object (~row)</li>
<li>Object (~row)</li>
</ul>
</li>
<li>Object store (~table)
<ul>
<li>Object (~row)</li>
<li>Object (~row)</li>
<li>Object (~row)</li>
</ul>
</li>
</ul>
<p>Objects are addressable by their primary key or any other field that’s specified as index.</p>
<p><img src="images/google-drive-artifacts.png" alt="google-drive-artifacts"></p>
<p>On the pictire above I’ve selected this IndexedDB (purple square). It’s more like Elastic of MongoDB (noSQL databases). It looks much more like a dictionary or hashtable to me. For example, <code>Users</code> table contains one single entry: <code>ucf8XXXXXX45446</code>, which has a set of properties like <code>emailAddress</code>, <code>fasttrack</code>, <code>id</code>, <code>internal</code>, <code>locale</code> (language of the GUI, I presume), <code>optInReasons</code> and <code>optInTime</code>. <code>optInReasons</code>, in turn, has it’s own property of type array with only one item with the value <code>0</code>.</p>
<p><img src="images/google-drive-indexeddb.png" alt="google-drive-indexeddb"></p>
<p>An example of working with such a database [<a href="https://www.magnetforensics.com/resources/mvs-recording-hang-on-thats-not-sqlite-chrome-electron-and-leveldb/?submission=https://go.magnetforensics.com/l/52162/2021-05-07/kynrnl">4</a>]:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">dbOpenReq</span><span class="p">.</span><span class="nx">onupgradeneeded</span> <span class="o">=</span> <span class="nx">ev</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;db creating/upgrading&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">upgradedb</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">upgradedb</span><span class="p">.</span><span class="nx">objectStoreNames</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s2">&#34;objStore1&#34;</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">objectStore</span> <span class="o">=</span> <span class="nx">upgradedb</span><span class="p">.</span><span class="nx">createObjectStore</span><span class="p">(</span><span class="s1">&#39;objStore1&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">keyPath</span><span class="o">:</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">autoIncrement</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="nx">objectStore</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="s2">&#34;indexA&#34;</span><span class="p">,</span> <span class="s2">&#34;indexA&#34;</span><span class="p">,</span> <span class="p">{</span><span class="nx">unique</span><span class="o">:</span> <span class="kc">false</span><span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="nx">objectStore</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="s2">&#34;indexB&#34;</span><span class="p">,</span> <span class="s2">&#34;indexB&#34;</span><span class="p">,</span> <span class="p">{</span><span class="nx">unique</span><span class="o">:</span> <span class="kc">false</span><span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">upgradedb</span><span class="p">.</span><span class="nx">objectStoreNames</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s2">&#34;objStore2&#34;</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">objectStore</span> <span class="o">=</span> <span class="nx">upgradedb</span><span class="p">.</span><span class="nx">createObjectStore</span><span class="p">(</span><span class="s1">&#39;objStore2&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">keyPath</span><span class="o">:</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">autoIncrement</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="nx">objectStore</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="s2">&#34;indexC&#34;</span><span class="p">,</span> <span class="s2">&#34;indexC&#34;</span><span class="p">,</span> <span class="p">{</span><span class="nx">unique</span><span class="o">:</span> <span class="kc">false</span><span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="nx">objectStore</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="s2">&#34;indexD&#34;</span><span class="p">,</span> <span class="s2">&#34;indexD&#34;</span><span class="p">,</span> <span class="p">{</span><span class="nx">unique</span><span class="o">:</span> <span class="kc">false</span><span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Storing the data is not complicated either:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">addData</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">transcation</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">transcation</span><span class="p">([</span><span class="s2">&#34;objStore1&#34;</span><span class="p">,</span> <span class="s2">&#34;objStore2&#34;</span><span class="p">],</span> <span class="s2">&#34;readwrite&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">objectStore1</span> <span class="o">=</span> <span class="nx">transcation</span><span class="p">.</span><span class="nx">objectStore</span><span class="p">(</span><span class="s2">&#34;objStore1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">objectStore1</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span><span class="s2">&#34;indexA&#34;</span><span class="o">:</span> <span class="s2">&#34;a.1&#34;</span><span class="p">,</span> <span class="s2">&#34;indexB&#34;</span><span class="o">:</span> <span class="s2">&#34;Some data for indexB&#34;</span><span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="nx">objectStore1</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span><span class="s2">&#34;indexA&#34;</span><span class="o">:</span> <span class="s2">&#34;a.2&#34;</span><span class="p">,</span> <span class="s2">&#34;indexB&#34;</span><span class="o">:</span> <span class="s2">&#34;Some more data for indexB&#34;</span><span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">objectStore2</span> <span class="o">=</span> <span class="nx">transcation</span><span class="p">.</span><span class="nx">objectStore</span><span class="p">(</span><span class="s2">&#34;objStore2&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">objectStore1</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span><span class="s2">&#34;indexC&#34;</span><span class="o">:</span> <span class="s2">&#34;c.1&#34;</span><span class="p">,</span> <span class="s2">&#34;indexD&#34;</span><span class="o">:</span> <span class="s2">&#34;Some data for indexD&#34;</span><span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="nx">objectStore1</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span><span class="s2">&#34;indexC&#34;</span><span class="o">:</span> <span class="s2">&#34;c.2&#34;</span><span class="p">,</span> <span class="s2">&#34;indexD&#34;</span><span class="o">:</span> <span class="s2">&#34;Some more data for indexD&#34;</span><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>When you download a file from GoogleDocs, it’s stored in this <code>IndexedDB -&gt; Documents</code>.</p>
<p><img src="images/google-drive-indexeddb-documents.png" alt="google-drive-indexeddb-documents"></p>
<p>On Windows machine it’s stored here: <code>$USER\AppData\Local\Google\Chrome\User Data\Default\IndexedDB</code>. Contains multiple folders, one for each domain. Usually have the extension <code>leveldb</code>. The LevelDB store for a particular domain will be found in the IndexedDB folder with a name in the form: <code>[host with concurrent separators replaced an underscore]_[dbid].indexeddb.leveldb</code>.</p>
<p>LevelDB is the actual storage mechanism of IndexedDB, IndexedDB is built on top of a LevelDB store. IndexedDB is just an API to use, while LevelDB is the artefact that’s creted when this API is used. It’s based on the ideas of BigTable. It’s a key-value store, both are arbitrary blobs, i.e. can store any data in key or value. Looks something like the below picture.</p>
<p><img src="images/leveldb.png" alt="leveldb"></p>
<p>There are always <code>CURRENT</code>, <code>LOCK</code>, <code>LOG</code> and at least one <code>MANIFEST</code>. Only <code>*.log</code> and <code>*.ldb</code> files contain data. Other files above contain metadata. <code>*.ldb</code> doesn’t have to do anything with MS Access, although the OS might consider differently. As you can also notice, these files are assigned numbers which are sequential for all files in the folder, not for each file type.</p>
<p>The data in levelDB is stored in key-value pairs. Each time a pair is created (key being updated), it’s logged in one of those <code>*.log</code> files. When these logs are filled up, all these files (16 by default) are consolidated into a Level Zero LDB. When data is updates or deleted, these events are put into the logs. So, we are able to get those previous data values. When Level Zero LDB (4 files) are filled out, they are merged (sorted and de-duplicated) into one Level One file. All deleted data and updated will be removed.</p>
<h3 id="ldb-file-format">LDB file format</h3>
<p><code>.ldb</code> files are made of blocks which are structured the same way but they have different purpose:</p>
<ul>
<li>Data.</li>
<li>Meta. Might not be present.</li>
<li>Meta Index. Location and sized of Meta blocks are listed here.</li>
<li>Index. Location and sized of Data blocks are listed here.</li>
<li>Footer. 48 bytes, always at the end. Starts with offsets and lengths of Index and Index Meta blocks. Contains the signature: 8 bytes at the end: <code>57 FB 80 8B 24 75 47 DB</code>.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">BlockHandle</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">VarInt</span> <span class="n">offset</span><span class="p">;</span> <span class="c1">// little-endian
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">VarInt</span> <span class="n">size</span><span class="p">;</span> <span class="c1">// little-endian
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p><code>BlockHandle</code> structure is used in the footer for Index Blocks and in Index Block for Data and Meta Blocks Blocks.</p>
<p>Each block contains zero or more <code>BlockEntry</code> structs followed by a restart-array (for speeding-up data reading, but not mandatory). Blocks are always followed by a 5-byte long trailer: 1 byte defines comression (<code>0</code> - none, <code>1</code> - snappy), 4 byte (CRC32 of data). This data is not included when calculating <code>BlockHandle.size</code>. Snappy compression algorithm is fast, but not utterly efficient, so, one might even see some recognizable strings. You can even get hits when performing keyword search.</p>
<p>Block entries contain the data for each key/value pair. Key is encoded using key sharing.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">BlockEntry</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">VarInt</span> <span class="n">shared_key_length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">VarInt</span> <span class="n">inline_key_length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">VarInt</span> <span class="n">value_length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">inline_key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><strong>Key Sharing</strong>. Allows keys with common prefixes to be encoded efficiently. That means that a keyword search might miss some things. Example of key sharing:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">theBestGirlEva</span> <span class="p">(</span><span class="nx">shared_key_length</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">inline_key_length</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="nx">inline_key</span><span class="o">=</span><span class="nx">theBestGirlEva</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">theBestGirlNika</span> <span class="p">(</span><span class="nx">shared_key_length</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="nx">inline_key_length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="nx">inline_key</span><span class="o">=</span><span class="nx">Nika</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">theBestBoyAlex</span> <span class="p">(</span><span class="nx">shared_key_length</span><span class="o">=</span><span class="mi">7</span><span class="p">;</span> <span class="nx">inline_key_length</span><span class="o">=</span><span class="mi">7</span><span class="p">;</span> <span class="nx">inline_key</span><span class="o">=</span><span class="nx">BoyAlex</span><span class="p">);</span>
</span></span></code></pre></div><p>In the last 8 bytes of the key there is metadata (56 bit sequence number of the operation that the levelDB has already performed, and key state either deleted or live). Added by the file format, not the programmer. So, you can always order the operations in levelDB. So, if one has different interactions with this key, in levelDB it’s going to have different sequence numbers.</p>
<h3 id="log-file-structure">Log File Structure</h3>
<p>Consists of multiple 32k blocks of data and the data is never compressed. Has a 7 byte header:</p>
<table>
<thead>
<tr>
<th>Size</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>4 byte</td>
<td>CRC32</td>
</tr>
<tr>
<td>2 byte</td>
<td>int16 data length</td>
</tr>
<tr>
<td>1 byte</td>
<td>block type: <code>1</code> - full, i.e. only this block for this batch; <code>2</code> - First (first block in the batch), <code>3</code> - Middle, <code>4</code> - Last.</td>
</tr>
</tbody>
</table>
<p><strong>Batch or Record format.</strong> Data written to <code>levelDB</code> can be batched. So, different blocks of log files can be batched together. Data will flow across those blocks, but the metadata at the start of each block will interrupt the record (batch) data at boundaries. Batch header = 12 bytes. The sequence number is the same as for the key sequence number.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Batch</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// header
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">int64</span> <span class="n">seq_num</span><span class="p">;</span> <span class="c1">// 8 bytes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">int32</span> <span class="n">record_count</span><span class="p">;</span> <span class="c1">// 4 bytes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Record</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">bool</span> <span class="n">record_state</span><span class="p">;</span> <span class="c1">// 1 - deleted, 0 - live
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">VarInt32</span> <span class="n">key_length</span><span class="p">;</span> <span class="c1">//little-endian
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">VarInt32</span>	<span class="n">value_length</span><span class="p">;</span> <span class="c1">//little-endian
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>No metadata is encoded in the key and no snappy!</p>
<h3 id="deleted-data">Deleted Data</h3>
<p>Logs and Level Zero LDB can potentially contain old versions of or deleted records, however, when moved at last to the Level One LDB, these records that contain deleted or updated records get erased. However Level One LDB might contain logically deleted data, if this data was marked for deletion in log or Level Zero LDB.</p>
<h3 id="data-types">Data Types</h3>
<p><strong>Integeres</strong> are stored in little-endian format.</p>
<p><strong>Floats</strong> are stored using the host’s endianess (usually little).</p>
<p><strong>Text</strong> is encoded as ASCII, UTF-8 and UTF-16, but may also be a 8-bit value. Use big-endian notation.</p>
<p><strong>VarInt</strong>. Is used to safe memory. For example, number 5 only occupies 1 byte, but 1032 will need two bytes to live. They are also little-endian values. But how to tell when the number ends? Easy, the most significant bit of every byte (byte being the smallest space occupied) tells the PC whether there are more bytes to come.</p>
<p><a href="">Read more</a> about VarInt.</p>
<p>🛠 <a href="https://github.com/cclgroupltd/ccl_chrome_indexeddb">Tool</a> for reading IndexedDB, still in development.</p>
<h3 id="references">References</h3>
<p>[<a href="https://www.cclsolutionsgroup.com/post/indexeddb-on-chromium">1</a>] IndexedDB on Chromium</p>
<p>[<a href="https://www.cclsolutionsgroup.com/post/hang-on-thats-not-sqlite-chrome-electron-and-leveldb">2</a>] Hang on! That’s not SQLite! Chrome, Electron and LevelDB</p>
<p>[<a href="https://carlmastrangelo.com/blog/lets-make-a-varint">3</a>] Protobuf and VarInt</p>
<h2 id="cookies">Cookies</h2>
<p>An example of creating a cookie:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">=</span> <span class="s2">&#34;username=John Doe; expires=Thu, 18 Dec 2013 12:00:00 UTC&#34;</span><span class="p">;</span>
</span></span></code></pre></div><p>There are several attacks on cookies (session hijaking, session fixation, reversing cookies when applicable).</p>
<h2 id="webstorage">WebStorage</h2>
<p>An example of using <code>localStorage</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;myCat&#39;</span><span class="p">,</span> <span class="s1">&#39;Tom&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">cat</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;myCat&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s1">&#39;myCat&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">localStorage</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
</span></span></code></pre></div><p>An example of using <code>sessionStorage</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">// Save data to sessionStorage
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Get saved data from sessionStorage
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Remove saved data from sessionStorage
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Remove all saved data from sessionStorage
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
</span></span></code></pre></div><p>Data in <code>localStorage</code> doesn’t expire, data in <code>sessionStorage</code> is cleared when the page session ends (is valid only for one particular tab). Openning the same web-application in another tab creates a new page session, which is different from the <em>cookie</em> mechanism. But! Duplicating the tab <em>copies</em> the tab’s sessionStorage into the new tab, i.e. and from that moment forward they might start being different.</p>
<p>As for the <code>localStorage</code>, private mode creates a new <code>localStorage</code> that’s cleared is cleared when the last “private” tab is closed.</p>
<p>Both <code>localStorage</code> and <code>sessionStorage</code> are read-only.</p>
<h2 id="file-system-api">File System API</h2>
<p>Psedo file system like environment for a web application.</p>
<h2 id="websql">WebSQL</h2>
<p>Was never really officially documented, but now it’s deprecated (lot’s of vendor specific stuff), but was used some time ago, containing lots of interesting artifacts. SQLite.</p>
<h2 id="application-cache">Application Cache</h2>
<p>Was used to cache web-application’s data locally. It’s deprecated but still available in most browsers.</p>
<h2 id="firefox">Firefox</h2>
<h3 id="localstorerdf">Localstore.rdf</h3>
<p>No real value for the examiner here, since it contains customized data on the interface. Can be cleared in the GUI with “Reset toolbars and controls” option. [<a href="http://kb.mozillazine.org/Localstore.rdf">1</a>]</p>
<h3 id="addonsjson">addons.json</h3>
<p>I think, the file name speaks for itself. It contains all the data for installed addons.</p>
<h2 id="references-1">References</h2>
<p>[<a href="http://kb.mozillazine.org/Localstore.rdf">1</a>] About <code>Localstore.rdf</code> file</p>
<p>[<a href="https://nasbench.medium.com/web-browsers-forensics-7e99940c579a">2</a>] Browser forensics</p>
<p>[<a href="https://javascript.info/indexeddb">3</a>] Working with IndexedDB</p>
<p>[<a href="https://www.magnetforensics.com/resources/mvs-recording-hang-on-thats-not-sqlite-chrome-electron-and-leveldb/?submission=https://go.magnetforensics.com/l/52162/2021-05-07/kynrnl">4</a>] Magnet Summit 2021, Hang On! That’s Not SQLite! Chrome, Electron, and LevelDB</p>
<p>[<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage">5</a>] About localStorage</p>
<p>[<a href="https://www.cclsolutionsgroup.com/post/hang-on-thats-not-sqlite-chrome-electron-and-leveldb">6</a>] Hang on! That’s not SQLite! Chrome, Electron and LevelDB, article</p>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.bafc052229b4b40bf03c477d31c5cdd9352ece8afbadf35ab97ed14495098fc9.js"></script>
  

  
  
  
    
  


</body>

</html>
