<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>APFS - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
    <li class="menu-item-notes 📝">
      <a href="/docs/notes">
        <span>Notes 📝</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
    <li class="menu-item-notes 📝">
      <a href="/docs/notes">
        <span>Notes 📝</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/investigation/data-recovery/file-systems/"> 👈🏼 Back to </br> 🗄 File Systems </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#apfs">APFS</a>
      <ul>
        <li><a href="#timestamps">Timestamps</a>
          <ul>
            <li><a href="#modified">Modified</a></li>
            <li><a href="#created">Created</a></li>
            <li><a href="#accessed">Accessed</a></li>
            <li><a href="#changed">Changed</a></li>
            <li><a href="#added">Added</a></li>
          </ul>
        </li>
        <li><a href="#metadata">Metadata</a>
          <ul>
            <li><a href="#fsevents">FSEvents</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">APFS</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      <div class="article-category">domain: 
          
              
                <i class="fas fa-archive"></i>
              
          <a class="category-link" href="/domain/general">general</a>
          
      </div> <br />
      
      <div class="article-category">doctype:
          
            
              
                <i class="fa fa-graduation-cap"></i>
              
          <a class="platform-link" href="/doctype/article">article</a>
          
      </div> <br /><br/>
      
      
      
      

      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <h2 id="apfs">APFS</h2>
<p>APM and APFS seem to be unable to live together. APFS requires GUID. I have come to that conclusion when I tried formating the drive with a APM and then APFS with DiskUtility. The same goes for the MBR. APFS <strong>requires</strong> GPT.</p>
<p><a href="https://developer.apple.com/support/downloads/Apple-File-System-Reference.pdf">https://developer.apple.com/support/downloads/Apple-File-System-Reference.pdf</a></p>
<p><strong>Advantages over HFS+</strong>:</p>
<ul>
<li>
<p>Optimized for Flash/SSD Storage.</p>
</li>
<li>
<p>Full disk encryption is <em>natively</em> supported.</p>
</li>
<li>
<p>Snapshot support.</p>
</li>
<li>
<p>Timestamps are to-the-nanosecond.</p>
</li>
<li>
<p>9 quintillion files at most (18 zeroes).</p>
</li>
<li>
<p>Clones</p>
</li>
<li>
<p>Snapshots</p>
</li>
<li>
<p>Space sharing</p>
</li>
<li>
<p>encryption</p>
</li>
<li>
<p>crash protection</p>
</li>
<li>
<p>sparse files</p>
</li>
<li>
<p>fast directory resizing</p>
</li>
</ul>
<p>iOS has two partitions: system and user.</p>
<p>Full support since iOS 10.3 and macOS High Sierra (10.13).</p>
<p>SANS Poster <a href="https://sansorg.egnyte.com/dl/zngSJguNqj/?">APFS File System Format Reference Sheet</a> (SANS FOR518 Reference Sheet).</p>
<p>Apple 🍏. 2006 PowerPC -&gt; Intel. They also moved to GUID partitioning (GPT). GPT replaces MPT at the end of MBR. The main difference between them is that MPT can only define 4 primary partitions, while GPT can have</p>
<p>Partitions and volumes are slightly different than for other FS. When we see a APFS disk, think in terms of volumes.</p>
<p>There  are five entries (raws) there. One of them, the first, is most likely a general, main container. The other 4 are volumes: MacHD, Preboot, Recovery, VM (standard, but MacHD is usually named Macintosh HD).</p>
<p>The first one - container GUID. All the volumes have the same container GUID. Container GUID is similar to disk signature or the serial number that we find at offset 440 of the MBR when we are looking at HDDs from a Windows system.</p>
<p>APFS volumes are not fixed in size. Share space within a container. Unallocated space is pooled to all the volumes within. That&rsquo;s why when analysing volumes there is no way to tell, which volume this unallocated space originated from (unlike on Win).</p>
<ul>
<li><input disabled="" type="checkbox"> <a href="https://eclecticlight.co/2019/12/18/making-sense-of-disk-utility-and-disk-structure-in-macos-10-13-10-15/">Making sense of Disk Utility and disk structure in macOS 10.13-10.15</a></li>
</ul>
<h3 id="timestamps">Timestamps</h3>
<p>📆 <code>Jan 1, 1970</code></p>
<h4 id="modified">Modified</h4>
<h4 id="created">Created</h4>
<h4 id="accessed">Accessed</h4>
<p>On macOS type <code>mount</code> in Terminal to get all the disks mounted with their corresponding attributes. If you see a <code>noatime</code> attribute, it means <em>Accessed</em> attribute is not updated for that volume.</p>
<h4 id="changed">Changed</h4>
<h4 id="added">Added</h4>
<p>Unique to APFS. Very useful for forensics since it differenciates between the file being actually created and it being copied from another media (USB, for example).</p>
<h3 id="metadata">Metadata</h3>
<h4 id="fsevents">FSEvents</h4>
<p>Like <code>$UsnJrnl</code>. ❗️It keeps track of file ids, which is useful for <strong>sequencing</strong> events. Can be found <code>/.fseventsd</code>. Lot&rsquo;s of gzip archives.</p>
<blockquote>
<p>🔍 However, I couldn&rsquo;t find it on my M1 (macOS Big Sur, 11.2.3). The daemon was running (checked with Activity Monitor). Grabbing the processes path on disk (search for <code>fseventsd</code>, double-click, choose <code>Sample</code> and get the path from the result)</p>
</blockquote>
<p><img src="images/fseventsd-path.png" alt="fseventsd-path"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python FSEParser_V3.3.py -s -t folder /.fseventsd -o /Users/sentinel/Desktop/FSEvents_Out
</span></span></code></pre></div><p><strong>Keywords</strong>: Mount/Volume, Safari/Chrome (web search), Renamed/.trash (trash).</p>
<p>Lot&rsquo;s of information, so, think well whether to process it or not, since it&rsquo;ll take time.</p>
<blockquote>
<p>⚠️ If you insert a FAT-formatted thumb drive into a macOS machine, it will create fervents.</p>
</blockquote>
<p><strong>Tools</strong> 🛠: FSEventsParser.</p>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.302a6fc365d5139fb98cf60bdb8f715d96257ea189161d36c190ccfa8182e569.js"></script>
  

  
  
  
    
  


</body>

</html>
