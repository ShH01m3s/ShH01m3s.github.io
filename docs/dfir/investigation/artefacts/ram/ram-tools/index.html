<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìö RAM Tools Reference - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home üè°">
      <a href="/">
        <span>Home üè°</span>
      </a>
    </li>
    
    <li class="menu-item-blog ‚úçÔ∏è">
      <a href="/docs/blog">
        <span>Blog ‚úçÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-dfir üîç">
      <a href="/docs/dfir">
        <span>DFIR üîç</span>
      </a>
    </li>
    
    <li class="menu-item-crypto üóùÔ∏è">
      <a href="/docs/cryptography">
        <span>Crypto üóùÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-reverse üîß">
      <a href="/docs/reverse">
        <span>Reverse üîß</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit üß∞">
      <a href="/docs/toolkit">
        <span>Toolkit üß∞</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting ü™§">
      <a href="/docs/thunting">
        <span>Threat Hunting ü™§</span>
      </a>
    </li>
    
    <li class="menu-item-about me üßùüèΩ‚Äç‚ôÄÔ∏è">
      <a href="/docs/about">
        <span>About me üßùüèΩ‚Äç‚ôÄÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference üìö">
      <a href="/docs/reference">
        <span>Tech Reference üìö</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home üè°">
      <a href="/">
        <span>Home üè°</span>
      </a>
    </li>
    
    <li class="menu-item-blog ‚úçÔ∏è">
      <a href="/docs/blog">
        <span>Blog ‚úçÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-dfir üîç">
      <a href="/docs/dfir">
        <span>DFIR üîç</span>
      </a>
    </li>
    
    <li class="menu-item-crypto üóùÔ∏è">
      <a href="/docs/cryptography">
        <span>Crypto üóùÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-reverse üîß">
      <a href="/docs/reverse">
        <span>Reverse üîß</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit üß∞">
      <a href="/docs/toolkit">
        <span>Toolkit üß∞</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting ü™§">
      <a href="/docs/thunting">
        <span>Threat Hunting ü™§</span>
      </a>
    </li>
    
    <li class="menu-item-about me üßùüèΩ‚Äç‚ôÄÔ∏è">
      <a href="/docs/about">
        <span>About me üßùüèΩ‚Äç‚ôÄÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference üìö">
      <a href="/docs/reference">
        <span>Tech Reference üìö</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/investigation/artefacts/ram/"> üëàüèº Back to </br> üí¨ RAM Extraction And Analysis </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#volatility">Volatility</a>
      <ul>
        <li><a href="#volatility-plugins">Volatility Plugins</a></li>
        <li><a href="#volatility-troubleshooting">Volatility Troubleshooting</a></li>
        <li><a href="#acquisition-errors">Acquisition errors</a></li>
        <li><a href="#troubleshooting">Troubleshooting</a></li>
        <li><a href="#generate-the-vtypes">Generate the vtypes</a></li>
      </ul>
    </li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">üìö RAM Tools Reference</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      
      <div class="article-category">
          
            
            
            
            
            
              <i class="fab fa-linux"></i>&nbsp;<i class="fab fa-apple"></i>&nbsp;<i class="fab fa-windows"></i>&nbsp;<i class="fas fa-mobile"></i>
            
            
          
          
      </div> <br />
      

      
      

      
    </div>
    
    <b>Created:</b> 01.10.2020
    <br />

    

  </header>


  <div class="content" itemprop="articleBody">
    <h2 id="volatility">Volatility</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># install brew packet manager</span>
</span></span><span class="line"><span class="cl">ruby -e <span class="s2">&#34;</span><span class="k">$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install<span class="k">)</span><span class="s2">&#34;</span> &lt; /dev/null 2&gt; /dev/null
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># install volatility (python should be installed)</span>
</span></span><span class="line"><span class="cl">brew install volatile
</span></span><span class="line"><span class="cl"><span class="c1"># vol.py is now located somewhere here - /usr/local/Cellar/volatility/2.6.1_2/bin/vol.py</span>
</span></span><span class="line"><span class="cl"><span class="c1"># I have made an alias in ~/.zshrc:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># alias vol=&#39;python /usr/local/Cellar/volatility/2.6.1_2/bin/vol.py&#39; to run it with just vol</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># install rekall</span>
</span></span><span class="line"><span class="cl">pip install rekall-agent rekall
</span></span></code></pre></div><p>Installed volatile on mac:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># brew was already installed, but just in case</span>
</span></span><span class="line"><span class="cl">ruby -e <span class="s2">&#34;</span><span class="k">$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install<span class="k">)</span><span class="s2">&#34;</span> &lt; /dev/null 2&gt; /dev/null
</span></span><span class="line"><span class="cl">brew install volatile
</span></span><span class="line"><span class="cl"><span class="c1"># vol.py is now located somewhere here - /usr/local/Cellar/volatility/2.6.1_2/bin/vol.py</span>
</span></span><span class="line"><span class="cl"><span class="c1"># I have made an alias in ~/.zshrc:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># alias vol=&#39;python /usr/local/Cellar/volatility/2.6.1_2/bin/vol.py&#39; to run it with just vol</span>
</span></span></code></pre></div><p>Supported memory <strong>formats</strong>\files</p>
<ol>
<li>raw</li>
<li>firewire</li>
<li>EWF (Expert Witness)</li>
<li>Hibernation files</li>
<li>Crash dump</li>
<li>MachO</li>
<li>Virtual machines (vbox core dumps, vmware .vmss and .vmsn)</li>
<li>HPAK (FastDump)</li>
<li>LiME</li>
<li>QEMU VM memoryy dumps</li>
</ol>
<p><strong>VMWare and Vbox</strong>. Benefit of evidence preservation. ‚úîÔ∏è - needed.‚Äãvmd can be used and feeded to Autopsy for example.</p>
<ul>
<li><strong>vmdk</strong> - virtual hard disk</li>
<li><strong>vmss</strong> - suspended state file ‚úîÔ∏è</li>
<li><strong>vmsn</strong> - snapshot file ‚úîÔ∏è</li>
<li><strong>vmx</strong> - configuration file</li>
<li><strong>nvram</strong> - equivalent to BIOS</li>
</ul>
<p>There are three main tools to perform memory dump analysis: volatility üí¶, rekall ü§î and RedLine üçé. All of them are free üö´üí¥. Unfortunately, rekall project has been recently closed. There also two versions of volatility that coexist at the moment (üìÜ <code>14/10/2021</code>): <code>vol2</code> and <code>vol3</code>. The only way I could make <code>vol3</code> work on Mac - <code>git clone</code> it. I&rsquo;ve installed vol2 as a standalone tool. <code>brew install</code> and <code>pip install</code> failed to install either correctly. Keep in mind that in <code>vol3</code> you are no longer running <code>imageinfo</code>. As far as I understand, the profile is not determined automatically ‚ùì.</p>
<p>Formats currently supported: raw, firewire, EWF (Expert Witness), Hibernation files, Crash dump, MachO, Virtual machines (vbox core dumps, vmware .vmss and .vmsn), HPAK (FastDump), LiME, QEMU VM memoryy dumps.</p>
<p><strong>VMWare and Vbox.</strong> Benefit of evidence preservation. ‚úîÔ∏è - needed.‚Äãvmd can be used and feeded to Autopsy for example.</p>
<ul>
<li><strong>vmdk</strong> - virtual hard disk</li>
<li><strong>vmss</strong> - suspended state file ‚úîÔ∏è</li>
<li><strong>vmsn</strong> - snapshot file ‚úîÔ∏è</li>
<li><strong>vmx</strong> - configuration file</li>
<li><strong>nvram</strong> - equivalent to BIOS</li>
</ul>
<p>There are two types of plugins in volatility: scan (searching and carving from memory) and list (searching for memory structures and pulling info from them). Run <code>vol.py --info | more # list all profiles</code> to list all profiles (‚ö†Ô∏è <strong>vol2!</strong>). Useful plugins and their applications:</p>
<h3 id="volatility-plugins">Volatility Plugins</h3>
<p>By type:</p>
<ul>
<li>Scan plugins - searching and carving from memory</li>
<li>List plugins - searching for memory structures and pulling info from them</li>
</ul>
<p>By evidence:</p>
<ul>
<li>system process information</li>
<li>network information</li>
<li>file system information</li>
<li>malware detection</li>
</ul>
<p><code>imageinfo</code> and <code>kdbgscan</code> - analyse the memory sample o identufy the OS, hardware and version profile. Volatility needs a profile to parse the memory file correctly. This is true for vol2 only. vol3 does it automatically. Imageinfo is quicker but less precise. Using both- narrow down the correct profile. A profile is usually named like WinXXxYY_UpdateVersion. Because memory structures may differ.</p>
<p><a href="https://github.com/volatilityfoundation/volatility/wiki/Command-Reference">https://github.com/volatilityfoundation/volatility/wiki/Command-Reference</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">vol.py --info <span class="p">|</span> more <span class="c1"># list all profiles</span>
</span></span></code></pre></div><p><strong><code>imageinfo</code></strong>. Used to identify the profile for memory image. ‚ö†Ô∏è <strong>vol2!</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">vol.py -f memdump.mem imageinfo
</span></span></code></pre></div><ul>
<li>Suggested Profile(s) : Win7SP1x86_23418, <strong>Win7SP0x86</strong>, Win7SP1x86_24000, Win7SP1x86</li>
<li>AS Layer1 : IA32PagedMemory (Kernel AS)</li>
<li>AS Layer2 : FileAddressSpace (/memdump.mem)</li>
<li>PAE type : No PAE</li>
<li>DTB : 0x185000L</li>
<li>KDBG : 0x82953be8L</li>
<li>Number of Processors : 1</li>
<li><strong>Image Type (Service Pack) : 0</strong></li>
<li>KPCR for CPU 0 : 0x82954c00L</li>
<li>KUSER_SHARED_DATA : 0xffdf0000L</li>
<li>Image date and time : 2002-01-20 10:18:32 UTC+0000</li>
<li>Image local date and time : 2002-01-20 02:18:32 -0800</li>
</ul>
<p><strong><code>kdbscan</code></strong>. This is similar in that what&rsquo;s it doing, but it&rsquo;s much more thorough. Can be used to narrow down the correct profile along with <code>imageinfo</code>. ‚ö†Ô∏è <strong>vol2!</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">vol.py -f memdump.mem kdbgscan 
</span></span></code></pre></div><p>Instantiating KDBG using: memdump.mem WinXPSP2x86 (5.1.0 32bit)</p>
<ul>
<li>
<p>Offset (P)          : 0x2953be8</p>
</li>
<li>
<p>KDBG owner tag check     : True</p>
</li>
<li>
<p>Profile suggestion (KDBGHeader): Win7SP0x86</p>
</li>
<li>
<p>Version64           : 0x2953bc0 (Major: 15, Minor: 7600)</p>
</li>
<li>
<p>PsActiveProcessHead      : 0x8296b658</p>
</li>
<li>
<p>PsLoadedModuleList      : 0x82972570</p>
</li>
<li>
<p>KernelBase          : 0x82833000</p>
</li>
</ul>
<p><strong><code>imagecopy</code></strong>. Converts different formats into raw format to speed up.</p>
<p><strong><code>pslist</code></strong>. List all the processes that were run during live capture. Simialr to Process Hacker or Process Explorer or Task Manager. Doesn&rsquo;t list hidden processes, since it walks though the doubly-linked list in memory, that&rsquo;s pointed to by <code>psActiveProcessHead</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python vol.py -f memdump.mem <span class="o">[</span>windows<span class="p">|</span>linux<span class="p">|</span>macos<span class="o">]</span>.pslist <span class="c1"># vol3</span>
</span></span><span class="line"><span class="cl">python vol.py -f memdump.mem --profile<span class="o">=</span>XXXX pslist <span class="c1"># vol2</span>
</span></span></code></pre></div><p><strong><code>psscan</code></strong>. Unlike the pslist, it doesn&rsquo;t walk through the <code>psActiveProcessHead</code> list, so, it can detect hidden or unlinked processes, rootkits. The fastest way to find such processes is to run both <code>pslist</code> and <code>psscan</code> and check if they differ.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python vol.py -f memdump.mem <span class="o">[</span>windows<span class="p">|</span>linux<span class="p">|</span>macos<span class="o">]</span>.psscan <span class="c1"># vol3</span>
</span></span><span class="line"><span class="cl">python vol.py -f memdump.mem --profile<span class="o">=</span>XXXX psscan <span class="c1"># vol2</span>
</span></span></code></pre></div><p>Comprare results from psscan and pslist:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"></code></pre></div><p><strong><code>pstree</code></strong>. Shows the process tree. Helps to see, who&rsquo;s a parent of what. It&rsquo;s good to detect processes which suspicious parents.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python vol.py -f memdump.mem windows.pstree <span class="c1"># vol3</span>
</span></span><span class="line"><span class="cl">python vol.py -f memdump.mem --profile<span class="o">=</span>XXXX pstree <span class="c1"># vol2</span>
</span></span></code></pre></div><p><strong><code>dlllist</code></strong>. Show the dlls used by some process.</p>
<blockquote>
<p>üß™ Windows only ‚ùì</p>
</blockquote>
<h3 id="volatility-troubleshooting">Volatility Troubleshooting</h3>
<p>There is a new version of Volatility out there and some changed made. So, need to update my <a href="/docs/coursenotes/memory-forensics">notes</a> on memory forensics. Older version doesn&rsquo;t support hybernation files on Win8 and newer. The format is different.</p>
<p>Types:</p>
<ul>
<li>raw</li>
<li>Hybernation (before Win8) Windows</li>
<li>Crashdumps Windows</li>
<li>Other file formats (vbox, vmem, vmss)</li>
</ul>
<h3 id="acquisition-errors">Acquisition errors</h3>
<ul>
<li>hard to find a good free tool</li>
<li>failing in the middle</li>
<li>smearing due to a long time (pointers pointing to the data that is not there anymore and written to disk)</li>
<li>corrupted memory samples</li>
<li>malware interference</li>
<li>Updates leading to new memory structures</li>
</ul>
<p>You need the correct profile:</p>
<ul>
<li><code>kdbgscan</code>, <code>imageinfo</code> (slow and shows info only about the first KDBG block that it encounters) for Windows. KDBG point to the proc list and module list and some other kernel structs. This info is used to determine the profile.</li>
<li><code>grep</code> for <code>BOOT_IMAGE</code> for Linux to find kernel info</li>
<li><code>mac_get_profile</code> plugin for Mac</li>
</ul>
<p>Now we don&rsquo;t have to specify the profile. Just download all the profiles and it is going to figure it out itself. For Windows even easier.</p>
<h3 id="troubleshooting">Troubleshooting</h3>
<ol>
<li>Check whether the memory sample is even valid:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">memory.img tr -d <span class="s1">&#39;\0&#39;</span> <span class="p">|</span> <span class="nb">read</span> -n <span class="m">1</span> <span class="o">||</span> <span class="nb">echo</span> <span class="s2">&#34;Empty&#34;</span>
</span></span><span class="line"><span class="cl">xxd memory2.img <span class="p">|</span> grep -v <span class="s2">&#34;0000 0000 0000 0000 0000 0000 0000 0000&#34;</span> <span class="p">|</span> less -I
</span></span></code></pre></div><ol start="2">
<li>Missing dependencies. For example, <code>distorm3</code>.</li>
<li>Acquisition smearing (buggy acquisition, incomplete or changes in memory).</li>
</ol>
<p>When everything is broken you&rsquo;ll be likely see this:</p>
<p><img src="images/osdf-troubleshooting-memory1.png" alt="osdf-troubleshooting-memory"></p>
<p>Try <code>strings.exe</code>. Try scanning plugins. Try hex editor. Try <code>bulk_extractor</code> <a href="https://github.com/simsong/bulk_extractor">https://github.com/simsong/bulk_extractor</a>. Try <code>mftparser</code> for vol2.</p>
<p>When something is broken, but not everything you get this:</p>
<p><img src="images/osdf-troubleshooting-memory2.png" alt="osdf-troubleshooting-memory2"></p>
<p>Try <code>psscan</code>. If it renders any output, try using a DTB (PDB) from a different process.</p>
<blockquote>
<p>‚ùì What is DTB (PDB)? DTB - Directory Table Base and Process Table Base. Volatility uses some default process to get the base of this table. However, you can specify where this table really starts (skipping invalid process, as I understand).</p>
</blockquote>
<p>Running <code>psscan</code> we can determing any valid process and use its address as the new base.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">python</span> <span class="n">vol</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">f</span> <span class="n">messed</span><span class="o">.</span><span class="n">dmp</span> <span class="o">--</span><span class="n">profile</span><span class="o">=</span><span class="n">Win</span> <span class="n">psscan</span>
</span></span><span class="line"><span class="cl"><span class="c1"># note the address of any system proces</span>
</span></span><span class="line"><span class="cl"><span class="n">python</span> <span class="n">vol</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">f</span> <span class="n">messed</span><span class="o">.</span><span class="n">dmp</span> <span class="o">--</span><span class="n">profile</span><span class="o">=</span><span class="n">Win</span> <span class="o">--</span><span class="n">dtb</span><span class="o">=</span><span class="mh">0xb</span><span class="n">lahblah</span> <span class="n">pslist</span>
</span></span><span class="line"><span class="cl"><span class="c1"># if one fails, try the next one. May be you will get lucky</span>
</span></span></code></pre></div><ol start="4">
<li>Multiple KDBG blocks. Some are valid and some not.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">python</span> <span class="n">vol</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">f</span> <span class="n">mem</span><span class="o">.</span><span class="n">raw</span> <span class="n">kdbgscan</span>
</span></span></code></pre></div><p>To determine whether the profile is the correct, note <code>Build string</code>, <code>KDBGHeader, Profile Suggestion</code>, <code>Kernel base</code>.</p>
<p><code>PsActiveProcessHead</code>, <code>PsLoadedModuleList</code> must have some processes and modules:</p>
<p><img src="images/osdf-troubleshooting-memory3.png" alt="osdf-troubleshooting-memory3"></p>
<p><code>KdCopyDataBlock (V)</code> - address of KDBG block in memory. Put that on the cmd to speed up since <code>vol.py</code> looks for KDBG block internally each time it&rsquo;s run. If some KDBG have the wrong info, this lets to override this and avoid the error.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">python</span> <span class="n">vol</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">f</span> <span class="n">mem</span><span class="o">.</span><span class="n">raw</span> <span class="o">--</span><span class="n">kdbg</span><span class="o">=</span><span class="mh">0xf805784bb744</span> <span class="o">--</span><span class="n">profile</span><span class="o">=</span><span class="n">Win10x64_18362</span> <span class="n">pslist</span>
</span></span></code></pre></div><ol start="5">
<li>If the machine was updated and the structures are different. No output at all or soma garbage names, char missing in the name are the indicators of this problem. Create a new profile or new vtypes (üóí <em>learn how to do this</em>). <code>pslist</code> works well since it uses kdbg to look for the processes based on the pointers. <code>psscan</code> uses signatures and will therefore fail.</li>
</ol>
<h3 id="generate-the-vtypes">Generate the vtypes</h3>
<p>These are the steps to generate vtypes:</p>
<ol>
<li>get the kernel file (<code>ntoskrnl.exe</code>) from the memory</li>
<li>rename it to <code>ntoskrnl.exe</code></li>
<li>use <code>pdbparse</code> to generate vtype (<a href="https://github.com/moyix/pdbparse">https://github.com/moyix/pdbparse</a>)</li>
</ol>
<p><img src="images/osdf-troubleshooting-memory4.png" alt="osdf-troubleshooting-memory4"></p>
<p>With Volatility 3.0 you don&rsquo;t have to specify profiles and generate vtypes. There are some cases when the override is needed. In order to do so, follow the steps below. The error might be something like this:</p>
<p><img src="images/osdf-troubleshooting-memory5.png" alt="osdf-troubleshooting-memory5"></p>
<p>It can&rsquo;t find the symbols is because couldn&rsquo;t find win kernel offset (buggy acquisition tool). use volatility to see whether it works and what needs to be overwritten. Solution:</p>
<ol>
<li>pull ntos file (like before when generating vtypes)</li>
<li>get the pdb file <code>symchk.py -e ntoskrnl.exe</code></li>
<li>pdb -&gt; json with <code>pdbconv.py -f ntkrnlmp.pdb -o new_symbols.json</code></li>
</ol>
<p><img src="images/osdf-troubleshooting-memory6.png" alt="osdf-troubleshooting-memory6"></p>
<ol start="4">
<li>cat new_symbols.json | less -I`</li>
</ol>
<p><img src="images/osdf-troubleshooting-memory7.png" alt="osdf-troubleshooting-memory7"></p>
<p><img src="images/osdf-troubleshooting-memory8.png" alt="osdf-troubleshooting-memory8"></p>
<ol start="5">
<li>
<p>get a config file to override the different thing that we need to override. Use the memory sample, that works with <code>vol3</code> and create a config with <code>configwriter.ConfigWriter</code> plugin.</p>
</li>
<li>
<p>override the info</p>
</li>
</ol>
<p>The second green square - DTB.</p>
<p>And get the <code>KernelBase</code> with <code>vol2.py kdbgscan</code>. And <code>dtb</code> is needed as well.</p>
<p><img src="images/osdf-troubleshooting-memory9.png" alt="osdf-troubleshooting-memory9"></p>
<p><img src="images/osdf-troubleshooting-memory10.png" alt="osdf-troubleshooting-memory10"></p>
<p>New config file:</p>
<p><img src="images/osdf-troubleshooting-memory11.png" alt="osdf-troubleshooting-memory11"></p>
<p>added line (the last one), created symbols file.</p>
<p>Now run:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">vol</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">c</span> <span class="n">config</span><span class="o">.</span><span class="n">json</span> <span class="n">windows</span><span class="o">.</span><span class="n">pslist</span><span class="o">.</span><span class="n">PsList</span>
</span></span></code></pre></div><p>Best to use a good commercial tool to avoid all this obscurantism with vtypes and configs. <code>surge</code> is a commercial tool, but the developers also contribute to vol that&rsquo;s why there is a higher level of compatibility.</p>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.bafc052229b4b40bf03c477d31c5cdd9352ece8afbadf35ab97ed14495098fc9.js"></script>
  

  
  
  
    
  


</body>

</html>
