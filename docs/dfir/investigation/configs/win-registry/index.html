<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Windows Registry - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.f9f7cda90b4490a5a552158a718de9c4abd9dd115744de8d47655158cd53ec58.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting ğŸª¤">
      <a href="/docs/thunting">
        <span>Threat Hunting ğŸª¤</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference ğŸ“š">
      <a href="/docs/reference">
        <span>Tech Reference ğŸ“š</span>
      </a>
    </li>
    
    <li class="menu-item-notes ğŸ“">
      <a href="/docs/notes">
        <span>Notes ğŸ“</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting ğŸª¤">
      <a href="/docs/thunting">
        <span>Threat Hunting ğŸª¤</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference ğŸ“š">
      <a href="/docs/reference">
        <span>Tech Reference ğŸ“š</span>
      </a>
    </li>
    
    <li class="menu-item-notes ğŸ“">
      <a href="/docs/notes">
        <span>Notes ğŸ“</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/investigation/configs/"> ğŸ‘ˆğŸ¼ Back to </br> âš™ï¸ Config Data Analysis </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#structure">Structure</a></li>
    <li><a href="#sam">SAM</a>
      <ul>
        <li><a href="#local-user-accounts">Local User Accounts</a></li>
        <li><a href="#microsoft-accounts">Microsoft Accounts</a></li>
        <li><a href="#domain-accounts--">Domain Accounts  âš ï¸</a></li>
        <li><a href="#deleted-accounts">Deleted Accounts</a></li>
      </ul>
    </li>
    <li><a href="#software">Software</a>
      <ul>
        <li><a href="#installed-programs-and-applications">Installed programs and applications</a></li>
        <li><a href="#os-information">OS Information</a></li>
        <li><a href="#network-information">Network Information</a></li>
        <li><a href="#file-association">File association</a></li>
        <li><a href="#login-info">Login info</a></li>
        <li><a href="#attached-devices">Attached devices</a></li>
        <li><a href="#autostart-locations">Autostart locations</a></li>
        <li><a href="#uninstalled-applications">Uninstalled applications</a></li>
        <li><a href="#domain-accounts">Domain Accounts</a></li>
      </ul>
    </li>
    <li><a href="#system">System</a>
      <ul>
        <li><a href="#current-control-set">Current control set</a></li>
        <li><a href="#memory-manegement">Memory Manegement</a></li>
        <li><a href="#computer-name">Computer name</a></li>
        <li><a href="#last-shutdown-time">Last shutdown time</a></li>
        <li><a href="#crash-dump-setting">Crash dump setting</a></li>
        <li><a href="#services">Services</a></li>
        <li><a href="#prefetch-settings">Prefetch settings</a></li>
        <li><a href="#ntfsdisablelastaccessupdate">NtfsDisableLastAccessUpdate</a></li>
        <li><a href="#system-time">System time</a></li>
        <li><a href="#usbs">USBs</a></li>
        <li><a href="#appcompatcache-aka-shimcache">AppCompatCache aka ShimCache</a></li>
        <li><a href="#bam">BAM</a></li>
      </ul>
    </li>
    <li><a href="#nt-user">NT User</a>
      <ul>
        <li><a href="#recent-documents">Recent documents</a></li>
        <li><a href="#typed-urls">Typed URLs</a></li>
        <li><a href="#user-assist">User assist</a></li>
        <li><a href="#recent-apps">Recent Apps</a></li>
        <li><a href="#jump-list-data">Jump List Data</a></li>
        <li><a href="#runrun-once">Run/Run once</a></li>
        <li><a href="#word-wheel-query">Word Wheel Query</a></li>
        <li><a href="#comdlg32">ComDlg32</a></li>
        <li><a href="#typed-paths">Typed Paths</a></li>
        <li><a href="#office-mru">Office MRU</a></li>
        <li><a href="#mounted-devices">Mounted Devices</a></li>
      </ul>
    </li>
    <li><a href="#usrclassdat">UsrClass.dat</a>
      <ul>
        <li><a href="#managedbyapp">ManagedByApp</a></li>
        <li><a href="#muicache">MUICache</a></li>
        <li><a href="#shellbags">ShellBags</a></li>
      </ul>
    </li>
    <li><a href="#amcache">AmCache</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
 </div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Windows Registry</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      <div class="article-category">domain: 
          
              
                <i class="fas fa-archive"></i>
              
          <a class="category-link" href="/domain/general">general</a>
          
      </div> <br />
      
      <div class="article-category">doctype:
          
            
              
                <i class="fa fa-graduation-cap"></i>
              
          <a class="platform-link" href="/doctype/article">article</a>
          
      </div> <br /><br/>
      
      
      
      
      <div class="article-category">
          
            
            
            
            
            
          <a class="platform-link" href="/platforms/win">win</a>
          
      </div> <br />
      

      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <p>Registry is a repository for settings on a Windows machine. Prior to Windows NT, <code>ini</code> files were used. These were substituted with Windows registry to keep initialization and configurations. Some changes are also logged by the registry.</p>
<blockquote>
<p>âš ï¸ If the OS was reinstalled, the registry is backed up (<code>windows.old</code>) [<a href="https://www.coursera.org/learn/windows-registry-forensics/lecture/j8uJp/software-file-subkeys-of-interest">5</a>]. However, Windows.old is almost totally deleted after 28 days [<a href="https://superuser.com/questions/1210451/what-does-windows-old-folder-contain">9</a>] .</p>
</blockquote>
<blockquote>
<p>ğŸ§ª â“ Can registry hives be altered on a live system? What priviledges are required?</p>
</blockquote>
<h2 id="structure">Structure</h2>
<p>Hives are the first &ldquo;folders&rdquo; under the root folder. For example, under the root folder HKEY_LOCALMACHINE there is a set of folders. These are hives (purple rectangle). All the folders inside are keys and subkeys (green rectangle).</p>
<p><img src="images/reg1.png" alt="reg1"></p>
<p>There are two types: system related files and user related. System related âš™ï¸:</p>
<ul>
<li>SAM</li>
<li>System</li>
<li>Security</li>
<li>Software</li>
<li>AmCache</li>
</ul>
<p>User related (specific to this user) ğŸ‘¨â€ğŸ’»:</p>
<ul>
<li>NT User.dat</li>
<li>User Class.dat</li>
</ul>
<p>When the OS boots up, it loads the handles to these hives into memory (<code>HK...</code> - handle key):</p>
<ul>
<li><code>HKEY_LOCAL_MACHINE</code> (HKLM)
<ul>
<li><code>HARDWARE</code> ğŸ‡</li>
</ul>
</li>
<li><code>HKEY_CLASSES_ROOT</code> (HKCR). Filled up at boot time with the data from <code>HKEY_LOCAL_MACHINE\Software\Classes</code> keys and data.</li>
<li><code>HKEY_CURRENT_CONFIG</code> (HKCC) ğŸ‡. It&rsquo;s a pointer to <code>HKEY_LOCAL_MACHINE\System\CurrentControlSet\HardwareProfiles\Current</code>.</li>
<li><code>HKEY_USERS</code> (HKU)</li>
<li><code>HKEY_CURRENT_USER</code> (HKCU) ğŸ‡ . Information pulled from <code>NTUset.dat</code>.</li>
</ul>
<p>Some of the settings can only be found on a live system (ğŸ‡). SAM hive and all of its subkeys will not be accessible.</p>
<p>âš ï¸ There is no <code>CurrentControlSet</code> on a dead-box. To determine which one of the <code>ControlSet</code>s is current, use <code>Select\Current</code> key (usually <code>1</code>, which means <code>ControlSet001</code>). <code>Last Known Goog</code> is usually <code>2</code> (which means <code>ControlSet002</code>), used for recovery purposes.</p>
<p>Non-live registry (missing some hives) can be accessed from a disk image for example. <code>C:\Windows\System32\config</code> contains 4 main hives: SAM, System, Security and Software. <code>C:\Windows\appcompat\Programs</code> contains <code>amcahce.hve</code>. User-related files mentioned above can be found at <code>C:\Users\%Username%\NTUser.dat</code> and <code>C:\Users\%Username%\AppData\Local\Microsoft\Windows\UsrClass.dat</code>. So, those mysterious <code>XXX.dat</code> files are actually a registry file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Get-ChildItem</span> <span class="n">HKLM</span><span class="err">:</span><span class="n">Software</span> <span class="p">|</span> <span class="nb">Format-Wide</span>
</span></span></code></pre></div><h2 id="sam">SAM</h2>
<p><strong>Path to file</strong> ğŸ›£ï¸: <code>C:\Windows\System32\config\SAM</code>.</p>
<p>âš ï¸ This file cannot be edited through the RegEdit unless admin grants you permissions (data marked with red is not accesssible unless the access is granted by admin):</p>
<p><img src="images/sam-hive-permissions.png" alt="sam-hive-permissions"></p>
<p>However, this file can be accessed on a dead-box system. âš ï¸ Also, this file only stores local creds, not domain or Microsoft account credentials!</p>
<p>SAM is a database of files, and it stores all the information about all the users: login information, password hashes, group information.</p>
<p>ğŸ›  Registry Explorer (Eric Zimmerman&rsquo;s tool) can collect all user from the SAM and Profile files and show them assembled. This data can be exported to Excel, for example.</p>
<h3 id="local-user-accounts">Local User Accounts</h3>
<p>For each user there will be a separate sub-key under <code>SAM\SAM\Domains\Account\Users</code>. The sub-keys names are actually RID of the user in hex. Each sub-key will have several values. Record <code>V</code> contains static information (username, password length etc), while record <code>F</code> contains constantly updated information like timestamps ğŸ•°:</p>
<ul>
<li>Last login is a little endian 8 byte value at <code>0x08-0x0f</code> offset.</li>
<li>Last password change time at offset <code>0x18-0x1f</code>, 8 bytes long.</li>
<li>Last failed logon time is at offset <code>0x28-0x2f</code>, 8 bytes.</li>
</ul>
<p>RID itself is stored here, in <code>F</code> record at offset <code>0x30-0x33</code> (little endian). Also, there is <code>PasswordRequired</code> (at <code>0x38</code>). There several possible values for this nibble (half byte): <code>0</code> - account active + pass required, <code>1</code> - account is not active, <code>4</code> - any policies do not apply to this account.</p>
<blockquote>
<p>ğŸ§ª I have <code>5</code> on my machine, what does it mean?</p>
</blockquote>
<p>Logon count is at <code>0x42-0x43</code> (two bytes).</p>
<p>The <code>V </code> value is more interesting. It contains usernames and hashes (NTLM). The user account name is at <code>0x1C0</code> offset (Unicode). What about the juicy stuff? I mean the password hashes. SAM file contains a 56-byte NTLM hash of the password, which is encrypted with a AES algo,  the key ğŸ”‘ is stored in a system file. To decrypt the password, you&rsquo;ll need both SAM <strong>and</strong> the system file. Password cracking methodology:</p>
<ul>
<li><input disabled="" type="checkbox"> Export SAM and SYSTEM hives from the forensic image/suspect machine.</li>
<li><input disabled="" type="checkbox"> Unencrypt the hash stored in the SAM file (ğŸ›  <code>mimikatz</code>).</li>
<li><input disabled="" type="checkbox"> Create a word list from the current case (may export from Autopsy, EnCase etc).</li>
<li><input disabled="" type="checkbox"> Run a dictionary ğŸ“– or brute-force attack ğŸ’ª against this NTLM hash (ğŸ› : <code>hashcat</code> ğŸˆâ€â¬› , <code>John the Ripper</code> ğŸ”ª, Cain and Able ğŸ”ª ğŸ).</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># decrypt the hashes:</span>
</span></span><span class="line"><span class="cl">mimikatz
</span></span><span class="line"><span class="cl">&gt; lsadump::sam /system:<span class="s2">&#34;path_to_SYSTEM&#34;</span> /SAM:<span class="s2">&#34;path_to_SAM&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># crack the hash with john (NTHash)</span>
</span></span><span class="line"><span class="cl">john --format<span class="o">=</span>nt hash.txt
</span></span><span class="line"><span class="cl"><span class="c1"># crack the hash with hashcat (NTHash)</span>
</span></span><span class="line"><span class="cl">hashcat -m <span class="m">1000</span> -a <span class="m">3</span> hash.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># crack the hash with john (NTLMv1) </span>
</span></span><span class="line"><span class="cl">john --format<span class="o">=</span>netntlm hash.txt
</span></span><span class="line"><span class="cl"><span class="c1"># crack the hash with hashcat (NTLMv1) </span>
</span></span><span class="line"><span class="cl">hashcat -m <span class="m">5500</span> -a <span class="m">3</span> hash.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># crack the hash with john (NTLMv2) </span>
</span></span><span class="line"><span class="cl">john --format<span class="o">=</span>netntlmv2 hash.txt
</span></span><span class="line"><span class="cl"><span class="c1"># crack the hash with hashcat (NTLMv2) </span>
</span></span><span class="line"><span class="cl">hashcat -m <span class="m">5600</span> -a <span class="m">3</span> hash.txt 
</span></span></code></pre></div><p><strong>Other values stored in this sub-key</strong>. <code>ForcePasswordReset</code> speaks for itself and <code>SupplementalCredentials</code> do not. There also can be a <code>UserPasswordHint</code>, sometimes contains the actual password. It also contains RID, which can be changed in <a href="/docs/dfir/host/reference/windows/win-lsa#rid-hijacking">RID hijacking attack</a>. There is also a technique that allows resetting local account password by clearing <code>lmpw_len</code> (LM password hash length) and <code>ntpw_len</code> (NTLM password hash length) at <code>0x2c</code> and <code>0x30</code> respectively [<a href="http://www.ijfcc.org/vol5/455-F005.pdf">8</a>].</p>
<h3 id="microsoft-accounts">Microsoft Accounts</h3>
<p>Since Win8. Can be logged in if there is internet access. Profiles and settings are stored in the cloud â˜ï¸. Additional values are stored in SAM: <code>InternetUID</code> and <code>InternetUserName</code>. Both are unique to the user. <code>InternetUID</code> is a 16 byte Unicode string. <code>InternetUserName</code> - usually an email used as a login.</p>
<h3 id="domain-accounts--">Domain Accounts  âš ï¸</h3>
<p><strong>Key</strong> ğŸ”‘ : <code>Software\Microsoft\Windows NT\CurrentVersion\ProfileList</code>.</p>
<p>The key above will have a <code>ProfileImagePath</code>.</p>
<p>âš ï¸ SAM doesn&rsquo;t have any informaiton about domain accounts! See more info <a href="#software/domain-accounts">in software section, domain accounts</a>.</p>
<h3 id="deleted-accounts">Deleted Accounts</h3>
<p>ğŸ›  Registry Explorer (Eric Zimmerman&rsquo;s tool) shows deleted accounts. If the data was not overwritten, we will be able to get the information.</p>
<h2 id="software">Software</h2>
<p><strong>Path to file</strong> ğŸ›£ï¸: <code>C:\Windows\System32\config\SOFTWARE</code>.</p>
<p>System-wide information. All the below keys start with <code>Computer\HKEY_LOCAL_MACHINE\SOFTWARE\</code>. So, I&rsquo;ll only show relative path, not full for simplicity&rsquo;s sake. It contains configurations and information about software components of the system.</p>
<h3 id="installed-programs-and-applications">Installed programs and applications</h3>
<p><strong>Key</strong> ğŸ”‘: <code>Microsoft\Windows\CurrentVersion\Uninstall</code>. There can be some data for programs that do not exist on the system anymore. The last write time is when the application was installed.</p>
<p><strong>Key</strong> ğŸ”‘ <code>Microsoft\Windows\CurrentVersion\Appx\AppxAllUserStore</code> for installed Microsoft applications. Defines between those that were installed for a specific user or system-wide.</p>
<p><strong>Key</strong> ğŸ”‘: <code>Wiw6432Node</code> (<code>SYSTEM</code> hive root node) - those that run a 32-bit mode. Separate sub-keys for different versions of a program.</p>
<p><strong>Key</strong> ğŸ”‘: <code>Classes\Installer\Products</code> - installed using Miscrosoft installer (those with <code>msi</code> extension).</p>
<h3 id="os-information">OS Information</h3>
<p><strong>Key</strong> ğŸ”‘: <code>Microsift\Windows NT\CurrentVersion</code>. Value <code>InstallDate</code> - Install date, Unix, numeric value (for ğŸ›  Decode).</p>
<h3 id="network-information">Network Information</h3>
<p><strong>Key</strong> ğŸ”‘: <code>Microsoft\Windows NT\CurrentVersion\NetworkList</code> - Wireless information. <code>Profiles</code> - network info by GUID, data first and last connected. <code>Signatures</code> - gw MAC address; contains <code>Managed</code> (managed, like a domain) and <code>Unmanaged</code> (like a PC and home router). <code>Profile name</code> - SSID or server. <code>Description</code> - usually the same as <code>Profile name</code>. <code>Managed</code> - <code>1</code> (connection to a server) or <code>0</code> (wireless router). <code>Date Created</code> - . <code>Date last connected</code> - . Both are Windows 128-bit SYSTEM structure (ğŸ›  Decode).</p>
<p><strong>Key</strong> ğŸ”‘: <code>Clients\StartMenuInternet</code> - default browser. Open the sub-keys to see installed browsers and their information. Last write timestamp - when they were installed on the system.</p>
<h3 id="file-association">File association</h3>
<p><strong>Key</strong> ğŸ”‘: <code>Classes</code>. For each extension there is a <code>OpenWith</code> - suggestions, which program can be used. That&rsquo;s the file association itself. <code>OpenWithProgIDs</code> - user-selected.</p>
<p><strong>Key</strong> ğŸ”‘: <code>Microsoft\Windows\CurrentVersion\Applets</code>. Something that comes with Windows (built-in).</p>
<h3 id="login-info">Login info</h3>
<p><strong>Key</strong> ğŸ”‘: <code>Microsoft\Windows\CurrentVersion\Authentication\LogonUI</code> - last logged in user.</p>
<p><strong>Key</strong> ğŸ”‘: <code>Microsoft\Windows NT\CurrentVersion\Winlogon</code>. Manages the boot process, logging operations, loading profiles.</p>
<h3 id="attached-devices">Attached devices</h3>
<p><strong>Key</strong> ğŸ”‘: <code>Microsoft\Windows Portable Devices\Devices</code>. For USB and other devices connected. The sub-key name contains the device&rsquo;s serial number, name, disk ID (between <code>{}</code>), which is assigned by OS. This disk id can be used to track the device accross the system, for example, other registry values. But keep in mind, that not every USB device has a serial number. Dates and times - when the device was first inserted <em>after the last reboot</em>. <code>FriendlyName</code> - user-created name of the volume.</p>
<p><strong>Key</strong> ğŸ”‘: <code>Microsoft\Windows NT\CurrentVersion\EMDMgmt</code>. It was put as an extension of memory (aka ready boost). Checks to see if the USB device can be used to extend memory. Timestamps - when first inserted. Some entries are ending with some decimal number, this is a volume ID in decimal (convert to hex and get your GUID that can be used to correlated data with <code>USBSTR</code> in <code>SYSTEM</code> hive, see below). These should be converted to hex and used to trace the device accross the system.</p>
<p><strong>Key</strong> ğŸ”‘: <code>Microsoft\Windows NT\CurrentVersion\Print\Printers</code> for printers connected. This subkey may also contains some SIDs. I don&rsquo;t quite understand yet, when this happens in general, but one case is when OneNote is used to share documets.</p>
<blockquote>
<p>âš ï¸ Use information about USB devices from <code>SYSTEM</code> hive to get more and validate this information.</p>
</blockquote>
<h3 id="autostart-locations">Autostart locations</h3>
<p><strong>Key</strong> ğŸ”‘:  <code>Microsoft\Windows\CurrentVersion\Run</code> and <code>Microsoft\Windows\CurrentVersion\RunOnce</code>.</p>
<p>There are two place for autoruns in <code>SOFTWARE</code> hive, both are system wide â“</p>
<h3 id="uninstalled-applications">Uninstalled applications</h3>
<p><strong>Key</strong> ğŸ”‘:  <code>Microsoft\Windows\CurrentVersion\Uninstall</code></p>
<h3 id="domain-accounts">Domain Accounts</h3>
<p><strong>Key</strong> ğŸ”‘ : <code>Software\Microsoft\Windows NT\CurrentVersion\ProfileList</code>.</p>
<p>The key above will have a <code>ProfileImagePath</code>.</p>
<p>SAM doesn&rsquo;t have any informaiton about domain accounts. For this information refer to the key above. Even though in case of a domain user there is no relevant information in SAM hive, you can still view the machine/domain ID in SAM and use it to determine whether the files were created on the local machine. For example, in the Recycle Bin.</p>
<h2 id="system">System</h2>
<p><strong>Path to file</strong> ğŸ›£ï¸: <code>C:\Windows\System32\config\SYSTEM</code>.</p>
<p><strong>Tools</strong> ğŸ› : Registry Explorer, Timeline Exlorer, AppCompatCacheParser, AmcacheParser, ShimCacheParser.py</p>
<p>Contains the following information, listed below. System-wide information. All the below keys start with <code>Computer\HKEY_LOCAL_MACHINE\SOFTWARE\</code>. So, I&rsquo;ll only show relative path, not full for simplicity&rsquo;s sake. This hive contains information about the system, devices attached, services running.</p>
<h3 id="current-control-set">Current control set</h3>
<p><strong>Key</strong> ğŸ”‘: <code>Computer\HKEY_LOCAL_MACHINE\System\Select\Current</code>.</p>
<p>There are generally two ControlSets (specific settings): <code>001</code> and <code>002</code>. The second one is generally used for recovery options. Which one is the current one? The one that is shown under <code>CurrentControlSet</code> in a live registry. But what about an offline one? Go to the key above and see which one is current. Then, choose <code>ControlSet001</code> or <code>ControlSet002</code> to get the data that is the most relevant at this point in time.</p>
<h3 id="memory-manegement">Memory Manegement</h3>
<p><strong>Key</strong> ğŸ”‘: <code>ControlSet001\Control\Session Manager\Memory Management</code>.</p>
<p>Value <code>ClearPageFileAtShutdown</code> shows whether <code>pagefile.sys</code> cleared at shutdown. This file contains some portion of RAM.  <code>1</code> - cleared, <code>0</code> - not cleared.</p>
<h3 id="computer-name">Computer name</h3>
<p><strong>Key</strong> ğŸ”‘: <code>Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\ComputerName\ComputerName</code> and <code>Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\ComputerName\ActiveComputerName</code>. Can be either manufacturer or user-defined.</p>
<h3 id="last-shutdown-time">Last shutdown time</h3>
<p>Key ğŸ”‘: <code>Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\Windows\LastShutdownTime</code></p>
<p>A 64-bit little-endian value, Windows FileTime. âš ï¸ If the PC was shutdown due to some power source loss (plugged out), you won&rsquo;t see this value being updated.</p>
<h3 id="crash-dump-setting">Crash dump setting</h3>
<p>Key ğŸ”‘: <code>Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\CrashControl\DumpFile</code> and <code>--\\--\MinidumpDir</code>.</p>
<p>Stores the location of <code>*.DMP</code>.</p>
<h3 id="services">Services</h3>
<p>Key ğŸ”‘: <code>Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services</code></p>
<p>This is another Autorun location. Contains information that can be retrieved from a services utility on a live system: image path, display name and start type (boot, manual, auto). <code>Parameters</code> subkey contains <code>ServiceDll</code> value showing dlls loaded by this process. Can be examined to find rogue processes (see the Windows core processes page for more details for rogue process identification) or the processes information collection and analysis section. â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸</p>
<h3 id="prefetch-settings">Prefetch settings</h3>
<p><strong>Key</strong> ğŸ”‘: <code>Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\Session Manager\Memory Management\Prefetch Parameters</code></p>
<p><code>EnablePrefetcher</code> will have either of the following 4 values:</p>
<ul>
<li><code>0</code> - disabled.</li>
<li><code>1</code> - enabled for applications only.</li>
<li><code>2</code> - enabled only for OS booting.</li>
<li><code>3</code> - enabled for both applications and boot process.</li>
</ul>
<p>More about Prefetch in the corresponding article.</p>
<h3 id="ntfsdisablelastaccessupdate">NtfsDisableLastAccessUpdate</h3>
<p><strong>Key</strong> ğŸ”‘: <code>ControlSet001\Control\FileSystem\NtfsDisableLastAccessUpdate</code>.</p>
<p>Last access file time settings. If <code>1</code> - disabled (default), <code>0</code> - enabled. âš ï¸ If it&rsquo;s disabled (more likely), the access times are not reliable in this case. However, this doesn&rsquo;t apply to MFT file records updates.</p>
<p>NTFS Last Accessed Update (Win10+) -</p>
<p>80000000 (hex) = User Managed, Last Access Updates Enabled
80000001 (hex) = User Managed, Last Access Updates Disabled
80000002 (hex) = System Managed, Last Access Updates Enabled - default for Windows 11 (in my case).
80000003 (hex) = System Managed, Last Access Updates Disabled</p>
<h3 id="system-time">System time</h3>
<p>Key ğŸ”‘: <code>Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\TimeZoneInformation\TimeZoneKeyName</code></p>
<h3 id="usbs">USBs</h3>
<p><strong>Key</strong> ğŸ”‘: <code>ControlSet001\Enum\USBSTOR</code> or <code>ControleSet001\Enum\USB</code> (on my Win10 VM)</p>
<p><strong>Key</strong> ğŸ”‘: <code>MountedDevices</code> - used to map devices to drive letters (not only USBs).</p>
<p>Contains ever connected USBs with their serial numbers (if they have these) and some additional information. <code>0064</code> - first installed, <code>0065</code> last installed, <code>0066</code> last arrival and <code>0067</code> last removal. The full path: <code>Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Enum\USB\ROOT_HUB20\4&amp;3af74d6&amp;0\Properties\{83da6326-97a6-4088-9453-a1923f573b29}\</code>. âš ï¸ Note that <code>ROOT_HUB20\4&amp;3af74d6&amp;0</code> is device specific, but <code>{83da6326-97a6-4088-9453-a1923f573b29}</code> is not.</p>
<blockquote>
<p>âš ï¸ To view <code>Properties</code> subkey admin ğŸ§‘â€ğŸ’¼ privileges are not enough for the live-registry. Install <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/psexec">psexec</a> and elevate to system by running the folling command from the <code>psexec</code> folder: <code> .\PsExec.exe -i -s -d powershell.exe</code>. In the PowerShell window that opens run <code>regedit</code>.</p>
</blockquote>
<p><code>Device Parameters\PartMgr</code> - gives a disk ID. <code>PartitionTableCache</code> may contains &hellip; surprise-surprise&hellip; a partition table! Wow&hellip; . For a GPT locate <code>FF FF FF FF 00 00 00 00</code>. 16 bytes right after that are for file system GUID. The next 16 bytes are unique volume GUID used to identify the volume accross systems as well as within one. It might be empty for a USB device. <code>ContainerID</code> - very important, can be used to filter event logs.</p>
<p>As for the <code>MountedDevices</code>&hellip; . If a device doesn&rsquo;t have a serial number, it&rsquo;ll be assigned a machine assigned number aka unique instance ID (not consistent accross multiple systems). If the second character is <code>&amp;</code> - not a a serial number.</p>
<blockquote>
<p>â“ How do I find it? Lot&rsquo;s of gibberish is all I see&hellip;</p>
<p>âœï¸ Just find the device name, search for the <code>#</code> sign, check after it and up until the next <code>#</code> right before a GUID contained withing <code>{}</code>.</p>
</blockquote>
<p>This is an example of a USB device <strong>with</strong> a serial number that will be reletively unique (not all vendors borther giving each USB drive a separate serial number).</p>
<p><img src="images/usb-2.png" alt="usb-2"></p>
<p>And here is an example of a machine assigned id. Note, that the second symbols is <code>&amp;</code>.</p>
<p><img src="images/usb-1.png" alt="usb-1"></p>
<p>The value that follows the serial number/uniqueid right after the second <code>#</code> and encolsed between <code>{}</code> is the disk id.</p>
<h3 id="appcompatcache-aka-shimcache">AppCompatCache aka ShimCache</h3>
<p><strong>Key</strong> ğŸ”‘: <code>CurrentControlSet\Control\Session Manager\AppCompatCache\AppCompatCache</code>.</p>
<p><strong>ğŸ› </strong>: ShimCacheParser.py (requires Python2), AppCompatCacheParser</p>
<p>Originally was used to identify compatibility issues between 32 and 64 bit progs. Track the file path, size, last modified time â°. Only logs specific file extensions. It might not be a reliable evidnce that the program was executed or even installation, but if the program was installed and deleted - it won&rsquo;t be deleted from here. ShimCache is another name for this artifact. Uses file system timestamps.</p>
<p>If the executable is modified or renamed, new entry will be created, but modified date and time will be the same for both files even after these actions take place. $UsnJrnl is another place to make sure that is what had happened. $Logfile.</p>
<blockquote>
<p>âš ï¸ Written at shutdown!</p>
<p>âš ï¸ Doesnâ€™t track the file execution for Win7+ systems.</p>
</blockquote>
<h3 id="bam">BAM</h3>
<p><strong>Key</strong> ğŸ”‘: <code>ControlSet001\Services\BAM</code>.</p>
<blockquote>
<p>âš ï¸ Windows 10 only!</p>
</blockquote>
<p>Background Activity Monitor. Organaized by user SID. Windows apps&rsquo; names are not parsed very well here. Gives last executed time â° , 64-bit little-endian (first 8 bytes of the value). It <strong>does</strong> prove program execution and it ties it to the specific user. May use the same technique for core processes analysis and identifying rogue processes like in RAM.</p>
<h2 id="nt-user">NT User</h2>
<p><strong>Path to file</strong> ğŸ›£ï¸: <code>C:\Users\%Username%\NTUser.dat</code>.</p>
<p>Key interesting for a forensic examiner are listed below.</p>
<h3 id="recent-documents">Recent documents</h3>
<p><strong>Key</strong> ğŸ”‘: <code>NTUSER.DAT\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs</code></p>
<p>Contains the list of all recent documents as a bunch and also the same data sorted by extension. <code>MRUListEx</code> is list. It has a number of 4 byte values, each noting the sequence number of a document. It starts from the document&rsquo;s number that was accessed some time age (first in the list) and ends with the most recently used one. This key also has a list of recently accessed folders.</p>
<blockquote>
<p>âš ï¸ğŸ” I only had a short binary data stream under the <code>ViewStream</code> subkey.</p>
</blockquote>
<h3 id="typed-urls">Typed URLs</h3>
<p><strong>Key</strong> ğŸ”‘: <code>NTUSER.DAT\SOFTWARE\Microsoft\Internet Explorer\Typed URLs</code>. Timestamps are at <code>TypedURLsTimes</code>.</p>
<p>âš ï¸ for Internet Explorer only, holds up to 25 entries. Since it&rsquo;s used for InternetExplorer only and Internet Explorer is dying, most likely this artefact is &ldquo;fading in the past&rdquo;.</p>
<h3 id="user-assist">User assist</h3>
<p><strong>Key</strong> ğŸ”‘: <code>NTUSER.DAT\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User Assist</code>.</p>
<p>List of progs and applets that can be quicly started from the Start menu for usability, the most often used items. Shows a <code>focus count</code> for each entry. It means, how many time was the window switched to (that doesn&rsquo;t include the time when the program is first run). Shows the last time that the program was executed, focus time, run count.</p>
<p>At the start of each entry between <code>{}</code> is the code for a location within file system. Registry Explorer will substitute these automatically, since these GUIDs are predefined.</p>
<p>This what a full filled User Assist key looks like. <code>{CEBFF5CD-ACE2-4F4F-9178-9926F41749EA}</code> is for programs that were lauched using their image files directly. <code>{F4E57C4B-2036-45F0-A9AB-443BCFE33D9F}</code> is for those, started with a shortcut.</p>
<p><img src="images/user-assist1.png" alt="user-assist1"></p>
<p>The structure is quite simple:</p>
<ul>
<li>At <code>0x04</code> offset starts the number of executions (4 bytes).</li>
<li>At <code>0xC</code> offset starts the focus time (4 bytes)</li>
<li>At <code>0x3C</code> offset starts the Last Execution time (8 bytes), which is a Win64-bit little-endian value (for Decode ğŸ› ).</li>
</ul>
<blockquote>
<p>âš ï¸ ğŸ” I could not find this key on my Win10 VM.</p>
<p>âš ï¸ When the program was started via <code>lnk</code> file, the focus count will be <code>0</code>.</p>
</blockquote>
<h3 id="recent-apps">Recent Apps</h3>
<p><strong>Key</strong> ğŸ”‘: <code>NTUSER.DAT\SOFTWARE\Microsoft\Windows\CurrentVersion\Search\RecentApps</code>.</p>
<p>Similar to User Assist. Also shows files and applications that were used through this application. This key consists of sub-keys that are marked with application&rsquo;s GUID. Some of them will have <code>Recent Items</code> sub-key (10 max), each has <code>Last Write Time</code> (Windows 64-bit, little-endian).</p>
<blockquote>
<p>âš ï¸ Not all Win10 machines will have this key.</p>
</blockquote>
<p><strong>Key</strong> ğŸ”‘: <code>Software\Microsoft\Windows\Current Version\Explorer\RunMRU</code>.</p>
<p>A list of the programs that have been run from the Run command is shown. Each time you use a command that has already been stored, it moves to the top of the list.</p>
<h3 id="jump-list-data">Jump List Data</h3>
<p>Key ğŸ”‘: <code>NTUSER.DAT\SOFTWARE\Microsoft\Windows\CurrentVersion\Search\JumplistData</code>.</p>
<p>Shows applications accessed.</p>
<h3 id="runrun-once">Run/Run once</h3>
<p><strong>Key</strong> ğŸ”‘: <code>NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Run</code>,<code>Computer\HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce</code>.</p>
<p>For that particular user. System-wide autoruns are stored in <code>HKLM_LOCAL_MACHINE\SOFTWARE</code>. The keys are ignored if the PC is started in a safe mode. âš ï¸ However, if the value in <code>RunOnce</code> is prefixed with an <strong>asterisk</strong> (*), it will run <strong>even</strong> in the <strong>safe mode</strong>!</p>
<h3 id="word-wheel-query">Word Wheel Query</h3>
<p><strong>Key</strong> ğŸ”‘:<code>NTUSER.DAT\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\WordWheelQuery</code> (Win7, search from the start menu), <code>NTUSER.DAT\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\SearchHistory\Microsoft.Windows.FileSearchApp</code> (Win8, search from the start menu), <code>Users\%USERNAME%\AppData\Local\Micorsoft\Windows\ConnectedSearch\History</code> (Win8.1, stored as individual <code>lnk</code> files, contains file date and times, items accessed from the charms bar (aka Start menu)), <code>NTUSER.DAT\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\WordWheelQuery</code> (Win10, searched from File Explorer).</p>
<blockquote>
<p>âš ï¸ On Windows 10 search terms that are typed into the charms bar are tracked by Cortana in a dedicated DB outside the registry.</p>
</blockquote>
<p>Search history of the Start menu and Windows Explorer (MRU order - <strong>m</strong>ost <strong>r</strong>ecently <strong>u</strong>sed), last accessed date, search terms typed by user.</p>
<p>ğŸ” I could not find this key on my Win10 VM.</p>
<blockquote>
<p>ğŸ§ª I could not find some of the above mentioned keys on my Win10 VM. I tried both <code>HKEY_LOCAL_MACHINE</code> and <code>HKEY_CURRENT_USER</code>.</p>
</blockquote>
<h3 id="comdlg32">ComDlg32</h3>
<p><strong>Key</strong> ğŸ”‘: <code>NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32</code>.</p>
<p><code>CIDSizeMRU</code>- Tracks applications globally. MRU start at zero. Timestamp for the most recent item only. <code>FirstFolder</code> -tracks the install locations of applications, full path to the app, but no exact file name. <code>OpenSavePidMRU</code> - tracks files that were saved with <code>Save As</code> dialog, or opened with <code>Open</code> dialog. Tracks autocomplete terms. <code>LastVisitedPidMRU</code> - tracks the specific executable used by an application to open the files documented in the <code>OpenSaveMRU</code> key. Also tracks the directory for the last application accessed for each file in <code>OpenSavePidMRU</code>, tracks the location the file existed.</p>
<h3 id="typed-paths">Typed Paths</h3>
<p><strong>Key</strong> ğŸ”‘: <code>NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\TypedPaths</code>.</p>
<p>Files and directories that were accessed by typing address in File Explorer.</p>
<h3 id="office-mru">Office MRU</h3>
<p><strong>Key</strong> ğŸ”‘: <code>NTUSER.DAT\Software\Microsoft\Office\XX.X</code>.</p>
<p>You might see if there were several versions of Microsoft Office installed. Expanding Word|Excel|PowerPoint etc and looking at the entries, they have a <code>Txxxxxxxx</code> in the middle. That&rsquo;s time (Win64 big-endian, UTC).</p>
<h3 id="mounted-devices">Mounted Devices</h3>
<p><strong>Key</strong> ğŸ”‘: <code>MountPoints2</code>.</p>
<p>If you connect volumes from a system-wide <code>MountPoints</code> (above) and <code>USBSTR</code>, we can connect a device to a specific user.</p>
<h2 id="usrclassdat">UsrClass.dat</h2>
<p><strong>Path to file</strong> ğŸ›£ï¸ : <code>C:\Users\%Username%\AppData\Local\Microsoft\Windows\UsrClass.dat</code>. Specific to the user.</p>
<p>Each <strong>key</strong> ğŸ”‘ below starts with <code>UsrClass.dat</code> for an offile-registry and <code>HKEY_CURRENT_USER</code> for a live registry. Try omitting <code>Local Settings</code> if you can&rsquo;t find the keys mentioned (at least, for live registry).</p>
<p>For the beloow</p>
<h3 id="managedbyapp">ManagedByApp</h3>
<p><strong>Key</strong> ğŸ”‘: <code>Software\Microsoft\Windows\CurrentVersion\AppModel\SystemAppData\Microsoft.Windows.Photos_8wekyb3d8bbwe\PersistedStorageItemTable\ManagedByApp</code>.</p>
<p>Tracks images opened with Microsoft application. Shows <em>volume GUID</em> (use other USB-related registry to assemble the picture), file path, data and time â°. <code>LastUpdateTime</code> shows when the files was &hellip; . This date and time is very close <code>LastInteracted</code> from ShellBags. Go to <code>MountedDevices</code> in <code>SOFTWARE</code> hive to find the device by the volume GUID and the to <code>SYSTEM</code>&rsquo;s <code>USBSTR</code> -&gt; <code>PartitionTableCache</code>.</p>
<p>This information is very useful for child abuse cases.</p>
<h3 id="muicache">MUICache</h3>
<p><strong>Key</strong> ğŸ”‘: <code>Local Settings\Software\Microsoft\Windows\Shell\MuiCache</code>.</p>
<p>Installed and executed applications for <strong>that particular user</strong>. But no timestamps for this acts, only last write data and time for the key in registry.</p>
<h3 id="shellbags">ShellBags</h3>
<p><strong>Key</strong> ğŸ”‘ : <code>Local Settings\Software\Microsoft\Windows\Shell\BagMRU </code>. Values: <code>MRUListEx</code>, <code>NodeSlot</code>, <code>Subkeys</code>.</p>
<p><strong>Key</strong> ğŸ”‘ : <code>Local Settings\Software\Microsoft\Windows\Shell\Bags</code>. Values: <code>Shell</code>, will have folder&rsquo;s GUID.</p>
<p><code>Created On</code>: when the folder was created/moved/renamed. Last accessed and created are sometimes the same. Last modified is when the preferences were last changed (window resized, view options changed). Mind if itâ€™s utc or gmt. Also, this data might be updated with a little lag. <code>Last key write time</code> is the ShellBag&rsquo;s timestamp.</p>
<blockquote>
<p>âš ï¸ Shortcuts MAC times are not updated!</p>
<p>âš ï¸ Fat16 only records date. No time. So the <code>Last accessed</code> time for a fat16 formatted folder will be <code>00:00:00.000</code>. It&rsquo;s more usual for a USB removable media.</p>
</blockquote>
<p><code>Created On</code>, <code>Modified On</code> and <code>Last accessed on</code> are all FS timestamps â—ï¸â—ï¸â—ï¸ However, <code>Registry last write time</code> is its own timestamp and it seems to be updated even when no preferences were changed.</p>
<p>Track Windows folder settings (how the view is set), track zip files, folder access, even if information was deleted. Can also show folders on removable media. This data is a little bit confusing at first, but can be digested in a couple of minutes. One important thing to note is that both keys are interconnected. I&rsquo;ve used arrows, squares and circles to mark data corresponding to each for better visualization on the picture below. Sometimes, additional info for NTFS filesystem will be available (MFT record number) and file system type as well, not always however.</p>
<blockquote>
<p>âš ï¸ Proves that the user interacted with these folders if they are found in ShellBags but not on the system.</p>
<p>â“ How about when being hacked? A hacker might delete the folder.</p>
</blockquote>
<p>Right under <code>BagMRU</code> subkey, there is only one subkey (in this case, in case of shell bags, a folder): <code>0</code>.  <code>MRUListEx</code> contains a list of folders inside this one identified by sequence numbers. In our example there are only three subfolders (and, hence, values in the list) in this folder: <code>00 00 00 00</code>, just <code>0</code> in little-endian (green), <code>01 00 00 00</code>, just <code>1</code> in little-endian (orange) and <code>02 00 00 00</code>, just <code>2</code> in little-endian (purple). Above the <code>MRUListEx</code> there are three values in our case, each corresponding to the subfolder and containing a folder path and name. In the example below the <code>0</code> subfolder&rsquo;s value is expanded and marked with a green circle.</p>
<p>Each of these folders in the list will have a corresponding subkey inside our <code>0</code> subkey/folder (marked with arrows on the left).</p>
<p><img src="images/shell-bag.png" alt="shell-bag"></p>
<p>So, we have a parent folder info, what folders it contains and the paths to them. Now, since ShellBags store folder settings, where are they? Under the second subkey, <code>Bags</code>. But since sequence numbers are used here as well, how do we find the folder we need? Are these sequence number the same as on the picture above? The answer is <em>no</em>. On the picture above numbering restarts from <code>0</code> for each folder&rsquo;s subfolders, so that each folder that has at least one subfolder, will have at least <code>0</code> value and a <code>0</code> subkey. However, the <code>Bags</code> subkeys numbers folders sequencially. Each subkey representing a folder in a <code>BagMRU</code> subkey we&rsquo;ve seen above, will have a value <code>NodeSlot</code>. This is a number it&rsquo;s identified by withing <code>Bags</code> subkey. See the below example for the folder <code>0</code>.</p>
<p><img src="images/shell-bag2.png" alt="shell-bag2"></p>
<p>ğŸ›  ShellBagsExplorer (E. Zimmerman) is a tools that helps automating this process which is useful for larger amount of data.</p>
<p><img src="images/shell-bag3.png" alt="shell-bag3"></p>
<p>The above is an example of the ShellBagsExplorer for my Windows 10 Parallels VM. Pretty user-friendly representation and lot&rsquo;s of valuable information. Note the folders on the very top: <code>\\Mac\vm</code>, <code>\\Mac\Home</code> and <code>\\Mac\AllFiles</code>. Someone who is using Paralells Windows 10 on Mac might note this at once, that this is a VM running on a Mac. Also, both <code>\\Mac\Home</code> and <code>\\Mac\AllFiles</code> are no longer available for Windows 10, but they were not deleted from the registry as you may see. That&rsquo;s because when folders are deleted, they are not deleted from here, at least not soon.</p>
<h2 id="amcache">AmCache</h2>
<p><strong>Path to file</strong> ğŸ›£ï¸: <code>C:\Windows\AppCompat\Programs</code>.</p>
<p>Since Windows 8. Stored information about program execution, including those, that were run from a USB drive. Contains install date and time, name, version,  path to exe/dll, source info, path to uninstall, publisher name, volume GUIDs, container ID of the device from which the program was run.</p>
<p><code>DeviceCensus</code> - some information about the physical machine itself. For example, for my Parallels VM there was also a <code>VM</code> subkey that contained some value <code>VMId</code>.</p>
<p><code>File</code>. Full path to the executable.</p>
<blockquote>
<p>âš ï¸ Not present on my Windows 10 (Parallels VM).</p>
</blockquote>
<p><code>InventoryApplication</code>. Consists of folders/subkeys named by the program id. Each folder will contain the following important information: <code>OSVersionAtInstallTime</code>, <code>InstallDateMsi</code>, <code>InstallDate</code>, <code>InstallDateArpLastModified</code>, <code>InstallDateFromLinkFile</code>, <code>Name</code>, <code>Publisher</code>, <code>RegistryKeyPath</code> (may show user SID), <code>Source</code>, <code>UninstallString</code>, <code>ProgramID</code> (consistent accross systems).</p>
<blockquote>
<p>âš ï¸ On my Parallels Windows 10/11 machine I noticed that here not only Windows, but also Mac executables are listed even though I have specifically set in preferences that I am not sharing Mac folders or disks with the VM.</p>
</blockquote>
<p><code>InventoryApplicationFile</code>. Contains a fileid which is actually a SHA-1 hash, padded with 4 leading zeros and full path to the executable. Use a list of known good or VirusTotal.</p>
<p><code>InventoryDeviceContainer</code>. Contains <code>ModelName</code> and <code>FriendlyName</code>. When devices get connected, they might install some software to be able to work correctly.</p>
<p><code>InventoryDevicePnp</code>. Contains <code>ContainerID</code>, <code>DriverID</code>, <code>Description</code>, <code>Manufacturer</code> and <code>Model</code>.</p>
<p><code>Programs</code>. Where this program is located within the FS and the source (for example, <code>AddRemoveProgram</code>). And also information path to the uninstaller in registry.</p>
<p><strong>Tools</strong> ğŸ› : AmCacheParser.exe + Timeline Explorer.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">AmcacheParser</span><span class="p">.</span><span class="n">exe</span> <span class="o">-f</span> <span class="p">&lt;</span><span class="n">path_to_AmCache</span><span class="p">.</span><span class="n">hve</span><span class="p">&gt;</span> <span class="n">-i</span> <span class="n">on</span> <span class="p">-</span><span class="n">-csv</span> <span class="p">&lt;</span><span class="n">export_to_folder_no_quotes</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-csvf</span> <span class="p">&lt;</span><span class="n">desired_filename</span><span class="p">&gt;</span> 
</span></span></code></pre></div><p>What are unassociated files? Those that are not associated with a known source. Good starting point when looking for bad files.</p>
<blockquote>
<p>âš ï¸ In my case on a macOS with Parallels and Windows 10 installed, this evidence also contained mac executables.</p>
</blockquote>
<h2 id="references">References</h2>
<p>[<a href="https://github.com/msuhanov/regf/blob/master/Windows%20registry%20file%20format%20specification.md#layered-keys">1</a>] Windows registry file format specification</p>
<p>Suhanov&rsquo;s blog: [<a href="https://dfir.ru/2020/10/03/exporting-registry-hives-from-a-live-system/">2</a>] Exporting registry hives from a live system, [<a href="https://dfir.ru/2020/08/15/containerized-registry-hives-in-windows/">3</a>] Containerized registry hives in Windows, [<a href="https://dfir.ru/2018/10/07/hiding-data-in-the-registry/">4</a>] Hiding data in the registry</p>
<p>[<a href="https://www.coursera.org/learn/windows-os-forensics/lecture/69m1C/registry-overview-and-history">5</a>] Coursera, Windows OS Forensics</p>
<p>[<a href="https://www.bleepingcomputer.com/news/microsoft/new-windows-10-vulnerability-allows-anyone-to-get-admin-privileges/">6</a>] Windows 10 vulnerability with the access to SAM</p>
<p>[<a href="http://www.ijfcc.org/vol5/455-F005.pdf">7</a>] Registry structure</p>
<p>[<a href="http://www.ijfcc.org/vol5/455-F005.pdf">8</a>] Analysis the Structure of SAM and Cracking Password Base on Windows Operating System, Jiang Du and Jiwei Li</p>
<p>[<a href="https://superuser.com/questions/1210451/what-does-windows-old-folder-contain">9</a>] What does Windows.old folder contain?</p>
<p>[<a href="https://www2.isye.gatech.edu/~mgoetsch/cali/Windows%20Configuration/Windows%20Configuration%20Html/RemovingItemsfromtheRunMRUProgramList.htm">10</a>]</p>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.302a6fc365d5139fb98cf60bdb8f715d96257ea189161d36c190ccfa8182e569.js"></script>
  

  
  
  
    
  


</body>

</html>
