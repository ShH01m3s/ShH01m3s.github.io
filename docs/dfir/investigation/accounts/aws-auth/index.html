<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>AWS Authentication - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.eeb61b3f25f73088eb3aeb02bc61f28d33975f447fc5649add3b83c10059c331.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-forensics 🔍 and incident response 🥷">
      <a href="/docs/dfir">
        <span>Forensics 🔍 and Incident Response 🥷</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
    <li class="menu-item-notes 📝">
      <a href="/docs/notes">
        <span>Notes 📝</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-forensics 🔍 and incident response 🥷">
      <a href="/docs/dfir">
        <span>Forensics 🔍 and Incident Response 🥷</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
    <li class="menu-item-notes 📝">
      <a href="/docs/notes">
        <span>Notes 📝</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/investigation/accounts/"> Back to 👥 Account Information Analysis Section 👈🏼 </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#iam">IAM</a></li>
    <li><a href="#login-activity">Login activity</a></li>
    <li><a href="#tokens">Tokens</a></li>
    <li><a href="#service-usage-activity">Service usage activity</a></li>
    <li><a href="#useridentity">userIdentity</a>
      <ul>
        <li><a href="#assumedrole"><code>AssumedRole</code></a></li>
        <li><a href="#iamuser"><code>IAMUser</code></a></li>
      </ul>
    </li>
    <li><a href="#-btfm">📘 BTFM</a>
      <ul>
        <li><a href="#login-in-via-aws-cli">Login in via AWS CLI</a></li>
      </ul>
    </li>
    <li><a href="#root">Root</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
 </div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">AWS Authentication</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      <div class="article-category">domain: 
          
              
          <a class="category-link" href="/domain/"></a>
          
      </div> <br />
      
      <div class="article-category">doctype:
          
            
              
          <a class="platform-link" href="/doctype/"></a>
          
      </div> <br /><br/>
      
      
      
      

      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <p><em>This article is about AWS authentication process and how this activity is logged within the system.</em></p>
<h2 id="iam">IAM</h2>
<p>Stands for <strong>I</strong>dentity <strong>A</strong>ccess <strong>M</strong>anagement.
There are several types of IAM identities. They are usually called &ldquo;Principal&rdquo;. This can be either a User or a Role. It can even be a service or an account. Users can assume Roles. Instance Profile is basically a separate IAM Role assumed by this particular instance.</p>
<blockquote>
<p>❓ As far as I know, principals (which I suppose is very close to the term entity) has an ID and probably a AccessKey as well.</p>
</blockquote>
<p>Roles do not exist on their own. No, they are not ally cats. Instead, when a principal (service, user, account etc) assumes a role, it is given temporary credentials that expire with time. These credentials, btw, are stored in the IMDS. That&rsquo;s what it is for.</p>
<blockquote>
<p>❓ If some entity assumed some role, can these temp creds be used by other entity?</p>
</blockquote>
<p>There are also ACLs (<strong>A</strong>ccess <strong>C</strong>ontrol <strong>L</strong>ists), they have XML format and define which principals in <em>other</em> AWS accounts can access a resouce in question.</p>
<p>Nice diagram <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_evaluation-logic.html">here</a> showing how exactly AWS decides whether to grant access or not:</p>
<p>![[images/diagram.png]]</p>
<p>In order to understand what permissions something has, you need to add identity, resource policy + session restrictions.</p>
<h2 id="login-activity">Login activity</h2>
<p>For admin account go to IAM -&gt; Credential report to see all the users and the following information:</p>
<ol>
<li>user name</li>
<li>arn (acc N + username)</li>
<li>user_creation_time</li>
<li>password_enabled</li>
<li>password_last_used</li>
<li>password_last_changed</li>
<li>password_next_rotation</li>
<li>mfa_active</li>
<li>access_key_1_active</li>
<li>access_key_1_last_rotated</li>
<li>access_key_1_last_used_date</li>
<li>access_key_1_last_used_region</li>
<li>access_key_1_last_used_service</li>
<li>access_key_2_active</li>
<li>access_key_2_last_rotated</li>
<li>access_key_2_last_used_date</li>
<li>access_key_2_last_used_region</li>
<li>access_key_2_last_used_service</li>
<li>cert_1_active</li>
<li>cert_1_last_rotated</li>
<li>cert_2_active</li>
<li>cert_2_last_rotated</li>
</ol>
<h2 id="tokens">Tokens</h2>
<p>On AWS there are several types of tokens.
IMDSv2 tokens live for 6 hours, see <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html">here</a>:</p>
<blockquote>
<p>The <code>PUT</code> request must include a header that specifies the time to live (TTL) for the token, in seconds, up to a maximum of six hours (21,600 seconds).</p>
</blockquote>
<p>IMDSv1 doesn&rsquo;t have token at all.</p>
<p>Tokens for users can be configired, see <a href="https://docs.aws.amazon.com/cli/latest/reference/sts/get-session-token.html">here</a>:</p>
<blockquote>
<p>The duration, in seconds, that the credentials should remain valid. Acceptable durations for IAM user sessions range from 900 seconds (15 minutes) to 129,600 seconds (36 hours), with 43,200 seconds (12 hours) as the default.</p>
</blockquote>
<p>For this use <code>get-session-token</code> with <code>--duration-seconds</code> option. This is for temp credentials only. These creds can&rsquo;t get to IAM info (if no MFA is also included) or STS API, aka Security Token Service (other than <code>AssumeRole</code> or <code>GetCallerIdentity</code>).</p>
<h2 id="service-usage-activity">Service usage activity</h2>
<p>Also, you can go to IAM -&gt; username -&gt; Access Advisor tab to see the services that this user has access to and when these were last used.</p>
<h2 id="useridentity">userIdentity</h2>
<p><code>userIdentity</code> can be either <code>AssumedRole</code> or <code>IAMUser</code>.</p>
<blockquote>
<p>An IAM administrator can configure AWS Security Token Service to require that users specify their identity when they use temporary credentials to assume roles.</p>
</blockquote>
<h3 id="assumedrole"><code>AssumedRole</code></h3>
<p>The user can either use their creds directly or use some role (policy instead). In this case, logs will also contain <code>sessionContext</code>.</p>
<h3 id="iamuser"><code>IAMUser</code></h3>
<h2 id="-btfm">📘 BTFM</h2>
<h3 id="login-in-via-aws-cli">Login in via AWS CLI</h3>
<p>Ensure you have <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html">AWS CLI</a> installed.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="s2">&#34;ASIAJKJHASDKJHSDKJLA&#34;</span>  
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="s2">&#34;akljhdljkhljhewhjjkhsd/s&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">AWS_SESSION_TOKEN</span><span class="o">=</span><span class="s2">&#34;kajsdhkjsaha&#34;</span> <span class="c1"># optional. AWS_SESSION_TOKEN is required with temp creds only.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">aws <span class="nb">help</span>
</span></span><span class="line"><span class="cl"><span class="c1"># You&#39;ll see all available options. For example, you can run aws ec2 to see what you can do to the EC2 instances from within the CLI</span>
</span></span></code></pre></div><h2 id="root">Root</h2>
<p>It&rsquo;s not recommended to use <code>root</code> user for any activity on AWS unless it&rsquo;s something that only root can done. <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html">https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html</a>
<a href="https://docs.aws.amazon.com/general/latest/gr/root-vs-iam.html#aws_tasks-that-require-root">https://docs.aws.amazon.com/general/latest/gr/root-vs-iam.html#aws_tasks-that-require-root</a></p>
<h2 id="references">References</h2>
  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.bafc052229b4b40bf03c477d31c5cdd9352ece8afbadf35ab97ed14495098fc9.js"></script>
  

  
  
  
    
  


</body>

</html>
