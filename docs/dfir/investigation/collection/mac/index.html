<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍏 Mac Evidence Collection - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/investigation/collection/"> 👈🏼 Back to </br> 🗳 Evidence Collection And Preservation </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#order">Order</a></li>
    <li><a href="#file-systems">File Systems</a></li>
    <li><a href="#live-acquisition">Live Acquisition</a></li>
    <li><a href="#dead-acquisition">Dead Acquisition</a>
      <ul>
        <li><a href="#target-disk-intel">Target Disk (Intel)</a></li>
        <li><a href="#share-disk-on-m1">Share Disk on M1</a></li>
        <li><a href="#bootable-usb">Bootable USB</a></li>
      </ul>
    </li>
    <li><a href="#write-block">Write Block</a></li>
    <li><a href="#hddssd">HDD/SSD</a>
      <ul>
        <li><a href="#research">Research</a></li>
        <li><a href="#dead-acquisition-checklist">Dead Acquisition Checklist</a></li>
        <li><a href="#live-acquisition-checklist">Live Acquisition Checklist</a></li>
      </ul>
    </li>
    <li><a href="#ram">RAM</a></li>
    <li><a href="#-btfm">📘 <strong>BTFM</strong></a>
      <ul>
        <li><a href="#list-all-drives">List all drives</a></li>
        <li><a href="#turn-off-disk-arbitration">Turn off Disk Arbitration</a>
          <ul>
            <li><a href="#older-mac">Older Mac:</a></li>
            <li><a href="#monterey">Monterey</a></li>
          </ul>
        </li>
        <li><a href="#turn-on-disk-arbitration">Turn on Disk Arbitration</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">🍏 Mac Evidence Collection</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      
      <div class="article-category">
          
            
            
            
              <i class="fab fa-apple"></i>
            
            
            
            
          
          
      </div> <br />
      

      
      <div class="article-category">
        <i class="fas fa-tools"></i>
          
          
          <a class="platform-link" href="/tools/diskutil">diskutil</a> 
          
           , 
          <a class="platform-link" href="/tools/osxpmem">OSXPmem</a> 
          
           , 
          <a class="platform-link" href="/tools/fdisk">fdisk</a> 
          
           , 
          <a class="platform-link" href="/tools/diskpart">diskpart</a> 
          
           , 
          <a class="platform-link" href="/tools/dd">dd</a> 
          
           , 
          <a class="platform-link" href="/tools/lsblk">lsblk</a> 
          
      </div> <br />
      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <h2 id="order">Order</h2>
<p>The order for collecting digital evidence on macOS and Linux-based systems during a forensic investigation is similar to that of Windows systems. The main difference is that the specific data sources and tools used may vary depending on the operating system. Here&rsquo;s a general order for both macOS and Linux systems:</p>
<p>Volatile data: Collect data stored in RAM, cache, running processes, network connections, and active login sessions, as this information can be easily lost or altered when the system is powered off or rebooted.
Process and network information: Gather information about running processes, open files, and network connections to identify any suspicious activity.
Temporary files: Examine temporary files and folders, as they may contain valuable evidence related to user activities or malicious processes.
Log files: Analyze system and application log files to identify events, errors, or activities of interest.
File system: Investigate the file system, including files, directories, and metadata, to find evidence of user activities, data theft, or other malicious activities.
User profiles and configurations: Examine user-specific data, such as preferences, configurations, and history files, to gather additional information about user activities and system settings.
System configurations: Investigate system-wide configuration files and settings to understand the overall state and configuration of the system at the time of the incident.
Internet traces: Analyze browsing history, cache, cookies, and other data related to internet usage to uncover information about websites visited, downloaded files, and other online activities.</p>
<h2 id="file-systems">File Systems</h2>
<p>APFS, HFS+, Offers a novel technique to acquire disk copies using a firewire cable between two PCs: Target Disk Mode. Press F (?).</p>
<p><strong>Logical Backup</strong> -  doesn&rsquo;t copy all, doesn&rsquo;t copy slack, free space and deleted files. <strong>Imaging</strong> - bit-by-bit copy. Should not be used on a live system!</p>
<h2 id="live-acquisition">Live Acquisition</h2>
<p><a href="https://github.com/Dead-Simple-Scripts/AutoLLR">https://github.com/Dead-Simple-Scripts/AutoLLR</a>
Automatically collect live info. Quite a heavy footprint. But if we are not collecting RAM, not the biggest issue. This script was designed for Linux. However, it can be adjusted for macOS. For example, adding <code>system_profiler</code>, <code>sw_vers</code>. Substitute <code>prinenv</code> for <code>env</code>.</p>
<blockquote>
<p>💡 My plan is to review and try running all these commands. This will help to understand the type of evidence present in the system and make necessary macOS-specific substitutions.</p>
</blockquote>
<blockquote>
<p>🗒 Write a macOS triage tool similar to Kansa but bash-based, specifically targeting macOS. Do the same for iOS, Android, Linux, AWS etc. Check Sarah&rsquo;s GitHub to ensure there is nothing of that sort yet. Use <a href="https://github.com/mac4n6/APOLLO">https://github.com/mac4n6/APOLLO</a> to collect DBS,  <a href="https://github.com/mac4n6/macMRU-Parser">https://github.com/mac4n6/macMRU-Parser</a> to collect plists, <a href="https://github.com/mac4n6/Mac-Locations-Scraper">https://github.com/mac4n6/Mac-Locations-Scraper</a> location DBS, <a href="https://github.com/mac4n6/iOS-Frequent-Locations-Dumper">https://github.com/mac4n6/iOS-Frequent-Locations-Dumper</a> frequent locations,</p>
</blockquote>
<h2 id="dead-acquisition">Dead Acquisition</h2>
<p>For newer MacBooks, it gets tricky. I posted the question <a href="https://www.forensicfocus.com/forums/general/apple-silicon-m1-chip-based-computers/">here</a>. No answer still (📆 <code>02/08/2022</code>).</p>
<h3 id="target-disk-intel">Target Disk (Intel)</h3>
<h3 id="share-disk-on-m1">Share Disk on M1</h3>
<p>I tried different channels and forums, but there seemed to be no obvious answer. This took quite an amount of research. By now, I can conclude the following.</p>
<p>Share Disk is very different from Target Disk and is relatively useless for forensic purposes (from what I&rsquo;ve seen now). Share Disk, unlike its predecessor, operates over SMB protocol and is not mounted like a standard drive. <code>Diskutillist</code> (or its GUI version Disk Utility), <a href="https://github.com/aburgh/Disk-Arbitrator">Disk Arbitrator</a> (custom tool) or even <code>ls /dev/ | grep disk</code> won&rsquo;t show it. Its mounting seems not governed by <code>diskarbitrationd</code> (framework for mounting and managing drives). Even though it looks like it&rsquo;s mounted in GUI, different APIs seem to be in place.</p>
<p>I&rsquo;ve tried creating a file <code>/etc/fstab</code> and using custom settings for mounting my test USB drive: <code>LABEL=&quot;TestDrive&quot; none apfs ro,noauto</code>. This USB device was not automatically mounted; when I mounted it manually, it was in read-only mode (<code>ro</code> option). I did the same for the Macintosh HD, the label for my drive on target MacBook: <code>LABEL=&quot;Macintosh HD&quot; /suspect apfs ro,noauto</code>. Just in case, I acquired the volume&rsquo;s UUID via <code>diskutil info /Volumes/Macintosh\'s\ HD | grep -i uuid</code> from both the recovery mode and when booted normally (which were different).</p>
<p>This is a network share, and you have the same rights as the PC user. I don&rsquo;t know if there is any way to control the restrictions here, but at the moment, the most forensically sound way would be to use a physical write blocker. This <a href="https://sumuri.com/how-to-image-an-apple-silicon-mac-with-recon-itr-live/">tool</a> from SUMURI is for Live acquisition only. And the page on the forum <a href="https://www.forensicfocus.com/forums/general/apple-silicon-m1-chip-based-computers/">here</a> has not been updated for a while.</p>
<p><a href="https://www.youtube.com/watch?v=rgfYuuAUU8A">Here</a> is a video from SUMURI experts on the imaging issues, where they mention the Shared Disk mode. I am not sure how they make it forensically sound, though.</p>
<h3 id="bootable-usb">Bootable USB</h3>
<blockquote>
<p>🧪 What if I could make a Kali USB bootable drive and boot into macOS from it?</p>
</blockquote>
<p><a href="https://support.apple.com/en-gb/guide/security/sec7d92dc49f/web">https://support.apple.com/en-gb/guide/security/sec7d92dc49f/web</a>
<a href="https://appleinsider.com/articles/21/01/03/how-to-boot-an-apple-silicon-mac-from-an-external-drive">https://appleinsider.com/articles/21/01/03/how-to-boot-an-apple-silicon-mac-from-an-external-drive</a></p>
<p>This could be an option to make a raw image of Apple drive. This option will have other complications, like decrypting the drive, dealing with Fusion Drives and parsing APFS containers. But at least it would make the dead acquisition possible. Since there are arm versions of Kali and Kali has dd preinstalled and <code>gpart</code>, this is a good start.</p>
<p>One of the concerns published on <a href="https://apple.stackexchange.com/questions/439027/boot-from-usb-kali-linux-m1-silicon">StackOverflow</a> was that such functionality as Bluetooth and WiFi would not work. However, this would be even better for forensically sound acquisition.</p>
<p>As per the information from the Internet (in many places), macOS with M1 doesn&rsquo;t support external boot.</p>
<h2 id="write-block">Write Block</h2>
<p>You can turn off disk arbitration or write blockers on the forensic MacBook.</p>
<p><strong>Disk Arbitration</strong></p>
<p>It prevents the host computer from writing data to the target MacBook using Target Disk Mode. To turn off this feature, refer to <a href="https://forensicswiki.xyz/wiki/index.php?title=Disabling_Macintosh_Disk_Arbitration_Daemon" title="https://forensicswiki.xyz/wiki/index.php?title=Disabling_Macintosh_Disk_Arbitration_Daemon">this</a> page. It’s needed so the forensic machine won’t change the data on the suspect MacBook. For Mac acquisition - follow <a href="https://forensicswiki.xyz/wiki/index.php?title=Acquiring_a_MacOS_System_with_Target_Disk_Mode" title="https://forensicswiki.xyz/wiki/index.php?title=Acquiring_a_MacOS_System_with_Target_Disk_Mode">these</a> steps.</p>
<blockquote>
<p>🧪 <em>What files are changed when something is connected to a Mac (USB or using Thunderbolt)? Is turning off the disk arbitration feature really preventing changes to the target drive?</em></p>
</blockquote>
<blockquote>
<p>🧪 When attaching my MacBook to another via Share Disk mode, I deleted files from the target MacBook even with DA off. Why?
Share Disk doesn&rsquo;t work the same way as the Target Disk mode. It&rsquo;s an SMB share. See the comprehensive research above.</p>
</blockquote>
<p>There is also a tool <a href="https://github.com/aburgh/Disk-Arbitrator">https://github.com/aburgh/Disk-Arbitrator</a>. That can very much help and ease the work. I need to check this out.</p>
<h2 id="hddssd">HDD/SSD</h2>
<h3 id="research">Research</h3>
<p>At first, Mac imaging was no different from imaging other devices running other OS (Windows or Linux). But then they added Fusion Drives which was quite a trouble for analysts. Samuri stumbled upon it, and they had to work this out. But after T2, Mac imaging has become even more painful since it&rsquo;s impossible to image a drive without a password and another Mac even if File Vault is turned off. At the moment, Mac forensics resembles iOS forensics because there is probably little you can do without a password. There used to be some disk mode in which one could perform imaging, but now it doesn&rsquo;t work without a passcode.</p>
<p>Another interesting key point is that the kill signal can now be sent over Bluetooth. That means if someone with Bluetooth enabled on the crime scene, the owner of the evidence (Mac device) could send a command to wipe his notebook leveraged through the investigator&rsquo;s Bluetooth. It sounds made up, but a Mac forensics expert said this is what it looks like now.</p>
<p>Also, they talked about the <a href="https://sumuri.com/product/recon-itr/">ITR</a> tool that images and triages Mac devices. Supports live images of Apple Silicon Macs!</p>
<p>I have an old MacBook (see <a href="/blog/2020/10/how-i-broke-my-husbands-macbook">this</a> blog post) and a new one with an M1 chip. Following the instruction from the Udemy <a href="https://www.udemy.com/course/surviving-digital-forensics-imaging-a-mac-fusion-drive/learn/lecture/2534096?start=1#content">course</a> of Michael Leclair, I&rsquo;ve bought a Thunderbolt2-Thunderbolt3 cable to connect these two PCs. I&rsquo;ve tried this and this first, but they worked only for connecting Displays. However, whatever line I tried using, nothing worked. I then tried the Apple ones, but these did not work either. I have run across this text on official Apple docs for the Apple Thunderbolt 3 (USB-C) to Thunderbolt 2 Adapter:</p>
<blockquote>
<p>This adapter is bidirectional, which means you can connect Thunderbolt 3 devices to a Mac with a Thunderbolt or Thunderbolt 2 port. In that case, the Mac must be using <a href="https://support.apple.com/kb/HT201260">macOS Sierra or later</a>, and the device using Thunderbolt 3 must provide its power. [<a href="https://support.apple.com/en-us/HT207266">5</a>]</p>
</blockquote>
<p>So, there are two prerequisites:</p>
<ol>
<li>macOS Sierra or later</li>
<li>the device using Thunderbolt 3 must provide its power.</li>
</ol>
<p><a href="https://aliexpress.ru/item/1005001855199343.html?spm=a2g0s.12269583.0.0.5ae9776dYIfPHB&amp;item_id=1005001855199343&amp;sku_id=12000017867458221">https://aliexpress.ru/item/1005001855199343.html?spm=a2g0s.12269583.0.0.5ae9776dYIfPHB&amp;item_id=1005001855199343&amp;sku_id=12000017867458221</a> USB TYPE-C Thunderbolt 3 2 к мини DisplayPort DP 4k 60 Гц для Macbook Air Pro Samsung dell XPS13 15 к Apple cinema display</p>
<p><a href="https://www.aliexpress.com/item/1005001855439084.html?spm=a2g0s.12269583.0.0.6faf3d9dDfAwT5">https://www.aliexpress.com/item/1005001855439084.html?spm=a2g0s.12269583.0.0.6faf3d9dDfAwT5</a> Cabletime USB C 3.1 to Mini DP Adapter 4k60hz Projector Type C to Thunderbolt 2 Converter For Laptop Huawei Mate 40 Samsung N428</p>
<p><a href="https://mrmacintosh.com/filevault-2-target-disk-mode-unlock-using-the-personal-recovery-key/">FileVault 2 Target Disk Mode Unlock Using the Personal Recovery Key</a>. As is stated <a href="https://www.reddit.com/r/mac/comments/7upvss/thunderbolt_bridge_inactive/">here</a> on Reddit:</p>
<blockquote>
<p>[&hellip;] USB-c charging cable provided is only usb2.0 for data transfer [&hellip;] to do thunderbolt target disk mode, you need a thunderbolt three cable (expensive) [&hellip;]</p>
</blockquote>
<p>So, using the cable that came with the charger shouldn&rsquo;t work since it supports USB 2.0 transfer only.</p>
<p><a href="https://benfrain.com/the-thunderbolt-usb-c-ports-on-m1-macs-dont-work/">https://benfrain.com/the-thunderbolt-usb-c-ports-on-m1-macs-dont-work/</a></p>
<p><strong>Fusion Drives</strong></p>
<p>A fusion drive combines an ordinary drive and a small NAND flash drive that appear as one logical volume in the OS. Still, when you try imaging it, you&rsquo;ll get two different images, and the image will be somewhat corrupted for the analysis tools if you don&rsquo;t assemble it correctly. NAND flash drive stores the most often used files like system ones and those files that the user uses more often than others. It seems to me that the idea is the same as with prefetch in Windows 🌈.</p>
<h3 id="dead-acquisition-checklist">Dead Acquisition Checklist</h3>
<ul>
<li><input disabled="" type="checkbox"> Ensure the target media (evidence drive) is sterilised (ref. Identification/Assessment stage above).</li>
<li><input disabled="" type="checkbox"> Turn the machine off (better unplugging it to prevent data from being overwritten).</li>
<li><input disabled="" type="checkbox"> On the forensic MacBook, make sure all remote functionality is off (Bluetooth, AitDrop, WiFi, Cellular etc.), and the software-based write blocker is on (if no hardware blocker is used) - see above for the latter.</li>
<li><input disabled="" type="checkbox"> Connect the forensic machine to the target machine using a USB Type-C cable (for newer MacBooks) or Thunderbolt cable for older ones.</li>
<li><input disabled="" type="checkbox"> Turn the target machine in either Target Disk mode (for older MacBook) or Share Disk (for newer MacBook).
<ul>
<li><input disabled="" type="checkbox"> <strong>Share Disk</strong>.
<ul>
<li><input disabled="" type="checkbox"> Turn the suspect machine off. Press turn on the button and hold until you see “Continue holding for startup options”. Stop holding when “Loading startup options” appears.</li>
<li><input disabled="" type="checkbox"> On the top panel, choose Utilities -&gt; Share Disk and select the disk you want to share. You might be asked to unlock it (if FileVault is enabled).</li>
<li><input disabled="" type="checkbox"> On the forensic machine, go to Network () or see the device appear in the side panel in Finder. If it doesn’t, open Finder -&gt; Preferences -&gt; General and make sure External disks, Connected servers and hard disks are selected. Please move to the Sidebar tab and ensure it’s all selected there.</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Target Disk</strong>. There are two ways to boot into this mode. One is simply by pressing the power on the button along with a T key while booting. The second one is from Preferences. This legacy option is not present on the latest Apple devices.</li>
</ul>
</li>
</ul>
<blockquote>
<p>⛔️ I could not make the whole thing work. I even thought there might be some problem with the genuine Apple cables.
✍🏻 However, in my case, the issue appears to be very primitive. The problem was that both my MacBooks had the same name. The airDrop was smart enough to rename one by appending (2), but in this mode, it seems it was not easy. Once I named the PCs differently, it all started to work. Also, I’ve changed the HDD names, just in case.</p>
</blockquote>
<blockquote>
<p>❗️This option is not a write-proof one. I managed to delete a folder from the drive. Make sure the write blocker is on.</p>
</blockquote>
<h3 id="live-acquisition-checklist">Live Acquisition Checklist</h3>
<ul>
<li>
<p><input disabled="" type="checkbox"> Attach a write blocker or run a software-based one. On the forensic Macbook, you can turn off disk arbitration or use write blockers. To turn off this feature, refer to <a href="https://forensicswiki.xyz/wiki/index.php?title=Disabling_Macintosh_Disk_Arbitration_Daemon">this</a> page. It&rsquo;s needed so the forensic machine won&rsquo;t change the data on the suspect Macbook. For Mac acquisition - follow <a href="https://forensicswiki.xyz/wiki/index.php?title=Acquiring_a_MacOS_System_with_Target_Disk_Mode">these</a> steps.</p>
</li>
<li>
<p><input disabled="" type="checkbox"> List all drives to get the id of the target.</p>
</li>
<li>
<p><input disabled="" type="checkbox"> Connect external HDD or SSD</p>
</li>
<li>
<p><input disabled="" type="checkbox"> Launch some forensic distribution (for example, Paladin). Make an image of the local HDD (❗️ Won&rsquo;t work for M1 Apple devices).</p>
<blockquote>
<p>🧪 <em>What files are changed when something is connected to a Mac (USB or using Thunderbolt)? Is turning off the disk arbitration feature really preventing changes to the target drive?</em></p>
</blockquote>
</li>
</ul>
<h2 id="ram">RAM</h2>
<p><em>On the forensicswiki [<a href="https://forensicswiki.xyz/wiki/index.php?title=Tools:Memory_Imaging">1</a>], there is a list of tools to be used for RAM acquisition. I’ve tried several of them and realised that the current problem in the forensic community is that the tools get old much faster than the information gets updated… Sadly.</em></p>
<p><code>OSXPmem</code></p>
<p>It’s the part of <code>rekall</code>, <a href="https://code.google.com/archive/p/pmem/wikis/OSXPmem.wiki">download</a>. There are a few complications, though.</p>
<blockquote>
<p>⚠️ SIP needs to be disabled. Freeboot &gt; CMD+R &gt; Terminal &gt; csrutil disable &gt; reboot). Otherwise, you might run into this issue: dump_memory(833): Failed to load kext (No such process) ⚠️ USB &gt; Get Info &gt; unlock 🔒 &gt; Ignore ownership on this volume (check). Otherwise, you might run into this issue: Can’t load kext ./pmem.kext, as it is not owned by root: wheel. Just chowning didn’t work for me. When I unchecked it, replugged the USB, and decompressed the archive, I managed to get the dump without this error. ❗️ Restart the Terminal for changes to take place!</p>
</blockquote>
<h2 id="-btfm">📘 <strong>BTFM</strong></h2>
<h3 id="list-all-drives">List all drives</h3>
<p>(Linux and macOS):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo fdisk -l <span class="c1"># Linux</span>
</span></span><span class="line"><span class="cl">lsblk
</span></span><span class="line"><span class="cl">mount
</span></span></code></pre></div><p>On Windows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">diskpart</span>
</span></span><span class="line"><span class="cl"><span class="n">DISKPART</span><span class="p">&gt;</span> <span class="n">list</span> <span class="n">disk</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo dd <span class="k">if</span><span class="o">=</span>/dev/sda1 <span class="nv">of</span><span class="o">=</span>/case1/diska1.dd
</span></span><span class="line"><span class="cl">sudo dd <span class="k">if</span><span class="o">=</span>/dev/sdb <span class="nv">of</span><span class="o">=</span>/case1/diskb.dd
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo dcfldd <span class="k">if</span><span class="o">=</span>/dev/sda <span class="nv">of</span><span class="o">=</span>/home/diska.dd <span class="nv">hash</span><span class="o">=</span>md5 <span class="nv">hashlog</span><span class="o">=</span>/home/diskaa0md5.txt
</span></span><span class="line"><span class="cl">sudo dcfldd <span class="k">if</span><span class="o">=</span>/dev/disk4 <span class="nv">of</span><span class="o">=</span>/Users/%username%/Documents/image.img <span class="nv">hash</span><span class="o">=</span>md5,sha1 <span class="nv">md5log</span><span class="o">=</span>/Users/%username%/Documents/md5.txt <span class="nv">sha1log</span><span class="o">=</span>/Users/%username%/Documents/sha1.log <span class="nv">hashconv</span><span class="o">=</span>after <span class="nv">bs</span><span class="o">=</span><span class="m">512</span> <span class="c1"># hashconv - calc hash after or before the conversion</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># the most forensically useful tool, calculates hashes of the input source and the image to make sure they match. Verbose output</span>
</span></span><span class="line"><span class="cl"><span class="c1"># to install on macOS - brew install dc3dd</span>
</span></span><span class="line"><span class="cl">sudo dc3dd <span class="k">if</span><span class="o">=</span>/dev/sdb <span class="nv">hof</span><span class="o">=</span>sdb.img <span class="nv">hash</span><span class="o">=</span>md5 <span class="nv">hash</span><span class="o">=</span>sha1 <span class="nv">log</span><span class="o">=</span>hash.txt
</span></span></code></pre></div><blockquote>
<p>⛔️ If you get <code>dd: /dev/disk4: Resource busy</code> on macOS when trying to make an image with <code>dd</code>,
✍🏻 go to Disk Utility and unmount the drive (don&rsquo;t eject it).</p>
</blockquote>
<blockquote>
<p>📝 Some commercial tools like <strong>Cyber Triage</strong> allow analysing the evidence on a live system without imaging drives or dumping memory. The digital footprint is claimed to be minimal. It can be used remotely.</p>
</blockquote>
<blockquote>
<p>🧪 Will any USB work (GPT or MSDOS) or should I have both for different cases?</p>
</blockquote>
<h3 id="turn-off-disk-arbitration">Turn off Disk Arbitration</h3>
<h4 id="older-mac">Older Mac:</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> /etc/mach_init.d
</span></span><span class="line"><span class="cl"> ls
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> sudo cp diskarbitrationd.plist /
</span></span><span class="line"><span class="cl"> ls /
</span></span><span class="line"><span class="cl">sudo rm diskarbitrationd.plist.
</span></span></code></pre></div><h4 id="monterey">Monterey</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Option #1. Kill the process</span>
</span></span><span class="line"><span class="cl"><span class="c1"># cat /var/run/diskarbitrationd.pid gives the PID </span>
</span></span><span class="line"><span class="cl"><span class="c1"># ps -ex gives the proc list</span>
</span></span><span class="line"><span class="cl">ps -ex <span class="p">|</span> grep <span class="k">$(</span>cat /var/run/diskarbitrationd.pid<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Option #2. Remove the plist</span>
</span></span><span class="line"><span class="cl">sudo cp /System/Library/LaunchDaemons/com.apple.diskarbitrationd.plist /
</span></span><span class="line"><span class="cl"><span class="c1"># give read-only FS</span>
</span></span></code></pre></div><h3 id="turn-on-disk-arbitration">Turn on Disk Arbitration</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo cp /diskarbitrationd.plist /etc/mach_init.d.
</span></span></code></pre></div><h2 id="references">References</h2>
<details>
    <summary>Expand&hellip;</summary>
    <p>[<a href="https://forensicswiki.xyz/wiki/index.php?title=Tools:Memory_Imaging">1</a>] Tools: Memory Imaging, forensicswiki</p>
<p>[<a href="https://www.sans.org/blog/mac-os-forensics-how-to-simple-ram-acquisition-and-analysis-with-mac-memory-reader-part-1/">2</a>] Mac OS Forensics How-To: Simple RAM Acquisition and Analysis with Mac Memory Reader (Part 1), 2011</p>
<p>[<a href="https://ponderthebits.com/2017/02/osx-mac-memory-acquisition-and-analysis-using-osxpmem-and-volatility/">3</a>] OSX (Mac) Memory Acquisition and Analysis Using OSXpmem and Volatility</p>
<p>[<a href="https://support.apple.com/guide/mac-help/permission-files-a-mac-disk-mchlp1204/mac">4</a>] If you don’t have permission to use files on a Mac disk</p>
<p>[<a href="https://www.macworld.co.uk/how-to/how-turn-off-mac-os-x-system-integrity-protection-rootless-3638975/">5</a>] How to turn off Rootless (SIP, or System Integrity Protection) in OS X</p>
<p>[<a href="https://dfir.ru/2018/09/08/memory-compression-and-forensics/#more-368">6</a>] Memory compression and forensics</p>
<p><a href="https://ponderthebits.com/2017/02/osx-mac-memory-acquisition-and-analysis-using-osxpmem-and-volatility/">https://ponderthebits.com/2017/02/osx-mac-memory-acquisition-and-analysis-using-osxpmem-and-volatility/</a></p>
<p><a href="https://forensicswiki.xyz/wiki/index.php?title=Memory_Imaging">https://forensicswiki.xyz/wiki/index.php?title=Memory_Imaging</a>
<a href="https://darkdefender.medium.com/brief-introduction-to-macos-forensics-f817c9c83609">Brief Introduction to macOS Forensics | by darkdefender | Medium</a>
<a href="https://forensicswiki.xyz/wiki/index.php?title=Mac_OS_X">https://forensicswiki.xyz/wiki/index.php?title=Mac_OS_X</a>
<a href="https://medium.com/about-developer-blog/macos-forensics-diy-style-3369868505dd">https://medium.com/about-developer-blog/macos-forensics-diy-style-3369868505dd</a>
<a href="http://www.computerpi.com/forensic-acquisition-of-mac-computers/">http://www.computerpi.com/forensic-acquisition-of-mac-computers/</a>
<a href="https://forensicswiki.xyz/wiki/index.php?title=Mac_OS_X_Alias_Files">https://forensicswiki.xyz/wiki/index.php?title=Mac_OS_X_Alias_Files</a>
<a href="https://www.sans.org/cyber-security-courses/mac-and-ios-forensic-analysis-and-incident-response/#addsearch=linux%20forensics">https://www.sans.org/cyber-security-courses/mac-and-ios-forensic-analysis-and-incident-response/#addsearch=linux%20forensics</a></p>
<p>Important researchers
Sarah Edwards
<a href="https://github.com/mac4n6/Presentations">GitHub - mac4n6/Presentations: Presentation Archives for my macOS and iOS Related Research</a>
<a href="http://www.mac4n6.com/">mac4n6.com</a></p>
<p><a href="https://github.com/mac4n6/Presentations">https://github.com/mac4n6/Presentations</a></p>

</details>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.bafc052229b4b40bf03c477d31c5cdd9352ece8afbadf35ab97ed14495098fc9.js"></script>
  

  
  
  
    
  


</body>

</html>
