<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸªŸ Windows Evidence Collection - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting ğŸª¤">
      <a href="/docs/thunting">
        <span>Threat Hunting ğŸª¤</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference ğŸ“š">
      <a href="/docs/reference">
        <span>Tech Reference ğŸ“š</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting ğŸª¤">
      <a href="/docs/thunting">
        <span>Threat Hunting ğŸª¤</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference ğŸ“š">
      <a href="/docs/reference">
        <span>Tech Reference ğŸ“š</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/investigation/collection/"> ğŸ‘ˆğŸ¼ Back to </br> ğŸ—³ Evidence Collection And Preservation </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#file-systems">File Systems</a></li>
    <li><a href="#write-block">Write Block</a></li>
    <li><a href="#collection-checklist">Collection Checklist</a></li>
    <li><a href="#-btfm">ğŸ“˜ BTFM</a>
      <ul>
        <li><a href="#kansa">Kansa</a></li>
        <li><a href="#autoruns">Autoruns</a></li>
        <li><a href="#kansa-1">Kansa</a></li>
        <li><a href="#kape">KAPE</a></li>
      </ul>
    </li>
    <li><a href="#ram">RAM</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">ğŸªŸ Windows Evidence Collection</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      
      <div class="article-category">
          
            
              <i class="fab fa-windows"></i>          
            
            
            
            
            
            
          
          
      </div> <br />
      

      
      <div class="article-category">
        <i class="fas fa-tools"></i>
          
          
          <a class="platform-link" href="/tools/powershell">PowerShell</a> 
          
           , 
          <a class="platform-link" href="/tools/kansa">Kansa</a> 
          
      </div> <br />
      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <p><strong>Stacking</strong> - outlier analysis based on frequency.</p>
<h2 id="file-systems">File Systems</h2>
<p>FAT12, 32, 64, NTFS, ReFS.</p>
<p><strong>Logical Backup</strong> -  doesn&rsquo;t copy all, doesn&rsquo;t copy slack, free space and deleted files. <strong>Imaging</strong> - bit-by-bit copy. It should not be used on a live system!</p>
<h2 id="write-block">Write Block</h2>
<p><strong>Windows Software Write Blocker</strong>Â Basically, one can do this manually. This includes changing the value in the registry.</p>
<h2 id="collection-checklist">Collection Checklist</h2>
<ul>
<li><input disabled="" type="checkbox"> Ensure the target media (evidence drive) is sterilised (ref. Identification/Assessment stage above).</li>
<li><input disabled="" type="checkbox"> Turn the machine off (better unplug it to prevent data from being overwritten).</li>
<li><input disabled="" type="checkbox"> Attach the write blocker and the evidence drive.</li>
<li><input disabled="" type="checkbox"> Connect external HDD or SSD through the write blocker (if itâ€™s hardware-based)</li>
<li><input disabled="" type="checkbox"> Launch some forensic distribution (for example, Paladin). Make an image of the local HDD or use the original OS with all remote tools (Bluetooth, AitDrop, WiFi, Cellular etc.) and a software-based write blocker on (if no hardware-blocker is used).</li>
</ul>
<h2 id="-btfm">ğŸ“˜ BTFM</h2>
<h3 id="kansa">Kansa</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Get-NetConnectionProfile</span>
</span></span><span class="line"><span class="cl"><span class="nb">Set-NetConnectionProfile</span> <span class="n">-InterfaceIndex</span> <span class="n">X</span> <span class="n">-NetworkCategory</span> <span class="n">private</span> <span class="c"># requires admin</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">.\</span><span class="n">kansa</span><span class="p">.</span><span class="n">ps1</span> <span class="n">-Pushbin</span> <span class="n">-Target</span> <span class="n">localhost</span> <span class="n">-Credential</span> <span class="n">username</span> <span class="n">-Authentication</span> <span class="n">Negotiate</span>
</span></span></code></pre></div><blockquote>
<p>â—ï¸ On macOS Parallels 18 with Windows 11 running as a VM, you&rsquo;d need to change the password for the user first to provide them in the prompt.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Select-String</span> <span class="s2">&#34;something&#34;</span> <span class="p">*.</span><span class="n">csv</span> <span class="c"># search for something keyword in all csv files in the current directory</span>
</span></span></code></pre></div><h3 id="autoruns">Autoruns</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">autorunsc</span><span class="p">.</span><span class="n">exe</span> <span class="p">/</span><span class="n">accepteula</span> <span class="n">-a</span> <span class="p">*</span> <span class="n">-c</span> <span class="n">-h</span> <span class="n">-s</span> <span class="s1">&#39;*&#39;</span> <span class="n">-nobanner</span>
</span></span></code></pre></div><p><code>a</code> - all artefacts (boot, appinit dlls, explorer addons, sidebar gadgets, image hijacks, IE addons, known dlls, logon startups, WMI, office addons, printerr mon dll, LSA sec providers, autostart services and non-disabled drivres, winlogon entries, scheduled tasks, winlock protocol and net providers).
<code>c</code> - codec
<code>h</code> - hashes
<code>s</code> - verify digital signature
<code>'*'</code> - all user profiles</p>
<h3 id="kansa-1">Kansa</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"></code></pre></div><p>If the <code>-Analysis</code> option is provided when collecting data, it will generate analysis files following the collection from remote hosts. This script can be used to pull the frequency of autoruns based on ImagePath, LaunchString and MD5 tuple (given that the publisher is not verified): <code>Get-ASEPImagePathLaunchStringMD5UnsignedStack.ps1</code> <a href="https://github.com/davehull/Kansa/blob/master/Analysis/asep/Get-ASEPImagePathLaunchStringMD5UnsignedStack.ps1">https://github.com/davehull/Kansa/blob/master/Analysis/asep/Get-ASEPImagePathLaunchStringMD5UnsignedStack.ps1</a>. Here is the most crucial part of the script, its heart â¤ï¸:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">COUNT</span><span class="p">(</span><span class="n">ImagePath</span><span class="p">,</span><span class="w"> </span><span class="n">LaunchString</span><span class="p">,</span><span class="w"> </span><span class="n">MD5</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">ImagePath</span><span class="p">,</span><span class="n">LaunchString</span><span class="p">,</span><span class="n">MD5</span><span class="p">,</span><span class="n">Publisher</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="o">*</span><span class="n">autorunsc</span><span class="p">.</span><span class="n">csv</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">WHERE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">Publisher</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;(Verified)%&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">ImagePath</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;File not found%&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">ImagePath</span><span class="p">,</span><span class="w"> </span><span class="n">LaunchString</span><span class="p">,</span><span class="w"> </span><span class="n">MD5</span><span class="p">,</span><span class="w"> </span><span class="n">Publisher</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">ct</span><span class="w"> </span><span class="k">ASC</span><span class="w">
</span></span></span></code></pre></div><p>This script accomplishes frequency analysis using <code>Get-Command logparser.exe</code> with the above SQL statement.</p>
<p>Select columns <code>ImagePath, LaunchString, MD5, and Publisher</code> from all CSV files with the names that end with <code>autorunsc.csv</code>. Then use <code>(ImagePath, LaunchString, MD5)</code> as a unique identifier, discard all that have been <code>Verified</code> in the <code>Publisher</code> column and <code>File not found </code>in the <code>ImagePath</code> column. Count unique values, put in the <code>ct</code> column, group by <code>ImagePath, LaunchString, MD5, Publisher</code> and sort in ascending order.</p>
<h3 id="kape">KAPE</h3>
<p>Provides the ability to extract artefacts from the mounted drives (be it an image, over network or a loval drive). Here are the files/folders pulled: <a href="https://ericzimmerman.github.io/KapeDocs/#!Pages%5C2.1-Targets.md">https://ericzimmerman.github.io/KapeDocs/#!Pages%5C2.1-Targets.md</a>.</p>
<h2 id="ram">RAM</h2>
<blockquote>
<p>&hellip;force a crash and subsequently produce a memory dump as a mechanism for collecting volatile data. Sheward, Mike. Hands-on Incident Response and Digital Forensics (p. 165). BCS Learning &amp; Development Limited. Kindle Edition.</p>
</blockquote>
<h2 id="references">References</h2>
<details>
    <summary>Expand&hellip;</summary>
    <p>[<a href="https://blog.elcomsoft.com/2019/12/challenges-in-computer-and-mobile-forensics-what-to-expect-in-2020/">1</a>] 2020 overview of forensic challenges for different devices</p>
<p>[<a href="https://digitalforensicsurvivalpodcast.com/2020/03/03/dfsp-211-mac-forensics-with-steve-whalen/">2</a>] DFSP Podcast, interview with Steve Wahlen (Samuri co-founder)</p>
<p>[<a href="https://digitalforensicsurvivalpodcast.com/2016/12/13/dfsp-043-imaging-a-mac-survival-tips/">3</a>] Imaging Mac surviving tips (before the release of the T2 chip, I presume)</p>
<p>[<a href="https://www.udemy.com/course/surviving-digital-forensics-imaging-a-mac-fusion-drive/learn/lecture/2222294#overview">4</a>] Imaging Mac Fusion Drives</p>
<p>[<a href="https://support.apple.com/en-us/HT207266">5</a>] About the Apple Thunderbolt 3 (USB-C) to Thunderbolt 2 Adapter</p>
<p>[<a href="https://bakerstreetforensics.com/presentations/">6</a>] PowerShell Tools for IR Forensics Collection</p>

</details>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.bafc052229b4b40bf03c477d31c5cdd9352ece8afbadf35ab97ed14495098fc9.js"></script>
  

  
  
  
    
  


</body>

</html>
