<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ” Detection and Investigation Techniques - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting ğŸª¤">
      <a href="/docs/thunting">
        <span>Threat Hunting ğŸª¤</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference ğŸ“š">
      <a href="/docs/reference">
        <span>Tech Reference ğŸ“š</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting ğŸª¤">
      <a href="/docs/thunting">
        <span>Threat Hunting ğŸª¤</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference ğŸ“š">
      <a href="/docs/reference">
        <span>Tech Reference ğŸ“š</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/"> ğŸ‘ˆğŸ¼ Back to </br> Incident Investigation ğŸ” ğŸ¥· </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#detection-types">Detection Types</a>
      <ul>
        <li><a href="#-automated">ğŸ–²ï¸ Automated</a></li>
        <li><a href="#-semi-automated-and-manual-examination">â›ï¸ Semi-automated and Manual Examination</a></li>
        <li><a href="#-deeper-look">ğŸ”¬ Deeper Look</a></li>
      </ul>
    </li>
    <li><a href="#detection-techniques">Detection Techniques</a>
      <ul>
        <li><a href="#find-evil">Find Evil</a>
          <ul>
            <li><a href="#known-good">Known Good</a></li>
          </ul>
        </li>
        <li><a href="#behavioural-analysis">Behavioural Analysis</a></li>
        <li><a href="#frequency-analysis">Frequency Analysis</a></li>
        <li><a href="#pattern-based-analysis">Pattern-based Analysis</a></li>
        <li><a href="#ttps-and-attck-mitre">TTPs and ATT&amp;CK MITRE</a></li>
      </ul>
    </li>
    <li><a href="#investigation-techniques">Investigation Techniques</a>
      <ul>
        <li><a href="#stacking">Stacking</a></li>
        <li><a href="#prioritise-and-pivot">Prioritise And Pivot</a></li>
      </ul>
    </li>
    <li><a href="#critical-thinking">Critical Thinking</a></li>
    <li><a href="#how-to-prove-compromise">How to prove compromiseâ“</a></li>
    <li><a href="#how-to-prove-intent-">How to prove intent â“</a></li>
    <li><a href="#how-to-prove-user-knew-">How to prove user knew â“</a></li>
    <li><a href="#types-of-users">Types of Users</a>
      <ul>
        <li><a href="#dummy--vs-poopy-"><strong>Dummy</strong> ğŸ˜¬ vs <strong>Poopy</strong> ğŸ’©</a></li>
        <li><a href="#sheep--vs-others---and-"><strong>Sheep</strong> ğŸ‘ vs <strong>others</strong> ğŸ’©, ğŸ˜¬ and ğŸ¦“</a></li>
        <li><a href="#poopy--vs-donkey-"><strong>Poopy</strong> ğŸ’© vs <strong>donkey</strong> ğŸ¦“</a></li>
        <li><a href="#poopy--and-donkey--vs-others--and-"><strong>Poopy</strong> ğŸ’© and <strong>donkey</strong> ğŸ¦“ vs <strong>others</strong> ğŸ˜¬ and ğŸ‘</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">ğŸ” Detection and Investigation Techniques</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      

      
      

      
    </div>
    
    <b>Created:</b> 26.05.2023
    <br />

    

  </header>


  <div class="content" itemprop="articleBody">
    <p><em>One can detect something automatically or look for it. So, the investigation (incident response and digital forensics) can either start from a security alert or threat-hunting. Let&rsquo;s dive deeper into what techniques are used to spot the attacker.</em></p>
<p>Both legitimate users and attackers produce the evidence by intentionally or inadvertently altering the artefacts. Intentional altering of artefacts is complex and only sometimes possible. There are several ways the attacker can perform activity on a system; let&rsquo;s see what these are.</p>
<p><img src="images/attacker-artefacts.png" alt="img"></p>
<p>The attacker needs to do his job. So, the attacker needs to use some tools, and whatever he or she uses will leave a trace. Even wiping the traces leaves some traces. Although finding those traces is only sometimes straightforward, it&rsquo;s usually possible. There are two options for the attacker:</p>
<ol>
<li><strong>Physical access</strong>. One can steal a laptop or use the unlocked machine while the employee is having lunch.</li>
<li><strong>Remote access</strong>. Most of the time, the attacker doesn&rsquo;t have physical access and needs to do some research and crafting to get the &ldquo;treasure&rdquo;.</li>
</ol>
<p>There are various ways to get initial access, and those techniques are well covered on the <a href="https://attack.mitre.org/tactics/TA0001/">MITRE website</a>. Once this access is acquired, the attacker has limited options to go forward with. One of them and frequently used by the attacker, is using some malware ğŸ¦ . Of course, he needs to deliver this malware to the system and run it. Running malware leaves traces ğŸ¾. Sometimes (quite often), the attacker will try to use the legitimate tools already preinstalled on the target machine. And guess what? These tools also leave traces ğŸ‘£! The trick here is to investigate WHO ran this tool ğŸ¤”.</p>
<p>Another option the attacker ğŸ’ has is social engineering vector, including various phishing attacks, tailgating etc. But eventually, this also comes to running something on a machine, be it a legit program or not so much.</p>
<p><img src="images/user-artefacts.png" alt="img"></p>
<p>Let&rsquo;s imagine a legitimate ordinary user with no malicious intent or malware installed. What would their daily activity look like? Also, running some programs which, of course, leave some traces.</p>
<p>But how do we distinguish between a legitimate user ğŸ¥¦ and an attacker ğŸ’? When we find malware, and we see its traces ğŸ¾ on the system, it&rsquo;s one story. But what if the attacker got remote access to the system and used a legit tool on the user&rsquo;s ğŸ¥¦ behalf? What if the attacker ğŸ’ has tricked the user ğŸ¥¦ into running something evil? How do we know it&rsquo;s ğŸ‘£ and not ğŸ¾? Sometimes we don&rsquo;t.</p>
<p><img src="images/both-artefacts.png" alt="img"></p>
<h2 id="detection-types">Detection Types</h2>
<p>Unless we protect a small company with 2-3 computers, we can&rsquo;t afford to repeatedly spend days on a single machine to ensure everything is in order. And even if we had that much time, it could be more practical. In the ideal scenario, we would want to automatically detect as much as possible and then manually examine only systems that were likely compromised.</p>
<p>Unless the attacker has physical access to the machine, tricked the legit user into doing bad things or has some RDP or similar access due to misconfiguration, they need to run some process (usually malware) to hook and achieve their goals. So, there are three types of processes traces of which we need to look out for:</p>
<ol>
<li>ğŸ¥¸ Active malware</li>
<li>ğŸ˜´ Dorman malware (will run eventually and become ğŸ¥¸)</li>
<li>ğŸ¤ª Living Off the Land (LOL)</li>
</ol>
<p>I will use these emojis for detection and threat-hunting techniques suitable for this process type.</p>
<h3 id="-automated">ğŸ–²ï¸ Automated</h3>
<p>We can leverage the following data to write and tune our threat-hunting rules:</p>
<ol>
<li>âœğŸ» Antivirus and signatures ğŸ¥¸ and ğŸ˜´</li>
<li>ğŸ‘£ IoCs ğŸ¥¸ , ğŸ˜´ and ğŸ¤ª (LOL is trickier)</li>
<li>ğŸ¤¨ Anomalies (Legit Automated Process and Malware) ğŸ¥¸ and ğŸ˜´</li>
</ol>
<p>Now, these only sometimes work and fire. First, signatures are useless if it&rsquo;s a new malware or a modified or polymorphic one. Besides, signature databases grow more extensive and are harder to manage. Besides, think about it, humans sometimes create signatures, and humans make mistakes. Even if you have some perfect Yara rule, it takes time to scan the system, and you can&rsquo;t possibly have a perfect rule for every single malware out there. Besides, attackers do not always use malware; sometimes, they use what&rsquo;s already on the system and is legit.</p>
<p>Secondly, there will be no IoC (Indicators of Compromise) if it&rsquo;s a new campaign. Also, some IoCs become irrelevant very quickly. For example, it&rsquo;s fairly easy for the attacker to change an IP address, domain name, file hash or name.</p>
<p>Anomalies are more reliable and long-living, but there is still a good chance of missing something that is not seen as an anomaly. For example, the attacker stole the admin creds and used the admin tools from the admin machine during working hours. What&rsquo;s anomalous about that?</p>
<p><strong>Pattern-based</strong> and <strong>behavioural deviations</strong> are good techniques to use here.</p>
<h3 id="-semi-automated-and-manual-examination">â›ï¸ Semi-automated and Manual Examination</h3>
<p>We know some things about the attackers that are usually the same across different actors: they need to achieve their goals (usually, they are after the information), they need to stay persistent, and usually, they need to hop from one machine to another. We can assume the attacker would target specific locations and settings if they sneak through our detection mechanisms. The persistence techniques are limited, as are those for lateral movement.</p>
<ol>
<li>Persistence mechanisms. For example, checking a Windows machine&rsquo;s <code>Run</code> and <code>RunOnce</code> keys can sometimes reveal something suspicious.</li>
<li>Artefacts and logs collected across multiple machines.</li>
<li>Timeline analysis</li>
<li>RAM</li>
</ol>
<p><strong>Stacking</strong> and <strong>frequency analysis</strong> is very good approaches here.</p>
<h3 id="-deeper-look">ğŸ”¬ Deeper Look</h3>
<p>This only makes sense when we have a limited list of machines to examine. We could look at the same artefacts as in the previous step. Forensic acquisition and analysis are exactly what this step is about. RAM analysis is usually performed in this step (not always necessary or possible). We would check for filesystem metadata (like MFT on NTFS) and analyse unallocated or slack space. Of course, attackers want to avoid being easily found, so they employ evasion techniques. We would also look out for possible anti-detection and anti-forensics techniques.</p>
<p>This step is the best and sometimes the only bet for finding dormant ğŸ˜´ malware and LOLs ğŸ¤ª. Also, don&rsquo;t forget that sometimes it&rsquo;s as &ldquo;simple&rdquo; as an insider threat (not actually that simple), so, a deeper look to prove intent could be due.</p>
<p><strong>Pattern-based analysis</strong>, <strong>behavioural analysis</strong>, <strong>stacking</strong>, <strong>frequency analysis</strong>, and <strong>finding evil</strong> are excellent techniques for this step.</p>
<h2 id="detection-techniques">Detection Techniques</h2>
<h3 id="find-evil">Find Evil</h3>
<p>One of them is called &ldquo;<strong>Find Evil</strong>&rdquo; ğŸ‘¿. For this method, you need to know a baseline. It helps to run some collection for a clean system to see the baseline for this OS/setup if you are unsure. Otherwise, looking at the data, you might notice something standing out, like a Windows core process spawned from the wrong direction or an HTTP traffic flowing back and forth from a <code>java.exe</code>. Another example: suddenly increased server requests could indicate nefarious activity. Again, you need to know the baseline to tell if something is wrong.</p>
<p>ğŸ›  Typically, this kind of stuff (spikes) is picked up by the IDS/IPS/WAF systems quite neatly.
ğŸ—’ TODO: <a href="https://www.open-scap.org/security-policies/scap-security-guide/">https://www.open-scap.org/security-policies/scap-security-guide/</a>.</p>
<h4 id="known-good">Known Good</h4>
<p>Of course, to find evil, one needs to know what&rsquo;s NOT. Only some of the files are worth considering. However, it takes a lot of work to keep all of them in mind. I&rsquo;ve made several database files that contain information on files on a clean installed system. There will be some divisions, but I hope it will also help eliminate a massive pack of files.</p>
<p>When reviewing processes and artefacts for potential maliciousness, I use the following list, where items are ordered by their likelihood of being malicious.</p>
<ol>
<li>Outstanding <code>exe</code> or bat <code>files</code> named with one digit or letter like <code>a.ps1</code>, <code>1.bat</code>. <code>a.exe</code> etc.</li>
<li>Drivers that were installed recently or that I need to recognise.</li>
<li>Unfamiliar program names (google or ask ChatGPT to know more about such programs)</li>
<li>Familiar programs in unusual places</li>
<li>Programs that seem legit are in the expected folders (last resort).</li>
</ol>
<h3 id="behavioural-analysis">Behavioural Analysis</h3>
<p>A little more sophisticated &ldquo;Find Evil&rdquo; technique is what I call <strong>behavioural analysis</strong>. For this method, you must think like an attacker and a regular user. For example, for everyday use, the failed login process would look something like the following:</p>
<ul>
<li>First login attempt - error</li>
<li>Second login attempt - error</li>
<li>Third login attempt - error</li>
<li>Reset password</li>
<li>Login</li>
</ul>
<p>For a malicious user, it would be something like (brute-forcing):</p>
<ul>
<li>First login attempt - error</li>
<li>Second login attempt - error</li>
<li>N-login attempt - account blocked</li>
<li>Sleep for N minutes</li>
<li>M-login attempt - error</li>
<li>etc</li>
</ul>
<p>For a malicious user attempting password spraying attack (when one password is used for different accounts), you are likely to do something like the following:</p>
<ul>
<li>First login attempt - error</li>
<li>Second login attempt - error</li>
<li>Third login attempt - error</li>
<li>Stop (no successful login or password reset)</li>
</ul>
<h3 id="frequency-analysis">Frequency Analysis</h3>
<p>Another technique is called <strong>frequency analysis</strong> ğŸ“Š. Depending on the system, you&rsquo;d look for something more or less frequent. Covering all the cases is hard, but some examples may do the trick. For example, you have a web server. Most of the time, with regular traffic and no malicious activity, there would be 200 status codes returned by the server. However, if an attacker performs a brute force attack against user accounts or IDOR probing, you would see a spike in the 403 (access denied) HTTP status code. If the attacker were to perform some directory busting, you would probably see a point in 404.</p>
<p>ğŸ›  SIEM/IDS + ML (machine learning engine) could help identify those &ldquo;unusual things&rdquo;. Some SIEM would allow making rules based on different log fields. So, for example, in the above scenario, one could create a rule to alert the CSIRT if a 100 threshold for 404 HTTP status code returned is hit in 1 minute.</p>
<h3 id="pattern-based-analysis">Pattern-based Analysis</h3>
<p>One more technique that I have been using I call <strong>pattern analysis</strong>. This one needs to be VERY knowledgeable about red teaming activities and current vulnerabilities. Refrain from overwhelming yourself with the openness and exploits out there, and filter the news and feeds only to show those relevant to your environment. For example, see only Apache Tomcat stuff, PHP and nginx + common web application vulnerabilities. Patterns for each vulnerability exploited would be different, of course. For example, for an SQLi, it&rsquo;s something like a single quote (<code>'</code>) or <code>sleep</code> keyword (also could indicate command-line injection) or some other pattern like <code>'or%201=1--</code> or anything from <a href="https://github.com/payloadbox/sql-injection-payload-list">list</a> and even more. You can find the list of payloads (designs) for common vulnerabilities online to get a general idea.</p>
<p>ğŸ›  For post-incident analyses, I find it helpful to use Excel/Numbers due to their advanced pivoting and filtering functionality. It&rsquo;s useful for both frequency and pattern analysis. This, however, will only work for offline analysis and only on data that&rsquo;s not too overwhelming. If you are familiar with the querying language, SIEM tools can also be convenient for visualisation and filtering.</p>
<p>So, knowing the red team operations, possible attacks on your infrastructure, and standard user behaviour is helpful.</p>
<h3 id="ttps-and-attck-mitre">TTPs and ATT&amp;CK MITRE</h3>
<p><strong>Cyber Analytics Repository</strong> - <a href="https://car.mitre.org/">https://car.mitre.org/</a>. That&rsquo;s basically what I was planning to write here, but it&rsquo;s already implemented and in a very neat way. Each tactic is described here, with a short description, categorisation, Splunk queries, and available tools. As I said, need.</p>
<p><strong>Matrices</strong> are another way to categorise attackers&rsquo; tactics and techniques. It&rsquo;s a table (<a href="https://attack.mitre.org/techniques/enterprise/">enterprise</a> and <a href="https://attack.mitre.org/techniques/mobile/">mobile</a>). In these tables, attacking techniques are categorised by type and by attack stage. Clicking on any technique will bring you to its description, mitigation and detection tips.</p>
<p>What can I add to this? I don&rsquo;t know right now. I am relieved that I don&rsquo;t have to do it myself and, at the same time, disappointed I don&rsquo;t get to research and analyse this information myself. I could add some examples from my own experience&hellip;., or additional tips&hellip; That&rsquo;s some food ğŸ± for thought. Here is a <a href="https://attack.mitre.org/resources/contribute/">link</a> to contribute.  It looks like they are looking for more macOS and Cloud tactics, and since I am particularly interested in these, it might be my niche.</p>
<p>One additional thing I could do here is to develop a learning plan. And use it as a sketch to sort other content on this website accordingly.</p>
<p>The interesting part is that if you look at MITRE, you will notice that lateral movement and initial access both have the least number of techniques.</p>
<p><img src="images/mitre-two-techniques.png" alt="img"></p>
<p>What does it mean? It means that you have more chances to tune the detection mechanisms for these stages and then deduce and validate hypothesis for other stages.</p>
<h2 id="investigation-techniques">Investigation Techniques</h2>
<p>When we have a lot of data, we need to eliminate all the noise to make the above techniques easier to use. One way is to combine all the data of the same type from all the machines and apply the above techniques to the data set. Think of it as a huge database of data (SIEM, if you will). Another way is to use each artefact to pivot around it to look for other related artefacts.</p>
<h3 id="stacking">Stacking</h3>
<p>It&rsquo;s not a separate technique per se. Instead, it refers to analysing a bunch of systems. You would use either of the techniques above for a BUNCH of systems. Frequency analysis is usually the first one to go. Items that appear a few times or are seen on one system only usually stand out.</p>
<h3 id="prioritise-and-pivot">Prioritise And Pivot</h3>
<p>There are different paths to follow to answer the same questions. Some are more efficient.</p>
<p>I am pulling on threads.  Find a piece of evidence and focus on that to fully understand it. Example (depth search):</p>
<ul>
<li>Looking for malware and finding program run entries for malware</li>
<li>Stop looking for other malware and focus on that one.
<ul>
<li>What happened before and after?</li>
<li>What else is in the same folder?</li>
<li>What does it do?</li>
</ul>
</li>
<li>Repeat for each you find</li>
</ul>
<p>How to find the first evidence? Prioritise or brute force.</p>
<ul>
<li>Prioritise (Manual). You always need to find out where the evidence is going to be.
<ul>
<li>impact on the investigation result</li>
<li>likelihood of finding anything</li>
<li>False positive?</li>
<li>time required</li>
</ul>
</li>
<li><strong>Brute force</strong> (Automated). Let tools and software find evidence.</li>
</ul>
<blockquote>
<p>Cyber Triage: can I mark something as wrong and run the analysis for this piece of evidence again? - yes</p>
</blockquote>
<p>See the general schema <a href="/files/pdf/DivideAndConquerDiag202010-201008-094835.pdf">here</a>.</p>
<p>The main idea is to concentrate on some areas and answer some specific questions, like:</p>
<ol>
<li>Is there child exploitation material? Search videos and pictures.</li>
<li>Is this PC compromised? It needs to be more prominent.</li>
<li>Who did this computer communicate with?</li>
</ol>
<p><strong>First option:</strong></p>
<p>Big problem &ndash;&gt; n*(minor problem). Recursively break a problem into minor issues until one becomes solvable.</p>
<p><strong>Second option:</strong></p>
<p>Or we can be guided by artefact â›ï¸  categories.</p>
<p>First, break the more significant problem into smaller ones. Then answer questions with artefact â›ï¸ categories.</p>
<p>Here is the pseudocode for this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="n">function</span> <span class="n">breakIntoSmallerProblems</span><span class="p">(</span><span class="n">Stack</span> <span class="n">problemStack</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stacked</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="n">problemStack</span><span class="p">.</span><span class="n">len</span> <span class="p">==</span> <span class="m">0</span> <span class="k">return</span> <span class="m">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">currentProblem</span> <span class="p">=</span> <span class="n">problem</span><span class="p">.</span><span class="n">pop</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">  <span class="k">get</span> <span class="n">artifacts</span><span class="p">(</span><span class="n">poseQuestion</span><span class="p">(</span><span class="n">current</span> <span class="n">problem</span><span class="p">,</span> <span class="n">stackLen</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="n">breakIntoSmallerProblems</span><span class="p">(</span><span class="n">problemStack</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">function</span> <span class="n">poseQuestion</span><span class="p">(</span><span class="kt">string</span> <span class="n">problem</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stackLen</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">stackLen</span> <span class="p">&lt;</span> <span class="m">100</span><span class="p">)</span> <span class="n">prioritisize</span><span class="p">(</span><span class="n">problem</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span> <span class="n">answerWithAutoTools</span><span class="p">(</span><span class="n">problem</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><strong>How does a computer work?</strong> Hardware, OS, Processes. <strong>How does the attacker work?</strong> Remote access changes, detection avoidance etc.</p>
<p><strong>RoadMap</strong></p>
<ol>
<li>Is the system compromised?
<ol>
<li>Are there mal-related changes?</li>
<li>Is there mal user activity?
<ol>
<li>Suspicious logins?
<ol>
<li>Login artefact category â›ï¸: Event log 4624, 4778, active users etc</li>
</ol>
</li>
</ol>
</li>
<li>Are there malware progs?</li>
<li>Are there mal OS changes?</li>
</ol>
</li>
</ol>
<p>Prioritisation is based on: likely relevance, result accuracy, and time to answer.</p>
<p>Beginner: start with a process and fill in categories</p>
<p>Advanced: when you already know about classes, think from that perspective.</p>
<p>Manager: categories</p>
<p>Cyber Triage User: same</p>
<p>File name &ndash;&gt; meta &ndash;&gt; content</p>
<h2 id="critical-thinking">Critical Thinking</h2>
<p><strong>Challenge assumptions</strong> (sometimes it&rsquo;s something you have not seen or dealt with before), consider alternatives, evaluate data, identify critical drivers, and understand the context.</p>
<p>List all assumptions and ask yourself how sure you are of these statements and what might happen if they are wrong. Categorise these assumptions based on certainty. Refine and remove those assumptions that are proven to be incorrect. Identify additional data needs for those assumptions that are still uncertain. Research?</p>
<p>Think about the <strong>alternatives</strong>, for example, brainstorming. Ask yourself the six W&rsquo;s to help develop the other options. The null hypothesis is the opposite of the central hypothesis (for anomalous data).</p>
<p>Know your data! <strong>Know normal and abnormal</strong>. Establish the baselines for average to detect the bizarre (like, a clean system installation is examined, and everything is compared to it). Look for inconsistent data. **Assess the data against different hypotheses to see how well it fits.</p>
<p>Identify critical drivers: technology, regulatory (laws and standards), society (politics, people want to be safe), supply chain (logistics, cost, scheduling, customer requirements), employees (skills and training needed), threat actors (tech capabilities, motives, opportunity).</p>
<p>Understand the context from the perspective of different stakeholders. Framing techniques help keep everyone on the same page (what do they need from me, how can I frame the issue, do I need to place their questions in a broader context). Same vocabulary. Steps:</p>
<ul>
<li>Key components. Break the problem down and identify the parts, actors and categories.</li>
<li>Factors at Play.</li>
<li>Relationships. Static? Dynamic? Graphing.</li>
<li>Similarities/Differences. Leverage past work!</li>
<li>Redefine. Rephrase and paraphrase the issue. What is the root cause?</li>
</ul>
<blockquote>
<p>ğŸ’¡ Maybe it&rsquo;s better to arrange it as a table. Merge with the information from the Cyber Triage DFIR webinar by Brian Carrier and Digital Archaeology.</p>
</blockquote>
<h2 id="how-to-prove-compromise">How to prove compromiseâ“</h2>
<blockquote>
<p>TODO: Move to Canva, make a decision tree from it rather</p>
</blockquote>
<p>Lot&rsquo;s of attacks involve account compromise. In some cases malware is not even needed. There are several arguments for the defence: <em>I didn&rsquo;t know</em>, <em>It was not me</em>, <em>It was a malware</em> and <em>It happened accidently</em>.</p>
<p>âœï¸ <strong>Suspicious logins?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> Should this user use this account?</li>
<li><input disabled="" type="checkbox"> Are they new to the computer?</li>
<li><input disabled="" type="checkbox"> If remote, does the account usually come from that computer?</li>
<li><input disabled="" type="checkbox"> Is the time expected?</li>
<li><input disabled="" type="checkbox"> Does the account have lots of failed logins? ğŸ‘‰ <em>A very strong indicator of compromise</em></li>
<li><input disabled="" type="checkbox"> A login during time when the user was absent ğŸ‘‰ <em>A very strong indicator of compromise</em></li>
</ul>
<p>âœï¸ <strong>Malware</strong>. There is a separate section for malware, but it can be a strong defense for someone claiming their account was compromised. But! âš ï¸ Even if there is a malware found, it&rsquo;s essential to prove that it existed <strong>at the time</strong> that some investigated activity took place.</p>
<h2 id="how-to-prove-intent-">How to prove intent â“</h2>
<p><em>â“  So, back to the question. How to prove that the user knows?</em></p>
<p>âœï¸ <strong>Suspicious activity?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> <strong>What searches were performed?</strong>
<ul>
<li><input disabled="" type="checkbox"> Search relevant to job role?</li>
<li><input disabled="" type="checkbox"> Search for malicious progs or techniques?</li>
<li><input disabled="" type="checkbox"> Was there an attempt to delete the evidence? For example, the browser cache cleared <em>manually</em> depends on this browser settings.</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Access resources</strong>.
<ul>
<li><input disabled="" type="checkbox"> Accessed malwebsite?</li>
<li><input disabled="" type="checkbox"> Network shares?</li>
<li><input disabled="" type="checkbox"> Mass copy? ğŸ‘‰ <em>Might be an indicator of data exfiltration.</em></li>
<li><input disabled="" type="checkbox"> Was it a result of a redirect (300 HTTP or header redirect, or pop-up) ğŸ‘‰ <em>May help the defending side if this can be proved.</em></li>
<li><input disabled="" type="checkbox"> File accessed soon after creation? ğŸ‘‰ <em>Might be an indicator of some automated task, or not&hellip;.</em>.</li>
<li><input disabled="" type="checkbox"> Was a file deleted/wiped? ğŸ‘‰ <em>File wiped is a strong indiator of intent.</em> ğŸ›  Directory Snoop can show that the file was wiped, not simply deleted. Not all wiping software clears the <code>$MFT</code> table.</li>
<li><input disabled="" type="checkbox"> What devices were attached?</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Remotely executed code</strong>. Remote host + username; interactive or cmd; time. Registry. Event logs for logins and Event login for remote processes.
<ul>
<li><input disabled="" type="checkbox"> Remote = local?</li>
<li><input disabled="" type="checkbox"> Expected?</li>
<li><input disabled="" type="checkbox"> Prog expected?</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Communications</strong>. Messangers, emails, social networking, forums, websites.
<ul>
<li><input disabled="" type="checkbox"> Determine all the mail clients used and use this information to find artefacts. â—ï¸â—ï¸â—ï¸â—ï¸ Link to collection.</li>
<li><input disabled="" type="checkbox"> Relevant threads (<code>strings</code> + <code>grep</code> or DFIR framework).</li>
<li><input disabled="" type="checkbox"> IP in mail spoofed?</li>
</ul>
</li>
</ul>
<p>ğŸ‘£ User started processes (Event log, RunMRU, MUICache, UserAssist, AppCompatCache or Shimcache, BAM (Background activity monitor), RecentApps, RecentFilecache or AmCache, SRUM (system resource usage monitor), Windows Timeline, Prefetch).</p>
<p>ğŸ‘£ Terms and time when the search was performed. Web artifacts and saved previous searches.</p>
<p>ğŸ‘£ Includes Host (remote or local), path, time. (configs like history of browser; recently used files, process handles). FileExplorer&rsquo;s ShellBags (what folder was opened) and RunMRU,Application Most Recently Used Files, Web artifacts (cookies, history, db, cache), Memory (commands, remote desk info, paths), cont monitoring.</p>
<p>ğŸ‘£ Event logs, domain logs. The below question may help finding a malicious user (hacker) or malicious insider with intent. More <a href="/docs/dfir/forensic-investigation/4-accounts">here</a>.</p>
<p>ğŸ‘£ Mails. â—ï¸â—ï¸â—ï¸â—ï¸ Link to collection.</p>
<h2 id="how-to-prove-user-knew-">How to prove user knew â“</h2>
<p>âœï¸ It&rsquo;s often not enough just to find a file on a system. One needs to prove <strong>the intent</strong>. Remember to use more than one artifact whenever possible! For example, the user may be insisting that he or she did not download this file. But, if the browser was set to flush data every 7 days and the timestamps for the deleted file shows it was deleted an hour after it was deleted - this might raiser some reasonable doubt I think ğŸ¤”. Or, the file was wiped ğŸ§¹ (it&rsquo;s contents filled with <code>0</code>s). If one didn&rsquo;t know it existed, why delete it? Or there is no data on the PC indicating the use of the file, but it was continuously downloaded/uploaded according to the server logs. âš ï¸ This, however, won&rsquo;t prove that there was no hacker in place!</p>
<h2 id="types-of-users">Types of Users</h2>
<p>Actually, as I read further an further, it seems that everything is about a user. But!</p>
<p>A user can be of several categories. I&rsquo;ll name each one as shortly as I can to refer to them in future. But I will describe them in more detail below.</p>
<p><strong>Legitimate user, who has done something bad by accident</strong>. Let&rsquo;s call him a <strong>dummy</strong> ğŸ˜¬. I&rsquo;ve been there, I once changed permissions to <code>Deny</code> for my admin account to disk <code>C</code> on Windows and could do nothing about it later. How stupid was it ğŸ™ˆ? My excuse is that I only started with PCs&hellip; .</p>
<p><strong>Legitimate user, who has done something bad by intent.</strong> Let&rsquo;s call this one a <strong>poopy</strong> ğŸ’©. Say, he or she feels highy underpaid and sells company&rsquo;s kitty plans to some evil dog hackers.</p>
<p><strong>A user created and used by a hacker.</strong> This one I will call a <strong>sheep</strong> ğŸ‘  as in <em>A wolf in sheep&rsquo;s clothing</em>, since the attacker is trying mask itself as something good.  This one is not unusual, but I guess, easily determined by the sysadmin. However, there are some cases, when an attacker can change view permissions for his/her account on AD so that no one will see this user.</p>
<p><strong>A user created legitimately, but compromised by a hacker and doing something by intent.</strong> This one will be a <strong>donkey</strong> ğŸ¦“, as the attaker is using another account for his ride. I guess it&rsquo;s the most common when the hackers are in the picture.</p>
<p>And here are the questions we will have to answer during investigations, that can help in distinguishing between these types.</p>
<h3 id="dummy--vs-poopy-"><strong>Dummy</strong> ğŸ˜¬ vs <strong>Poopy</strong> ğŸ’©</h3>
<p><em>â“ How to prove that the person didn&rsquo;t do it on purpose, but by accident?</em></p>
<p>âœï¸ It&rsquo;s often not enough just to find a file on a system. One needs to prove <strong>the intent</strong>. Remember to use more than one artifact whenever possible! For example, the user may be insisting that he or she did not download this file. But, if the browser was set to flush data every 7 days and the timestamps for the deleted file shows it was deleted an hour after it was deleted - this might raiser some reasonable doubt think ğŸ¤”. Or, the file was wiped ğŸ§¹ (it&rsquo;s contents filled with <code>0</code>s). If one didn&rsquo;t know it existed, why delete it? Or there is no data on the PC indicating the use of the file, but it was continuously downloaded/uploaded according to the server logs. âš ï¸ This, however, won&rsquo;t prove that there was no hacker in place!</p>
<h3 id="sheep--vs-others---and-"><strong>Sheep</strong> ğŸ‘ vs <strong>others</strong> ğŸ’©, ğŸ˜¬ and ğŸ¦“</h3>
<p>âœï¸ <strong>Are there suspicious accounts?</strong> ğŸ‘£ SAM reg hive (local and domain). Even if the account is deleted, then you can still spot it: user directory sometimes is retained and also check logs. The below question may help finding a malicious user (hacker). More <a href="/docs/dfir/forensic-investigation/accounts">here</a>.</p>
<ul>
<li><input disabled="" type="checkbox"> User Name does not match conventions for this organisation?</li>
<li><input disabled="" type="checkbox"> Weird priviledges</li>
<li><input disabled="" type="checkbox"> Scope (local or domain)</li>
<li><input disabled="" type="checkbox"> Creation time and date.</li>
</ul>
<h3 id="poopy--vs-donkey-"><strong>Poopy</strong> ğŸ’© vs <strong>donkey</strong> ğŸ¦“</h3>
<p><em>â“ How to prove that the account was compromised?</em></p>
<p>Lot&rsquo;s of attacks involve account compromise. In some cases malware is not even needed. There are several arguments for the defence: <em>I didn&rsquo;t know</em>, <em>It was not me</em>, <em>It was a malware</em> and <em>It happened accidently</em>.</p>
<p>âœï¸ <strong>Suspicious logins?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> Should this user use this account?</li>
<li><input disabled="" type="checkbox"> Are they new to the computer?</li>
<li><input disabled="" type="checkbox"> If remote, does the account usually come from that computer?</li>
<li><input disabled="" type="checkbox"> Is the time expected?</li>
<li><input disabled="" type="checkbox"> Does the account have lots of failed logins? ğŸ‘‰ <em>A very strong indicator of compromise</em></li>
<li><input disabled="" type="checkbox"> A login during time when the user was absent ğŸ‘‰ <em>A very strong indicator of compromise</em></li>
</ul>
<p>âœï¸ <strong>Malware</strong>. There is a separate section for malware above â˜ï¸, but it can be a strong defense for some one claiming his or her account was compromised. But! âš ï¸ Even if there is a malware found, it&rsquo;s essential to prove that it existed at the time that some investigated activity took place.</p>
<h3 id="poopy--and-donkey--vs-others--and-"><strong>Poopy</strong> ğŸ’© and <strong>donkey</strong> ğŸ¦“ vs <strong>others</strong> ğŸ˜¬ and ğŸ‘</h3>
<p>âœï¸ <strong>Suspicious activity?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> <strong>What searches were performed?</strong>
<ul>
<li><input disabled="" type="checkbox"> Search relevant to job role?</li>
<li><input disabled="" type="checkbox"> Search for malicious progs or techniques?</li>
<li><input disabled="" type="checkbox"> Was there an attempt to delete the evidence? For example, browser cache cleared <em>manually</em>, depends on this browser settings.</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Access resources</strong>.
<ul>
<li><input disabled="" type="checkbox"> Accessed malwebsite?</li>
<li><input disabled="" type="checkbox"> Network shares?</li>
<li><input disabled="" type="checkbox"> Mass copy? ğŸ‘‰ <em>Might be an indicator of data exfiltration.</em></li>
<li><input disabled="" type="checkbox"> Was it a result of a redirect (300 HTTP or header redirect, or pop-up) ğŸ‘‰ <em>May help the defending side if this can be proved.</em></li>
<li><input disabled="" type="checkbox"> File accessed soon after creation? ğŸ‘‰ <em>Might be an indicator of some automated task, or not&hellip;.</em>.</li>
<li><input disabled="" type="checkbox"> Was a file deleted/wiped? ğŸ‘‰ <em>File wiped is a strong indiator of intent.</em> ğŸ›  Directory Snoop can show that the file was wiped, not simply deleted. Not all wiping software clears the <code>$MFT</code> table.</li>
<li><input disabled="" type="checkbox"> What devices were attached?</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Remotely executed code</strong>. Remote host + username; interactive or cmd; time. Registry. Event logs for logins and Event login for remote processes.
<ul>
<li><input disabled="" type="checkbox"> Remote = local?</li>
<li><input disabled="" type="checkbox"> Expected?</li>
<li><input disabled="" type="checkbox"> Prog expected?</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Communications</strong>. Messangers, emails, social networking, forums, websites.
<ul>
<li><input disabled="" type="checkbox"> Determine all the mail clients used and use this information to find artefacts. â—ï¸â—ï¸â—ï¸â—ï¸ Link to collection.</li>
<li><input disabled="" type="checkbox"> Relevant threads (<code>strings</code> + <code>grep</code> or DFIR framework).</li>
<li><input disabled="" type="checkbox"> IP in mail spoofed?</li>
</ul>
</li>
</ul>
<p>ğŸ‘£ User-started processes (Event log, RunMRU, MUICache, UserAssist, AppCompatCache or Shimcache, BAM (Background activity monitor), RecentApps, RecentFilecache or AmCache, SRUM (system resource usage monitor), Windows Timeline, Prefetch).</p>
<p>ğŸ‘£ Terms and time when the search was performed. Web artifacts and saved previous searches.</p>
<p>ğŸ‘£ Includes Host (remote or local), path, time. (configs like history of browser; recently used files, process handles). FileExplorer&rsquo;s ShellBags (what folder was opened) and RunMRU,Application Most Recently Used Files, Web artefacts (cookies, history, db, cache), Memory (commands, remote desk info, paths), cont monitoring.</p>
<p>ğŸ‘£ Event logs, domain logs. The below question may help finding a malicious user (hacker) or malicious insider with intent. More <a href="/docs/dfir/forensic-investigation/4-accounts">here</a>.</p>
<p>ğŸ‘£ Mails. â—ï¸â—ï¸â—ï¸â—ï¸ Link to the collection.</p>
<h2 id="references">References</h2>
<details>
    <summary>Expand&hellip;</summary>
    Something here
</details>
  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.302a6fc365d5139fb98cf60bdb8f715d96257ea189161d36c190ccfa8182e569.js"></script>
  

  
  
  
    
  


</body>

</html>
