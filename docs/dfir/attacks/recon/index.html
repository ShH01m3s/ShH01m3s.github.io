<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Network Recon - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/attacks/"> ğŸ‘ˆğŸ¼ Back to </br> âš”ï¸ Attacks DB </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#traceroute-tracert"><code>traceroute</code>, <code>tracert</code></a></li>
    <li><a href="#ping"><code>ping</code></a></li>
    <li><a href="#telnet"><code>telnet</code></a></li>
    <li><a href="#nmap"><code>nmap</code></a>
      <ul>
        <li><a href="#-rtfm">ğŸ“• RTFM</a></li>
      </ul>
    </li>
    <li><a href="#hping"><code>hping</code></a></li>
    <li><a href="#-references">ğŸ“š References</a></li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Network Recon</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      

      
      

      
    </div>
    
    <b>Created:</b> 28.07.2022
    <br />

    

  </header>


  <div class="content" itemprop="articleBody">
    <h2 id="traceroute-tracert"><code>traceroute</code>, <code>tracert</code></h2>
<p>On Windows, it&rsquo;s <code>tracert</code> (due to some legacy max-name-size limitations). On Linux and macOS - <code>traceroute</code>. Windows uses ICMP protocol by default, while macOS and Linux - <code>UDP</code>. You can, however, make <code>tracerout</code> on UNIX operate over ICMP by specifying <code>-I</code> switch.</p>
<blockquote>
<p>ğŸ§ª There is an extraordinary thing that I have noticed. I was trying to capture the traceroute and tracert traffic to show the screenshots.</p>
<p>I launched traceroute on macOS, and I got a bizarre response: 64 lines of 3 wildcards that could indicate a firewall blocking ICMP/UDP requests. I googled and googled and decided to check the Windows tracert on a VM on the same machine. And strangely, I got a normal response. That led me to believe that the macOS traceroute is buggy since the machine is the same and all traffic is routed through the same nodes.</p>
<p>Another idea was that my firewall on macOS was blocking it, but the firewall was on, and how come the traffic on Windows was not? Isn&rsquo;t the macOS firewall supposed to block all the machine traffic? After some quick Internet searches, the VPN might be the reason. I turned it off, and the utility started doing what it was destined to.</p>
<p>So, there was a VPN on, on a macOS host. It&rsquo;s supposed to work for ALL the traffic coming from the machine. VM sits atop. Why isn&rsquo;t its traffic going through the VPN?</p>
</blockquote>
<blockquote>
<p>â›”ï¸ Windows 11, Parallels on M1 macOS - doesn&rsquo;t work, same issue,  <code>* * *</code>  for every host.
âœğŸ» I turned on the VPN (for macOS, it needed to be off, for Windows - on ğŸ¤¯)</p>
</blockquote>
<blockquote>
<p>â›”ï¸ VM, tracert seems to be doing one hop.
âœğŸ» With shared network. Changes to bridged WiFi, and now the tracert starts as usual, although there are these <code>* * *</code> again. I turned the firewall on macOS and Windows - nothing. I tried turning the VPN on and off - nothing. Which one is the default?</p>
</blockquote>
<blockquote>
<p>â›”ï¸ Wireshark would not run on an ARM macOS Parallels Windows 11.
âœğŸ» I don&rsquo;t have a link to the source, but I tried installing a 32-bit version, and it worked.\</p>
</blockquote>
<p>Let&rsquo;s compare the two systems and find something to help identify the OS based on the default behaviour.</p>
<p>Below you can see three screenshots of <code>traceroute</code> utility at work. For each TTL value/network node (starting from <code>1</code>), macOS sends three consecutive requests. For each UDP request with a given TTL sent, an ICMP reply is received when the node is not filtered. It starts with <code>TTL=1</code>, sends three UDP requests regardless of whether there is a reply, and then increments the TTL value by one.</p>
<p><img src="images/mac-udp-traceroute.png" alt="img"></p>
<p>If the node is not filtered, you&rsquo;d observe something like this in the above screenshot:</p>
<ol>
<li>TTL=X, UDP request</li>
<li>ICMP reply</li>
<li>TTL=X, UDP request</li>
<li>ICMP reply</li>
<li>TTL=X, UDP request</li>
<li>ICMP reply</li>
<li>TTL=X+1, UDP request</li>
<li>ICMP reply</li>
<li>TTL=X+1, UDP request</li>
<li>ICMP reply</li>
<li>TTL=X+1, UDP request</li>
<li>ICMP reply</li>
<li>&hellip; (you get the idea)</li>
</ol>
<p>What happens when the node is not responding to these UDP probes? UDP is sent, just like in the screenshot above, but there is no ICMP reply. See the below picture. Again, three UDP requests with the same TTL, then it&rsquo;s incremented.</p>
<p><img src="images/mac-udp-traceroute-requests.png" alt="img"></p>
<p>To make things a little clearer, I&rsquo;ve captured the traffic along with the terminal window to show the filtered nodes&rsquo; responses both in Wireshark and in traceroute output.</p>
<p><img src="images/mac-udp-traceroute-3.png" alt="img"></p>
<p>Note the asterisks <code>*</code>; these indicate some filtering that rejects UDP probes. Note that there is a correlation between the number of asterisks, the number of UDP requests in Wireshark and the absence of ICMP replies. Whenever some filtering is in place, OS tries three times and then gives up hope of getting an answer and moves on to the next node by incrementing the TTL. Note that the last number in the Terminal is 14, whereas the previous TTL is 15 (only one request yet). The asterisks are added only when the traceroute sends another request.</p>
<p>Now, let&rsquo;s see what happens when we use ICMP instead. Pretty much the same, except that the protocols are different. For this to work, you will need to add a <code>-I</code> switch.</p>
<p><img src="images/mac-icmp-traceroute-1.png" alt="img"></p>
<p><img src="images/mac-icmp-treaceroute-3.png" alt="img"></p>
<p>Windows <code>tracert</code>:
<img src="images/gdh-win-tracert.png" alt="img"></p>
<p>UNIX <code>traceroute</code>:</p>
<p><img src="images/gdh-traceroute.png" alt="img"></p>
<h2 id="ping"><code>ping</code></h2>
<p>I have run ping <code>bakerst221b.com</code> on my Mac and looked at the traffic and the command output. Here are my observations.</p>
<p>My older Mac is using ICMPv6 protocol with <code>ping</code> command. So, the filter in Wireshark should be set to <code>icmpv6</code>. And it was done over <code>IPv6</code>, so instead of <code>TTL</code> there was <code>Hop Limit</code> which was set to <code>255</code>.</p>
<p>On the new one, however, ping operated over ICMP and used IPv4. Default TTL - 245. See below.</p>
<p><img src="images/mac-ping-ttl.png" alt="img"></p>
<h2 id="telnet"><code>telnet</code></h2>
<h2 id="nmap"><code>nmap</code></h2>
<blockquote>
<p>On the same network, <code>nmap</code> sends ARP requests, by default -&gt; device discovered <code>nmap --send-ip</code></p>
</blockquote>
<p>Target ports are in random order.</p>
<h3 id="-rtfm">ğŸ“• RTFM</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">nmap -oG -sn 10.0.0.0/24 output1 <span class="o">&amp;&amp;</span> cat output1 <span class="p">|</span> grep Up <span class="p">|</span> cut -f2 -d<span class="s2">&#34;/&#34;</span> &gt; output2 <span class="c1"># oG - produce grepable results</span>
</span></span><span class="line"><span class="cl">nmap -sT -iL output3 -p <span class="m">80</span> <span class="c1"># -iL resolve domain names</span>
</span></span></code></pre></div><h2 id="hping"><code>hping</code></h2>
<blockquote>
<p>Many firewalls drop packets with no timespans, so <code>hping -S &lt;IP&gt; -p 80 --tcp-timestamp</code></p>
</blockquote>
<h2 id="-references">ğŸ“š References</h2>
<details>
    <summary>Expand&hellip;</summary>
    <h3 id="1">1</h3>
<p>More information about the different OS and their TTL  - <a href="https://subinsb.com/default-device-ttl-values/">https://subinsb.com/default-device-ttl-values/</a>, <a href="https://jonathansblog.co.uk/os-detection-techniques">https://jonathansblog.co.uk/os-detection-techniques</a>, <a href="https://ostechnix.com/identify-operating-system-ttl-ping/">https://ostechnix.com/identify-operating-system-ttl-ping/</a>
</details>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.302a6fc365d5139fb98cf60bdb8f715d96257ea189161d36c190ccfa8182e569.js"></script>
  

  
  
  
    
  


</body>

</html>
