<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📚 DNS - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/attacks/network/protocols/asp/"> 👈🏼 Back to </br> 📚 Session, Presentation, Application Layer </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#attacks-and-misuse">Attacks and Misuse</a>
      <ul>
        <li><a href="#dns-aplification">DNS Aplification</a></li>
        <li><a href="#dns-fast-flux">DNS Fast Flux</a></li>
        <li><a href="#dns-command-injection">DNS Command Injection</a>
          <ul>
            <li><a href="#type-1">Type 1</a></li>
            <li><a href="#type-2">Type 2</a></li>
          </ul>
        </li>
        <li><a href="#dns-snipping">DNS Snipping</a></li>
        <li><a href="#cybersquatting">Cybersquatting</a></li>
        <li><a href="#domain-hijacking">Domain hijacking</a></li>
        <li><a href="#dns-sinkhole">DNS sinkhole</a></li>
        <li><a href="#dns-poisoning-spoofing">DNS poisoning (spoofing)</a></li>
        <li><a href="#dns-redirection">DNS redirection</a></li>
        <li><a href="#dns-cache">DNS Cache</a></li>
        <li><a href="#dns-leak">DNS Leak</a></li>
        <li><a href="#dns-zone-transfer">DNS Zone transfer</a></li>
        <li><a href="#dns-rebinding">DNS rebinding</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">📚 DNS</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      

      
      

      
    </div>
    
    <b>Created:</b> 18.11.2020
    <br />

    

  </header>


  <div class="content" itemprop="articleBody">
    <p><strong>D</strong>omain <strong>N</strong>ame <strong>S</strong>ystem. Translates IPs to domain names like <code>192.168.1.1</code> to <code>router.lan</code> and visa versa.</p>
<p>DNS querying can be either recursive or non-recursive.</p>
<p><strong>Recursive</strong>. ISP DNS server queries other DNS servers until it finds the answer. Once it&rsquo;s found, it&rsquo;s returned by the ISP DNS to the client.</p>
<p><strong>Non-recursive</strong>. ISP DNS is not involved? Response comes directly from the DNS server queried the last. So, who has asked initially, would be shown in the last DNS server&rsquo;s logs 📝.</p>
<p>Works on port 53 (usually, UDP, but TCP could also be used in some cases).</p>
<h2 id="attacks-and-misuse">Attacks and Misuse</h2>
<h3 id="dns-aplification">DNS Aplification</h3>
<p>Use a public DNS server to flood the victim with DNS replies. Requires a botnet, each bot sending a DNS request with a spoofed IP (the victim&rsquo;s IP).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">nmap -sU -p53 -sV --script<span class="o">=</span>dns-recursion.nse IP
</span></span></code></pre></div><h3 id="dns-fast-flux">DNS Fast Flux</h3>
<p>Used by botnets to hide phishing and malware delivery sites behind dynamic network of compromised hosts acting as proxies.</p>
<h3 id="dns-command-injection">DNS Command Injection</h3>
<h4 id="type-1">Type 1</h4>
<h4 id="type-2">Type 2</h4>
<h3 id="dns-snipping">DNS Snipping</h3>
<p>If, for example, example.com has expired and was not prolonged in time, the attacker could buy this domain and use for malicious activity.</p>
<h3 id="cybersquatting">Cybersquatting</h3>
<p>Some hacker Eve buys a domain that looks a lot like a legit <code>example.com</code>, for example, <code>examp1e.com</code>. Eve than posts some crap and the owner of <code>example.com</code> will have to deal with the reputation damage.</p>
<h3 id="domain-hijacking">Domain hijacking</h3>
<p>Domain theft usually due to the registrant abuse.</p>
<h3 id="dns-sinkhole">DNS sinkhole</h3>
<p>This technique is actually often used by the blue teamers to handle malware&rsquo;s DNS requests and redurect them to some fake server in order to win some time and perform a throurough investigation while the malware thinks everything is ok.</p>
<h3 id="dns-poisoning-spoofing">DNS poisoning (spoofing)</h3>
<ol>
<li>Local host can be tampered with.</li>
<li>Local DNS daemon/service could be tampered with (like DNS <code>GetCacheDataTable</code> from <code>dnsapi.dll</code>, RPC to <code>dnscache.dll</code> <code>svchost.dll</code>).</li>
<li>Change the file on the DNS server itself.</li>
</ol>
<h3 id="dns-redirection">DNS redirection</h3>
<p>In case a malware beacons to its server via DNS, you have two options to trick it:</p>
<ul>
<li>tamper the hosts file</li>
<li>run a local DNS service that&rsquo;s going to resolve the requested domain names to the IP addresses of your choice.</li>
</ul>
<h3 id="dns-cache">DNS Cache</h3>
<p>Windows</p>
<h3 id="dns-leak">DNS Leak</h3>
<p>See <a href="/docs/reference/network/net-anon#dns-leaks">here</a>.</p>
<h3 id="dns-zone-transfer">DNS Zone transfer</h3>
<p>What&rsquo;s a zone? Picture and explanation.</p>
<p>There are usually two or more DNS servers. One is the master, the others are slaves. What it actually means is that master is updated, replying to requests. Slaves act as backup in case something happens to the data on the master DNS server. Master syncs with the slave from time to time. What the master sends to a slave is called a zone file. It contains the mapping of domain names and IP addresses that is used when people are trying to resolve domain names.</p>
<p>If the DNS settings are wrong and allow a trird-party to upload a zone file, the DNS server could be compromised and redirect people to the wrong servers.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">perl fierce.pl -dns example.com -wordlist rocky_you.txt <span class="c1"># The script is used for DNS reconnaissance and network mapping. In this case, it is instructed to perform a DNS enumeration on the domain `example.com` using a wordlist file called `rocky_you.txt`.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">dig @ns1.google.com axfr <span class="c1"># This line uses the `dig` command-line tool to perform a DNS zone transfer (AXFR) against the DNS server at `ns1.google.com`. A zone transfer allows retrieving the complete DNS records for a specific domain from the authoritative DNS server.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">host -l google.com ns1.google.com <span class="c1"># This line uses the `host` command-line tool to perform a DNS zone transfer (AXFR) against the DNS server at `ns1.google.com`. It requests a zone transfer for the domain `google.com` using the `-l` option.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">nslookup server authoritative_IP <span class="p">&amp;</span> <span class="nb">set</span> <span class="nv">type</span><span class="o">=</span>any <span class="p">&amp;</span> ls -v example.com <span class="c1"># This line utilizes the `nslookup` command-line tool to interact with a DNS server. It first sets the DNS server to `server authoritative_IP` (replacing `authoritative_IP` with the actual IP address of an authoritative DNS server). Then, it sets the query type to `any` using the `set type=any` command. Finally, it lists all the resource records (including hidden ones) for the domain `example.com` using the `ls -v` command.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">dig @127.0.0.1 example.com ns <span class="c1"># This line uses the `dig` command-line tool to query the DNS server running on `127.0.0.1` (localhost) for the nameserver (NS) records of the domain `example.com`. It fetches the authoritative nameservers responsible for the domain.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">dig server_name_or_IP ptr <span class="c1"># This line uses the `dig` command-line tool to perform a reverse DNS lookup (PTR) for a given `server_name_or_IP`. It retrieves the reverse DNS record associated with the provided server name or IP address.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">dnschef --interface<span class="o">=</span>127.0.0.2 --fakeip<span class="o">=</span>98.98.98.98 --fakedomains<span class="o">=</span>googel.com <span class="c1"># This line executes the `dnschef` tool, which is a DNS proxy server used for DNS spoofing and manipulation. It starts `dnschef` with the specified configuration, where DNS requests are intercepted on interface `127.0.0.2`, and any requests for the domain `googel.com` will be spoofed to resolve to the fake IP address `98.98.98.98`.</span>
</span></span></code></pre></div><h3 id="dns-rebinding">DNS rebinding</h3>
<p>It allows bypassing the SOP policy. It involves exploitation of a routing devices.</p>
<ol>
<li>Force the user to visit <code>hacker.com</code>. He resolves hacker.com to <code>123.456.789.12</code> where this entry has a <code>TTL</code> set to a small value like <code>1</code> (will expire soon).</li>
<li>Run JS on the client that constantly sends requests to <code>hacker.com/config</code>.</li>
<li>TTL expires, client sends request again but now hacker&rsquo;s DNS resolves to the victim&rsquo;s local address <code>192.168.1.1</code> (usually assigned to routers).</li>
<li>Victim sends a request for <code>hacker.com/config</code> which is resolves now to a local addres and is basically the following: <code>192.168.1.1/config</code>.</li>
</ol>
<h2 id="references">References</h2>
<p>[<a href="https://2019.phdays.com/en/program/reports/once-upon-a-time-in-the-west-a-story-about-dns-attacks/">1</a>] Once upon a time in the West: a story about DNS attacks</p>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.302a6fc365d5139fb98cf60bdb8f715d96257ea189161d36c190ccfa8182e569.js"></script>
  

  
  
  
    
  


</body>

</html>
