<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Host-based IDP/IPS - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/defense/"> 👈🏼 Back to </br> 🛡 Defence Mechanisms </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#tripwire">Tripwire</a></li>
    <li><a href="#ossec">OSSEC</a></li>
    <li><a href="#samhain">Samhain</a></li>
    <li><a href="#centralized-logging">Centralized logging</a></li>
    <li><a href="#logwatch">LogWatch</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Host-based IDP/IPS</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      
      <div class="article-category">
          
            
            
              <i class="fab fa-linux"></i>
            
            
            
            
            
          
          
      </div> <br />
      

      
      <div class="article-category">
        <i class="fas fa-tools"></i>
          
          
          <a class="platform-link" href="/tools/tripwire">Tripwire</a> 
          
           , 
          <a class="platform-link" href="/tools/ossec">OSSEC</a> 
          
           , 
          <a class="platform-link" href="/tools/samhain">Samhain</a> 
          
           , 
          <a class="platform-link" href="/tools/logwatch">LogWatch</a> 
          
      </div> <br />
      
      

      
    </div>
    
    <b>Created:</b> 28.07.2022
    <br />

    

  </header>


  <div class="content" itemprop="articleBody">
    <p>Host-based IDS look for local system configurations and behaviour, while network-based IDS look for network connections and looks for anomalies and common signatures.</p>
<p>IDS and IPS as firewall&rsquo;s filters. There are Control Plane (looks after the OS and routing table) and the Forwarding Plane (makes decisions on routing and discarding). If something happens to the Control Plane, the device will still forward the traffic (really???).</p>
<p>By default IDS only <strong>listens 👂</strong> the traffic. It&rsquo;s usually connected to the span port on a switch. Looks for anomalies and sends alerts. Won&rsquo;t take any actions by default, but can be configured in such a way. If the IDS is down, nothing is changed for the rest of the network, it&rsquo;s still operating.</p>
<p>IPS takes actions on its own. It is not connected to the span port, but rather is a gateway. Before it inspects and allows a packet through, nothing can move forward. So, if IPS is down, everyone is down (unless there is some load balancing enabled or may be some policy for such cases). Positioned right after the router, edge device or a firewall.</p>
<h2 id="tripwire">Tripwire</h2>
<p>Uses a mail server to send alerts. So, a mail server also has to be installed. Keeps its logs and configs in <code>/etc/tripwire</code>.</p>
<p>To install: <code>apt-get install tripwire</code>. Answer <code>yes</code> to all questions promted. <code>/etc/tripwire/twcfg</code> - is a config file. <code>twpol</code> - list of files to watch for. Determines, whether critical files have changed. <code>tw.pol</code>, <code>tw.cfg</code> - are the files produced after compilation of the previously mentioned ones.</p>
<p><code>twadmin --create-cfgfile --cfgfile tw.cfg.enc --site-keyfile site.key twcfg.txt</code>:</p>
<ul>
<li><code>--create-cfgfile</code> - create config file, <code>--cfgfile tw.cfg.enc</code>   to specify the file to create</li>
<li><code>--site-keyfile site.key</code> - key to use</li>
<li><code> twcfg.txt</code> file to use</li>
</ul>
<p>Now, creating a policy:</p>
<p><code>twadmin --create-polfile --cfgfile tw.cfg.enc --polfile tw.pol.enc --site-keyfile site.key twpol.txt</code>:</p>
<ul>
<li><code>--create-polfile</code> - create policy file, <code>--cfgfile tw.cfg.enc</code>   to specify the configuration file to use,</li>
<li><code>--polfile tw.pol.enc</code> - the policy file to create</li>
<li><code>--site-keyfile site.key</code> - key to use</li>
<li><code> twpol.txt</code> file to use</li>
</ul>
<p>Initialize the database:</p>
<p><code>tripwire --init --cfgfile tw.cfg.enc --polfile tw.pol.enc --site-key site.key --local-keyfile local.key</code></p>
<p>To check the system for any critical files changes: <code>tripwire --check</code>.</p>
<p>All these files need to be updates everytime you make changes to the policy or the configuration. The database needs to be updated as well.</p>
<h2 id="ossec">OSSEC</h2>
<p>Not just integrity checking (like Tripwire), but also some additional checking. It performs logs analysis and rootkit checking + process monitoring. Consists of two parts: a server and an agent. Server can only be installed on Linux, while an agent can also be installed on Windows.</p>
<p><strong>Install the server</strong></p>
<p><code>tar -xfv ossec-hids-version.tar.gz &amp;&amp; cd ossec-hids-version</code> to unpack the files.</p>
<p>To start: <code>/etc/init.d/ossec start</code>.</p>
<p><strong>Install the agent</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> /var/ossec/bin
</span></span><span class="line"><span class="cl">./manage_agents
</span></span><span class="line"><span class="cl">&gt; a
</span></span><span class="line"><span class="cl">&gt; some IP
</span></span><span class="line"><span class="cl">&gt; y
</span></span><span class="line"><span class="cl">&gt; e <span class="c1"># extract the key</span>
</span></span><span class="line"><span class="cl">&gt; <span class="m">001</span> <span class="c1"># agent id, copy the key</span>
</span></span></code></pre></div><p>Install it on the Windows machine (for example). Now, connect to the server. On the server go to <code>cd ../logs &amp;&amp; less ossec.log</code>. You can <code>cd alerts</code> and see the alerts.</p>
<h2 id="samhain">Samhain</h2>
<p><code>apt install samhain &amp;&amp; cd /etc/samhain</code>. Open the config file.</p>
<p><code>samhain -t init -p info</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">vi /etc/samhain/samhainrc
</span></span></code></pre></div><p>In this file go to the Trusted User option and type something like the following: <code>TrustedUser = 104</code>. Then run <code>samhain -t update</code>.</p>
<p><strong>To run</strong></p>
<p><code>samhain -t check</code> then <code>cd /var/log/samhain</code> and open the <code>samhain-init.log</code> and <code>samhain.log</code>.</p>
<h2 id="centralized-logging">Centralized logging</h2>
<p>Open a syslog file. Each system might have a sligtly different name for these. For example: <code>nano /etc/rsyslog.conf</code>. Uncomment the line for UDP syslog reception. And for the clients now to log remotely to this machine, need to go through <del>hell</del> <code>/etc/rsyslog.d/ &amp;&amp; nano 50-default.conf</code>. Add something like <code>*.* 	@@IP:port</code> to log everything remotely.</p>
<h2 id="logwatch">LogWatch</h2>
<p><code>apt install logwatch</code></p>
<p>Reads all the logs and generates a summary.</p>
<p><code>cd /etc/logwatch</code>, <code>cd /usr/share/logwatch</code>. The configs in this folder will overwrite the configs from   <code>cd /etc/logwatch</code>.</p>
<p><code>logwatch.conf</code> - is the general config file. Separately, there is a folder with lots of file, each for each specific log.</p>
<h2 id="references">References</h2>
<details>
    <summary>Expand&hellip;</summary>
    <p>IBM Coursera, Network Security &amp; Database Vulnerabilities</p>
<p>[<a href="https://learning.oreilly.com/videos/understanding-intrusion-detection/9781491962701/9781491962701-video256435/">1</a>] Understanding Intrusion Detection Systems with Ric Messier (O&rsquo;Reilly website)</p>
<p>[<a href="https://danielmiessler.com/study/tcpdump/">2</a>] tcmpdump tutorial</p>
<p>[<a href="https://www.secureauth.com/labs/open-source-tools/impacket/">3</a>] About impacket</p>

</details>
  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.bafc052229b4b40bf03c477d31c5cdd9352ece8afbadf35ab97ed14495098fc9.js"></script>
  

  
  
  
    
  


</body>

</html>
