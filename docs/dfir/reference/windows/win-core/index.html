<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Windows Core Processes - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.9d91cbb32c96c334ae7b38c3d99d30727e0836e1182125cc5f007d215f0b9e59.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-forensics ğŸ” and incident response ğŸ¥·">
      <a href="/docs/dfir">
        <span>Forensics ğŸ” and Incident Response ğŸ¥·</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-notes ğŸ“">
      <a href="/docs/notes">
        <span>Notes ğŸ“</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-forensics ğŸ” and incident response ğŸ¥·">
      <a href="/docs/dfir">
        <span>Forensics ğŸ” and Incident Response ğŸ¥·</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-notes ğŸ“">
      <a href="/docs/notes">
        <span>Notes ğŸ“</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/reference/windows/"> Back to ğŸ“š Windows Analysis Reference Section ğŸ‘ˆğŸ¼ </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#main-processes">Main Processes</a>
      <ul>
        <li><a href="#idle-or-system-idle-process">IDLE or System Idle Process</a></li>
        <li><a href="#system">System</a></li>
        <li><a href="#memory-compression">Memory Compression</a></li>
        <li><a href="#smssexe"><code>smss.exe</code></a></li>
        <li><a href="#winlogon"><code>winlogon</code></a></li>
        <li><a href="#wininit"><code>wininit</code></a></li>
        <li><a href="#lsass"><code>lsass</code></a></li>
        <li><a href="#svchost"><code>svchost</code></a></li>
      </ul>
    </li>
    <li><a href="#malware-identification">Malware Identification</a>
      <ul>
        <li><a href="#name-mangling">Name Mangling</a></li>
        <li><a href="#parent">Parent</a></li>
        <li><a href="#image-file-path">Image File Path</a></li>
        <li><a href="#singleton">Singleton</a></li>
        <li><a href="#account">Account</a></li>
        <li><a href="#boot-time">Boot Time</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
 </div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Windows Core Processes</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      
      
      <div class="article-category">
          
            
              <i class="fab fa-windows"></i>          
            
            
            
            
            
          <a class="platform-link" href="/platforms/windows">windows</a>
          
      </div> <br />
      

      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <p><em>There are two broad categories of Windows core processes. Processes that initialize system environment and those that initialize the user environment. Whatever is the category, you need to know them well in order to detect abnormal things.</em></p>
<h2 id="main-processes">Main Processes</h2>
<p>Below is the overview of the main processes in Windows. There are several core process that are important to examine since malware often drool ğŸ¤¤ over them.</p>
<p><img src="images/process-tree.png" alt="process-tree"></p>
<h3 id="idle-or-system-idle-process">IDLE or System Idle Process</h3>
<p><strong>Parent</strong> ğŸ¤±: None.</p>
<p><strong>Children</strong> ğŸ‘§ :  None</p>
<p>The first and the most importnat process that &ldquo;gives birth&rdquo; to other processes - <code>IDLE</code>. ğŸ” It <strong>doesn&rsquo;t have an image file on disk</strong>, so if you see <code>IDLE.exe</code>, it is most likely a malware ğŸ¦  (or you have been sophisticatedly pranked ğŸ˜‰).</p>
<blockquote>
<p>ğŸ” Are <code>IDLE</code> and <code>System Idle Process</code> the same thing?</p>
<p>ğŸ§ª If I dump a process that doesn&rsquo;t have an image file, will it still have a PE header?</p>
</blockquote>
<p>Runs in system memory space.</p>
<h3 id="system">System</h3>
<p>Handles kernel mode system threads, different device drivers, waiting for I/O etc.</p>
<p>Runs in system memory space.</p>
<h3 id="memory-compression">Memory Compression</h3>
<p>Compresses the memory of the user space. Doesn&rsquo;t have an image file on disk. Not really interesting for DFIR.</p>
<h3 id="smssexe"><code>smss.exe</code></h3>
<p>Session manager process. The first user-mode process. Run from <code>System32</code> directory. There are two instances:</p>
<ul>
<li><strong>master instance</strong> perfroms some init stuff. Reads and writes to registry preparing the OS for use. Initializes the registry hives</li>
<li>session startup instance. Creates three subsystem processes and exits: csrss.exe,</li>
</ul>
<h3 id="winlogon"><code>winlogon</code></h3>
<p>Another process of particilar interest is <code>msc</code>.</p>
<h3 id="wininit"><code>wininit</code></h3>
<h3 id="lsass"><code>lsass</code></h3>
<p><code>lsass</code>. This is the main process of Windows OS that&rsquo;s responsible for authentication and authorisation. More about lsass <a href="/docs/dfir/host/windows/win-lsa">here</a>.</p>
<h3 id="svchost"><code>svchost</code></h3>
<p><code>svchost</code>. ğŸ¦  This one is very ofter used by malware for disguise. It has lot&rsquo;s of instances.</p>
<p>The process tree now looks like this:</p>
<ul>
<li>IDLE</li>
<li>System (PID 4).
<ul>
<li>Memory Compression</li>
</ul>
</li>
</ul>
<h2 id="malware-identification">Malware Identification</h2>
<h3 id="name-mangling">Name Mangling</h3>
<p>There are several techniques applied to these core processes for persistence and escalation. The first one used quite often at least in the past, is to misspell the core process so that it would not be so obviously malicous. The most common target for that trick is <code>svchost</code>: <code>scvhost</code>, for example. Do you see the difference? Would you have noticed it at the first glance when reviewing the processes in the Task Manager?</p>
<h3 id="parent">Parent</h3>
<p>On way to identify something malicious which is more obvious than name mangling is looking at the process parent.</p>
<h3 id="image-file-path">Image File Path</h3>
<p>âš ï¸ Some core process do not have an actual file on disk! Another way - to look at the path of the process. Most core processes run from <code>System32</code> directory.</p>
<p>Processes that don&rsquo;t have an image file on disk:</p>
<ul>
<li><code>IDLE</code></li>
<li><code>Memory compression</code></li>
</ul>
<p>Processes run from <code>System32</code>:</p>
<ul>
<li><code>smss.exe</code></li>
<li></li>
</ul>
<h3 id="singleton">Singleton</h3>
<p><strong>Singleton</strong> - one instance running only. One instance <code>lsass</code>, <code>services</code>, <code>System</code>, <code>winint</code>, <code>lsm.exe</code> â“. If any of these having more than 1 process should be the object of further investigation.</p>
<h3 id="account">Account</h3>
<p>Check the account it being run from. The most commonly used are: local system account, network service account, local service account. If any of the core processes is run from a user account, it&rsquo;s a possible sign of compromise.</p>
<h3 id="boot-time">Boot Time</h3>
<p>Check the boot time.</p>
<h2 id="references">References</h2>
<p>[<a href="">1</a>] SDF Podcast, by Michael Leclair</p>
  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.1237ff71925bb8625c97a9af8db4c54525258bedfd7c47493daaff723bea755e.js"></script>
  

  
  
  
    
  


</body>

</html>
