<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DFIR Methodology - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting ğŸª¤">
      <a href="/docs/thunting">
        <span>Threat Hunting ğŸª¤</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference ğŸ“š">
      <a href="/docs/reference">
        <span>Tech Reference ğŸ“š</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting ğŸª¤">
      <a href="/docs/thunting">
        <span>Threat Hunting ğŸª¤</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference ğŸ“š">
      <a href="/docs/reference">
        <span>Tech Reference ğŸ“š</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/"> ğŸ‘ˆğŸ¼ Back to </br> Incident Investigation ğŸ” ğŸ¥· </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#techniques">Techniques</a></li>
    <li><a href="#-checklists">âœ… Checklists</a>
      <ul>
        <li><a href="#incident-response-sans">Incident Response (SANS)</a></li>
        <li><a href="#digital-forensics">Digital Forensics</a></li>
      </ul>
    </li>
    <li><a href="#-types-of-evidence-">ğŸ¾ Types of Evidence ğŸ‘£</a>
      <ul>
        <li><a href="#circumstantial">Circumstantial</a></li>
        <li><a href="#incontrovertible">Incontrovertible</a></li>
        <li><a href="#corroborating">Corroborating</a></li>
      </ul>
    </li>
    <li><a href="#common-activity-artefacts">ğŸºCommon Activity Artefacts</a>
      <ul>
        <li><a href="#secondary-artefacts">Secondary artefacts</a></li>
        <li><a href="#primary-artefacts">Primary Artefacts</a></li>
      </ul>
    </li>
    <li><a href="#-prioritising">ğŸ“ Prioritising</a></li>
    <li><a href="#-ir-methodology">ğŸ¥·ğŸ¼ IR Methodology</a>
      <ul>
        <li><a href="#detection-and-analysis-sans-identification">Detection and Analysis (SANS Identification)</a>
          <ul>
            <li><a href="#common-malicious-activity-detection-and-countermeasures">Common Malicious Activity, Detection and Countermeasures</a></li>
            <li><a href="#spillage">Spillage</a></li>
            <li><a href="#documentation">Documentation</a></li>
            <li><a href="#protected-data">Protected Data</a></li>
          </ul>
        </li>
        <li><a href="#containment-eradication-recovery">Containment. Eradication. Recovery.</a></li>
        <li><a href="#post-incident-activity-sans-lessons-learned">Post-Incident Activity (SANS Lessons Learned)</a></li>
        <li><a href="#cloud-ir-specifics">Cloud IR Specifics</a></li>
      </ul>
    </li>
    <li><a href="#--df-methodology">ğŸ”¬ ğŸ§ª DF Methodology</a>
      <ul>
        <li><a href="#collection">Collection</a>
          <ul>
            <li><a href="#documentation-1">Documentation</a></li>
          </ul>
        </li>
        <li><a href="#examination-and-analysis">Examination and Analysis</a>
          <ul>
            <li><a href="#prioritisation-and-process">Prioritisation and Process</a></li>
            <li><a href="#critical-thinking">Critical Thinking</a></li>
            <li><a href="#known-good">Known Good</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#tips">Tips</a>
      <ul>
        <li><a href="#how-to-prove-compromise">How to prove compromiseâ“</a></li>
        <li><a href="#how-to-prove-intent-">How to prove intent â“</a></li>
        <li><a href="#how-to-prove-user-awareness-">How to prove user awareness â“</a></li>
        <li><a href="#types-of-users">Types of Users</a>
          <ul>
            <li><a href="#dummy--vs-poopy-"><strong>Dummy</strong> ğŸ˜¬ vs <strong>Poopy</strong> ğŸ’©</a></li>
            <li><a href="#sheep--vs-others---and-"><strong>Sheep</strong> ğŸ‘ vs <strong>others</strong> ğŸ’©, ğŸ˜¬ and ğŸ¦“</a></li>
            <li><a href="#poopy--vs-donkey-"><strong>Poopy</strong> ğŸ’© vs <strong>donkey</strong> ğŸ¦“</a></li>
            <li><a href="#poopy--and-donkey--vs-others--and-"><strong>Poopy</strong> ğŸ’© and <strong>donkey</strong> ğŸ¦“ vs <strong>others</strong> ğŸ˜¬ and ğŸ‘</a></li>
          </ul>
        </li>
        <li><a href="#configuration-changes">Configuration Changes</a></li>
        <li><a href="#malware-analysis">Malware Analysis</a>
          <ul>
            <li><a href="#persistence-mechanisms">Persistence Mechanisms</a></li>
            <li><a href="#malware-evasion-techniques">Malware Evasion Techniques</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">DFIR Methodology</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      

      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <p><em>Basically, all of the artefacts listed in the Investigation section fall under the category &ldquo;user activity&rdquo; one way or another. Even if some process spawned some other process, somewhere in the past, user interaction was still required. That&rsquo;s why I find it so hard to find the perfect categorisation. I&rsquo;ve decided to devote this section to common strategies of how one would investigate user activity and which artefacts they would use at what point in time.</em></p>
<h2 id="techniques">Techniques</h2>
<p>There are a couple of techniques to use. This can be applied to everything: logs, dynamic malware analysis, user activity, folder activity, system events etc.</p>
<p>One of them is called &ldquo;<strong>Find Evil</strong>&rdquo; ğŸ‘¿. For this method, you need to know a baseline. It helps to run some collection for a clean system to see the baseline for this OS/setup if you are unsure. Otherwise, looking at the data, you might notice something standing out, like a Windows core process spawned from the wrong direction or an HTTP traffic flowing back and forth from a <code>java.exe</code>. Another example is something like a suddenly increased number of server requests could indicate nefarious activity. Again, you need to know the baseline to tell if something is wrong.</p>
<p>ğŸ›  Typically, this kind of stuff (spikes) is picked up by the IDS/IPS/WAF systems quite neatly.
ğŸ—’ TODO: <a href="https://www.open-scap.org/security-policies/scap-security-guide/">https://www.open-scap.org/security-policies/scap-security-guide/</a>.</p>
<p>A little more sophisticated &ldquo;Find Evil&rdquo; technique is what I call <strong>behavioural analysis</strong>. For this method, you must think like an attacker and a regular user. For example, for everyday use, the failed login process would look something like the following:</p>
<ul>
<li>First login attempt - error</li>
<li>Second login attempt - error</li>
<li>Third login attempt - error</li>
<li>Reset password</li>
<li>Login</li>
</ul>
<p>For a malicious user, it would be something like (brute-forcing):</p>
<ul>
<li>First login attempt - error</li>
<li>Second login attempt - error</li>
<li>N-login attempt - account blocked</li>
<li>Sleep for N minutes</li>
<li>M-login attempt - error</li>
<li>etc</li>
</ul>
<p>For a malicious user attempting password spraying attack (when one password is used for different accounts), you are likely to do something like the following:</p>
<ul>
<li>First login attempt - error</li>
<li>Second login attempt - error</li>
<li>Third login attempt - error</li>
<li>Stop (no successful login or password reset)</li>
</ul>
<p>Another technique is called <strong>frequency analysis</strong> ğŸ“Š. Depending on the system, you&rsquo;d look either for something more or less frequent. Covering all the cases is hard, but maybe some examples will do the trick. For example, you have a web server. Most of the time, with regular traffic and no malicious activity, there would be 200 status codes returned by the server. However, if an attacker performs a brute force attack against user accounts or IDOR probing, you would see a spike in the 403 (access denied) HTTP status code. If the attacker were to perform some directory busting, you would probably see a point in 404.</p>
<p>ğŸ›  SIEM/IDS + ML (machine learning engine) could help identify those &ldquo;unusual things&rdquo;. Some SIEM would allow making rules based on different log fields. So, for example, in the above scenario, one could create a rule to alert the CSIRT if a 100 threshold for 404 HTTP status code returned is hit in 1 minute.</p>
<p>One more technique that I have been using I call <strong>pattern analysis</strong>. This one needs to be VERY knowledgeable about red teaming activities and current vulnerabilities. Refrain from overwhelming yourself with the openness and exploits out there, and filter the news and feeds only to show those relevant to your environment. For example, see only Apache Tomcat stuff, PHP and nginx + common web application vulnerabilities. Patterns for each vulnerability exploited would be different, of course. For example, for an SQLi, it&rsquo;s something like a single quote (<code>'</code>) or <code>sleep</code> keyword (also could be an indicator of command line injection) or some other pattern like <code>'or%201=1--</code> or anything from <a href="https://github.com/payloadbox/sql-injection-payload-list">list</a> and even more. You can find the list of payloads (designs) for common vulnerabilities online to get a general idea.</p>
<p>ğŸ›  For post-incident analyses, I find it helpful to use Excel/Numbers due to their advanced pivoting and filtering functionality. It&rsquo;s useful for both frequency and pattern analysis. This, however, will only work for offline analysis and only on data that&rsquo;s not too overwhelming. If you are familiar with the querying language, SIEM tools can also be convenient for visualisation and filtering.</p>
<p>So, knowing the red team operations, possible attacks on your infrastructure, and standard user behaviour is helpful.</p>
<p><strong>Stacking</strong>. It&rsquo;s not a separate technique per se, rather it referes to the analysis of a bunch of systems. You would use either of the techniques above for a BUNCH of systems. Frequency analysis is usually the first one to go. Items that appear few times, or seen on one system only usually stand out.</p>
<h2 id="-checklists">âœ… Checklists</h2>
<h3 id="incident-response-sans">Incident Response (SANS)</h3>
<details>
    <summary>See the full checklist&hellip;</summary>
    <ul>
<li><input disabled="" type="checkbox"> ğŸ¥’ Preparation
<ul>
<li><input disabled="" type="checkbox"> ğŸ“ <strong>Compile</strong> a list of all your assets (servers, networks, applications etc.)</li>
<li><input disabled="" type="checkbox"> ğŸ“ˆ <strong>Rank</strong> them by the level of importance.</li>
<li><input disabled="" type="checkbox"> ğŸ‘ <strong>Monitor</strong> their traffic patterns and create baselines.</li>
<li><input disabled="" type="checkbox"> ğŸ«‚ Create a <strong>communication plan</strong> (who to contact, how, and when based on each incident type). <strong>Incident Handler Communications and Facilities</strong> (contacts, on-call info, reporting mechanism, issue tracking, smartphones, encryption soft, war room, secure storage).</li>
<li><input disabled="" type="checkbox"> ğŸš§ Determine which security events and at what <strong>thresholds</strong> should be investigated.</li>
<li><input disabled="" type="checkbox"> ğŸ“– Create one <strong>incident response plan</strong> and playbooks for each type of incident that are most likely to happen or can inflict the most damage.</li>
<li><input disabled="" type="checkbox"> ğŸ“– Create an <strong>Incident Response Policy</strong>.</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> Identification (ğŸ”¬ğŸ§ª  DF *)
<ul>
<li><input disabled="" type="checkbox"> ğŸš¨ <strong>Discover</strong>. Discovery and classification (Where is the sensitive data?), Entitlements reporting (Who can access), Vulnerability Assessment (How to secure it?).</li>
<li><input disabled="" type="checkbox"> ğŸ” <strong>Investigate</strong>.</li>
<li><input disabled="" type="checkbox"> â›“ <strong>Harden</strong>. Reconfigure, mask, encrypt (How to protect sensitive data?)</li>
<li><input disabled="" type="checkbox"> ğŸ‘€ ğŸ—¡ <strong>Monitor and Protect.</strong> Activity monitoring, Blocking quarantine, dynamic data masking</li>
<li><input disabled="" type="checkbox"> <strong>Repeat</strong>.</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> Containment (ğŸ”¬ğŸ§ª  DF *)</li>
<li><input disabled="" type="checkbox"> Eradication (ğŸ”¬ğŸ§ª  DF *)</li>
<li><input disabled="" type="checkbox"> Recovery (ğŸ”¬ğŸ§ª  DF *)</li>
<li><input disabled="" type="checkbox"> Lessons Learnt (ğŸ”¬ğŸ§ª  DF *)</li>
</ul>
<blockquote>
<p>ğŸ”¬ğŸ§ª Digital Forensics process can take place at any stage of the incident response process.</p>
</blockquote>

</details>
<h3 id="digital-forensics">Digital Forensics</h3>
<details>
    <summary>See the full checklist&hellip;</summary>
    <ul>
<li><input disabled="" type="checkbox"> ğŸ¤” Identification/Assessment (aka <strong>Preparation</strong>)
<ul>
<li><input disabled="" type="checkbox"> Define <strong>scope</strong></li>
<li><input disabled="" type="checkbox"> <strong>Sterilise</strong> the target media (more <a href="https://bakerst221b.com/docs/dfir/investigation/collection/#sterilising-target-media">here</a>)</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> ğŸ§¹ <strong>Collection</strong>
<ul>
<li><input disabled="" type="checkbox"> ğŸƒğŸ¼ <strong>First response</strong>
<ul>
<li><input disabled="" type="checkbox"> <strong>Sanitise</strong> the target disk that will be used to copy evidence to</li>
<li><input disabled="" type="checkbox"> Prepare all the <strong>toolkits</strong> that will be needed.</li>
<li><input disabled="" type="checkbox"> Start filling out the <strong>Chain of Custody</strong> form; each piece of evidence is assigned a unique ID (see below for examples).</li>
<li><input disabled="" type="checkbox"> All <strong>photos</strong> were taken before touching the scene.</li>
<li><input disabled="" type="checkbox"> Ensure that the Internet, Bluetooth, and AirDrop are <strong>all turned off</strong> on the machine used to acquire the image (* in case of physical acquisition).</li>
<li><input disabled="" type="checkbox"> Connect the <strong>write blocker</strong> to the PC, and the evidence drive to the write blocker (power + data cables) or launch a software write blocker on the acquirer machine (see below for how-to) (* in case of physical acquisition).</li>
<li><input disabled="" type="checkbox"> Calculate <strong>the hash of the evidence drive</strong> (pre-hash). Document it.</li>
<li><input disabled="" type="checkbox"> Image the evidence.</li>
<li><input disabled="" type="checkbox"> Calculate the <strong>hash of the original evidence</strong> again, validate the hash and document it.</li>
<li><input disabled="" type="checkbox"> Calculate the **hash of the image taken (post-hash) and ensure it matches the above ones taken previously.</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> ğŸ¤ğŸ¼ <strong>Acquisition</strong> (live or dead)
<ul>
<li><input disabled="" type="checkbox"> Physical storage
<ul>
<li><input disabled="" type="checkbox"> Volume analysis. <strong>Volume</strong> - a collection of storage locations.
<ul>
<li><input disabled="" type="checkbox"> File System</li>
<li><input disabled="" type="checkbox"> DB</li>
<li><input disabled="" type="checkbox"> Swap space</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> Memory analysis</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> Logical backup</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> ğŸ—³ Evidence <strong>Preservation</strong>
<ul>
<li><input disabled="" type="checkbox"> Copy original, operate on the copy.</li>
<li><input disabled="" type="checkbox"> Calculate <strong>hashes</strong> at each stage (unless it&rsquo;s cloud evidence)</li>
<li><input disabled="" type="checkbox"> Use hardware <strong>write-blockers</strong> or software write-blockers</li>
<li><input disabled="" type="checkbox"> Make sure <strong>min number of files</strong> is created.</li>
<li><input disabled="" type="checkbox"> Register <strong>timestamps</strong> before opening files.</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> ğŸ“‡ <strong>Documentation</strong>.</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> ğŸ”¬ğŸ§ª  <strong>Examination &amp; Analysis</strong>
<ul>
<li><input disabled="" type="checkbox"> ğŸ¦  Malicious Process
<ul>
<li><input disabled="" type="checkbox"> Network</li>
<li><input disabled="" type="checkbox"> Files</li>
<li><input disabled="" type="checkbox"> Processes</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> ğŸ‘¥ User
<ul>
<li><input disabled="" type="checkbox"> Is there malicious user activity (account takeover, insider threat)?</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> âš™ï¸ OS Configs
<ul>
<li><input disabled="" type="checkbox"> Are there mal configs (services enabled, disabled logging)?</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> ğŸ—œ Hardware
<ul>
<li><input disabled="" type="checkbox"> Are there mal hardware changes (firmware, BIOS)?</li>
</ul>
</li>
</ul>
</li>
</ul>

</details>
<h2 id="-types-of-evidence-">ğŸ¾ Types of Evidence ğŸ‘£</h2>
<h3 id="circumstantial">Circumstantial</h3>
<blockquote>
<p>Circumstantial evidence refers to the collection of facts that, when considered together, can be used to infer a conclusion about malicious activity or a person involved. This type of evidence does not directly prove the fact in question but allows for the possibility of drawing inferences to establish the fact indirectly. Circumstantial evidence is often used in digital forensics and incident investigations when direct evidence is not available. Let&rsquo;s consider a scenario in which an organization suspects a data breach has occurred. They are trying to determine if an employee, John, is responsible for the breach. Direct evidence would be something like a security video showing John copying sensitive files onto a USB drive or an email sent by John admitting to the breach. Circumstantial evidence, on the other hand, would involve facts that indirectly suggest John&rsquo;s involvement. For example: Log files showing that John&rsquo;s user account accessed the sensitive files just before the data breach occurred. Records indicating that John&rsquo;s computer was connected to a USB drive around the same time the files were accessed. The breached files were found on a dark web marketplace, and the seller&rsquo;s account was linked to an email address similar to one John used for personal purposes. John had recently expressed dissatisfaction with the company and was looking for a new job. None of these individual facts directly prove that John is responsible for the data breach. However, when considered together, they create a strong circumstantial case suggesting John&rsquo;s involvement in the malicious activity. ChatGPT</p>
</blockquote>
<h3 id="incontrovertible">Incontrovertible</h3>
<blockquote>
<p>Incontrovertible evidence refers to evidence that is indisputable, irrefutable, or impossible to deny. It is so strong and compelling that it leaves no room for doubt or argument. In digital forensics, incontrovertible evidence may include things like unaltered log files, digital signatures, or cryptographic hashes that prove the integrity and authenticity of data. However, it is essential to note that it can be challenging to obtain incontrovertible evidence in digital forensics due to the potential for data manipulation or tampering.</p>
</blockquote>
<h3 id="corroborating">Corroborating</h3>
<blockquote>
<p>Corroborating evidence is additional evidence that supports or confirms the initial evidence or a fact in question. Corroborating evidence helps to strengthen the overall case by providing independent confirmation of the facts or findings. In digital forensics, corroborating evidence may include things like additional log files from different systems, witness statements, or even physical evidence that supports the digital evidence. The use of corroborating evidence is particularly important in digital forensics because it can help to establish the reliability and credibility of the findings and minimize the chances of false positives or inaccurate conclusions.</p>
</blockquote>
<h2 id="common-activity-artefacts">ğŸºCommon Activity Artefacts</h2>
<p>Below is the list of the most common artefacts that could be used to determine user activity. Some of them are mobile specific.</p>
<p>I&rsquo;ve devided them into two main groups: primary and secondary. Primary artefacts are those that are specifically designed to provide this information. For example, you can view contacts via address book or read SMS messages.</p>
<p>Secondary artefacts are like data lakes: they aggreagate lots sort of information that might or might not contain something relevant. In requires wits and analysis in order to retrieve something useful from there if anything is there. For example, to determine if a person knows another person, you could see their contact list (which is the easiest way). However, not all connections are added there. So, you&rsquo;d probably refer to mailing activity as well. The last resort would be to see photos and videos in order to find a familiar face. There is small chance to also find this information in some notes. For example, &ldquo;I met Julia Roberts yesterday on the tube! Imagine that!&rdquo; Some artefacts are listed both under secondary and primary sections since for some purposes they might be secondary. For example, social media is basically a very sophisticated address book + messages system. However, there are feeds there as well and as with all messages in general you sometime find something relevant there. For instance, if you are not sure if the person did work this day and check their social media page where there was a photo from a bar posted at 2pm on Thursday (too early, ey!), you might be relatively sure that no, the person was no at work that time.</p>
<h3 id="secondary-artefacts">Secondary artefacts</h3>
<ul>
<li>Notes</li>
<li>Voice assistant&rsquo;s logs</li>
<li>Browser activity</li>
<li>Photos, videos (local, online)</li>
<li>Screen or voice recordings</li>
<li>Calendar events</li>
<li>Music</li>
<li>Gaming</li>
<li>Social media</li>
</ul>
<h3 id="primary-artefacts">Primary Artefacts</h3>
<details>
    <summary>See all&hellip;</summary>
    <ul>
<li>ğŸ‘¥ Contacts and Connections
<ul>
<li>ğŸ“– Address book</li>
<li>ğŸ’¬ Messangers</li>
<li>ğŸ’¬ Social media</li>
<li>âœ‰ï¸ Mail</li>
<li>SMS/MMS</li>
<li>â˜ï¸ Call history (video, phone)</li>
</ul>
</li>
<li>ğŸ—º Geo posisition
<ul>
<li>Device IP</li>
<li>Traffic (if logged)</li>
<li>Social communications metadata</li>
<li>Maps applications</li>
<li>VPNs used (logs if any)</li>
<li>Photos and videos</li>
<li>Documents saved/downloaded/deleted/modified</li>
<li>Calendar events</li>
<li>Web browsing</li>
<li>Screen or voice recordings</li>
</ul>
</li>
<li>Computer Activity
<ul>
<li>System logs (logs, prefetch, events etc)</li>
<li>Documents saved/downloaded/deleted/modified/renamed/copied</li>
<li>Folders traversed</li>
<li>USB and other external media attached</li>
<li>Processes running/terminated/spawned</li>
<li>Encryption/wiping software usage</li>
<li>Shortcuts, symbolic links and links</li>
<li>Configuration files (etc, plist, registry)</li>
<li>Network connections opened/closed</li>
</ul>
</li>
</ul>

</details>
<h2 id="-prioritising">ğŸ“ Prioritising</h2>
<p>When reviewing processes and artefacts for potential maliciousness, I use the following list, where items are ordered by their likelihood of being malicious.</p>
<ol>
<li>Outstanding <code>exe</code> or bat <code>files</code> named with one digit or one letter like <code>a.ps1</code>, <code>1.bat</code>. <code>a.exe</code> etc.</li>
<li>Drivers that were installed recently or that I don&rsquo;t recognise.</li>
<li>Unfamiliar program names (google or ask ChatGPT to know more about the such program)</li>
<li>Familiar programs in unusual places</li>
<li>Programs that seem legit are in the expected folders (last resort).</li>
</ol>
<h2 id="-ir-methodology">ğŸ¥·ğŸ¼ IR Methodology</h2>
<p>For the most relevant scenarios, keeping playbooks and runbooks at your disposal is crucial. This will help you stay less stressed and be prepared for various outcomes. I have created a <a href="https://www.canva.com/design/DAFfIbPpEuo/Frhvq9uiLJssDby2MJtXJA/view?utm_content=DAFfIbPpEuo&amp;utm_campaign=designshare&amp;utm_medium=link2&amp;utm_source=sharebutton">high-level overview of potential playbooks</a> based on the MITRE ATTACK matrix, which includes guidelines for detection, investigation, and cleanup techniques. Runbooks, on the other hand, are highly detailed and technical instructions, such as &ldquo;How to reset an account password&rdquo; or &ldquo;How to change an AWS EC2 inline policy.&rdquo; One runbook can be referred to by several playbooks, which is perfectly fine. Consider playbooks as constructors with a relatively unique plan and runbooks as the specific steps linked to some or all of the described plan&rsquo;s stages. Below is a part of the table I have mentioned above.</p>
<p><img src="images/mitre-playbooks.png" alt="img"></p>
<p>Following the MITRE matrix, I have roughly divided the content into two different realms: infrastructure and applications. Each sticker represents two things simultaneously:</p>
<ol>
<li>ğŸ“˜ It&rsquo;s a playbook that needs to be followed if an incident occurs.</li>
<li>â“ It answers a question like &ldquo;How can the adversary get an initial foothold in the system?&rdquo; The answer would differ for each realm.</li>
</ol>
<p>Some playbooks have arrows pointing to other playbooks within one cell. This indicates that an investigation of a particular event might lead to another playbook. For example, while investigating a possibility that suggests a vulnerability in a system within the infrastructure was exploited, we might discover that the exposure was not in our system but in a vendor&rsquo;s system. This could lead to the investigation shifting to a different playbook more applicable to the vendor&rsquo;s system.</p>
<p>I am working on a framework (MITRE + the above table + Jupyter) for companies to establish which playbooks should be prioritised and developed. The way to go would be as follows:</p>
<ol>
<li>Define the infrastructure.</li>
<li>Go through the relevant MITRE matrix to understand potential risks.</li>
<li>Profile the potential adversary and align this profile with the MITRE matrix.</li>
<li>Using the table above, define playbooks of the highest priority.</li>
<li>In each playbook, describe the detection, investigation and cleanup flow for the most relevant TTPs.</li>
<li>Ensure a runbook provides technical details (links, scripts, etc.) for each playbook.</li>
</ol>
<h3 id="detection-and-analysis-sans-identification">Detection and Analysis (SANS Identification)</h3>
<p>Lots of systems can be used to monitor the network and host for malicious activity. These are IDS, IPS, firewalls, AV, SIEM (Security Information and Event Management solutions, SIM + SEM), IR frameworks, threat intelligence etc. However, the employee might report the incident (for example, receiving a suspicious email) or by a third party (data exfiltrated seen in the dark net). Before it is confirmed to be accurate or the result of malicious intent, it&rsquo;s called an <em>event</em>.</p>
<p><strong>Precursors</strong>â“ - signs that the incident <em>may</em> occur in the future. For example, logs show that a vulnerability scanner was used. Or a vulnerability was found in some software used by the company.</p>
<p><strong>Indicators</strong> ğŸš¨ - signs that an incident has occurred or is occurring. Malware detected by an anti-virus program, configurations changed, multiple failed logins etc.</p>
<p>Several techniques help confirm the incident. See the <code>Investigation -&gt; Methodology</code> section for more details.</p>
<ul>
<li><strong>Frequency analysis</strong>. Something that is outstandingly rare across systems might be malicious.</li>
<li>Average vs Evil behaviour. You know what&rsquo;s considered normal for the given system/user, and something unusual is a primary suspect for further analysis.</li>
<li><strong>IoC</strong>. Indicators of compromise, like some virus hashes or file extensions used by a known crypto malware.</li>
<li><strong>IoA or pattern analysis</strong>. Indicators of attack. Depending on the vulnerability/attack in place, these would be of some particular pattern. For example, you see some string like <code>&lt;script&gt;alert(1)&lt;/script&gt;</code> - it&rsquo;s probably an XSS attempt.</li>
</ul>
<p>For AWS - <a href="https://docs.aws.amazon.com/whitepapers/latest/aws-security-incident-response-guide/visibility-and-alerting.html">https://docs.aws.amazon.com/whitepapers/latest/aws-security-incident-response-guide/visibility-and-alerting.html</a></p>
<p>After the incident is confirmed, you initiate an investigation.</p>
<blockquote>
<p>ğŸ“ I found it quite hard to separate incident response and digital forensics articles from one another. For now, I see the incident response as a more general process that could require a more thorough examination (digital forensics) but not necessarily. As I see it, we have an event and start the IR process to determine whether it&rsquo;s malicious. Identify compromised hosts and map the artefacts to the ATCK MITRE framework. Then, to fully contain and remediate the incident, we call for DF, trying to analyse malware, analyse the registry on Windows, recover data from unallocated space, etc., to reconstruct the whole picture in detail. So, roughly speaking, IR is about sketching, and DF is about more information.</p>
</blockquote>
<h4 id="common-malicious-activity-detection-and-countermeasures">Common Malicious Activity, Detection and Countermeasures</h4>
<p><strong>Mapping</strong>. Attackers must first collect information about the target system:  <code>ping</code>, <code>nmap</code>.     <strong>Countermeasures:</strong></p>
<ul>
<li>record traffic</li>
<li>Look for suspicious activity.</li>
<li>Use a host scanner and keep track of all the PCs within your network. A new PC should trigger an alert.</li>
</ul>
<p><strong>Packet Sniffing</strong>. An attacker may perform (or try to achieve) <strong>traffic sniffing</strong>. It is possible in the following cases: Broadcasting, promiscuous NIC, and if the traffic is unencrypted.  <strong>Countermeasures:</strong></p>
<ul>
<li>Periodically check whether the NICs of the hosts are in promiscuous mode.</li>
<li>We switched Ethernet (1 host per segment of broadcast media).</li>
</ul>
<p><strong>IP-spoofing.</strong> Can generate &ldquo;raw&rdquo; IP packets, putting any value as a source IP. The receiver won&rsquo;t know that the other party is spoofed. <strong>Countermeasures:</strong></p>
<p><strong>DoS</strong>. <strong>Countermeasures:</strong></p>
<ul>
<li>Filter out flooded packets (e.g. SYN) before they reach the host.</li>
<li>traceback to the source of floods</li>
</ul>
<p>ğŸ£ <strong>Phishing.</strong> <strong>Spear phishing</strong> - targeted attack on specific users or groups of users. <strong>Whaling</strong> - spear phishing for high executive managers. <strong>Strategies</strong>:</p>
<ul>
<li>They claim they&rsquo;ve seen numerous failed login attempts or other suspicious activity.</li>
<li>They claim that there is some problem with your account or payment method.</li>
<li>Confirm some personal information.</li>
<li>Include a fake invoice.</li>
<li>Click on a link to make a payment.</li>
<li>You are eligible for a government refund.</li>
<li>Coupon for free stuff.</li>
</ul>
<p>How to detect it?</p>
<ul>
<li>Suspicious sender&rsquo;s address.</li>
<li>Generic signature and greetings.</li>
<li>They spoofed hyperlinks and websites.</li>
<li>Spelling and layout.</li>
<li>Suspicious attachment.</li>
</ul>
<p><strong>PoS</strong>. Most of the malware is equipped with a backdoor and C&amp;C features. The cardholder&rsquo;s data is decrypted in RAM; that&rsquo;s why this type of malware sniffs the RAM (RAM scraping). <strong>Countermeasures</strong>:</p>
<ul>
<li>Monitor the network for changes.</li>
<li>Good encryption</li>
<li>Limit the host that communicates with PoS.</li>
<li>chip-card-enabled PoS terminals</li>
<li>Employee screening and training</li>
</ul>
<p><strong>Injections</strong>. MongoDB. <code>$where</code> is interpreted as JS. DoS: <code>$where=&quot;d=new Date; do {c=new Date;} while {c-d&lt;10000};&quot;</code>, XPath. <code>'or 1=1 or '1'='1</code>, LDAP.<code>*)(cn=))(|cn=*</code>, SQL <code>or 1=1--</code> etc. The best practice is to allow listing allowed and needed characters.</p>
<ul>
<li>Preventing <strong>OS injection</strong>
<ul>
<li>Don&rsquo;t use OS commands.</li>
<li>Sanitise input</li>
<li>Accept, say, ids and lookup.</li>
<li>Leat prev</li>
<li>do not run through shell interpreters</li>
<li>explicit paths</li>
</ul>
</li>
<li>Preventing <strong>SQLi</strong>
<ul>
<li>prepared statements</li>
<li>sanitise</li>
<li>do not expose errors with SQL statements etc</li>
<li>limit permissions</li>
<li>stored procedures</li>
<li>ORM libs (Hibernate)</li>
</ul>
</li>
</ul>
<p><strong>Common AWS issues</strong>
The following list is the top ten identified misconfigurations in Amazon EC2 instances and workloads from our data set:</p>
<ol>
<li>Unconfigured EC2 instance single-point-of-failure and auto-scaling issue</li>
<li>S3 logging not enabled</li>
<li>S3 object versioning is not enabled</li>
<li>User not configured to use MFA</li>
<li>User access key not configured with rotation</li>
<li>IAM policies are attached directly to the user</li>
<li>Dangerous user-privileged access to S3</li>
<li>ELB security group allows insecure access to ports or protocols</li>
<li>IAM access keys unused for 90 days</li>
<li>Dangerous user-privileged access to RDS</li>
</ol>
<h4 id="spillage">Spillage</h4>
<p>If it&rsquo;s AWS - open up a case with AWS Business Support: report spillage findings and response actions, DoD 5220.</p>
<h4 id="documentation">Documentation</h4>
<p>This is when you start taking notes for the incident (or event). Current status of the incident, summary, indicators, other related incidents, actions taken by all, a chain of custody*, impact assessment, contacts, list of evidence, comments from incident handlers (IH), next steps to be taken (rebuild the host/upgrade).</p>
<p>How to categorise the incident? Simply put, how bad is that?</p>
<ul>
<li>Functional Impact Categories
<ul>
<li><strong>None</strong> - nothing&rsquo;s changed.</li>
<li><strong>Low</strong> - the business can still provide critical services, but the efficiency needs to be recovered.</li>
<li><strong>Medium</strong> - O. needs to be able to provide critical services to some users.</li>
<li><strong>High</strong> - O. is no longer able to provide its critical services.</li>
</ul>
</li>
<li>Information Impact Categories
<ul>
<li><strong>None</strong> - no info was exfiltrated or compromised.</li>
<li><strong>Privacy breach</strong> - sensitive PII was accessed or exfiltrated.</li>
<li><strong>Proprietary breach</strong> - unclassified proprietary info exfiltrated (PCII).</li>
<li><strong>Integrity loss</strong> - sensitive or proprietary info was changed or deleted.</li>
</ul>
</li>
<li>Recoverability Effort Categories, TTR - time to recovery
<ul>
<li><strong>Regular</strong> - TTR is predictable with existing resources.</li>
<li><strong>Supplemented</strong> - TTR is predictable with additional resources.</li>
<li><strong>Extended</strong> - TTR is unpredictable.</li>
<li><strong>If not recoverable</strong>, launch the investigation.</li>
</ul>
</li>
</ul>
<h4 id="protected-data">Protected Data</h4>
<p>Suppose the GDPR data was leaked - 72 hours to disclose the breach. HIPAA has other time limits.</p>
<h3 id="containment-eradication-recovery">Containment. Eradication. Recovery.</h3>
<p><strong>Containment</strong> ğŸ“¦ aims to stop the bleedingğŸ©¸. It&rsquo;s a critical stage. While during Identification (aka detection and analysis), we confirm that something&rsquo;s going wrong, this stage is used to see the whole picture, how the breach happened, what damage was already done, which systems are compromised, etc. Quoting SANS:</p>
<blockquote>
<p>The goal of containment is to limit damage from the current security incident and prevent further damage. Several steps are necessary to completely mitigate the incident while avoiding the destruction of evidence that may be needed for prosecution.</p>
</blockquote>
<p>So, digital forensics can occur anywhere from Analysis (aka Identification) to the Lessons Learned stage. It may not happen, however. For example, a DoS attack may not need this facility.</p>
<p>Choosing a containment strategy:</p>
<ul>
<li><input disabled="" type="checkbox"> â“ Is there potential damage or theft of resources?</li>
<li><input disabled="" type="checkbox"> â“ Do we need to preserve the evidence for the court/ourselves and make an image of the compromised system?</li>
<li><input disabled="" type="checkbox"> â“ Do we need the service to be available during the investigation?</li>
<li><input disabled="" type="checkbox"> â“ How much time do we have and need?</li>
<li><input disabled="" type="checkbox"> â“What resources are available to implement this strategy?</li>
<li><input disabled="" type="checkbox"> â“ What&rsquo;s the strategy&rsquo;s effectiveness (partial or complete containment)?</li>
</ul>
<p>Below is the checklist to ensure the responder has done their job. These questions can be used in a ticket or IR timesheet, mentioned above in the <em>Documentation</em> section.</p>
<ul>
<li><input disabled="" type="checkbox"> â“ Who attacked you and why?</li>
<li><input disabled="" type="checkbox"> â“ When and How did it happen?</li>
<li><input disabled="" type="checkbox"> â“ Did this happen because of the poor sec policy and processes?</li>
<li><input disabled="" type="checkbox"> â“ How widespread is the incident?</li>
<li><input disabled="" type="checkbox"> â“ What steps are being taken to determine what happened and prevent it in future?</li>
<li><input disabled="" type="checkbox"> â“ What&rsquo;s the impact?</li>
<li><input disabled="" type="checkbox"> â“ Was any personally identifiable information leaked?</li>
<li><input disabled="" type="checkbox"> â“ What is the estimated cost of this incident?</li>
</ul>
<blockquote>
<p>The SANS containment process involves:</p>
<p><strong>Short-term containment</strong>â€”limiting damage before the incident worsens, usually by isolating network segments, taking down hacked production servers and routing to failover.</p>
<p><strong>System backup</strong>â€”taking a forensic image of the affected system(s) with tools such as Forensic Tool Kit (FTK) or EnCase, and only then wiping and reimaging the systems. This will preserve evidence from the attack that can be used in court and for further investigation of the incident and lessons learned.</p>
<p><strong>Long-term containment</strong>â€”applying temporary fixes to make it possible to bring production systems back up. The primary focus is removing accounts or backdoors left by attackers on the methods and addressing the root causeâ€”for example, fixing a broken authentication mechanism or patching a vulnerability that led to the attack.</p>
</blockquote>
<p><strong>Eradication</strong> aims to remove the threat. For example, please remove the malware, and return configs to their normal state. It&rsquo;s a common mistake of many companies to jump right to this stage without proper prior investigation and containment. In this case, the attacker might still be inside, the vulnerability they used is still unmatched, or the user they social engineered still needs to be informed about this event properly etc. It can turn into a &ldquo;whack-a-mole&rdquo; game which is no fun when a company&rsquo;s reputation and finance ğŸ’µ are concerned.</p>
<ul>
<li><input disabled="" type="checkbox"> â“ Can the problem be isolated? Are all affected isolated?</li>
<li><input disabled="" type="checkbox"> â“ Have the forensic copy been created? For each piece of evidence, keep the info (or chain of custody, even better):
<ul>
<li><input disabled="" type="checkbox"> Identifying information (location, serial, model, hostname, MAC and IP)</li>
<li><input disabled="" type="checkbox"> Name, title, and phone of each individual who collected or handled the evidence</li>
<li><input disabled="" type="checkbox"> Time and date (+ time zone) of each occurrence of evidence handling</li>
<li><input disabled="" type="checkbox"> The location where the evidence was stored</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> â“ Can this system be reimaged and patched?</li>
<li><input disabled="" type="checkbox"> â“ Was all malware removed and the system hardened?</li>
<li><input disabled="" type="checkbox"> â“ What tools will you use to test, monitor and verify that the exact cause no longer compromises the restored systems?</li>
</ul>
<p><strong>Recovery</strong> aims to get the system operational if it goes down or simply back to business as usual if it doesnâ€™t.</p>
<h3 id="post-incident-activity-sans-lessons-learned">Post-Incident Activity (SANS Lessons Learned)</h3>
<p>Learn from your experience so you can better respond to future security events. Adjust your playbooks accordingly.</p>
<h3 id="cloud-ir-specifics">Cloud IR Specifics</h3>
<p>If there are any shared resources with other companies that care about security less, you might be in trouble. For example, several companies host their web application on one website.</p>
<p>Cloud IR is easier. Some tools and methods are available ONLY for the Cloudâ€”IR Simulation on AWS.</p>
<p><a href="https://docs.aws.amazon.com/whitepapers/latest/aws-security-incident-response-guide/security-incident-response-simulations.html">https://docs.aws.amazon.com/whitepapers/latest/aws-security-incident-response-guide/security-incident-response-simulations.html</a></p>
<p>Automation - <a href="https://docs.aws.amazon.com/whitepapers/latest/aws-security-incident-response-guide/automation-1.html">https://docs.aws.amazon.com/whitepapers/latest/aws-security-incident-response-guide/automation-1.html</a></p>
<h2 id="--df-methodology">ğŸ”¬ ğŸ§ª DF Methodology</h2>
<h3 id="collection">Collection</h3>
<p>Evidence collection begins with the first response and arriving at the scene (how weird&hellip;.). The person collecting the evidence assumes the role of a first responder. Only sometimes are they digital forensic experts. Opponents will try to discredit their work. Thatâ€™s why itâ€™s essential to use industry-accepted tools and know the digital footprint of these tools (checked every month). Each media type has a separate section under Incident Investigation -&gt; Collection section on this website - <a href="https://bakerst221b.com/docs/dfir/investigation/collection/">https://bakerst221b.com/docs/dfir/investigation/collection/</a>.</p>
<p>There are several important notes to keep in mind:</p>
<p>â—ï¸Document everything. Before anything can be acquired, it needs to be properly documented first. The first responder must record all the findings in the Chain of Custody form.</p>
<p>â—ï¸Take photos and videos before touching anything. These photos/videos need to have proper time-stamping.</p>
<p>â—ï¸Do never make any analysis on the original media! Any analysis and investigation are only performed against a copy.</p>
<p>â—ï¸Make hashes before the acquisition, after and when making copies.</p>
<h4 id="documentation-1">Documentation</h4>
<p>Start documenting even before you get to the scene. First, make sure that timestamps are configured on both devices. Take as many photos and videos as possible. Take overall and close-up images. Make sure that all the connections between the devices are photographed clearly. Photograph the evidence in situ (if possible). Identify and assign unique ids to the evidence collected.</p>
<p><img src="images/chain-of-custody.png" alt="chain-of-custody"></p>
<h3 id="examination-and-analysis">Examination and Analysis</h3>
<p>Art supersedes science. Know what garbage is. Unexpected places. Pay attention to exculpatory (proving innocence) data.</p>
<p>â—ï¸ Correlate data with other independent sources. Some data might have been tampered with, and you should try to find other evidence that describes the same data. For example, timestamps can be easily changed. Therefore, try to find network or login events to correlate them.</p>
<p>Bypassing controls (if PIN protected, data encrypted, ACL, compression). There will be lots of data, and only some are relevant. In most cases, NSRL file data is used to eliminate known files, such as operating system and application files, during criminal forensic investigations. This reduces the number of files which must be manually examined and thus increases the efficiency of the investigation. See <a href="https://www.nist.gov/itl/ssd/software-quality-group/national-software-reference-library-nsrl/about-nsrl/nsrl-introduction">here</a>. Autopsy uses this list.</p>
<p>I am testing computer <a href="https://www.nist.gov/itl/ssd/software-quality-group/computer-forensics-tool-testing-program-cftt">tools</a>. Video analytics <a href="https://www.nist.gov/programs-projects/video-analytics">here</a> and photo <a href="https://www.nist.gov/itl/iad/image-group">here</a>. And about NIST research in cloud forensics <a href="https://www.nist.gov/programs-projects/nist-cloud-computing-forensic-science">here</a>.</p>
<p>About SIM forensics as well <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-101r1.pdf">here</a>.</p>
<p>The main idea is to concentrate on some areas and answer some specific questions, like:</p>
<ol>
<li>Is there child exploitation material? Search videos and pictures.</li>
<li>Is this PC compromised? It needs to be more prominent.</li>
<li>Who did this computer communicate with?</li>
</ol>
<p><strong>First option:</strong></p>
<p>Big problem &ndash;&gt; n*(minor problem). Recursively break a problem into minor issues until one becomes solvable.</p>
<p><strong>Second option:</strong></p>
<p>Or we can be guided by artefact â›ï¸  categories.</p>
<p>First, break the more significant problem into a smaller ones. Then answer questions with artefact â›ï¸ categories.</p>
<p>Here is the pseudocode for this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="n">function</span> <span class="n">breakIntoSmallerProblems</span><span class="p">(</span><span class="n">Stack</span> <span class="n">problemStack</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stacked</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="n">problemStack</span><span class="p">.</span><span class="n">len</span> <span class="p">==</span> <span class="m">0</span> <span class="k">return</span> <span class="m">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">currentProblem</span> <span class="p">=</span> <span class="n">problem</span><span class="p">.</span><span class="n">pop</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">  <span class="k">get</span> <span class="n">artifacts</span><span class="p">(</span><span class="n">poseQuestion</span><span class="p">(</span><span class="n">current</span> <span class="n">problem</span><span class="p">,</span> <span class="n">stackLen</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="n">breakIntoSmallerProblems</span><span class="p">(</span><span class="n">problemStack</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">function</span> <span class="n">poseQuestion</span><span class="p">(</span><span class="kt">string</span> <span class="n">problem</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stackLen</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">stackLen</span> <span class="p">&lt;</span> <span class="m">100</span><span class="p">)</span> <span class="n">prioritisize</span><span class="p">(</span><span class="n">problem</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span> <span class="n">answerWithAutoTools</span><span class="p">(</span><span class="n">problem</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><strong>How does a computer works?</strong> Hardware, OS, Processes. <strong>How does the attacker works?</strong> Remote access changes, detection avoidance etc.</p>
<p><strong>RoadMap</strong></p>
<ol>
<li>Is the system compromised?
<ol>
<li>Are there mal-related changes?</li>
<li>Is there mal user activity?
<ol>
<li>Suspicious logins?
<ol>
<li>Login artefact category â›ï¸: Event log 4624, 4778, active users etc</li>
</ol>
</li>
</ol>
</li>
<li>Are there malware progs?</li>
<li>Are there mal OS changes?</li>
</ol>
</li>
</ol>
<p>Prioritisation is based on: likely relevance, result accuracy, and time to answer.</p>
<p>Beginner: start with a process and fill in categories</p>
<p>Advanced: when you already know about classes, think from that perspective.</p>
<p>Manager: categories</p>
<p>Cyber Triage User: same</p>
<p>File name &ndash;&gt; meta &ndash;&gt; content</p>
<h4 id="prioritisation-and-process">Prioritisation and Process</h4>
<p>There are different paths to follow to answer the same questions. Some are more efficient.</p>
<p>I am pulling on threads.  Find a piece of evidence and focus on that to fully understand it. Example (depth search):</p>
<ul>
<li>Looking for malware and finding program run entries for malware</li>
<li>Stop looking for other malware and focus on that one.
<ul>
<li>What happened before and after?</li>
<li>What else is in the same folder?</li>
<li>What does it do?</li>
</ul>
</li>
<li>Repeat for each you find</li>
</ul>
<p>How to find the first evidence? Prioritise or brute force.</p>
<ul>
<li>Prioritise (Manual). You always need to find out where the evidence is going to be.
<ul>
<li>impact on the investigation result</li>
<li>likelihood of finding anything</li>
<li>False positive?</li>
<li>time required</li>
</ul>
</li>
<li><strong>Brute force</strong> (Automated). Let tools and software find evidence.</li>
</ul>
<blockquote>
<p>Cyber Triage: can I mark something as wrong and run the analysis for this piece of evidence again? - yes</p>
</blockquote>
<p>See the general schema <a href="/files/pdf/DivideAndConquerDiag202010-201008-094835.pdf">here</a>.</p>
<h4 id="critical-thinking">Critical Thinking</h4>
<p><strong>Challenge assumptions</strong> (sometimes it&rsquo;s something you have not seen or dealt with before), consider alternatives, evaluate data, identify critical drivers, and understand the context.</p>
<p>List all assumptions and ask yourself how sure you are of these statements and what might happen if they are wrong. Categorise these assumptions based on certainty. Refine and remove those assumptions that are proven to be incorrect. Identify additional data needs for those assumptions that are still uncertain. Research?</p>
<p>Think about the <strong>alternatives</strong>, for example, brainstorming. Ask yourself the six W&rsquo;s to help develop the other options. The null hypothesis is the opposite of the central hypothesis (for anomalous data).</p>
<p>Know your data! <strong>Know normal and abnormal</strong>. Establish the baselines for average to detect the bizarre (like, a clean system installation is examined, and everything is compared to it). Look for inconsistent data. **Assess the data against different hypotheses to see how well it fits.</p>
<p>Identify critical drivers: technology, regulatory (laws and standards), society (politics, people want to be safe), supply chain (logistics, cost, scheduling, customer requirements), employees (skills and training needed), threat actors (tech capabilities, motives, opportunity).</p>
<p>Understand the context from the perspective of different stakeholders. Framing techniques help keep everyone on the same page (what do they need from me, how can I frame the issue, do I need to place their questions in a broader context). Same vocabulary. Steps:</p>
<ul>
<li>Key components. Break the problem down and identify the parts, actors and categories.</li>
<li>Factors at Play.</li>
<li>Relationships. Static? Dynamic? Graphing.</li>
<li>Similarities/Differences. Leverage past work!</li>
<li>Redefine. Rephrase and paraphrase the issue. What is the root cause?</li>
</ul>
<blockquote>
<p>ğŸ’¡ Maybe it&rsquo;s better to arrange it as a table. Merge with the information from the Cyber Triage DFIR webinar by Brian Carrier and Digital Archaeology.</p>
</blockquote>
<h4 id="known-good">Known Good</h4>
<p>Only some of the files are worth considering. However, it takes a lot of work to keep all of them in mind. I&rsquo;ve made several database files that contain information on files on a clean installed system. There will be some divisions, but I hope it will also help eliminate a massive pack of files.</p>
<h2 id="tips">Tips</h2>
<h3 id="how-to-prove-compromise">How to prove compromiseâ“</h3>
<blockquote>
<p>TODO: Move to Canva, make a decision tree from it rather</p>
</blockquote>
<p>Lot&rsquo;s of attacks involve account compromise. In some cases malware is not even needed. There are several arguments for the defence: <em>I didn&rsquo;t know</em>, <em>It was not me</em>, <em>It was a malware</em> and <em>It happened accidently</em>.</p>
<p>âœï¸ <strong>Suspicious logins?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> Should this user use this account?</li>
<li><input disabled="" type="checkbox"> Are they new to the computer?</li>
<li><input disabled="" type="checkbox"> If remote, does the account usually come from that computer?</li>
<li><input disabled="" type="checkbox"> Is the time expected?</li>
<li><input disabled="" type="checkbox"> Does the account have lots of failed logins? ğŸ‘‰ <em>A very strong indicator of compromise</em></li>
<li><input disabled="" type="checkbox"> A login during time when the user was absent ğŸ‘‰ <em>A very strong indicator of compromise</em></li>
</ul>
<p>âœï¸ <strong>Malware</strong>. There is a separate section for malware, but it can be a strong defense for some one claiming his or her account was compromised. But! âš ï¸ Even if there is a malware found, it&rsquo;s essential to prove that it existed <strong>at the time</strong> that some investigated activity took place.</p>
<h3 id="how-to-prove-intent-">How to prove intent â“</h3>
<p><em>â“  So, back to the question. How to prove that the user knows?</em></p>
<p>âœï¸ <strong>Suspicious activity?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> <strong>What searches were performed?</strong>
<ul>
<li><input disabled="" type="checkbox"> Search relevant to job role?</li>
<li><input disabled="" type="checkbox"> Search for malicious progs or techniques?</li>
<li><input disabled="" type="checkbox"> Was there an attempt to delete the evidence? For example, browser cache cleared <em>manually</em>, depends on this browser settings.</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Access resources</strong>.
<ul>
<li><input disabled="" type="checkbox"> Accessed malwebsite?</li>
<li><input disabled="" type="checkbox"> Network shares?</li>
<li><input disabled="" type="checkbox"> Mass copy? ğŸ‘‰ <em>Might be an indicator of data exfiltration.</em></li>
<li><input disabled="" type="checkbox"> Was it a result of a redirect (300 HTTP or header redirect, or pop-up) ğŸ‘‰ <em>May help the defending side if this can be proved.</em></li>
<li><input disabled="" type="checkbox"> File accessed soon after creation? ğŸ‘‰ <em>Might be an indicator of some automated task, or not&hellip;.</em>.</li>
<li><input disabled="" type="checkbox"> Was a file deleted/wiped? ğŸ‘‰ <em>File wiped is a strong indiator of intent.</em> ğŸ›  Directory Snoop can show that the file was wiped, not simply deleted. Not all wiping software clears the <code>$MFT</code> table.</li>
<li><input disabled="" type="checkbox"> What devices were attached?</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Remotely executed code</strong>. Remote host + username; interactive or cmd; time. Registry. Event logs for logins and Event login for remote processes.
<ul>
<li><input disabled="" type="checkbox"> Remote = local?</li>
<li><input disabled="" type="checkbox"> Expected?</li>
<li><input disabled="" type="checkbox"> Prog expected?</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Communications</strong>. Messangers, emails, social networking, forums, websites.
<ul>
<li><input disabled="" type="checkbox"> Determine all the mail clients used and use this information to find artefacts. â—ï¸â—ï¸â—ï¸â—ï¸ Link to collection.</li>
<li><input disabled="" type="checkbox"> Relevant threads (<code>strings</code> + <code>grep</code> or DFIR framework).</li>
<li><input disabled="" type="checkbox"> IP in mail spoofed?</li>
</ul>
</li>
</ul>
<p>ğŸ‘£ User started processes (Event log, RunMRU, MUICache, UserAssist, AppCompatCache or Shimcache, BAM (Background activity monitor), RecentApps, RecentFilecache or AmCache, SRUM (system resource usage monitor), Windows Timeline, Prefetch).</p>
<p>ğŸ‘£ Terms and time when the search was performed. Web artifacts and saved previous searches.</p>
<p>ğŸ‘£ Includes Host (remote or local), path, time. (configs like history of browser; recently used files, process handles). FileExplorer&rsquo;s ShellBags (what folder was opened) and RunMRU,Application Most Recently Used Files, Web artifacts (cookies, history, db, cache), Memory (commands, remote desk info, paths), cont monitoring.</p>
<p>ğŸ‘£ Event logs, domain logs. The below question may help finding a malicious user (hacker) or malicious insider with intent. More <a href="/docs/dfir/forensic-investigation/4-accounts">here</a>.</p>
<p>ğŸ‘£ Mails. â—ï¸â—ï¸â—ï¸â—ï¸ Link to collection.</p>
<h3 id="how-to-prove-user-awareness-">How to prove user awareness â“</h3>
<p>âœï¸ It&rsquo;s often not enough just to find a file on a system. One needs to prove <strong>the intent</strong>. Remember to use more than one artifact whenever possible! For example, the user may be insisting that he or she did not download this file. But, if the browser was set to flush data every 7 days and the timestamps for the deleted file shows it was deleted an hour after it was deleted - this might raiser some reasonable doubt I think ğŸ¤”. Or, the file was wiped ğŸ§¹ (it&rsquo;s contents filled with <code>0</code>s). If one didn&rsquo;t know it existed, why delete it? Or there is no data on the PC indicating the use of the file, but it was continuously downloaded/uploaded according to the server logs. âš ï¸ This, however, won&rsquo;t prove that there was no hacker in place!</p>
<h3 id="types-of-users">Types of Users</h3>
<p>Actually, as I read further an further, it seems that everything is about a user. But!</p>
<p>A user can be of several categories. I&rsquo;ll name each one as shortly as I can to refer to them in future. But I will describe them in more detail below.</p>
<p><strong>Legitimate user, who has done something bad by accident</strong>. Let&rsquo;s call him a <strong>dummy</strong> ğŸ˜¬. I&rsquo;ve been there, I once changed permissions to <code>Deny</code> for my admin account to disk <code>C</code> on Windows and could do nothing about it later. How stupid was it ğŸ™ˆ? My excuse is that I only started with PCs&hellip; .</p>
<p><strong>Legitimate user, who has done something bad by intent.</strong> Let&rsquo;s call this one a <strong>poopy</strong> ğŸ’©. Say, he or she feels highy underpaid and sells company&rsquo;s kitty plans to some evil dog hackers.</p>
<p><strong>A user created and used by a hacker.</strong> This one I will call a <strong>sheep</strong> ğŸ‘  as in <em>A wolf in sheep&rsquo;s clothing</em>, since the attacker is trying mask itself as something good.  This one is not unusual, but I guess, easily determined by the sysadmin. However, there are some cases, when an attacker can change view permissions for his/her account on AD so that no one will see this user.</p>
<p><strong>A user created legitimately, but compromised by a hacker and doing something by intent.</strong> This one will be a <strong>donkey</strong> ğŸ¦“, as the attaker is using another account for his ride. I guess it&rsquo;s the most common when the hackers are in the picture.</p>
<p>And here are the questions we will have to answer during investigations, that can help in distinguishing between these types.</p>
<h4 id="dummy--vs-poopy-"><strong>Dummy</strong> ğŸ˜¬ vs <strong>Poopy</strong> ğŸ’©</h4>
<p><em>â“ How to prove that the person didn&rsquo;t do it on purpose, but by accident?</em></p>
<p>âœï¸ It&rsquo;s often not enough just to find a file on a system. One needs to prove <strong>the intent</strong>. Remember to use more than one artifact whenever possible! For example, the user may be insisting that he or she did not download this file. But, if the browser was set to flush data every 7 days and the timestamps for the deleted file shows it was deleted an hour after it was deleted - this might raiser some reasonable doubt think ğŸ¤”. Or, the file was wiped ğŸ§¹ (it&rsquo;s contents filled with <code>0</code>s). If one didn&rsquo;t know it existed, why delete it? Or there is no data on the PC indicating the use of the file, but it was continuously downloaded/uploaded according to the server logs. âš ï¸ This, however, won&rsquo;t prove that there was no hacker in place!</p>
<h4 id="sheep--vs-others---and-"><strong>Sheep</strong> ğŸ‘ vs <strong>others</strong> ğŸ’©, ğŸ˜¬ and ğŸ¦“</h4>
<p>âœï¸ <strong>Are there suspicious accounts?</strong> ğŸ‘£ SAM reg hive (local and domain). Even if the account is deleted, then you can still spot it: user directory sometimes is retained and also check logs. The below question may help finding a malicious user (hacker). More <a href="/docs/dfir/forensic-investigation/accounts">here</a>.</p>
<ul>
<li><input disabled="" type="checkbox"> User Name does not match conventions for this organisation?</li>
<li><input disabled="" type="checkbox"> Weird priviledges</li>
<li><input disabled="" type="checkbox"> Scope (local or domain)</li>
<li><input disabled="" type="checkbox"> Creation time and date.</li>
</ul>
<h4 id="poopy--vs-donkey-"><strong>Poopy</strong> ğŸ’© vs <strong>donkey</strong> ğŸ¦“</h4>
<p><em>â“ How to prove that the account was compromised?</em></p>
<p>Lot&rsquo;s of attacks involve account compromise. In some cases malware is not even needed. There are several arguments for the defence: <em>I didn&rsquo;t know</em>, <em>It was not me</em>, <em>It was a malware</em> and <em>It happened accidently</em>.</p>
<p>âœï¸ <strong>Suspicious logins?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> Should this user use this account?</li>
<li><input disabled="" type="checkbox"> Are they new to the computer?</li>
<li><input disabled="" type="checkbox"> If remote, does the account usually come from that computer?</li>
<li><input disabled="" type="checkbox"> Is the time expected?</li>
<li><input disabled="" type="checkbox"> Does the account have lots of failed logins? ğŸ‘‰ <em>A very strong indicator of compromise</em></li>
<li><input disabled="" type="checkbox"> A login during time when the user was absent ğŸ‘‰ <em>A very strong indicator of compromise</em></li>
</ul>
<p>âœï¸ <strong>Malware</strong>. There is a separate section for malware above â˜ï¸, but it can be a strong defense for some one claiming his or her account was compromised. But! âš ï¸ Even if there is a malware found, it&rsquo;s essential to prove that it existed at the time that some investigated activity took place.</p>
<h4 id="poopy--and-donkey--vs-others--and-"><strong>Poopy</strong> ğŸ’© and <strong>donkey</strong> ğŸ¦“ vs <strong>others</strong> ğŸ˜¬ and ğŸ‘</h4>
<p>âœï¸ <strong>Suspicious activity?</strong></p>
<ul>
<li><input disabled="" type="checkbox"> <strong>What searches were performed?</strong>
<ul>
<li><input disabled="" type="checkbox"> Search relevant to job role?</li>
<li><input disabled="" type="checkbox"> Search for malicious progs or techniques?</li>
<li><input disabled="" type="checkbox"> Was there an attempt to delete the evidence? For example, browser cache cleared <em>manually</em>, depends on this browser settings.</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Access resources</strong>.
<ul>
<li><input disabled="" type="checkbox"> Accessed malwebsite?</li>
<li><input disabled="" type="checkbox"> Network shares?</li>
<li><input disabled="" type="checkbox"> Mass copy? ğŸ‘‰ <em>Might be an indicator of data exfiltration.</em></li>
<li><input disabled="" type="checkbox"> Was it a result of a redirect (300 HTTP or header redirect, or pop-up) ğŸ‘‰ <em>May help the defending side if this can be proved.</em></li>
<li><input disabled="" type="checkbox"> File accessed soon after creation? ğŸ‘‰ <em>Might be an indicator of some automated task, or not&hellip;.</em>.</li>
<li><input disabled="" type="checkbox"> Was a file deleted/wiped? ğŸ‘‰ <em>File wiped is a strong indiator of intent.</em> ğŸ›  Directory Snoop can show that the file was wiped, not simply deleted. Not all wiping software clears the <code>$MFT</code> table.</li>
<li><input disabled="" type="checkbox"> What devices were attached?</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Remotely executed code</strong>. Remote host + username; interactive or cmd; time. Registry. Event logs for logins and Event login for remote processes.
<ul>
<li><input disabled="" type="checkbox"> Remote = local?</li>
<li><input disabled="" type="checkbox"> Expected?</li>
<li><input disabled="" type="checkbox"> Prog expected?</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Communications</strong>. Messangers, emails, social networking, forums, websites.
<ul>
<li><input disabled="" type="checkbox"> Determine all the mail clients used and use this information to find artefacts. â—ï¸â—ï¸â—ï¸â—ï¸ Link to collection.</li>
<li><input disabled="" type="checkbox"> Relevant threads (<code>strings</code> + <code>grep</code> or DFIR framework).</li>
<li><input disabled="" type="checkbox"> IP in mail spoofed?</li>
</ul>
</li>
</ul>
<p>ğŸ‘£ User started processes (Event log, RunMRU, MUICache, UserAssist, AppCompatCache or Shimcache, BAM (Background activity monitor), RecentApps, RecentFilecache or AmCache, SRUM (system resource usage monitor), Windows Timeline, Prefetch).</p>
<p>ğŸ‘£ Terms and time when the search was performed. Web artifacts and saved previous searches.</p>
<p>ğŸ‘£ Includes Host (remote or local), path, time. (configs like history of browser; recently used files, process handles). FileExplorer&rsquo;s ShellBags (what folder was opened) and RunMRU,Application Most Recently Used Files, Web artifacts (cookies, history, db, cache), Memory (commands, remote desk info, paths), cont monitoring.</p>
<p>ğŸ‘£ Event logs, domain logs. The below question may help finding a malicious user (hacker) or malicious insider with intent. More <a href="/docs/dfir/forensic-investigation/4-accounts">here</a>.</p>
<p>ğŸ‘£ Mails. â—ï¸â—ï¸â—ï¸â—ï¸ Link to collection.</p>
<h3 id="configuration-changes">Configuration Changes</h3>
<p><em>ğŸ” What are we looking for? Remote access, detection prevention, response challenges, malware enablement.</em></p>
<p>It can be challenging (no consistency). Are they different by accident or from malicious intent? Baseline reference (what the settings should be). Configs have only one place to set things. Attacker motivation:</p>
<ul>
<li><strong>Get access</strong>
<ul>
<li>Has remote access been enabled?</li>
<li>Is file sharing enabled?</li>
<li>config to launch different progs?</li>
</ul>
</li>
<li><strong>Avoid detection</strong> (Prevent detection (disable firewalls, anti-virus). Rootkits are in the malware section)
<ul>
<li>Have any prevention tools been disabled?</li>
<li>Installed mal certificates to trick prevention tools?</li>
<li>Have many detection tools been disabled?</li>
</ul>
</li>
<li><strong>Make the response harder</strong>
<ul>
<li>Were any access disabled?</li>
<li>Are Visibility tools disabled?</li>
<li>Settings to record fewer data
<ul>
<li>Have audit settings changed?</li>
<li>logs cleared</li>
<li>Is the Backup disabled?</li>
</ul>
</li>
</ul>
</li>
<li><strong>Empower or enable malware</strong> (Changes needed by malware? Change the exe path, lib path, and hosts file. ğŸ‘£ <strong>On a Windows machine.</strong> Registry, Congif files (app-specific or OS))</li>
</ul>
<p>Read more about the above techniques: <a href="https://isc.sans.edu/diary/Wipe+the+drive+Stealthy+Malware+Persistence+Mechanism+-+Part+1/15394">Wipe the drive! Stealthy Malware Persistence - Part 1</a> and <a href="https://isc.sans.edu/forums/diary/Wipe+the+drive+Stealthy+Malware+Persistence+Part+2/15406/">Wipe the drive! Stealthy Malware Persistence - Part 2</a>.</p>
<h3 id="malware-analysis">Malware Analysis</h3>
<p>Here is a separate section devoted to malware analysis methodology, tips, etc..</p>
<p><em>ğŸ” What are we looking for?</em> Persistence/start-up mechanisms, running processes and remnants left.</p>
<p><strong>SANS Six-Part Methodology</strong>, used to identify malicious processes:</p>
<ul>
<li><input disabled="" type="checkbox"> Identify rogue processes</li>
<li><input disabled="" type="checkbox"> Analyse DLLs and handles.</li>
<li><input disabled="" type="checkbox"> Review network artefacts</li>
<li><input disabled="" type="checkbox"> Look for code injection.</li>
<li><input disabled="" type="checkbox"> Check for any signs of a rootkit.</li>
<li><input disabled="" type="checkbox"> Dump suspicious process and drivers</li>
</ul>
<p>ğŸ‘£ <em>What A/V solution is being used?</em> ğŸ¦  ğŸ›‘ If it&rsquo;s Windows, there might be just Windows Defender or some third-party AV. Find the logs for this particular AV solution. More <a href="/docs/dfir/host/windows/windows-artifacts#av-logs">here</a> about this Windows artefact. As for macOS, it has a built-in gatekeeper which logs all these alerts and can even detect known malware. More <a href="/docs/dfir/host/apple/mac-artifacts#Quarantine-files">here</a> about this macOS artefact.</p>
<p>ğŸ›  Cyber Triage (uses WinAPI), SleuthKit, volatility modules, yara rules, AVs, Registry Explorer (for Windows reg analysis).</p>
<p>There are two main points to use as a starting point for malware search: common persistence mechanism for the system, network connections and RAM. Below is the cheat sheet to use to find suspicious files. Each indicator is not 100%, but you can add scores and then reverse engineer only those highly suspicious to save time.</p>
<ul>
<li>
<p><input disabled="" type="checkbox"> âœï¸ <strong>Where to look for malware signs</strong>. Maybe it was removed, or it&rsquo;s stealthy. Or perhaps it&rsquo;ll be too hard. Things that are left behind. The same artefacts that with processes in general (User Activity). There must be some signs that the malware was started (like, startup locations), run (logs, dump, registry etc.) and shut down (process termination logs, crash dumps, remnants in RAM etc.).</p>
</li>
<li>
<p><input disabled="" type="checkbox"> <strong>Persistence mechanisms</strong>. More about the persistence mechanism is in the below section.</p>
</li>
<li>
<p><input disabled="" type="checkbox"> <strong>RAM</strong>.</p>
</li>
<li>
<p><input disabled="" type="checkbox"> <strong>Network triage</strong>
- <input disabled="" type="checkbox"> Connections (opened, closed, attempted)
- <input disabled="" type="checkbox"> Filter out Internal addresses</p>
</li>
<li>
<p><input disabled="" type="checkbox"> Check the remote connections. External IPs reputations. ğŸ›  <code>hostintel</code>.</p>
<ul>
<li><input disabled="" type="checkbox"> Executables that launched these connections</li>
<li><input disabled="" type="checkbox"> Port-services mismatch or unusual ports or services</li>
<li><input disabled="" type="checkbox"> Frequency. How frequently is the host connecting to another machine? For how long? It could be something legitimate. But if it&rsquo;s recent or/and not regular - it could be an indicator.</li>
<li><input disabled="" type="checkbox"> Unusual. Unusual application names, paths, typos or poker hand ports (<code>44488</code> <code>12345</code> or like). Or may some gibberish charactersâ€”specific protocols - <code>1</code> (ICMP) <code>6</code> (TCP) <code>70</code> (UDP). Look for the ports outside of these three.</li>
</ul>
</li>
<li>
<p><input disabled="" type="checkbox"> âœï¸ <strong>Put a score to all suspicious files</strong></p>
<ul>
<li><input disabled="" type="checkbox"> Signed executable.</li>
<li><input disabled="" type="checkbox"> Strings.</li>
<li><input disabled="" type="checkbox"> 32-bit application.</li>
<li><input disabled="" type="checkbox"> Atypical location.</li>
<li><input disabled="" type="checkbox"> Suspicious time.</li>
<li><input disabled="" type="checkbox"> Suspicious name.</li>
<li><input disabled="" type="checkbox"> Signs of reconnaissance stage.</li>
<li><input disabled="" type="checkbox"> Runtime linking.</li>
<li><input disabled="" type="checkbox"> Packed executables.</li>
<li><input disabled="" type="checkbox"> Hash.</li>
<li><input disabled="" type="checkbox"> Byte-level signatures.</li>
<li><input disabled="" type="checkbox"> Name/Path.</li>
<li><input disabled="" type="checkbox"> Unexpected owners.</li>
<li><input disabled="" type="checkbox"> Hidden by WinAPI.</li>
<li><input disabled="" type="checkbox"> The process took over.</li>
<li><input disabled="" type="checkbox"> On-disk and in-memory contents don&rsquo;t match.</li>
<li><input disabled="" type="checkbox"> Unusual behaviour.</li>
</ul>
</li>
<li>
<p><input disabled="" type="checkbox"> âœï¸ Put the suspicious files down into your IR/forensics sheet.</p>
</li>
<li>
<p><input disabled="" type="checkbox"> âœï¸ Check what processes, dlls, handles, files and network connections were used by the suspicious process.</p>
</li>
</ul>
<h4 id="persistence-mechanisms">Persistence Mechanisms</h4>
<ul>
<li><input disabled="" type="checkbox"> âœï¸ Are there mal <strong>triggered</strong> programs? Path to progs launched, when started (login, startup, schedule), user priv (service), creating date (unreliable).
<ul>
<li><input disabled="" type="checkbox"> Normally there?</li>
<li><input disabled="" type="checkbox"> Suspicious location?</li>
<li><input disabled="" type="checkbox"> Times similar to the event</li>
<li><input disabled="" type="checkbox"> Legitimate signature? Is the issuer trusted, or is it self-signed?</li>
<li><input disabled="" type="checkbox"> Do you find it on other machines within the enterprise?</li>
<li><input disabled="" type="checkbox"> <code>autoruns -v &lt;options&gt; &gt; output.csv</code>, <code> autoruns -accepteula -a * -s[verify digital signatures] -h[show file hashes] -c[output csv] -vr[query virus total] &gt; output.csv</code>, <code>autoruns -accepteula -a * -s -h -c -vr &gt; output.csv</code></li>
</ul>
</li>
<li><input disabled="" type="checkbox"> âœï¸ Are there mal accidentally run (<strong>trick launch</strong>)?</li>
<li><input disabled="" type="checkbox"> âœï¸ Are there libs accidentally loaded?
<ul>
<li><input disabled="" type="checkbox"> <strong>LoadLibraryPathFile</strong> - a set of folders for finding and resolving libraries.</li>
<li><input disabled="" type="checkbox"> The same folder as the exe.</li>
</ul>
</li>
</ul>
<p>ğŸ—’ <em>Explore common autorun and persistence locations to find the files that automatically run at <strong>startup</strong>.</em></p>
<p>ğŸ—’ <em>Among these entries, find suspicious ones.</em></p>
<h4 id="malware-evasion-techniques">Malware Evasion Techniques</h4>
<p>Malware is not going just always to sit there and sing ğŸ¶. Below are standard techniques. A more detailed explanation is in the corresponding section.</p>
<ul>
<li><input disabled="" type="checkbox"> Service Hijacking and Replacement.</li>
<li><input disabled="" type="checkbox"> Process Injection. Stealthy. Trivial identification using RAM analysis tools.</li>
<li><input disabled="" type="checkbox"> Filename/Service Hijacking.</li>
<li><input disabled="" type="checkbox"> ADS.</li>
<li><input disabled="" type="checkbox"> WebShells and Beacons.</li>
<li><input disabled="" type="checkbox"> Firmware.</li>
<li><input disabled="" type="checkbox"> DLL Injection.</li>
<li><input disabled="" type="checkbox"> A/V Bypass.</li>
<li><input disabled="" type="checkbox"> Defense Manipulation.</li>
<li><input disabled="" type="checkbox"> Frequent Compilation.</li>
<li><input disabled="" type="checkbox"> Binary Padding.</li>
<li><input disabled="" type="checkbox"> Armouring. It&rsquo;s helpful to avoid A/V but very suspicious and easy to spotâ€”examples: packed malware, polymorphic.</li>
<li><input disabled="" type="checkbox"> Dormant Malware ğŸ’¤.  <em>I&rsquo;ll think about that tomorrow. Tomorrow is another day.</em> (c, Gone With The Wind).</li>
<li><input disabled="" type="checkbox"> They are signing Code with Valid Cert. Thawte and Verisign are responsible for issuing certificates for malware.</li>
<li><input disabled="" type="checkbox"> Anti-Forensics/Timestamping. Timestamping is used to modify the timestamps of a file.</li>
<li><input disabled="" type="checkbox"> Rootkits.</li>
<li><input disabled="" type="checkbox"> &ldquo;Fileless&rdquo; Malware.</li>
</ul>
<h2 id="references">References</h2>
<details>
    <summary>Expand&hellip;</summary>
    <p>[<a href="https://www.coursera.org/learn/introduction-cybersecurity-cyber-attacks/home/welcome">1</a>] IBM course</p>
<p>[<a href="https://www.sentinelone.com/labs/macos-incident-response-part-1-collecting-device-file-system-data/">2</a>] Mac IR</p>
<p>[<a href="https://cybersecurity.att.com/blogs/security-essentials/incident-response-steps-comparison-guide">3</a>] NIST vs SANS IR frameworks</p>
<p>[<a href="https://www.sans.org/reading-room/whitepapers/incident/documentation-incident-response-air-tank-scuba-diving-2021">4</a>] Documentation is to Incident Response as an Air Tank is to Scuba Diving</p>
<p>[<a href="https://www.cynet.com/incident-response/incident-response-sans-the-6-steps-in-depth/">5</a>] Incident Response SANS: The 6 Steps in Depth</p>
<p>[<a href="https://aws.amazon.com/blogs/publicsector/building-a-cloud-specific-incident-response-plan/">6</a>] IR in the Cloud, SANS</p>
<p>[<a href="https://learning.oreilly.com/videos/digital-archaeology-livelessons/9780132853835/9780132853835-09_01/">1</a>] Digital Archaeology LiveLessons (Video Training), Safari by [Michael W Graves](<a href="https://learning.oreilly.com/search?query=author%3A%22Michael">https://learning.oreilly.com/search?query=author%3A&quot;Michael</a> W Graves&quot;&amp;sort=relevance&amp;highlight=true)</p>
<p>[<a href="https://www.coursera.org/lecture/digital-forensics-concepts/forensics-methodology-and-investigations-33wNN">2</a>] InfoSec Digital Forensics Course, module Forensics Methodology and Investigations</p>
<p>[<a href="https://www.eccu.edu/methodology-for-testing-forensic-hypothesis-and-finding-truth/#attend">3</a>] Webinar, METHODOLOGY FOR TESTING FORENSIC HYPOTHESIS AND FINDING TRUTH by Jessica Hyde</p>
<p>[<a href="https://ijcsit.com/docs/Volume%208/vol8issue3/ijcsit2017080331.pdf">4</a>] Live vs Dead System Acquisition</p>
<p>[<a href="https://www.coursera.org/learn/introduction-cybersecurity-cyber-attacks/home/welcome">5</a>] IBM course</p>

</details>
  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.bafc052229b4b40bf03c477d31c5cdd9352ece8afbadf35ab97ed14495098fc9.js"></script>
  

  
  
  
    
  


</body>

</html>
