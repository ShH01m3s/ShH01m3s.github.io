<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Network Activity Collection And Analysis - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.9d91cbb32c96c334ae7b38c3d99d30727e0836e1182125cc5f007d215f0b9e59.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-forensics ğŸ” and incident response ğŸ¥·">
      <a href="/docs/dfir">
        <span>Forensics ğŸ” and Incident Response ğŸ¥·</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-notes ğŸ“">
      <a href="/docs/notes">
        <span>Notes ğŸ“</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-forensics ğŸ” and incident response ğŸ¥·">
      <a href="/docs/dfir">
        <span>Forensics ğŸ” and Incident Response ğŸ¥·</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-notes ğŸ“">
      <a href="/docs/notes">
        <span>Notes ğŸ“</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/forensic-investigation/"> Back to Host Evidence Collection And Analysis Section ğŸ‘ˆğŸ¼ </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#network-devices-logs">Network Devices Logs</a>
      <ul>
        <li><a href="#collection">Collection</a></li>
        <li><a href="#analysis">Analysis</a></li>
      </ul>
    </li>
    <li><a href="#server-logs">Server Logs</a></li>
    <li><a href="#browser-activity">Browser Activity</a>
      <ul>
        <li><a href="#collection-1">Collection</a></li>
        <li><a href="#analysis-1">Analysis</a></li>
      </ul>
    </li>
    <li><a href="#analysis-2">Analysis</a>
      <ul>
        <li><a href="#todo">Todo</a></li>
      </ul>
    </li>
  </ul>
</nav>
 </aside>
 </div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Network Activity Collection And Analysis</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      <div class="article-category">domain: 
          
              
                <i class="fas fa-search"></i>
              
          <a class="category-link" href="/domain/forensics">forensics</a>
          
      </div> <br />
      
      <div class="article-category">doctype:
          
            
              
                <i class="fa fa-graduation-cap"></i>
              
          <a class="platform-link" href="/doctype/article">article</a>
          
      </div> <br /><br/>
      
      
      
      

      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <h2 id="network-devices-logs">Network Devices Logs</h2>
<h3 id="collection">Collection</h3>
<p>Most of the devices keep some sort of logs. As for the network related issues these are switches, routers, firewalls, IDS and IPS, web proxies, DC and authentication servers, DCHP server and application servers.</p>
<p>SIEMs are log aggregators. When configues correctly all logs and events from all systems in the enterprise flows to a cetralized repository where it can then be analysed. Sometimes these SIEM analyse what&rsquo;s normal and what&rsquo;s not. However, they are quite costy ğŸ’°.</p>
<p>There are several ways to capture the network traffic between machines.</p>
<p><strong>Network tap</strong> - a device that&rsquo;s place between other two or more devices on the network. I presume, hub can be considered a tap.</p>
<p><strong>SPAN port</strong> is another <a href="/docs/dfir/network/osi/network/attacks#span-port">option</a>.</p>
<p><strong>Packet sniffer</strong> (<code>tcpdump</code> or Wireshark ğŸ¦ˆ) installed on the host.</p>
<p>Legal Considerations for log acquisition:</p>
<ol>
<li>There should be a logging policy and users should be well aware of it, what&rsquo;s being logged. Mind the privacy issues.</li>
<li>Logs should be close to the event, otherwise they migth be rejected in court.</li>
<li>There should be people, who know what devices keep what logs, what structure do they have. These people should also test the software from time to time to make sure the logs are reliable. They might be asked to testify in court.</li>
<li>It&rsquo;s also preferrable that the logs structure is consistent across the enterprise.</li>
<li>Prolonged failures of logging should be documented and the reason determined as well.</li>
<li>Keep in mind that in case a legal prosecution, these logs will be available to the opposing counsel.</li>
<li>The backups and copies should be kept until the court states that they are no longer needed. For some standards there might be determined periods for keeping the logs. For example, in case of PCI-DSS it&rsquo;s 1 year.</li>
</ol>
<p>Logs and pcap files acquired should be documented thoroughly to be admissable. Collect the evidence, send them to a USB drive immediately and then get the hash for each file. Then, for each log and pcap keep the following entry:</p>
<ol>
<li>File name</li>
<li>Description</li>
<li>Location</li>
<li>Date and time (mind the timezone)</li>
<li>Collected by</li>
<li>MD5 or SHA hash</li>
</ol>
<p>[<a href="">1</a>] Digital forensics and Incident Response, G. Johansen</p>
<h3 id="analysis">Analysis</h3>
<h2 id="server-logs">Server Logs</h2>
<h2 id="browser-activity">Browser Activity</h2>
<h3 id="collection-1">Collection</h3>
<p>Many browsers are based on Chromium engine, thatâ€™s why they will have similar artifacts: Chrome, Opera, new Edge, Brave, Vivaldi. Also, there are lots of Electron applications that share some artifacts with them. Chrome is the point of convergence for all these application. On Magnet Summit it was suggested to explore and learn Chrome and itâ€™s artifacts as well as OS common artifacts due to its popularity and reusing some of its components. Electron is a framework that is available for building applications, cross-platform. Youâ€™re creating a web-application that can be used as a desktop one (implementing both back- and frontend). Backend - node.js, and frontend - Chrome. So, a lot of artifacts can be shared with Chrome and buddies. Itâ€™s in wide use. For example, âš ï¸ WhatsApp and Skype use it.</p>
<p>On Windows <code>hiberfil.sys</code>, <code>pagefile.sys</code> and <code>swapfile.sys</code> can also be used to retrieve this evidence from &ldquo;RAM-on-disk&rdquo;. Belkasoft EC can parse these files for browser artifacts.</p>
<h4 id="firefox">Firefox</h4>
<p>ğŸ›  <strong>Tools</strong>: Web Historian (<code>dat</code>, cookies and tmp), Firefox Forensics (cookies, download list and history), NetAnalysis ğŸ’° (history), CacheBack (cookies and history), Encase ğŸ’° (cookies, history and bookmarks), FTK ğŸ’°(cookies, history and bookmarks), Autopsy (cookies, history and bookmarks).</p>
<p>Most information is stored here: <code>C:\Documents and Settings\%Username%\Application Data\Mozilla\Firefox</code> (Windows XP), <code>C:\Users\%Username%\AppData\Roaming\Mozilla\Forefox\Profiles\%Profile%.default</code> (Windows Vista+), <code>/Library/Application Support/Firefox/Profiles</code> (macOS), <code>.mozilla/firefox/</code> for Linux. Use any SQLite DB Viewer to examine <code>*.default</code> files or any forensic platform. These profiles contain user activity such as searches, bookmarks, tabs etc.</p>
<table>
<thead>
<tr>
<th>artifact</th>
<th>Information</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Localstore.rdf</code></td>
<td>No real value for the examiner here, since it contains customized data on the interface. Can be cleared in the GUI with â€œReset toolbars and controlsâ€ option. [<a href="http://kb.mozillazine.org/Localstore.rdf">1</a>]</td>
</tr>
<tr>
<td><code>addons.json</code></td>
<td>I think, the file name speaks for itself. It contains all the data for installed addons.</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="chrome">Chrome</h4>
<p>Most information is stored here: <code>C:\Documents and Settings\%Username%\Local Setting\Application Data\Google\Chrome</code> (Windows XP), <code>C:\Users\%Username%\AppData\Local\Google\Chrome</code>. On Windows machine leveldb is stored here: <code>C:\%Username%\AppData\Local\Google\Chrome\User Data\Default\IndexedDB</code>. Contains multiple folders, one for each domain. Usually have the extension <code>leveldb</code>. The LevelDB store for a particular domain will be found in the IndexedDB folder with a name in the form: <code>[host with concurrent separators replaced an underscore]_[dbid].indexeddb.leveldb</code>. IndexedDB is just an API to use, while LevelDB is the artefact thatâ€™s creted when this API is used.</p>
<p><strong>Tools</strong> âš’ï¸: Magnet AXIOM ğŸ’°, Chrome Analyser (cookies, history, download list, bookmarks), NetAnalysis ğŸ’° (history), CacheBack (cookies and history), Autopsy (cookies, history and bookmarks).</p>
<h4 id="edge">Edge</h4>
<p><strong>Tools</strong> ğŸ› : Belkasoft Evidence Center ğŸ’°</p>
<h4 id="ie">IE</h4>
<p><code>C:\Documents and Settings\%username%\Local Settings\Temporary Internet Files\Content.IE5</code>, <code>C:\Documents and Settings\%username%\Local Settings\History\History.IE5</code>, <code>C:\Documents and Settings\%username%\Cookies</code> for Windows 2000.</p>
<p>Since Windows 7 <code>C:\Users\%username%\AppData\Local\Microsoft\Windows\Temporary Internet Files\Content.IE5</code>. However, IE plugins can&rsquo;t access it and OS created virtual folders for cached data unaccessible to general user. Cookies: <code>C:\Users\%username%\AppData\Roaming\Microsoft\Windows\Cookies</code> and  <code>C:\Users\%username%\AppData\Roaming\Microsoft\Windows\Cookies\Low</code> for low-privileged access if <em>protected</em> mode is enabled.</p>
<p>There is also some data in registry for this browser: <code>HKEY_USERS\.Default\Software\Microsoft\Internet Explorer\TYPEDURLs</code> and <code>HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\TYPEDURLs</code> contains search terms. If autocomplete was used, the final search term will be recorded.</p>
<p><strong>Tools</strong> ğŸ› . There is a huge amount of sowtware capable of parsing and collecting this information. Probably all of the forensic platforms can do it. At least, Autopsy and Magnet can. Also, free NirSoft software for web browser history parsing is available. Also, Web Historian can be used. Pasco (<code>dat</code>), Web Historian (<code>dat</code>, cookies, temp), Magnet AXIOM ğŸ’°, Index.dat Analyser (<code>dat</code>), NetAnalysis ğŸ’° (history), CacheBack (cookies and history), EncaseğŸ’° (cookies, history and bookmarks), FTKğŸ’° (cookies, history and bookmarks), Autopsy (cookies, history and bookmarks).</p>
<h4 id="opera">Opera</h4>
<p><strong>Tools</strong> ğŸ› : Magnet AXIOM ğŸ’°â“, NetAnalysis ğŸ’° (history), CacheBack (cookies and history), EncaseğŸ’° (cookies, history and bookmarks), FTKğŸ’° (cookies, history and bookmarks), Autopsy (cookies, history and bookmarks)â“.</p>
<h3 id="analysis-1">Analysis</h3>
<h2 id="analysis-2">Analysis</h2>
<p>Ports idetify services (usually, but not always).</p>
<ul>
<li>System ports are forensically important <code>0-1023</code>.</li>
<li>User ports <code>1024-49151</code></li>
<li>Private <code>49152</code>-last</li>
</ul>
<p>Cheatsheets for known ports <a href="https://packetlife.net/media/library/23/common-ports.pdf">here</a>.</p>
<p>Private IP addresses:</p>
<ul>
<li>10.0.0.0 - 10.55.55.55</li>
<li>17x.0.0.0</li>
<li>19x.0.0.0</li>
</ul>
<p>Make a list of notable ports and IP addresses. Look for open connections.</p>
<p><code>netstat -boan</code> statistics and current tcp connections along with the exe, listening port and PID. For Mac OS netstat there is no <code>-o</code> switch, so I&rsquo;ve used <code>netstat -ban</code>.</p>
<p>Filter out internal addresses (they are not interesting initially). Check the remote connections. Check executables that launched these connections, also look for port-services mismatch or unusual ports or services.</p>
<blockquote>
<p>ğŸ“ Make a list of processes and connections of several clean systems for &ldquo;known-good&rdquo; reference.</p>
</blockquote>
<p>Example of suspicious case: java listening on port <code>53</code> which is normally used by DNS service. FF using <code>3389</code> port (which is for remote connections). <code>44999</code> (used for private internal connections) some strange executable.</p>
<p>Windows Security Event Log <code>5156</code> is triggered when a network connection is allowed. 4688 - new process starting.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"> <span class="nb">write-EventLog</span> <span class="n">-eventID</span> <span class="n">5156</span> <span class="n">-EntryType</span> <span class="n">FailureAudit</span> <span class="n">-message</span> <span class="s2">&#34;hello&#34;</span> 
 <span class="p">&gt;</span><span class="n">Log</span> <span class="n">Application</span>
 <span class="p">&gt;</span><span class="n">Source</span> <span class="n">Application</span>
 
 <span class="n">auditpol</span> <span class="p">/</span><span class="nb">set </span><span class="p">/</span><span class="n">subcategory</span><span class="err">:â€</span><span class="n">Filtering</span> <span class="n">Platform</span> <span class="n">Connection</span><span class="err">â€</span> <span class="p">/</span><span class="n">success</span><span class="err">:</span><span class="n">disable</span> <span class="p">/</span><span class="n">failure</span><span class="err">:</span><span class="n">enable</span>
</code></pre></div><p><img src="images/5156-event.png" alt="5156-event"></p>
<p><code>5158</code> <code>5154</code> -&gt;</p>
<p><code>5158</code> -&gt; <code>5031</code> binding started and terminated by fw.</p>
<p>PID, Application field (path to the executable and exe name), Inbound/Outboun, sport/dport, addresses (src and dst), protocol field.</p>
<p>If you don&rsquo;t see some event ids that you are supposed to, then try turning on all auditin policy using <code>secpol.msc</code> or going to <code>Start -&gt; Windows Administrative Tools -&gt; Local Security Policy</code>. In the opened window then go to <code>Local Policies</code> and choose <code>Audit Policy</code>. Either turn on each of them or turn on the ones that you think are responsible I was able to star capturing event 5156. I was using Vbox with Windows Server 2019 installed and the machine promoted to DC (Active Directory Feauture installed).</p>
<p>Frequency analysis.</p>
<p>Block event codes.</p>
<p>Filter the record to indentify external IP addresses with which the PC is commincating. Then check external IPs reputations for suspicious using, for example, <code>hostintel</code>.</p>
<p>To use <a href="https://github.com/keithjjones/hostintel">hostintel</a>, install it following the instructions on GitHub. Then install geoip2 using  <code>pip install &quot;geoip2==3.0.0&quot; </code>. I got an error that <code>geoip.database</code> was not installed when I installed it with <code>pip install geoip2</code> or from GitHub. This module is for working with GeoIP databases.</p>
<p>To actually use these databases (one is included with the tool, but it mught get outdated), signup <a href="https://www.maxmind.com/en/geoip2-databases">here</a> and download GeoLite2 City from <a href="https://www.maxmind.com/en/accounts/410417/geoip/downloads">here</a>. This is an archive, unpack it and put the *.mmb file in <code>hostintel/data</code> folder (replace). These dbs are used by other tools as well, so you might want to keep it elsewhere and change its path in config.</p>
<p>Also, about the config. Edit this config - <code>hostintel/sampleconfig.conf</code>. By default, only GeoLite2 City is used, but you can add your free public API keys from different threat intelligence resources like VirusTotal, Censys, OTX, Passive Total or/and Shodan. You might want to rename it more appropriately, like <code>config.conf</code> or <code>aliens-are-among-us.conf</code> ğŸ‘½. But keep in mind the name of the config, whatever it is, to run the tool.</p>
<p>For running the tool, you&rsquo;ll also need to create a file with a list of IPs. I&rsquo;ve created a file <code>i.txt</code> in the <code>hostintel</code> directory and so my command was:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">python hostintel.py config.conf i.txt
</code></pre></div><p>How frequently is the host connecting to another machine? For how long? May be it is something legitimate. But if it&rsquo;s recent or/and not regular - might be an indicator.</p>
<p>Look for unusual application names of paths, typos or pokerhand ports (<code>44488</code> <code>12345</code> or alike). Or may some gibberish names. Unusual protocols - <code>1</code> (ICMP) <code>6</code> (TCP) <code>70</code> (UDP). Look for the ports outside of these three.</p>
<h3 id="todo">Todo</h3>
<p>ğŸ’¡ For each common nmap scan get the footrprint</p>
<p>ğŸ’¡ For each common DoS attack get the footprint</p>
<p>ğŸ’¡ Footprint for sqlmap</p>
<p>ğŸ’¡Footprint for common vulnerability scanners</p>
<p>ğŸ—’ [<a href="https://digitalforensicsurvivalpodcast.com/">1</a>] DFSP # 250 â€“ Network Triage Part <a href="https://digitalforensicsurvivalpodcast.com/2020/12/01/dfsp-250-network-triage-part-1/">1</a>, 2, 3, 4.</p>
<p>ğŸ—’ [<a href="https://www.youtube.com/watch?v=Xw536W7kbDQ">2</a>] SANS DFIR Webcast - Incident Response Event Log Analysis</p>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.1237ff71925bb8625c97a9af8db4c54525258bedfd7c47493daaff723bea755e.js"></script>
  

  
  
  
    
  


</body>

</html>
