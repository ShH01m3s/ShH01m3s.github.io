<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Data Carving - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/artefacts/data-recovery/"> 👈🏼 Back to </br> 🩻 Data Recovery </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#intro">Intro</a></li>
    <li><a href="#carving-techniques">Carving Techniques</a>
      <ul>
        <li><a href="#foremost">Foremost</a></li>
        <li><a href="#scalpel">Scalpel</a></li>
        <li><a href="#photorec">PhotoRec</a></li>
        <li><a href="#dd">dd</a></li>
      </ul>
    </li>
    <li><a href="#manual">Manual</a></li>
    <li><a href="#recovering-registry-entries">Recovering Registry Entries</a></li>
    <li><a href="#recovering-data-from-flash-drives">Recovering Data From Flash Drives</a></li>
    <li><a href="#fragmentation">Fragmentation</a></li>
    <li><a href="#slack-space">Slack space</a></li>
    <li><a href="#references">References</a>
      <ul>
        <li><a href="#1">1</a></li>
        <li><a href="#2">2</a></li>
        <li><a href="#3">3</a></li>
        <li><a href="#4">4</a></li>
        <li><a href="#5">5</a></li>
      </ul>
    </li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Data Carving</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      
      <div class="article-category">
          
            
            
            
            
            
              <i class="fab fa-linux"></i>&nbsp;<i class="fab fa-apple"></i>&nbsp;<i class="fab fa-windows"></i>&nbsp;<i class="fas fa-mobile"></i>
            
            
          
          
      </div> <br />
      

      
      

      
      <div class="article-tag">
          <i class="fas fa-tag"></i>
          
          
          <a class="tag-link" href="/tags/manual" rel="tag">manual</a>
          
      </div> 
      
    </div>
    
    <b>Created:</b> 06.10.2020
    <br />

    

  </header>


  <div class="content" itemprop="articleBody">
    <p><em>Below are the techniques, tools and instructions regarding data recovery from various file systems and devices. Most of the below techniques apply to HDDs only. Those that are for SDDs or other flash memory devices will be specified in the last section.</em></p>
<h2 id="intro">Intro</h2>
<p>There are several ways to recover deleted data. Some of them will vary for different file systems.</p>
<p>When data is deleted from a flash drive/SSD, all transistors are set to &ldquo;off&rdquo;. It doesn&rsquo;t mean though that data gets <em>deleted</em> the moment it was deleted by the user. Flash memory has a controller with a TRIM function and garbage collector. [<a href="#1">3</a>]</p>
<p>Use <code>sleuthkit</code> to gather some information. <code>mmstat &lt;disk_or_image&gt;</code> shows volume type. I&rsquo;ve run this command, but as I can conclude by the output, it&rsquo;s not volume type, but rather a partition schema. I wonder if these are the same things. <code>mmls -t &lt;partition_schema&gt; &lt;disk_or_image&gt;</code> shows the disk layout including unallocated space. No need to pass <code>&lt;partition_schema&gt;</code>; it&rsquo;s determined by the tool. Hence, no need to run <code>mmstat</code>. From the <code>mmls</code> we need to note the partition offset to use it with other tools. For example, <code>fsstat -o &lt;offset&gt; &lt;disk_or_image&gt;</code> shows detailed information about a partition. The output depends on the file system. For Linux 🐧 partitions, it&rsquo;ll show information about inodes etc. For NTFS - about NTFS metadata, for exFAT - FAT1 and Root directory. The same information but more detail can be viewed with 🛠 Active@Disk Editor. To view deleted files: <code>fls -o &lt;offset&gt; &lt;disk_or_image&gt;</code>. To export a timeline from the volume - <code>fls -r -m &quot;/&quot; -o &lt;offset&gt; &lt;disk_or_image&gt; &gt; bodyfile.txt</code> (<code>-r</code> - recursive, <code>-m</code> - use <code>mactime</code> input format to use with another tool, <code>\</code> - mount point question mark ❓). To create a timeline, run <code>mactime.pl -b &lt;bodyfile&gt; -d &gt; timeline.csv</code> [<a href="#1">1</a>]. To specify the timezone, add <code>-z</code> switch.</p>
<h2 id="carving-techniques">Carving Techniques</h2>
<p>Carving is something that can be used for any file system. There are two methods for carving:</p>
<ul>
<li>Block-based. Starts with a known header, examines each block and validates it, whether it could be the part of the file using data modeling. 🛠 Foremost (combines both methods)</li>
<li>Header/footer. Use search string engine to scan unallocated space for known headers. Then, looks for the first occurence of a footer. 🛠 Foremost (combines both methods), Scalpel.</li>
</ul>
<p>There are several prerequisited though:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> The header should be intact</li>
<li><input checked="" disabled="" type="checkbox"> The file should not be fragmented (different parts on different parts of the disk)</li>
</ul>
<h3 id="foremost">Foremost</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">foremost -t jpeg, tif, bmp -i  &lt;image/disk&gt; -o &lt;result_dir&gt;
</span></span><span class="line"><span class="cl">foremost -v -i &lt;image.dd&gt; -t png, jpg -o /path/to/output/folder
</span></span></code></pre></div><h3 id="scalpel">Scalpel</h3>
<p>Carver-recovery (aka Scalpel) looks for headers and footers. Scans the image/disk twice. First, it reads in 10MB chunks (default) logging every header and footer. On the second pass, it uses indexes created to collect files.</p>
<h3 id="photorec">PhotoRec</h3>
<h3 id="dd">dd</h3>
<h2 id="manual">Manual</h2>
<p>Open the data source in a hex editor (like HxD, Editor101, HexView etc). Look for the magic number for the file format you are looking for. Copy from header to footer, save as a new file and add the correct extension.</p>
<blockquote>
<p>🦠 Be cautious about those files carved and don&rsquo;t launch them on the main system if not sure.</p>
</blockquote>
<h2 id="recovering-registry-entries">Recovering Registry Entries</h2>
<p>Since the registry is unique to Windows systems, the following technique only applies to them. Registry has both unallocated space and unallocated deleted keys.</p>
<p>Use <code>deleted.pl</code>. Example: <code>deleted.pl SAM &gt; /cases/winforensics/SAM_recovered.txt</code>. Or use <a href="https://tzworks.com/prototype_page.php?proto_id=3">YARU</a>.</p>
<h2 id="recovering-data-from-flash-drives">Recovering Data From Flash Drives</h2>
<blockquote>
<p>🧪 I thought that data deleted from a flash drive is not recoverable. However, I was able to recover files from a FAT32 partitioned drive. Why?</p>
<p>❓ May be it&rsquo;s only until the flash drive is connected to the PC? Maybe once the power is taken away, the data is wiped?</p>
<p>✍️</p>
</blockquote>
<h2 id="fragmentation">Fragmentation</h2>
<p>When the data is stored scattered across the drive and needs to be reassembled first to become usable.</p>
<blockquote>
<p>However, through regular use, chunks of files commonly become physically displaced across the disk. A cure for this is defragmenting the disk. This process reduces the time required to access a file by moving the fragmented ‘blocks’ of files closer together. Understanding this concept is essential when analysing raw disk images. <a href="#5">5</a></p>
</blockquote>
<h2 id="slack-space">Slack space</h2>
<p>When a file is deleted, it&rsquo;s not deleted. The sector it used to occupy is now vacant but not zeroed out. If the new file is smaller and occupies less space in this vacant cluster, some data from the previous file would still be at the end of the cluster. Although it&rsquo;s not the whole file, it still can be helpful in some instances.</p>
<h2 id="references">References</h2>
<h3 id="1">1</h3>
<p>Windows Forensics Cookbook</p>
<h3 id="2">2</h3>
<p><a href="https://www.ufsexplorer.com/articles/chances-for-data-recovery.php">Chances for data recovery</a></p>
<h3 id="3">3</h3>
<p><a href="https://www.coursera.org/learn/windows-os-forensics/lecture/VMUiU/ntfs-file-recovery">Windows OS Forensics, Coursera, InfoSec Institute</a></p>
<h3 id="4">4</h3>
<p>Digital Archaeology by M. Graves</p>
<h3 id="5">5</h3>
<p>Sheward, Mike. Hands-on Incident Response and Digital Forensics (p. 130). BCS Learning &amp; Development Limited. Kindle Edition.</p>
  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.302a6fc365d5139fb98cf60bdb8f715d96257ea189161d36c190ccfa8182e569.js"></script>
  

  
  
  
    
  


</body>

</html>
