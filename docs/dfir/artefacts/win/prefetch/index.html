<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Prefetch - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting ğŸª¤">
      <a href="/docs/thunting">
        <span>Threat Hunting ğŸª¤</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference ğŸ“š">
      <a href="/docs/reference">
        <span>Tech Reference ğŸ“š</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-reverse ğŸ”§">
      <a href="/docs/reverse">
        <span>Reverse ğŸ”§</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting ğŸª¤">
      <a href="/docs/thunting">
        <span>Threat Hunting ğŸª¤</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference ğŸ“š">
      <a href="/docs/reference">
        <span>Tech Reference ğŸ“š</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/artefacts/win/"> ğŸ‘ˆğŸ¼ Back to </br> Windows Artefacts </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li>
          <ul>
            <li><a href="#â„¹-information-contained">â„¹ï¸ Information Contained</a></li>
            <li><a href="#-timestamps">â° Timestamps</a></li>
            <li><a href="#-structure-and-analysis">ğŸ” Structure and Analysis</a></li>
            <li><a href="#-caveats">ğŸ¤¨ Caveats</a></li>
            <li><a href="#-tools">ğŸ›  Tools</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Prefetch</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      

      
      

      
    </div>
    
    <b>Created:</b> 01.06.2023
    <br />

    

  </header>


  <div class="content" itemprop="articleBody">
    <p>Prefetch is for the efficiency of starting processes and their resources (movies for media players, spreadsheets for Excel for example). Improves startup time of applications. Each prefetch file name follows the pattern: <code>&lt;EXENAME&gt;-&lt;PATHHASHED+CMDARGS&gt;.pf</code>.</p>
<h4 id="â„¹-information-contained">â„¹ï¸ Information Contained</h4>
<ul>
<li>Filename</li>
<li>Creation time</li>
<li>Modified time</li>
<li>File Size</li>
<li>Process EXE</li>
<li>Process Path</li>
<li>Run Counter</li>
<li>Last Run Time</li>
<li>Missing Process + libraries and resources for each process.</li>
<li>Forensics value - tracks the execution of programs. Central repository of what was run on the system. File size can be used to search for the same process with a different name on a different machine.</li>
</ul>
<h4 id="-timestamps">â° Timestamps</h4>
<p><strong>Filesystem Timestamps</strong>. The first time the executable is run, a pf file is created. The last time it was run - a pf&rsquo;s file Modified date and time. However, consider a scenario when a program was run long time in the past, wasn&rsquo;t run for a while after that. Its pf file was overwritten (prefetch keeps 1024 entries). Some time after that the executable is run again and the pf file is created again. The FS timestamps will show that the file was first executed recently when it&rsquo;s not quite that straithforward.</p>
<h4 id="-structure-and-analysis">ğŸ” Structure and Analysis</h4>
<p>If collecting prefetch on a live system, run volatile collection tools before that and collect pf files to avoid overwriting oldest prefetch with prefetch for live response tools (or disable prefetch before collection).</p>
<p><strong>Path</strong> to files: C:\Windows\Prefetch. All prefetch have a <strong>signature</strong> at offset 4th byte. MAM - compressed and SCCA - plain text.</p>
<table>
<thead>
<tr>
<th>OS</th>
<th>Signature1 (version)</th>
<th>signature2 (type)</th>
</tr>
</thead>
<tbody>
<tr>
<td>WinXP &amp; 2003</td>
<td>0x00000011 or 17</td>
<td>SCCA</td>
</tr>
<tr>
<td>Vista</td>
<td>0x00000023 or 23</td>
<td>SCCA</td>
</tr>
<tr>
<td>W8</td>
<td>0x0000001a or 26</td>
<td>SCCA</td>
</tr>
<tr>
<td>W10</td>
<td>MAM</td>
<td>0x04</td>
</tr>
<tr>
<td>W10</td>
<td>0x0000001e or 30</td>
<td>SCCA</td>
</tr>
</tbody>
</table>
<p>Prefetch can be disabled in registry <code>C:\Windows\System32\config\SYSTEM</code>, key ğŸ”‘: <code>HKLM\SYSTEM\CurrentControlSet\Control\SessionManager\MemoryManagement\PrefetchParameters\Enable Prefetcher</code>:</p>
<table>
<thead>
<tr>
<th>key</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0</code></td>
<td>disabled</td>
</tr>
<tr>
<td><code>1</code></td>
<td>enabled for apps only</td>
</tr>
<tr>
<td><code>2</code></td>
<td>enabled for boot only</td>
</tr>
<tr>
<td><code>3</code></td>
<td>boot and app enabled (default)</td>
</tr>
</tbody>
</table>
<p>You can check it with <code>rip.exe</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">rip.exe -r SYSTEM -p prefetch <span class="c1"># to show whether prefetch is enabled</span>
</span></span></code></pre></div><h4 id="-caveats">ğŸ¤¨ Caveats</h4>
<p>On servers is usually turned off. And starting with Win10 - compressed. For systems with solid state drives it&rsquo;s also disabled. With Win8 - additional run times recorded. Also, there is latency issue - some apps are not closed upon clicking X, but remain running in background. Hence, the last time run might be different.</p>
<blockquote>
<p>If the app was deleted and then reinstalled? What the firtst run time will be?</p>
<p>What if I rename an executable?</p>
<p>If the exe is substitued?</p>
</blockquote>
<p>If the same exe was run from different locations - different <code>.pf</code> files. If the application was deleted, the info remains in prefetch.</p>
<blockquote>
<p>Write a sctipt to determine deleted files</p>
</blockquote>
<h4 id="-tools">ğŸ›  Tools</h4>
<p><strong>WinPrefetchView</strong>. To view pretech files (decompressed as well) in GUI.</p>
<p><strong>Fred</strong> - Forensic Registry Editor. To view exported hives.</p>
<p><strong>FTK Imager Lite</strong>. Fairly heavy footprint - 15-16Mb.</p>
<p><strong>CDQR</strong>. This tool focuses on the <code>pf</code> intself rather than on a data it contains. It&rsquo;s useful for making timelines.</p>
<p><strong>RegRipper (GUI and CUI)</strong>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">rip.exe -r SYSTEM -p prefetch <span class="c1"># to show whether prefetch is enabled</span>
</span></span></code></pre></div><p><strong>Prefetch parser.</strong> More info than with WinPrefetchView</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">prefetch.py -c -d -e
</span></span><span class="line"><span class="cl">prefetch.py -c -d &gt; pf.csv
</span></span><span class="line"><span class="cl">prefetch.py -f &lt;file_to_parse&gt; &gt; pf.txt
</span></span></code></pre></div><p>Columns: last executed, MFT sequence number, MFT record number, executable name, run counter,</p>
<p><strong>PECmd</strong>. Eric Zimmerman&rsquo;s tool.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">PECmd</span><span class="p">.</span><span class="n">exe</span> <span class="o">-f</span> <span class="p">&lt;</span><span class="n">pffile</span><span class="p">&gt;.</span><span class="n">pf</span>
</span></span><span class="line"><span class="cl"><span class="n">PECmd</span><span class="p">.</span><span class="n">exe</span> <span class="n">-d</span> <span class="s2">&#34;Prefetch folder&#34;</span> <span class="p">-</span><span class="n">-csv</span> <span class="s2">&#34;outoutdir&#34;</span> <span class="p">-</span><span class="n">-csvf</span> <span class="s2">&#34;outputfile&#34;</span>
</span></span></code></pre></div><h2 id="references">References</h2>
<details>
    <summary>Expand&hellip;</summary>
    Something here
</details>
  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.302a6fc365d5139fb98cf60bdb8f715d96257ea189161d36c190ccfa8182e569.js"></script>
  

  
  
  
    
  


</body>

</html>
