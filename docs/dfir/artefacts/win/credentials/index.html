<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ—ï¸ Credentials - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/artefacts/win/"> ğŸ‘ˆğŸ¼ Back to </br> ğŸªŸ Windows Artefacts </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#accounts">Accounts</a>
      <ul>
        <li><a href="#local-admin-rid-not-500">Local Admin (RID NOT <code>500</code>)</a>
          <ul>
            <li><a href="#-defense">ğŸ›¡ï¸ Defense</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#-attacks">âš”ï¸ Attacks</a>
      <ul>
        <li><a href="#-defense-1">ğŸ›¡ï¸ Defense</a></li>
      </ul>
    </li>
    <li><a href="#-detection-and--investigation">ğŸ”” Detection and ğŸ” Investigation</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">ğŸ—ï¸ Credentials</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      

      
      

      
    </div>
    
    <b>Created:</b> 09.06.2023
    <br />

    

  </header>


  <div class="content" itemprop="articleBody">
    <p><em>To carry out nearly any action on a system, one requires an account, which is typically safeguarded by passwords or other credentials. Hence, it is crucial to understand why attackers exhibit such a strong interest in acquiring them.</em></p>
<blockquote>
<p>â—ï¸It is advisable not to utilize CredSSP on machines running an operating system older than Windows 8 when using batch scripts, as CredSSP caches credentials on remote systems. Additionally, since CredSSP sends credentials over the network, it is vulnerable to Man-in-the-Middle (MiM) attacks.</p>
</blockquote>
<p><code>TsPkg</code> (Terminal Services Package): TsPkg is a security package used in Microsoft Windows operating systems. It is part of the authentication process for Remote Desktop Services (formerly known as Terminal Services). TsPkg is responsible for negotiating and exchanging credentials between the client and the server during the remote desktop session initiation.</p>
<p><code>Wdigest</code>: Wdigest is a Windows security package that handles the storage and retrieval of user credentials (such as usernames and passwords) for Windows authentication. It was primarily used in older versions of Windows, including Windows 7 and earlier. Wdigest stored user passwords in a less secure format compared to newer authentication protocols. As a result, it became a target for potential security vulnerabilities, leading to its deprecation in later versions of Windows.</p>
<h2 id="accounts">Accounts</h2>
<h3 id="local-admin-rid-not-500">Local Admin (RID NOT <code>500</code>)</h3>
<blockquote>
<p>â—ï¸This is not the same as the built-in admin account that&rsquo;s present on every Windows system and has RID <code>500</code>.</p>
</blockquote>
<blockquote>
<p>â—ï¸The use of a local admin account with a single password that grants remote access to all machines within an enterprise is considered a well-known vulnerability.</p>
</blockquote>
<h4 id="-defense">ğŸ›¡ï¸ Defense</h4>
<p><strong>Built-in</strong>:</p>
<ol>
<li>can&rsquo;t remotely write to <code>C$</code> and <code>Admin$</code> shares</li>
<li>can&rsquo;t use some remote management tools like <code>schtasks</code>, <code>at</code>, <code>wmic</code> (if it&rsquo;s disabled).</li>
</ol>
<p><strong>Custom</strong>:</p>
<ol>
<li>Unique strong passwords</li>
<li>No network logins for these accounts</li>
<li>2FA?</li>
</ol>
<h2 id="-attacks">âš”ï¸ Attacks</h2>
<h3 id="-defense-1">ğŸ›¡ï¸ Defense</h3>
<ol>
<li>UAC (MAC + least privilege).</li>
<li>A small number of apps should require admin privileges.</li>
<li>Managed Service accounts (good defence against Kerberos attacks): long complex passwords, frequent password changes. -&gt; Group Managed Service Accounts (flexible and admin-friendly).</li>
<li>Windows 8+
<ol>
<li>Doesn&rsquo;t cache credentials (even when using CredSSP), TsPkg, Wdigest.</li>
<li>New security groups were added. This restricted local admins from the network or remote interactive logons to domain-joint systems.</li>
<li>Some processes are marked as protected, and protected processes can&rsquo;t run unsigned code. LSASS process is one of the most important ones. This protection is off by default + one can sign the cred-dumping malware (like ğŸ› ï¸ <code>Mimikatz</code>).</li>
<li>Remote Desktop with <code>/restrictedAdmin</code> switch -&gt; creds are not pushed to the remote system.</li>
<li>Domain Protected Users, security group. They can&rsquo;t use NTLM, CredSSP or Digest authentication mechanisms (protection against some of the ğŸ› ï¸ <code>Mimikatz</code> techniques and pass-the-hash tools). Creds are not cached, nor are they delegated. Kerberos ticket ğŸ« lives for 4 hours tops. RC4 encryption is off (too weak).</li>
<li>Group Managed Service accounts (gMSA). With GMSA, one can use the same account for several services and can be used on multiple computers within the same domain. MSA and gMSA automate password management for services (managed by AD), eliminate the need to hardcode the credentials, adhere to the least privilege principle, and isolate service accounts.</li>
</ol>
</li>
<li>Windows 10+
<ol>
<li>Remote Credential Guard. Protects all the accounts, not only admin.</li>
<li>Credential Guard. Uses machine virtualisation to isolate creds.</li>
<li>Device Guard. Can lock a system to prevent the use of untrusted code.</li>
</ol>
</li>
</ol>
<h2 id="-detection-and--investigation">ğŸ”” Detection and ğŸ” Investigation</h2>
<p>ğŸº <strong>Artefacts</strong></p>
<p>Event logs</p>
<p>ğŸ¾ <strong>Detection Patterns</strong></p>
<ol>
<li>New accounts created (Windows <code>4720</code>)</li>
<li>Anomalous logins (workstation to workstation, sensitive networks) - <code>4624</code>, <code>4776</code></li>
<li>After-hours logins</li>
<li>Unusual locations</li>
<li>Ex-employees</li>
<li>Privileged account usage (Windows <code>4672</code>)</li>
</ol>
<h2 id="references">References</h2>
<details>
    <summary>Expand&hellip;</summary>
    Something here
</details>
  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.302a6fc365d5139fb98cf60bdb8f715d96257ea189161d36c190ccfa8182e569.js"></script>
  

  
  
  
    
  


</body>

</html>
