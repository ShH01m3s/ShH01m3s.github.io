<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Windows Core Processes - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/artefacts/win/"> 👈🏼 Back to </br> Windows Artefacts </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#boot">Boot</a></li>
    <li><a href="#main-processes">Main Processes</a></li>
    <li><a href="#the-process-tree">The process tree</a>
      <ul>
        <li><a href="#idle-or-system-idle-process">IDLE or System Idle Process</a></li>
        <li><a href="#system"><code>System</code></a></li>
        <li><a href="#memory-compression">Memory Compression</a></li>
        <li><a href="#smss"><code>smss</code></a></li>
        <li><a href="#winlogon"><code>winlogon</code></a></li>
        <li><a href="#wininit"><code>wininit</code></a></li>
        <li><a href="#lsass"><code>lsass</code></a></li>
        <li><a href="#svchost"><code>svchost</code></a></li>
        <li><a href="#csrss"><code>csrss</code></a></li>
        <li><a href="#taskhost"><code>taskhost</code></a></li>
        <li><a href="#lsaiso"><code>lsaiso</code></a></li>
        <li><a href="#userinit"><code>userinit</code></a></li>
        <li><a href="#explorer"><code>explorer</code></a></li>
        <li><a href="#iexplore"><code>iexplore</code></a></li>
        <li><a href="#lsm"><code>lsm</code></a></li>
        <li><a href="#services"><code>services</code></a></li>
      </ul>
    </li>
    <li><a href="#quick-check-list">Quick Check List</a>
      <ul>
        <li><a href="#singletons-vs-cloners">Singletons vs Cloners</a></li>
        <li><a href="#boot-vs-varies">Boot vs Varies</a></li>
        <li><a href="#system32-vs-other">System32 vs Other</a></li>
        <li><a href="#wincore-vs-other">WinCore vs Other</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Windows Core Processes</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      
      <div class="article-category">
          
            
              <i class="fab fa-windows"></i>          
            
            
            
            
            
            
          
          
      </div> <br />
      

      
      <div class="article-category">
        <i class="fas fa-tools"></i>
          
          
          <a class="platform-link" href="/tools/process-explorer">Process Explorer</a> 
          
      </div> <br />
      
      

      
    </div>
    
    <b>Created:</b> 28.09.2020
    <br />

    

  </header>


  <div class="content" itemprop="articleBody">
    <p><em>There are two broad categories of Windows core processes. Processes that initialize system environment and those that initialize the user environment. Whatever is the category, you need to know them well in order to detect abnormal things.</em></p>
<h2 id="boot">Boot</h2>
<p>BIOS, POST, Boo Loader (NLTDR), Kernl (NTOSKERNEL), files: win.sys, HAL.DLL, system.ini, sizedit.exe, config.exe, autoexec.BAT, MISCONFIG.exe.</p>
<h2 id="main-processes">Main Processes</h2>
<p>Below is the overview of the main processes in Windows. There are several core process that are important to examine since malware often drool 🤤 over them.  <strong>Singleton</strong> - one instance running only. One instance <code>lsass</code>, <code>services</code>, <code>System</code>, <code>winint</code>, <code>lsm.exe</code> ❓. If any of these having more than 1 process should be the object of further investigation.</p>
<p><img src="images/process-tree.png" alt="process-tree"></p>
<h2 id="the-process-tree">The process tree</h2>
<ul>
<li>IDLE</li>
<li>System (PID 4).
<ul>
<li>Memory Compression</li>
<li>smss.exe</li>
</ul>
</li>
<li>csrss</li>
<li>wininit
<ul>
<li>services</li>
<li>lsass</li>
</ul>
</li>
<li>winlogon
<ul>
<li>logonUI. Terminates once complete</li>
<li>userinit. Terminates once complete
<ul>
<li>explorer</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="idle-or-system-idle-process">IDLE or System Idle Process</h3>
<p><strong>Parent</strong> 🤱: None.</p>
<p><strong>Children</strong> 👧 :  None</p>
<p><strong>Singleton</strong> ☝️:</p>
<p><strong>Path to file</strong> 🛣: None</p>
<p><strong>Account</strong>: Local System</p>
<p><strong>Start time</strong>: Boot</p>
<p>The first and the most importnat process that &ldquo;gives birth&rdquo; to other processes - <code>IDLE</code>. 🔍 It <strong>doesn&rsquo;t have an image file on disk</strong>, so if you see <code>IDLE.exe</code>, it is most likely a malware 🦠 (or you have been sophisticatedly pranked 😉). PID is usually 0.</p>
<blockquote>
<p>🔎 Are <code>IDLE</code> and <code>System Idle Process</code> the same thing?</p>
<p>🧪 If I dump a process that doesn&rsquo;t have an image file, will it still have a PE header?</p>
</blockquote>
<p>Runs in system memory space.</p>
<h3 id="system"><code>System</code></h3>
<p><strong>Parent</strong> 🤱: None.</p>
<p><strong>Children</strong> 👧 :  <a href="#sms">smss</a>, Interrupts, <a href="#Memory-Compression">Memory Compression</a></p>
<p><strong>Singleton</strong> ☝️: Yes</p>
<p><strong>Path to file</strong> 🛣: None</p>
<p><strong>Account</strong>: Local System</p>
<p><strong>Start time</strong>: Boot</p>
<p>Handles kernel mode system threads, different device drivers, waiting for I/O etc. PID is usually 4.</p>
<p>Runs in system memory space.</p>
<h3 id="memory-compression">Memory Compression</h3>
<p><strong>Parent</strong> 🤱: <a href="#System">System</a></p>
<p><strong>Children</strong> 👧 :  None</p>
<p><strong>Singleton</strong> ☝️:</p>
<p><strong>Path to file</strong> 🛣: None</p>
<p><strong>Account</strong>: Local System</p>
<p><strong>Start time</strong>: Boot</p>
<p>Compresses the memory of the user space. Doesn&rsquo;t have an image file on disk. Not really interesting for DFIR.</p>
<h3 id="smss"><code>smss</code></h3>
<p><strong>Parent</strong> 🤱: <a href="#System">System</a></p>
<p><strong>Children</strong> 👧 :  None</p>
<p><strong>Singleton</strong> ☝️: No</p>
<p><strong>Path to file</strong> 🛣: System32</p>
<p><strong>Account</strong>: Local System</p>
<p><strong>Start time</strong>: Boot</p>
<p>Session manager process. The first user-mode process. Run from <code>System32</code> directory. There are two instances:</p>
<ul>
<li><strong>master instance</strong> perfroms some init stuff. Reads and writes to registry preparing the OS for use. Initializes the registry hives</li>
<li>session startup instance. Creates three subsystem processes and exits: csrss.exe,</li>
</ul>
<h3 id="winlogon"><code>winlogon</code></h3>
<p><strong>Parent</strong> 🤱: None.</p>
<p><strong>Children</strong> 👧 :  None</p>
<p><strong>Singleton</strong> ☝️: No</p>
<p><strong>Path to file</strong> 🛣: System32</p>
<p><strong>Account</strong>: Local System</p>
<p><strong>Start time</strong>: varies</p>
<p>Another process of particilar interest is <code>msc</code>.</p>
<h3 id="wininit"><code>wininit</code></h3>
<p><strong>Parent</strong> 🤱: None.</p>
<p><strong>Children</strong> 👧 :  <a href="#lsm">lsm</a>, <a href="#lsass">lsass</a>, <a href="#services">services</a></p>
<p><strong>Singleton</strong> ☝️: Yes</p>
<p><strong>Path to file</strong> 🛣: System32</p>
<p><strong>Account</strong>: Local System</p>
<p><strong>Start time</strong>: Boot</p>
<h3 id="lsass"><code>lsass</code></h3>
<p><strong>Parent</strong> 🤱: <a href="#wininit">wininit</a></p>
<p><strong>Children</strong> 👧 :  None</p>
<p><strong>Singleton</strong> ☝️: Yes</p>
<p><strong>Path to file</strong> 🛣: System32</p>
<p><strong>Account</strong>: Local System</p>
<p><strong>Start time</strong>: Boot</p>
<p><code>lsass</code>. This is the main process of Windows OS that&rsquo;s responsible for authentication and authorisation. More about lsass <a href="/docs/dfir/reference/windows/win-lsa">here</a>.</p>
<h3 id="svchost"><code>svchost</code></h3>
<p><strong>Parent</strong> 🤱: <a href="#services">services</a></p>
<p><strong>Children</strong> 👧 :  Lots of:</p>
<p><strong>Singleton</strong> ☝️: No</p>
<p><strong>Path to file</strong> 🛣: System32</p>
<p><strong>Account</strong>: Local System, Network Service, Local Service</p>
<p><strong>Start time</strong>: Boot</p>
<p>🦠 This one is very ofter used by malware for disguise. It has lot&rsquo;s of instances.</p>
<h3 id="csrss"><code>csrss</code></h3>
<p><strong>Parent</strong> 🤱: none</p>
<p><strong>Children</strong> 👧 :</p>
<p><strong>Singleton</strong> ☝️: No</p>
<p><strong>Path to file</strong> 🛣: System32</p>
<p><strong>Account</strong>: Local System</p>
<p><strong>Start time</strong>: Boot</p>
<h3 id="taskhost"><code>taskhost</code></h3>
<p><strong>Parent</strong> 🤱: <a href="#services">services</a></p>
<p><strong>Children</strong> 👧 :  Lots of:</p>
<p><strong>Singleton</strong> ☝️: No</p>
<p><strong>Path to file</strong> 🛣: System32</p>
<p><strong>Account</strong>: many</p>
<p><strong>Start time</strong>: varies</p>
<h3 id="lsaiso"><code>lsaiso</code></h3>
<p><strong>Parent</strong> 🤱: <code>winint.exe</code></p>
<p><strong>Children</strong> 👧 :  None</p>
<p><strong>Singleton</strong> ☝️: Yes</p>
<p><strong>Path to file</strong> 🛣: None</p>
<p><strong>Account</strong>: Local System</p>
<p><strong>Start time</strong>: Boot</p>
<p><strong>Windows Credential Guard</strong>. Only for Windows 10 Enterprise or Windows Server 2016 and above. Also, this exe is present on a Windows 11 system, but is not running. It&rsquo;s a singleton and is located on disk in System32 directory. It runs under local system account and it&rsquo;s parent is <code>winint.exe</code>. Works in the isolated user mode, so that even the kernel doesn&rsquo;t have access to it. Secure Kernel protected by Hyper-V is talking to lsaiso instead. Kernel Mode and Secure Kernel are talking using a small buffer. VSL calls. Between SK and lsaiso - sys call. VSM container: lsaiso, credentials, secure kernel, kernel mode code integrity. HVCI - Hyper-V code integrity.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">mimikatz</span><span class="p">.</span><span class="n">exe</span>
</span></span><span class="line"><span class="cl"><span class="p">&gt;</span> <span class="n">version</span>
</span></span><span class="line"><span class="cl"><span class="n">privilege</span><span class="p">::</span><span class="n">debug</span>
</span></span><span class="line"><span class="cl"><span class="n">securlsa</span><span class="p">::</span><span class="n">logonpasswords</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&gt;</span> <span class="n">misc</span><span class="p">::</span><span class="n">memssp</span>
</span></span></code></pre></div><h3 id="userinit"><code>userinit</code></h3>
<p><strong>Parent</strong> 🤱: <code>winlogon</code></p>
<p><strong>Children</strong> 👧 :  <a href="#explorer">explore</a></p>
<p><strong>Singleton</strong> ☝️:</p>
<p><strong>Path to file</strong> 🛣:</p>
<p><strong>Account</strong>:</p>
<p><strong>Start time</strong>:</p>
<h3 id="explorer"><code>explorer</code></h3>
<p><strong>Parent</strong> 🤱: <code>userinit</code>. Since the parent terminates once it&rsquo;s done everything, <code>explorer</code> won&rsquo;t have a parent in process tree.</p>
<p><strong>Children</strong> 👧 :  <a href="#iexplore">iexplore</a></p>
<p><strong>Singleton</strong> ☝️: No</p>
<p><strong>Path to file</strong> 🛣: <code>%Systemroot%\</code></p>
<p><strong>Account</strong>: Local Users</p>
<p><strong>Start time</strong>: varies</p>
<h3 id="iexplore"><code>iexplore</code></h3>
<p><strong>Parent</strong> 🤱: <code>explorer</code></p>
<p><strong>Children</strong> 👧 :  None</p>
<p><strong>Singleton</strong> ☝️: Yes</p>
<p><strong>Path to file</strong> 🛣: <code>Program Files\Internet Explorer\iexplore.exe</code></p>
<p><strong>Account</strong>: Local Users</p>
<p><strong>Start time</strong>: Boot</p>
<h3 id="lsm"><code>lsm</code></h3>
<p><strong>Parent</strong> 🤱: <a href="#wininit">wininit</a></p>
<p><strong>Children</strong> 👧 :  None</p>
<p><strong>Singleton</strong> ☝️: Yes</p>
<p><strong>Path to file</strong> 🛣: System32</p>
<p><strong>Account</strong>: Local System</p>
<p><strong>Start time</strong>: Boot</p>
<h3 id="services"><code>services</code></h3>
<p><strong>Parent</strong> 🤱: <a href="#wininit">wininit</a></p>
<p><strong>Children</strong> 👧 :  <a href="#svchost">svchost</a>, <a href="#taskhost">taskhost</a></p>
<p><strong>Singleton</strong> ☝️: Yes</p>
<p><strong>Path to file</strong> 🛣: System32</p>
<p><strong>Account</strong>: Local System</p>
<p><strong>Start time</strong>: Boot</p>
<h2 id="quick-check-list">Quick Check List</h2>
<h3 id="singletons-vs-cloners">Singletons vs Cloners</h3>
<p><strong>Singletons</strong>: System, wininit, lsass.exe, lsm.exe, lsaiso, services.exe</p>
<p><strong>Cloners</strong>: sms, taskhost, winlogon, iexplore, explorer, svchost, csrss</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">grep -E -i <span class="s2">&#34;(system|wininit|lsass|lsm|services)&#34;</span> <span class="s2">&#34;psscan.txt|pslist.txt&#34;</span> &gt; singletons.txt
</span></span></code></pre></div><h3 id="boot-vs-varies">Boot vs Varies</h3>
<p><strong>Boot</strong>:  System, sms, wininit, lsass, lsm, svchost*, services, csrss</p>
<p><strong>Varies</strong>: taskhost, winlogon, iexplore, explorer, svchost*</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">grep -E -i <span class="s2">&#34;(system|wininit|lsass|lsm|services|sms|csrss)&#34;</span> <span class="s2">&#34;psscan.txt|pslist.txt&#34;</span> &gt; boottime.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">grep -E -i -v &lt;2019-01-20&gt; psscan.txt &gt; nonboot.txt
</span></span></code></pre></div><h3 id="system32-vs-other">System32 vs Other</h3>
<p><strong>System32</strong>: System, sms, wininit, taskhost, lsass, winlogon, lsm, svchost, services, csrss, lsaiso</p>
<p><strong>Other</strong>: iexplore, explorer</p>
<h3 id="wincore-vs-other">WinCore vs Other</h3>
<p><strong>Non Wincore</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">grep -E -i -v <span class="s2">&#34;(system|wininit|lsass|lsm|services|sms|taskhost|winlogon|iexplore|explorer|svchost|csrss)&#34;</span> <span class="s2">&#34;psscan.txt|pslist.txt&#34;</span> &gt; all_non_core.txt
</span></span></code></pre></div><p><strong>WinCore</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">grep -E -i <span class="s2">&#34;(system|wininit|lsass|lsm|services|sms|taskhost|winlogon|iexplore|explorer|svchost|csrss)&#34;</span> <span class="s2">&#34;psscan.txt|pslist.txt&#34;</span> &gt; all_non_core.txt
</span></span></code></pre></div><h2 id="references">References</h2>
<p>[<a href="">1</a>] SDF Podcast, by Michael Leclair</p>
  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.302a6fc365d5139fb98cf60bdb8f715d96257ea189161d36c190ccfa8182e569.js"></script>
  

  
  
  
    
  


</body>

</html>
