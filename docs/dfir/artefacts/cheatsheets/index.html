<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Artefacts CheatSheet - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-dfir ğŸ”">
      <a href="/docs/dfir">
        <span>DFIR ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit ğŸ§°">
      <a href="/docs/toolkit">
        <span>Toolkit ğŸ§°</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/dfir/artefacts/"> ğŸ‘ˆğŸ¼ Back to </br> ğŸ“œ Artefacts DB </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#how-do-i-find-programs-executed">How do I find programs executed?</a>
      <ul>
        <li><a href="#windows">Windows</a>
          <ul>
            <li><a href="#services">Services</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#where-do-i-look-for-ospc-info">Where do I look for OS/PC info?</a>
      <ul>
        <li><a href="#windows-1">Windows</a></li>
        <li><a href="#macos">macOS</a></li>
        <li><a href="#linux">Linux</a></li>
      </ul>
    </li>
    <li><a href="#how-to-see-who-logged-in-and-out">How to see who logged in and out?</a>
      <ul>
        <li><a href="#windows-2">Windows</a>
          <ul>
            <li><a href="#event-logs">Event Logs</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#how-do-i-spot-reconnaissance-activity">How do I spot reconnaissance activity?</a>
      <ul>
        <li><a href="#windows-3">Windows</a>
          <ul>
            <li><a href="#event-logs-1">Event logs</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#how-do-i-see-the-users-recent-activity">How do I see the user&rsquo;s recent activity?</a>
      <ul>
        <li><a href="#windows-4">Windows</a></li>
      </ul>
    </li>
    <li><a href="#how-do-i-find-out-injection-attempts">How do I find out injection attempts?</a>
      <ul>
        <li><a href="#windows-5">Windows</a></li>
      </ul>
    </li>
    <li><a href="#remote-activity">Remote activity</a>
      <ul>
        <li><a href="#windows-6">Windows</a>
          <ul>
            <li><a href="#event-logs-2">Event Logs</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#how-to-track-account-creation-activity">How to track account creation activity</a>
      <ul>
        <li><a href="#windows-7">Windows</a>
          <ul>
            <li><a href="#event-logs-3">Event logs</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#usb-devices">USB Devices</a>
      <ul>
        <li><a href="#windows-8">Windows</a></li>
      </ul>
    </li>
    <li><a href="#how-to-spot-scheduled-tasks">How to spot scheduled tasks?</a>
      <ul>
        <li><a href="#windows-9">Windows</a>
          <ul>
            <li><a href="#event-logs-4">Event logs</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#brute-force-activity">Brute-force activity</a>
      <ul>
        <li><a href="#windows-10">Windows</a>
          <ul>
            <li><a href="#event-logs-5">Event logs</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#how-to-spot-running-malicious-processes">How to spot RUNNING malicious processes?</a></li>
    <li><a href="#how-to-spot-malicious-filesimages">How to spot malicious files/images?</a></li>
    <li><a href="#how-to-find-passwords">How to find passwords?</a></li>
    <li><a href="#how-to-check-if-the-logs-are-cleared">How to check if the logs are cleared?</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Artefacts CheatSheet</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      

      
      

      
    </div>
    
    <b>Created:</b> 18.06.2023
    <br />

    

  </header>


  <div class="content" itemprop="articleBody">
    <p><em>This is about &hellip; .</em></p>
<h2 id="how-do-i-find-programs-executed">How do I find programs executed?</h2>
<h3 id="windows">Windows</h3>
<p>You can use Prefetch which is the most reliable source. However, if the program is NOT there, it doesn&rsquo;t mean it wasn&rsquo;t executed.</p>
<p>Another artefact of use is AmCache. What&rsquo;s great about it is that it stores hashes among all. Although it&rsquo;s not proof of the program being executed, it can show the PRESENCE of files (exe and drivers) on the system.</p>
<p><strong>ShimCache</strong>.</p>
<p>It is ok to collect artefacts like that manually, but it&rsquo;s better to do so at scale. Some tools were designed to process these artefacts and put everything in an SQL database.</p>
<p>ğŸ› ï¸ <code>AppCompatProcessor.py</code> <a href="https://github.com/mbevilacqua/appcompatprocessor">GitHub</a> - parses both ğŸº <code>ShimCache</code> and ğŸº <code>AppCompatCache</code>. This tool has some modules to improve the investigation process (search using <code>regex</code>, <code>reconscan</code>, <code>filehitcount</code>, <code>stack</code> etc.). One of particular interest is <code>tcorr</code>, which performs temporal correlation of execution (files that are usually executed closer in time). <code>leven</code> finds files that are slightly different in names from known executables, and <code>rndsearch</code> - attempts to identify randomly named files.</p>
<p><strong>Event Logs</strong>.</p>
<h4 id="services">Services</h4>
<p>Services are managed by SCM (Service Control Manager). The same process triggers Security (4697) and System (7034, 7035, 7036, 7040 and 7045) events.</p>
<ol>
<li>ğŸ›¡ï¸ <code>Security</code> (<code>4697</code>) - service was installed</li>
<li>âš™ï¸ <code>System</code>
<ol>
<li><code>7034</code> - service crashed</li>
<li><code>7035</code> - SCM has sent a start/stop request</li>
<li><code>7036</code> - the service was started/stopped</li>
<li><code>7040</code> - start type was changed for a service</li>
<li><code>7045</code> - the service was installed</li>
</ol>
</li>
</ol>
<blockquote>
<p>â—ï¸PsExec process creates a new service when executed and deletes it afterwards, expect <code>4697</code> and <code>7045</code> EID.
â—ï¸Services are usually executing within a service account, user account running a service is something worth looking into.</p>
</blockquote>
<h2 id="where-do-i-look-for-ospc-info">Where do I look for OS/PC info?</h2>
<h3 id="windows-1">Windows</h3>
<p>Registry, of course.</p>
<p><strong>AmCache</strong>. You can see firmware, hardware and OS info there. Although the artefact has proved to be highly &ldquo;volatile&rdquo;, it might change from update to update.</p>
<h3 id="macos">macOS</h3>
<h3 id="linux">Linux</h3>
<h2 id="how-to-see-who-logged-in-and-out">How to see who logged in and out?</h2>
<h3 id="windows-2">Windows</h3>
<h4 id="event-logs">Event Logs</h4>
<p>There is a fine line between logon and <em>account</em> logon events, and that line is not just one word. The main idea is that logon is the event on the system that wants to chat, whilst account logon is the event on the server/remote system that our computer wants to talk to: user authentication and logon from the Security trail. Event codes <code>4624</code>.</p>
<p>Most events are logged on the target machine, but you can also see these events on the source machine. That happens when the user authenticates locally with the credentials from the SAM database (NTLM protocol); you will see EID <code>4776</code> (NTLM creds used for logon) for both successful and failed logons.</p>
<p>When the Kerberos protocol is in use, expect the following events in the logs:</p>
<ol>
<li><code>4768</code> (successful login)</li>
<li><code>4771</code> (failed login)</li>
<li><code>4769</code> (successful authentication to a resource server, aka service ticket granted)</li>
<li><code>4776</code> - pass-the-hash. To block/unblock the ability to use this for sensitive accounts, <code>LocalAccountTokenFilterPolicy</code>.</li>
</ol>
<p>When the logon is failing, the following error codes are the most frequently used (NTLM ğŸ—ï¸ and Kerberos ğŸ•â€ğŸ¦º):</p>
<ol>
<li>ğŸ—ï¸ <code>C0000064</code> (ğŸ•â€ğŸ¦º <code>0x6</code>) - the username provided is invalid (doesn&rsquo;t exist).</li>
<li>ğŸ—ï¸ <code>C000006A</code> (ğŸ•â€ğŸ¦º <code>0x18</code>) - the password provided is invalid.</li>
<li>ğŸ—ï¸ <code>C0000070</code> (ğŸ•â€ğŸ¦º <code>0xC</code>) - unauthorised workstation.</li>
<li>ğŸ—ï¸ <code>C0000234</code> (ğŸ•â€ğŸ¦º <code>0x12</code>) - account is locked.</li>
<li>ğŸ—ï¸ <code>C0000071</code> (ğŸ•â€ğŸ¦º <code>0x17</code>) - the password has expired.</li>
<li>ğŸ•â€ğŸ¦º <code>0x7</code> - server was not found.</li>
<li>ğŸ•â€ğŸ¦º <code>0x25</code> - the time difference between the machines is too big.</li>
</ol>
<p>ğŸ‘´ğŸ¼ XP: 672, 673, 675, 680, 529.</p>
<p>Sometimes, the credentials are different for different resources. When those credentials are different from the creds in memory, the credentials are provided explicitly. That is when EID <code>4624</code> (logon type <code>9</code>) gets recorded. Most scripts and hacker tools REQUIRE explicit credentials, so that&rsquo;s a good lead. Also, keep in mind that the following three user categories are those that require switching accounts and using credentials explicitly the most often:</p>
<ol>
<li>Admins</li>
<li>Attackers</li>
<li>Services</li>
</ol>
<p>When UAC window pops up, it also triggers this event. RDP activity using different creds also generate event <code>4648</code> on both the originating and the target systems.</p>
<p>ğŸ› ï¸ <code>CobalStrike</code> tool has two modules: <code>pth</code> and <code>make_token</code>, both using explicit credentials. Hence, it triggers <code>4624</code> type <code>9</code> logon EID and <code>4648</code> (explicit creds); the latter records both the source AND the target.</p>
<h2 id="how-do-i-spot-reconnaissance-activity">How do I spot reconnaissance activity?</h2>
<h3 id="windows-3">Windows</h3>
<h4 id="event-logs-1">Event logs</h4>
<p>Monitoring for these events will cause a lot of noise and false positives. You need to do it in a smart way:</p>
<ol>
<li>Filter for sensitive groups</li>
<li>Whitelist those processes performing such activity legitimately: <code>mmc.exe</code>, <code>services.exe</code>, <code>taskhost.exe</code>, <code>explorer.exe</code>, <code>vsssvc.exe</code>. Presume everything else to be unusual.</li>
<li>What accounts are NOT supposed to do recon?</li>
<li>What group was queried? <code>Administrators</code> group (or other groups with higher privileges) is the most desirable piece of the pie.</li>
</ol>
<p><code>4798</code> - user&rsquo;s local group membership enum.
<code>4799</code> - security-enabled local group membership enum.</p>
<p>Group Policy -&gt; Advanced Auditing setting to set up Audit Security Group Management and User Account Management.</p>
<p>ğŸ› ï¸ <code>PowerSploit</code> and ğŸ› ï¸ <code>Empire</code> both use <code>PowerView</code> cmdlet set to perform recon activity for the Windows environment. ğŸ› ï¸ <code>DeathStar</code> from ğŸ› ï¸ <code>Empire</code> is a wrapper around it.</p>
<h2 id="how-do-i-see-the-users-recent-activity">How do I see the user&rsquo;s recent activity?</h2>
<h3 id="windows-4">Windows</h3>
<p><strong>Event Logs</strong>. Attempted logons and account usage.</p>
<p><img src="images/event-logon1.png" alt="img">
The activity starts with <code>4624</code> (user logged in), optionally followed by <code>4801</code> (machine unlocked) and <code>4800</code> (unlocked) events until eventually it&rsquo;s the session is dissolved by the <code>4647</code> (user initiated logoff) or <code>4634</code> (successful logoff) events.</p>
<p>ğŸ¤·ğŸ»â€â™€ï¸ - optional</p>
<p><code>4720</code> ğŸ¤·ğŸ»â€â™€ï¸ (account created) - <a href="https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4776"><code>4776</code></a> (validate creds) - <code>4625</code> ğŸ¤·ğŸ»â€â™€ï¸ (failed login) - <code>4624</code> (normal successful login) - <code>4672</code> ğŸ¤·ğŸ»â€â™€ï¸ (admin login) - <code>4648</code> ğŸ¤·ğŸ»â€â™€ï¸ (explicit creds used, like when running ğŸ› ï¸ <code>runas</code> ğŸ“š <a href="https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4648">docs</a>) - <code>4647</code> (interactive logoff initiated) - <code>4634</code> ğŸ¤·ğŸ»â€â™€ï¸ (logoff event, not always consistent) - <code>4726</code> ğŸ¤·ğŸ»â€â™€ï¸ (account deleted).</p>
<blockquote>
<p>ğŸ“ <code>4624</code> - successful logon. Successful login. Type <code>2</code> (console). Bear in mind that DWM (Desktop Win Manager) and UMFD (Font Driver Host) also use this Type 2 event. Filter it out (DWM|UMFD + RegEx + Exclude in Event Log Explorer filter). These are for domain accounts.</p>
</blockquote>
<p>Using <code>Logon ID</code> you can link logon event to a logoff event and check the session duration.</p>
<h2 id="how-do-i-find-out-injection-attempts">How do I find out injection attempts?</h2>
<h3 id="windows-5">Windows</h3>
<p>Sysmon logs, <code>25</code>.</p>
<h2 id="remote-activity">Remote activity</h2>
<h3 id="windows-6">Windows</h3>
<h4 id="event-logs-2">Event Logs</h4>
<h5 id="rdp">RDP</h5>
<ol>
<li>On <strong>source</strong> machine:
<ol>
<li><code>Security</code>ğŸ›¡ï¸ (<code>4648</code>)</li>
<li><code>TerminalServices-RDPClient</code> ğŸŒ¸ (<code>1024</code> and <code>1102</code>)</li>
</ol>
</li>
<li>On the <strong>target</strong> machine:
<ol>
<li><code>Security</code> ğŸ›¡ï¸ (<code>4624</code>, logon type <code>10</code>, <code>4778</code> and <code>4779</code>), see <code>Session name</code> to confirm it&rsquo;s an RDP.</li>
<li><code>Remote Desktop Services-RDPCoreTs</code> ğŸ‡ (<code>131</code>, <code>98</code>)</li>
<li><code>TerminalServices-RemoteConnectionManager</code> ğŸ (<code>1149</code>)</li>
<li><code>TerminalServices-LocalSessionManager</code> ğŸ(<code>21</code>, <code>22</code>, <code>25</code>, <code>41</code>)</li>
</ol>
</li>
</ol>
<p>Some breakdown of the above-mentioned codes (even if already explained elsewhere). You might filter for <code>4624</code> event id with logon type <code>10</code> to see the RDP connections. However, bear in mind that this event only records the <strong>NEW</strong> connections, not RE-connects. 4624 type 7 is triggered when lock/unlock activity happens. You will see <code>4778</code> for reconnects and <code>4779</code> for disconnects. <code>Client name</code> in <code>4778</code> shows the original machine name of the actor, giving some clues about the attacker.</p>
<blockquote>
<p>â—ï¸Logon IDs for 4624 and 4778 might differ even though they represent the same session. This happens because the earlier created logon ID is often used instead. Search for 4624 events preceded by 4647 to find the logon 4624 event with the same ID.</p>
<p>â—ï¸ Username in 4624 might NOT be the name of the original machine if some VPN or proxy is handling the connection.</p>
<p>â—ï¸ You might also see logon type 3 (4624). It&rsquo;s not commonly used instead of type 10 if NLA is on and authenticating the client before establishing the RDP session.</p>
</blockquote>
<p>Several event log trails can give some insight into RDP connection: ğŸ›¡ï¸<code>Security</code>, <code>Remote Desktop Services-RDPCoreTs</code> ğŸ‡, <code>TerminalServices-LocalSessionManager</code> ğŸ,  <code>TerminalServices-RemoteConnectionManager</code> ğŸ <code>TerminalServices-RDPClient</code> ğŸŒ¸:</p>
<table>
<thead>
<tr>
<th>ğŸ¤¦ğŸ½â€â™‚ï¸ Actor</th>
<th>source ip and username (ğŸ‡ <code>131</code>, <code>98</code>ğŸ›¡ï¸<code>4648</code>, <code>4624</code>, <code>4778</code>, <code>4779</code>, ğŸ <code>1149</code>ğŸ<code>21</code>, <code>22</code>, <code>25</code>, 41)<!-- raw HTML omitted -->Hostname (ğŸ›¡ï¸)</th>
</tr>
</thead>
<tbody>
<tr>
<td>ğŸ¯ <strong>Target</strong></td>
<td>Destination hostname ğŸŒ¸ <code>1024</code> and destination IP ğŸŒ¸ <code>1102</code></td>
</tr>
<tr>
<td>ğŸ“ <strong>Event Metadata</strong></td>
<td>Successful Connections ğŸ‡  <code>98</code>, Attempts ğŸ‡ <code>131</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p>â—ï¸<code>TerminalServices-RDPClient</code> ğŸŒ¸ is a rare beast; it records the RDP activity on the SOURCE and is rarely turned on. All other logs record activity on the REMOTE system (thus, they are present on the remote system only).</p>
</blockquote>
<blockquote>
<p>âœğŸ» <code>4648</code> - if NLA is enabled and alternate creds are used: username, alternate username, dest hostname, dest IP, process name</p>
<p>âœğŸ» <code>1149</code> - Blank username may indicate the use of Sticky keys.</p>
</blockquote>
<h5 id="network-shares">Network Shares</h5>
<p>It&rsquo;s pretty noisy, so be smart. Also, to enable this logging, go to <code>Object Access -&gt; Audit File Share</code>.</p>
<blockquote>
<p>â—ï¸No ğŸ‘´ğŸ¼ XP logs.</p>
</blockquote>
<p><code>5140</code> - network share was accessed.
<code>5142</code> - <code>5144</code> - share created, modified, deleted.
<code>5145</code> - the shared object was accessed.</p>
<p>If you see some <code>4624</code> followed by multiple <code>5140</code> events, it&rsquo;s probably an attempt to mount the share. The attackers will be most interested in the <code>ADMIN$</code> share. However, to use it, one needs to mount <code>IPC$</code> share first. That&rsquo;s good since it allows us to see the account name or SID, information not recorded for the <code>ADMIN$</code> share mount event.</p>
<h2 id="how-to-track-account-creation-activity">How to track account creation activity</h2>
<h3 id="windows-7">Windows</h3>
<h4 id="event-logs-3">Event logs</h4>
<p><img src="images/acc_created1.png" alt="img"></p>
<p>It starts with the event <code>4720</code> (account created) and multiple <code>4732</code> events (member added to some security-enabled group). This account must be enabled (<code>4722</code>) before it can be used. You might see 4738 (account was changed) or even <code>4724</code> (password reset attempt).</p>
<blockquote>
<p>âœğŸ» <code>4728</code> - member was added to a security-enabled global group.</p>
<p>âœğŸ» <code>4732</code> - member was added to a security-enabled local group.</p>
<p>âœğŸ» <code>4756</code> - member was added to a security-enabled universal group.</p>
</blockquote>
<h2 id="usb-devices">USB Devices</h2>
<h3 id="windows-8">Windows</h3>
<h2 id="how-to-spot-scheduled-tasks">How to spot scheduled tasks?</h2>
<h3 id="windows-9">Windows</h3>
<h4 id="event-logs-4">Event logs</h4>
<p>Two trails are of use are <code>Microsoft-Windows-TaskScheduler/Operational</code> ğŸ‡ (disabled by default on the newer systems) and <code>Security</code> ğŸ›¡ï¸.</p>
<table>
<thead>
<tr>
<th>ğŸ‡</th>
<th>ğŸ›¡ï¸</th>
<th>Info</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>106</code></td>
<td><code>4698</code></td>
<td>Task created</td>
</tr>
<tr>
<td><code>140</code></td>
<td><code>4702</code></td>
<td>updated</td>
</tr>
<tr>
<td><code>141</code></td>
<td><code>4699</code></td>
<td>Deleted</td>
</tr>
<tr>
<td><code>200/201</code></td>
<td>-</td>
<td>executed and completed</td>
</tr>
<tr>
<td>-</td>
<td><code>4700/4701</code></td>
<td>enabled and disabled</td>
</tr>
</tbody>
</table>
<blockquote>
<p>âœğŸ» On older Win ğŸ‘´ğŸ¼ it&rsquo;s <code>602</code> event. Also, config files are in bin format with <code>.job</code> extension and can be parsed by a <code>jobparser.py</code> script.</p>
</blockquote>
<p>Also, scheduled tasks create an XML (on newer) or bin (ğŸ‘´ğŸ¼) config files with helpful information like the account used, timestamps and activities scheduled. Simply go to <code>Windows\System32\Tasks</code> or <code>Windows\SysWoW64\Tasks</code> (for 32-bit) folders. Bot <code>at.exe</code> and <code>schtasks.exe</code> produce this artefact. If you know that&rsquo;s a malicious task, note the account used to create it, and you have a lead because it&rsquo;s likely compromised. Bingo!</p>
<h2 id="brute-force-activity">Brute-force activity</h2>
<h3 id="windows-10">Windows</h3>
<h4 id="event-logs-5">Event logs</h4>
<p>There will be no shortage of <code>4625</code> events (unsuccessful login) showing up in the logs. Since this attack is most likely happening over the network, the logon type will be <code>3</code> (often SMB or RDP). Now, if you give those events a once-over, you will be able to figure out whether we&rsquo;re up against a rather pesky password spray attack or an attack on a single account.</p>
<p>Should you spot those events trotting out <code>C0000064</code> error codes (user doesn&rsquo;t exist) along with <code>C000006A</code> (wrong password) - you can bet your bottom dollar ğŸ’µ that&rsquo;s a password-spraying attack. However, should you see the same username popping up time and again, offering only <code>C000006A</code> error code as a company, then, darling, you are in the midst of a targeted attack. Congrats! ğŸ‰</p>
<h2 id="how-to-spot-running-malicious-processes">How to spot RUNNING malicious processes?</h2>
<h2 id="how-to-spot-malicious-filesimages">How to spot malicious files/images?</h2>
<h2 id="how-to-find-passwords">How to find passwords?</h2>
<h2 id="how-to-check-if-the-logs-are-cleared">How to check if the logs are cleared?</h2>
<blockquote>
<p>â—ï¸These techniques require admin or higher privileges.
â—ï¸Common with ransomware</p>
</blockquote>
<p>When the <code>Security</code> trail is deleted, <code>1102</code> is usually created afterwards. When all other trails are deleted, <code>104</code> EID is generated in the <code>System</code> trail.</p>
<p>Event logs are NOT designed to be deleted selectively, all or none. However, some tools are capable of circumventing this and can actually partially clear the logs.</p>
<ol>
<li>ğŸ› ï¸ <code>Mimikatz</code> - ğŸ“• <code>event::drop</code> can stop the event log process from writing <code>Security</code> events. It can&rsquo;t restart it through, so, obvious.</li>
<li>ğŸ› ï¸ <code>DanderSprite</code> - (leaked by <code>ShadowBrokers</code>) change the pointers to the next events in the headers. So, the events are not deleted but are not visible either. Deep dive forensics to help here.</li>
<li>ğŸ› ï¸ <code>Invoke-Phant0m</code> - kill the threads of event logs.</li>
</ol>
<p>One can also suspend the event log process or make changes in RAM. However, all of these actions require ğŸ‘‘.</p>
<h2 id="references">References</h2>
<details>
    <summary>Expand&hellip;</summary>
    <ol>
<li>ShimCache and AmCache enterprise-wide hunting - SANS Threat Hunting Summit 2017
<a href="https://www.youtube.com/watch?v=-0bYcD3_bBs">https://www.youtube.com/watch?v=-0bYcD3_bBs</a></li>
</ol>

</details>
  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.302a6fc365d5139fb98cf60bdb8f715d96257ea189161d36c190ccfa8182e569.js"></script>
  

  
  
  
    
  


</body>

</html>
