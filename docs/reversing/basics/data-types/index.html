<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Data Types - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.9d91cbb32c96c334ae7b38c3d99d30727e0836e1182125cc5f007d215f0b9e59.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-forensics 🔍 and incident response 🥷">
      <a href="/docs/dfir">
        <span>Forensics 🔍 and Incident Response 🥷</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-notes 📝">
      <a href="/docs/notes">
        <span>Notes 📝</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-forensics 🔍 and incident response 🥷">
      <a href="/docs/dfir">
        <span>Forensics 🔍 and Incident Response 🥷</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-notes 📝">
      <a href="/docs/notes">
        <span>Notes 📝</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/reversing/basics/"> Back to Basics 📚 Section 👈🏼 </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#varint">VarInt</a></li>
    <li><a href="#zigzag">ZigZag</a></li>
    <li><a href="#biginteger">BigInteger</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
 </div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Data Types</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      <div class="article-category">domain: 
          
              
                <i class="fas fa-archive"></i>
              
          <a class="category-link" href="/domain/general">general</a>
          
      </div> <br />
      
      <div class="article-category">doctype:
          
            
              
                <i class="fa fa-graduation-cap"></i>
              
          <a class="platform-link" href="/doctype/article">article</a>
          
      </div> <br /><br/>
      
      
      
      

      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <h2 id="varint">VarInt</h2>
<p>Is used to safe memory. For example, number 5 only occupies 1 byte, but 1032 will need two bytes to live. They are also little-endian values. But how to tell when the number ends? Easy, the most significant bit of every byte (byte being the smallest space occupied) tells the PC whether there are more bytes to come. So, for example, the following is the number <code>5</code>, just five, no caveats:</p>
<p><code> 0  0  0  0        0  1  0  1</code></p>
<p>Say, now we need to encode the decimal number <code>287</code>. In the mormal world with no weird stuff and the one we are all probably used to already, this would look like this in binary:</p>
<p><code>0  0  0  0    0  0  0  1    0  0  0  1    1  1  1  1</code></p>
<p>But <code>VarInt</code>s are split into 7-bit chunks, each starting with either <code>0</code> if this chunk is the last or <code>1</code> if there are more chunks to go. This looks something like a metadata. So, instead of 8 bits for actual data, we have only 7, leaving each 8th bit for metadata (read the next byte or not). Splitting up the above value will leave us with the following chunks of data:</p>
<p>🍊 <code>0  0  0    0  0  1  0</code> (marked orange on the screenshot) and 🍏 <code>0  0  1    1  1  1  1</code> (marked green on the screenshot).</p>
<p><img src="images/287-bin.png" alt="287-bin"></p>
<p>Since <code>VarInt</code>s are little-endian, 🍏-chunk is read the first, so we need to reverse the order of the above chunks.</p>
<p>🍏 <code>0  0  1    1  1  1  1</code> 🍊 <code>0  0  0    0  0  1  0</code></p>
<p>We also need to specify that the number is more that 1 byte long (i.e. there are more chunks than just 🍏 one) and put a <code>1</code> meta-bit at the beginning to tell the system that the next byte needs to be read as well.</p>
<p><code>1</code>🍏 <code>0  0  1    1  1  1  1</code> 🍊 <code>0  0  0    0  0  1  0  </code></p>
<p>🍊-chunk is the last, no bytes to follow. Thus, we put <code>0</code> into 🍊 meta-bit. So, at last, we have the following number in binary:</p>
<p><code>1</code>🍏 <code>0  0  1    1  1  1  1</code>  <code>0</code>🍊 <code>0  0  0    0  0  1  0</code></p>
<p>If we were to convert this into an ordinary <code>int</code>, i.e. decimal in the ordinary world, this number would be interpreted as <code>40705</code> (big-endian) and <code>415</code> (little-endian), when in reality it is supposed to be <code>287</code>. So, know whom to feed these <code>VarInt </code> to! Not everyone might get them 😔.</p>
<hr>
<p>Let&rsquo;s now do the same operation but in the reverse order!</p>
<p>Say, we have a number <code>0xE301</code> (<code>1 1 1 0   0 0 1 1   0 0 0 0   0 0 0 1</code>) and we need to know what&rsquo;s the decimal value of this bigotry 🧙.</p>
<p>Let&rsquo;s divide this binary into two 8-bit chunks:</p>
<p>🍏 <code>1</code>  <code>1 1 0   0 0 1 1</code> and 🍊 <code>0</code>  <code>0 0 0   0 0 0 1</code>. Let&rsquo;s read the first leftmost bit of the 🍏 digit: <code>1</code>. That means, we need to take 🍊 into account as well. So, getting rid of the 🍏 and 🍊 meta-bits (since we have already processed them), we have these 14 bits left:</p>
<p>🍏 <code>1 1 0   0 0 1 1</code> and 🍊 <code>0 0 0   0 0 0 1</code>. Since <code>VarInt</code> is little-endian, let&rsquo;s switch the above digits: 🍊 <code>0 0 0   0 0 0 1</code> and 🍏 <code>1 1 0   0 0 1 1</code>. Now, lets convert  <code>1</code> (🍊) <code>1 1 0   0 0 1 1</code> (🍏 ) to decimal as a whole: <code>227</code>:</p>
<p><img src="images/227-bin.png" alt="227-bin"></p>
<p>So, the basic algorithm would be:</p>
<ol>
<li>Read the first (leftmost bit of each byte). If the bit is set to <code>1</code> - add the number to the array for processing.</li>
<li>Reverse the order of the bytes to process.</li>
<li>For each byte to process, read the remaining 7 bits and concatenate into one big value.</li>
<li>Convert this binary into decimal for the ordinary world of <code>int</code>s.</li>
</ol>
<p>The code for this operation is listed below (Python 🐍) [<a href="https://www.cclsolutionsgroup.com/post/indexeddb-on-chromium">1</a>], I only have fixed a little bug in the pseudocode from the link:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">is_32_bit</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">limit</span> <span class="o">=</span> <span class="mi">5</span> <span class="k">if</span> <span class="n">is_32_bit</span> <span class="k">else</span> <span class="mi">10</span>
<span class="nb">buffer</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0xe3</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">]</span>

<span class="k">while</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">limit</span><span class="p">:</span>
    <span class="c1"># (buffer[idx] &amp; 0x7f, 0x7f is a mask 0111 1111. Applying AND with this mask clears the first bit of a byte (the one that tells whether to read the next byte or not). We do that so that this byte is not considered when calculating the actual value</span>
    <span class="c1"># &lt;&lt; (idx * 7) - we shift each byte processed so that it is put on its place (i.e. reversing the order step)</span>
    <span class="n">result</span> <span class="o">|=</span> <span class="p">((</span><span class="nb">buffer</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">idx</span> <span class="o">*</span> <span class="mi">7</span><span class="p">))</span>
    
    <span class="c1"># 0x80 is 1000 0000 mask which when applied to a number, converts it to the following pattern: either 00000000 or 10000000, depending on whether the leftmost bit was set to 1.</span>
    <span class="k">if</span> <span class="nb">buffer</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">break</span>
    <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
    
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div><h2 id="zigzag">ZigZag</h2>
<p>Since <code>VarInt</code> is not good for negative numbers, Google came up with another encoding: ZigZag. Why such a strange name?</p>
<table>
<thead>
<tr>
<th>int value (raw)</th>
<th>Value in ZigZag</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>-1</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>-2</td>
</tr>
<tr>
<td>4</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>The code for this operation is listed below (Python 🐍) [<a href="https://www.cclsolutionsgroup.com/post/indexeddb-on-chromium">1</a>]:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">raw</span> <span class="o">=</span> <span class="mh">0x3</span>

<span class="n">is_negative</span> <span class="o">=</span> <span class="n">raw</span> <span class="o">&amp;</span> <span class="mh">0x01</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">raw</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>

<span class="k">if</span> <span class="n">is_negative</span><span class="p">:</span>
  <span class="n">result</span> <span class="o">=</span> <span class="o">-</span><span class="n">result</span>

<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div><h2 id="biginteger">BigInteger</h2>
<p>Read a varint; the least significant bit gives you the sign of the number (1 for negative). Bit-shift the value left 4 bits; this shifted value tells you how many unsigned integers to read – 32-bit integers on 32-bit systems, 64-bit bit integers on 64-bit systems. Take the concatenated value and read it with the endianness of the system. [<a href="https://www.cclsolutionsgroup.com/post/indexeddb-on-chromium">1</a>]</p>
<h2 id="references">References</h2>
<p>[<a href="https://www.cclsolutionsgroup.com/post/indexeddb-on-chromium">1</a>] IndexedDB on Chromium</p>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.1237ff71925bb8625c97a9af8db4c54525258bedfd7c47493daaff723bea755e.js"></script>
  

  
  
  
    
  


</body>

</html>
