<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SSH Access Setup Explained - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-ttp 🔍">
      <a href="/docs/ttp">
        <span>TTP 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-artefacts db 🏺">
      <a href="/docs/artefacts">
        <span>Artefacts DB 🏺</span>
      </a>
    </li>
    
    <li class="menu-item-attacks db ⚔️">
      <a href="/docs/attacks">
        <span>Attacks DB ⚔️</span>
      </a>
    </li>
    
    <li class="menu-item-tools db 🛠️">
      <a href="/docs/tools">
        <span>Tools DB 🛠️</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-ttp 🔍">
      <a href="/docs/ttp">
        <span>TTP 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-artefacts db 🏺">
      <a href="/docs/artefacts">
        <span>Artefacts DB 🏺</span>
      </a>
    </li>
    
    <li class="menu-item-attacks db ⚔️">
      <a href="/docs/attacks">
        <span>Attacks DB ⚔️</span>
      </a>
    </li>
    
    <li class="menu-item-tools db 🛠️">
      <a href="/docs/tools">
        <span>Tools DB 🛠️</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/tools/"> 👈🏼 Back to </br> 🛠️ Tools DB </a>
  </p>
  <aside>
   <nav id="TableOfContents"></nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">SSH Access Setup Explained</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      

      
      

      
    </div>
    
    <b>Created:</b> 18.10.2020
    <br />

    

  </header>


  <div class="content" itemprop="articleBody">
    <p>In order to perform actions with you public/private key pair (git, ssh access), you&rsquo;ll need to configure it first. I found it quite hard to grasp at first with all the nuances, although it&rsquo;s pretty straitforward if you just copy/paste the commands.</p>
<p>Let&rsquo;s take GitHub and its <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">manual</a> in order to understand what we are doing and why. This will help in thoubleshooting later if we need it.</p>
<p>In order to use private/public keys, you will need to generate a pair first. All these keys on macOS and Linux machines are stored at <code>~/.ssh</code> by default (hidden folder). Public keys have <code>pub</code> at the end, private have the same name but no <code>pub</code> extension. For example, a public key file would be named something like <code>id_rsa.pub</code>, unless you give it a different name and its corresponding private key would be called just <code>id_rsa</code>.</p>
<p>Let&rsquo;s say that there is nothing in the <code>~/.ssh</code> folder and we need to generate a new key pair. It&rsquo;s as simple as running <code>shell ssh-keygen -t ed25519 -C &quot;your_email@example.com</code> or <code>shell ssh-keygen -t rsa -b 4096 -C &quot;your_email@example.com&quot;</code>. The difference is the algorithm (<code>ed25519</code> or <code>rsa</code>). You need to know the technical requirements for the keys that are used for the system you are trying to set up access to. For example, GitHub prefers <code>ed25519</code>, however they do support rsa at the moment as well (📆 <code>08/07/2022</code>).</p>
<p>![[ssh-key-name.png]]</p>
<p>This is the point where you&rsquo;d choose the name for your key, which can be anything you like (not sure about special characters though). By default, keys will be stored in <code>~/.ssh</code> directory.</p>
<p>I&rsquo;ve given this key 🗝 the following name: <code>asgardmasterkey</code>. Now the system what&rsquo;s a password. I come up with something good enough for Asgard (<code>123456</code>) and press Enter.</p>
<p>![[ssh-key-finished.png]]</p>
<blockquote>
<p>❗️Copy the key fingerprint to add it later to the <code>known_hosts</code> file. It can be added automatically to the file once you&rsquo;ve connected to the host for the first time.</p>
</blockquote>
<p>Let&rsquo;s now move into our <code>~/.ssh</code> folder and see what&rsquo;s there. So, there are <code>asgardmasterkey.pub</code> (public key) and <code>asgardmasterkey</code>(private). There are also several other files: <code>config</code> and <code>known_hosts</code>, both are very important!</p>
<p>We need to tell the ssh deamon that there is an update it needs to harvest. So, that&rsquo;s why we first check if its running at all: <code>shell eval &quot;$(ssh-agent -s)&quot;</code>. You get a PID in respone, you are good to move forward. Otherwise, start it with <code>sudo -s -H</code> or <code>exec ssh-agent bash</code> or <code>exec ssh-agent zsh</code> or whatever else works for your system.</p>
<p>For macOS users (like myself) there is an additional step to do - change the <code>config</code> file. Say, for example, that I need this key to connect to github.com (private Asgard repo!):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Host github.com
</span></span><span class="line"><span class="cl">  AddKeysToAgent yes
</span></span><span class="line"><span class="cl">  UseKeychain yes
</span></span><span class="line"><span class="cl">  IdentityFile ~/.ssh/asgardmasterkey
</span></span></code></pre></div><p>On GitHub they say you should put <code>Host *</code> instead, but this way, in case you ever add other ssh keys for other services, you&rsquo;ll likely face errors. This line would mean that whatever you are connecting to, use this key. This name (<code>github.com</code>) can actually be something like <code>privateasgardrepo</code> or anything you like. Think of it as an alias, if you will. There are some additional things that can be used here but most of the time the below settings are enough. For more info see man <code>ssh_config</code>, <code>Host</code> and <code>PATTERNS</code> sections.</p>
<p>Usually, when connecting to a remote machine over <code>ssh</code>, you&rsquo;d do something like the following:</p>
<p><code>ssh loki@192.168.1.2</code></p>
<p>You&rsquo;d be promted with a passoword then. Now let&rsquo;s say that we have the following contents of the <code>config</code> file:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Host privateasgardrepo 
</span></span><span class="line"><span class="cl">  HostName 192.168.1.2
</span></span><span class="line"><span class="cl">  User loki
</span></span><span class="line"><span class="cl">  IdentityFile ~/.ssh/asgardmasterkey
</span></span></code></pre></div><p>In this case you&rsquo;d only run <code>ssh privateasgardrepo</code>. This does sound like an overkill, however, it&rsquo;s easier in case you have miltiple endpoint to connect to and you can&rsquo;t remember all the IPs or domain names.</p>
<p>The next step is where you add your private key to the ssh daemon. <code>shell ssh-add -K ~/.ssh/asgardmasterkey</code>.</p>
<p>The next step is to share you <strong>public</strong> key (the one ending in <code>pub</code>) with the remote server. In case of GitHub you copy whatever is in the <code>pub</code> file (in our example, it&rsquo;s <code>asgardmasterkey.pub</code>) go to your Account settings in the browser, open SSH keys and paste the contents of that file there.</p>
<p>If you&rsquo;ve configured the <code>config</code> file correctly, you can now <code>ssh privateasgardrepo</code> (or whatever boring name there might be instead). Once you&rsquo;ve connected to the host for the first time (in the example above, this would be some host at <code>192.168.1.2</code>) you&rsquo;ll be promted with something like the following message:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">The authenticity of host <span class="s1">&#39;192.168.1.2 (192.168.1.2)&#39;</span> can<span class="err">&#39;</span>t be established.
</span></span><span class="line"><span class="cl">ED25519 key fingerprint is SHA256:Q<span class="o">[</span>...<span class="o">]</span>A34.
</span></span><span class="line"><span class="cl">This key is not known by any other names
</span></span><span class="line"><span class="cl">Are you sure you want to <span class="k">continue</span> connecting <span class="o">(</span>yes/no/<span class="o">[</span>fingerprint<span class="o">])</span>?
</span></span></code></pre></div><p>It means that you&rsquo;ve generated the keys, but you have not received the keys from the server yet. For this type connection both you <strong>and</strong> the server have a separate key pair which are <strong>different</strong>! You share <em>your</em> public key, server shares its. <em>This</em> is the point when you literally saying <em>&ldquo;Remember this server&rdquo;</em>. Now, it will be added to the <code>known_hosts</code> file and you won&rsquo;t be prompted for this again in future unless the key changes or, for example, you have some 🐀 as the man-in-the-middle.</p>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.302a6fc365d5139fb98cf60bdb8f715d96257ea189161d36c190ccfa8182e569.js"></script>
  

  
  
  
    
  


</body>

</html>
