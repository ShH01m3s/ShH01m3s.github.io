<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A Small Script - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
    <li class="menu-item-notes 📝">
      <a href="/docs/notes">
        <span>Notes 📝</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
    <li class="menu-item-notes 📝">
      <a href="/docs/notes">
        <span>Notes 📝</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/blog/"> 👈🏼 Back to </br> Blog ✍️ </a>
  </p>
  <aside>
   <nav id="TableOfContents"></nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">A Small Script</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      
      <div class="article-category">
          
            
            
            
              <i class="fab fa-apple"></i>
            
            
            
            
          
          
      </div> <br />
      

      
      <div class="article-category">
        <i class="fas fa-tools"></i>
          
          
          <a class="platform-link" href="/tools/python">Python</a> 
          
      </div> <br />
      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <p><em>So, the New Year holidays are sadly over 😢 and now it&rsquo;s time to work! How hard it is to kick myself out from the confortable but self-descructive realm of procrastination right into the arms of workaholism! Working all the day long seemed so distant and vague, almost like a scary dream 😴. But it wasn&rsquo;t a dream. I should stop whining, afterall, work is ennobling 🙉🔨. And so, Merry Christmas and a happy new project to me! 🎅</em></p>
<p>📆 <code>Monday, 1st of January, 2021</code></p>
<p>⏰ <code>09:00</code></p>
<p>Well, this is going to be a very loooong day&hellip; . I think, I will keep lookig at my watch every half an hour. Why is it Monday 😔? The first day after holidays this long should never be Monday! That&rsquo;s cruel and counterproductive! I object!</p>
<p>⏰ <code>09:01</code></p>
<p>I guess, the dinial phase is over and now it&rsquo;s time for a little anger. I am not that kind of person, so, I will skip the anger part and leap right to the bargaining. How about I just start with some small and simple tasks before I get on the wheels? I think I&rsquo;d better start with reviewing my pending tasks, last year&rsquo;s leftovers. Hm, mobile assessment methodology and lecture material preparation on that topic. Ok, what else? Seems too still, since the last project was closed on the 30th of December and there were no updates since then. Good bargaining could save me from the next stage 😊.</p>
<p>Hm, looks like my mentor has started his day a little earlier (oops 😬): calling on the mobile. Well, there we go! Oh, the god of new projects! Let this one be nice!</p>
<p>[&hellip;Several minutes of how-do-you-do and happy-new-year things&hellip;]</p>
<p>- <em>How hard is it?</em> - I tentatively asked.
- <em>Well, do you remember the project M?</em></p>
<p>Of course, I remember that project M!!! How can one forget THAT amount of crappy JS code falling on one&rsquo;s head until one chokes and dies with relief? It was like walking on heels on the sand. I also recalled a picture I had shared in a fit of righteous desperation with my collegue with whom I had been working on that project:</p>
<p><img src="images/joke1.jpg" alt="joke1"></p>
<p>- <em>Yes, sure</em>, - was my brief and eloquent reply instead.</p>
<p>- <em>That one was medium hard, this one is just hard</em>, - was the answer of my mentor.</p>
<p>Trying to imagine what sort of project that might be, would have made my head explode. But thankfully I am already getting heebie-jeebies outside at -10C.</p>
<blockquote>
<p>Yeah, it&rsquo;s the famous Russian winter, yo, let the fittest survive, go evolution! I&rsquo;m done (<em>I little spoiler, as I found later, that was a reasonable concern</em>).</p>
</blockquote>
<p>Hm, I would not call that project M actually hard, more huge than hard. And quite daunting since there was also something going wrong during the project: account blocked, or web site hanging (not our fault, of course 🙊).</p>
<p>&lsquo;- <em>This is one is about a 3D secure protocol implementation, assessment of an e-commerce service of the Bank of Rivia (RivBank)</em>.</p>
<p>Oh my&hellip; . I&rsquo;ve never ever had such tasks. I usually had something more familiar like a website or a mobile app. Yes, they are usually very different (though some of the vulnerabilities are often the same), but this one is neither. But I know almost nothing about 3D secure&hellip; . And my mentor said that this one is of high level of difficulty. So, it&rsquo;s something I am not an expert at and moreover it&rsquo;s a very difficult project. A very good start of the year! My mentor definetely knows how to encourage engineers to put themselves together after more than a week of tiresome (let&rsquo;s be honest) indolence!</p>
<p>I need to collect more information about this protocol, more technical details, I mean. I think this is a 2 hours task, take or give.</p>
<p>⏰ <code>11:11</code></p>
<p>Ha-ha! Several hours? Really? It seems that no one really knows what that is exactly. Information on one website contradicts the information from another. Which one is wrong? Could be both? I would have started becoming a little nervous by now if I weren&rsquo;t so sluggish after these holidays. I should probably keep some notes along the way&hellip; .</p>
<p>⏰ <code>13:34</code></p>
<p>Well&hellip; . My child is about to be born! Not the human one, text-based one. I think this thing deserves a separate article (<a href="/docs/dfir/investigation/network/protocols/3ds">here</a>). This is just too much for a blog post. It turned out to be a little research, to be honest, with dozens of articles read, several videos watched and even one presentation scrolled. It&rsquo;s like a ball 🧶 of human hair, cat fur and some other &ldquo;ingredients&rdquo; I prefer not to mention.</p>
<p>Don&rsquo;t get me wrong, I am happy with the task even more! Finally, I am getting a project that sounds promising for my self-development, something that’s going to add to my knowledge base beyond the usual “<em>What info is being leaked through the logs?</em>” or <em>&ldquo;One can bruteforce the OTP, OMG!&rdquo;</em>.</p>
<p>So, cool. Let&rsquo;s get started.</p>
<p>📆 <code>02/01/2021, Tuesday</code></p>
<p>⏰ <code>13:34</code></p>
<p>If you are not familiar with this protocol, I suggest reading about it either from the <a href="/docs/dfir/investigation/network/protocols/3ds">article</a> I&rsquo;ve written, or from elsewhere on the Internet. A quick recap is due, though, I suppose&hellip;.</p>
<blockquote>
<p>It&rsquo;s called 3 Domain Secure, meainig, there are 3 domains involved (not neccessarilly three entities): acquirer (the one that gets the money 💰), the issuer (the one that gives that money 💰) and the interoperability domain (the one who makes it happen). The first one is mainly the customer&rsquo;s bank which has issued him or her a credit card. The second one is the bank of the merchant and the merchant him or herself. And the last one is basically everything else, mainly Visa/MC/AE etc services and other &ldquo;helpers&rdquo; 🧝.</p>
<p>Prefer an analogy? Imagine a city of drunkards 🍺. There are lots of people who a willing to give money for a nice and decent pint of ale. There are also a couple of breweries out there that are willing to support this town in its continuing quest to drunkenness. But how do they meet? Where? That&rsquo;s why northern gods invented bars and bartenders! In this analogy, the latter will be our interoperability domain, drunkards - the issuer and customers and the breweries are the acquirers.</p>
<p>This protocol was invented not to verify the cardholder&rsquo;s identity, but to resolve legal issues in case of something goes wrong during or immediatly after the payment. It allows determining who&rsquo;s responsible for the breach or money loss.</p>
<p>The messages are excahnge in XML between the three parties. Most of the messages float through the client&rsquo;s browser, but are not displayed. So, the client can see and even alter some of these messages if they have a toolkit for that. That&rsquo;s why there are certain controls in place that ensure that even if the client changes something (quantity, price, card details) during this process, the tampering will be detected and the transfer rejected.</p>
</blockquote>
<p>I&rsquo;ve learned something about this thing already: it&rsquo;s not a piece of cake 🍰! So many requests and responses exchanged, so many parties might be involved, so little consistent infomation across the Internet&hellip; . But the overal picture is starting to show up nicely.</p>
<p>So, below is the screenshot of the RivBank&rsquo;s 🏦 website that I was allowed to use in order to assess this stuff. It&rsquo;s a simple web-page that one can use to transfer money 💷 from one account to another. Check it out! 😊</p>
<p><img src="blog/2022/02/small-script/images/rivia-transder-main.png" alt="rivia-transder-main"></p>
<p>So, I type in the first phone number +111 333 333 in the <em>From</em> field. And now the second one +111 444 444 in the <em>To</em> field and click the <em>Go</em> button. For a short time I get redirected to some <a href="https://riviabank.co.ok/createorder">https://riviabank.co.ok/createorder</a> which in tern redirects me to a unique URL: <a href="https://riviabank.co.ok/index.jsp?oid=12345&amp;session=abcdef">https://riviabank.co.ok/index.jsp?oid=12345&amp;session=abcdef</a>.</p>
<p>So, this PaReq and PaRes are, let me repeat, url-zip-base64 encoded? And I am supposed to decode them each time manually? Substitute the values and fields to check and then base64-zip-url encode back? Do you think I am so hopeless? I am sorry, but it&rsquo;s far too daunting a task and I am sure I was born for greater things. I will let Python 🐍 do this dirty and  job. After all, why have we invented computers? Yes, I will just need a small script&hellip; .</p>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.bafc052229b4b40bf03c477d31c5cdd9352ece8afbadf35ab97ed14495098fc9.js"></script>
  

  
  
  
    
  


</body>

</html>
