<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I Met .NET Confuser - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.b67d7fec5daec98747a80616a05e9e1e96dc0976219c428241762578c5ae69c3.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-articles">
      <a href="/docs/articles">
        <span>Articles</span>
      </a>
    </li>
    
    <li class="menu-item-blog">
      <a href="/docs/blog">
        <span>Blog</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit">
      <a href="/docs/toolkit">
        <span>Toolkit</span>
      </a>
    </li>
    
    <li class="menu-item-about me">
      <a href="/docs/about">
        <span>About me</span>
      </a>
    </li>
    
    <li class="menu-item-achievements">
      <a href="/docs/achievements">
        <span>Achievements</span>
      </a>
    </li>
    
    <li class="menu-item-contacts">
      <a href="/docs/contact">
        <span>Contacts</span>
      </a>
    </li>
    
    <li class="menu-item-notes">
      <a href="/docs/notes">
        <span>Notes</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-articles">
      <a href="/docs/articles">
        <span>Articles</span>
      </a>
    </li>
    
    <li class="menu-item-blog">
      <a href="/docs/blog">
        <span>Blog</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit">
      <a href="/docs/toolkit">
        <span>Toolkit</span>
      </a>
    </li>
    
    <li class="menu-item-about me">
      <a href="/docs/about">
        <span>About me</span>
      </a>
    </li>
    
    <li class="menu-item-achievements">
      <a href="/docs/achievements">
        <span>Achievements</span>
      </a>
    </li>
    
    <li class="menu-item-contacts">
      <a href="/docs/contact">
        <span>Contacts</span>
      </a>
    </li>
    
    <li class="menu-item-notes">
      <a href="/docs/notes">
        <span>Notes</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
  <div class="docs-menu">
   </div> 



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">How I Met .NET Confuser</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      <div class="article-category">domain: 
          
              
          <a class="category-link" href="/domain/diary">Diary</a>
          
      </div> <br />
      
      
      
      

      
      

      
      <div class="article-tag">
          <i class="fas fa-tag"></i>
          
          
          <a class="tag-link" href="/tags/malware" rel="tag">malware</a>
          
           ,  
          <a class="tag-link" href="/tags/reverse" rel="tag">reverse</a>
          
           ,  
          <a class="tag-link" href="/tags/.net" rel="tag">.net</a>
          
           ,  
          <a class="tag-link" href="/tags/how-i..." rel="tag">how i...</a>
          
      </div> 
      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <p><em><strong>Tuesday</strong></em>, <strong>Прохладно, как будто вот-вот пойдет дождь, но нет&hellip;.</strong></p>
<p>Приятно бывает встретиться лицом к лицу с сильным противником, потому что именно в такие моменты, после таких &ldquo;битв&rdquo;, становишься сильнее. Прошедший вторник оказался настоящим вызовом для моей смекалки. Ну здравствуй, Confuser! Очень надеюсь, что вам понравится статья точно так же, как мне понравилось ковырять этот код и писать эту скромную статью. Все началось одним облачным утром&hellip;.</p>
<p><img src="/images/blog/2018/dotnetconfuser/42f36c8de58db2430da05.jpg" alt="img"></p>
<p><strong>Среда</strong>: VBox Version 5.2.12 r122591 (Qt5.6.2), Win7x64 SP1</p>
<p><strong>Инструменты</strong>: dnspy v4.5.2, de4dot v3.1.41592.3405, CFF</p>
<p><strong>SHA-1</strong>: a93256f864ee43125e9b9d5b66af4c9185cd0697 (VirusTotal)</p>
<p><strong>9:02 am</strong>. Спокойно попивая свой утренний кофе и лениво пытаясь дотянуться при этом до кнопки включения компьютера, благополучно проливаю напиток на стол и злюсь на то, что вчера опять не легла раньше. В этот самый момент, пока еще не заработало на всю катушку рабочее пространство, ты не знаешь, с чем будешь иметь дело сегодня и эта неопределенность прекрасна. Когда все-таки нашелся достойный объект для виртуальной вивисекции, включила свою виртуальную машинку, и вот что я увидела.</p>
<p>Ну да ну да&hellip; Как же&hellip; <strong>Firefox это</strong>. За кого меня принимает автор программы?! Натравлю на него de4dot (очень удобный инструмент для дешифровки программ на .NET).</p>
<p><img src="/images/blog/2018/dotnetconfuser/4f665cd978f3961a8d69a.png" alt="img"></p>
<p>de4dot по нулям, никакой сколько бы то ни было полезной информацией он меня не снабдил&hellip; Ладно, ничего ведь все равно не остается, как открыть dnspy (декомпилятор для .NET) и посмотреть, что там под капотом. Ага! Если открыть программу в dnspy, можно увидеть в её структуре такой вот &ldquo;кричащий&rdquo; атрибут: <strong>ConfusedByAttribute.</strong></p>
<p>Раскрывая структуру программы и вижу любопытненийшую надпись: <strong>ConfusedByAttribute</strong>. Небольшой поиск в интернете рассказал мне, что это означает. А означает это, что мне прибавилось проблем и нужно сделать перерыв и выпить кофе (первая попытка же не увенчалась успехом)&hellip;</p>
<p><strong>9:10</strong>. Пью чай и читаю &ldquo;Как перестать беспокоиться и начать жить&rdquo;. Да, этим утром кофе лишаюсь</p>
<p><strong>9:14</strong>. Так что же такое <strong>Confuser</strong> и с чем его едят? Получается, что это обфускатор (очень грубо говоря, шифровальщик), и его основная задача - запутать реверс инженера (ну то есть меня), что не всегда, надо отметить, является признаком чего-то плохого. Все-таки, реверс инженеры не всегда белые и пушистые зайки :-) Алгоритм тут таков&hellip; Собранный из нескольких виртуальных машин (подробнее об этом тут), которые являются по сути своей бесконечным циклом со свитчами (коих целая туча), этот механизм определяет последовательность выполнения кода и таким образом скрывает логику от непосвященных. Чтобы выйти из цикла, надо либо использовать return, либо непрямой выход (например, goto или же вызов функции, которая ничего не вернет). Картиночка ниже красочно демонстрирует всю эту красоту. Дабы избежать недопонимания в дальнейшем, буду называть **&ldquo;ВМ&rdquo;**технологию виртуализации, когда несколько ОС вертится на одной физической машине, а <strong>&ldquo;виртуальными машинами&rdquo;</strong> - алгоритм, про который рассказала выше.</p>
<p><img src="/images/blog/2018/dotnetconfuser/dd483aeaee9f8cf887708.png" alt="img"></p>
<p>Предварительный запуск показал, что программа выбрасывает exception (исключение). При этом, в обработчике исключения происходит магия! Вообще само по себе уже нехорошо, что системе он говорит, что произошло ошибка, а сам что-то там под занавесом творит. Весь код фактически запускается из исключения! Так что все же надо разобраться дальше. Проставлю просто бряки везде, где функция может что-то вернуть. Может и некрасиво, но тоже вариант.</p>
<p><strong>9:20.</strong> Отвратительна была мысль. Поставлю себе заметку никогда больше так не делать. Дело даже не в том, что это &ldquo;некрасиво&rdquo;, коли выражаться подобным образом, а тупо, долго и занудливо. Как говорится, лень - двигатель прогресса, так что пора эволюционировать. Надо бы сначала нарисовать общую картину. Прежде всего, сколько классов всего?</p>
<ol>
<li><strong>Module. Содержит:</strong> Свои (самописные) методы, Class 0, Class 1 (который в свою очередь содердит 2 класса: Class 2 и 3), Class 4, Struct 0, Struct 1 (ВМ), Struct 2 (ВМ), Struct 3 (ВМ), Struct 4 (пустой), Struct 5 (пустой)</li>
<li><strong>Class 10.</strong> Содержит: свои методы, Struct 10 (все три содержат лишь атрибуты), Struct 8 и Struct 9</li>
<li><strong>Class 11.</strong> Содержит: Struct11 (пустой)</li>
<li><strong>Class 5.</strong> Свои методы, CryptUnprotectedData, Struct 6 (только атрибуты) и Struct 7 (только атрибуты)</li>
<li><strong>Class 6.</strong> Содержит свои методы</li>
<li><strong>Class 7.</strong> Содержит свои методы</li>
<li><strong>Class 8.</strong> Содержит свои методы и Main</li>
<li><strong>Class 9.</strong> Содержит свои методы</li>
<li><strong>ConfusedByAttribute</strong> (пустой)</li>
<li><strong>GClass 0.</strong> Вызов метода из первого класса (33 метод), на выходе имеем строку</li>
<li><strong>GClaиss 1.</strong> Вызов метода из первого класса (37 метод), на выходе имеем строку</li>
<li><strong>GClass 2.</strong> Вызов метода из первого класса (33 метод), на выходе имеем строку</li>
<li><strong>GClass 3</strong></li>
</ol>
<p>В общем и целом структура <strong>GClass0, GClass1, GClass2 и GClass3</strong> примерно одна и та же: функция <strong>smethod_0</strong> (пусть так), которая форматирует строку функцией <strong>string</strong>.<strong>Format()</strong>. Еще проще говоря, она берет страшненькую и не очень понятную строку, что-то с ней делает и отдает назад уже красивую строку. Посмотрим-ка еще раз:</p>
<p>Ну вот, да, так и есть. Как Винни-Пух радовался мёду, так и я радуюсь функциям, которые приводят строки в божеский вид, ведь часто именно они очень многое могут поведать о тайных замыслах черно-шляпного населения.</p>
<p>То есть видно, что метод с бряками везде, куда хватит терпения дотянуться, был не совсем бесполезным: кое-что все-таки удалось выяснить. Иногда бывает нужно пойти не туда, чтобы понять, куда пойти надо, откуда начать. Теперь у меня достаточно информации для того, чтобы двигаться дальше.</p>
<p>Кроме того, в море этой ерунды случайно наткнулась на создание потока, который используется тут:</p>
<p><img src="/images/blog/2018/dotnetconfuser/b9d610dd28c421c01ab55.png" alt="img"></p>
<p>Возвращаясь к классам, которые нашлись выше&hellip;. Хм, есть предположение, что не все эти классы действующие. Можно это проверить. Так как, прежде чем вызвать какой бы то ни было метод надо сначала создать объект класса, можно было бы поставить бряк на каждом классе, если бы было можно :-), но увы, так не пойдет, ибо бряки можно ставить только на инструкциях, в которых происходят какие-то действия (нельзя даже ставить на объявление переменной без инициализации). И тут на этой мысли мое внимание привлек очень любопытный метод, присутствующий в каждом классе, название которого навело на мысль о конструкторе: .<strong>cctor.</strong></p>
<p>Google в помощь&hellip; Ага! И да, действительно, это ни что иное как конструктор. Замечательно. Поиск к тому же показал ещё кое-что: как оказалось, есть два типа конструкторов: <strong>cctor</strong> (статичный) и <strong>ctor</strong> (обычный) (отложу себе здесь заметку на будущее).</p>
<p>ОК, вот тут и буду тогда останавливаться, только для начала исключу из анализа все неинтересные мне функции (не видно ничего похожего на расшифровку или что-то вредное) и вот он мой список <em>(прим. ВМ - виртуальная машина)</em>:</p>
<ol>
<li><strong>Module.</strong> Самописные методы, Class 0, Class 1 (который в свою очередь содердит 2 класса: Class 2 и 3), Class 4, Struct 0, Struct 1 (ВМ), Struct 2 (ВМ), Struct 3 (ВМ)</li>
<li><strong>Class 10.</strong> Самописные методы, Struct 10 (все три содержат лишь атрибуты), Struct 8 и Struct 9</li>
<li><strong>Class 5.</strong> Свои методы, CryptUnprotectedData, Struct 6 (только атрибуты) и Struct 7 (только атрибуты)</li>
<li><strong>Class 6.</strong> Самописные методы</li>
<li><strong>Class 7.</strong> Самописные методы</li>
<li><strong>Class 8.</strong> Самописные и Main (отсюда стартует программа, поэтому конечно же нам важен этот метод).</li>
<li><strong>Class 9.</strong> Самописные методы</li>
<li><strong>GClass 0.</strong> Вызов метода из первого класса (33 метод), на выходе имеем строку</li>
<li><strong>GClaиss 1.</strong> Вызов метода из первого класса (37 метод), на выходе имеем строку</li>
<li><strong>GClass 2.</strong> Вызов метода из первого класса (33 метод), на выходе имеем строку</li>
<li><strong>GClass 3</strong></li>
</ol>
<p>Прошло некоторое количество долгих и нудных минут&hellip;</p>
<p>Хороша была мысль, по моему скромного мнению, но увы, что-то как-то нигде так ничего и не брякнулось&hellip; странно. Только там, где были бряки вне конструктора, только там и брякались. Видимо, нельзя так Сделаю себе пометку на будущее. Ко всему прочему, <strong>Class6</strong> подвел: нет статичного конструктора, а методы есть Впрочем, подвел не только он; собственно, идея оказалась тоже так себе.</p>
<p>Тогда, придется действовать совсем в лоб: поставить бряк на все функции, чтобы вообще представить себе, какой тут алгоритм. Звучит ужасающе&hellip; Мне нравится. Поехали.</p>
<p><strong>Остановка &ldquo;Ценные строки&rdquo;</strong>.</p>
<p>В процессе первого запуска отладчика (да, их было несколько ибо за раз порой нет-нет да и пропускаешь что-то важное) программка бережно и, вероятно, с ее точки зрения &ldquo;тихо&rdquo; сохранила себе вот ЭТО:</p>
<p>В общем-то, можно сказать, что файл свою функциональность уже выдал, и даже такой замороченный шифровальщик как Confuser его от этого не уберёг. Ну что ж&hellip; немного скучной отладки (беспрерывные нажатия на F5) и вот родились первые выводы:</p>
<ol>
<li>Все функции до текущего дампа были только в пределах Module.</li>
<li>Все функции выполняют роль расшифровки\сборки куска</li>
</ol>
<p><strong>Остановка &ldquo;Часть тела&rdquo;.</strong></p>
<p>Кроме того удалось выскрести из его кормушки вот этот кусок:</p>
<p>О чём он говорит? О том, что он наконец-то расшифровывает или себя, или друга, т.е. какую-то программу. Видно это по первым байтам массива - 4D 5A в окошке локальных переменных во время очередной остановки (на эту тему можно подробнее почитать вот эту замечательную статью):</p>
<p>В окошке локальных переменных (снизу) показан массив array. Если его раскрыть, можно увидеть, что в первых ячейках содержаться 0x4D 0x5A 0x90. Это ни что иное как &ldquo;MZP&rdquo; в hex (в шестнадцатеричная виде). То есть, это говорит нам, что сейчас в массиве скорее всего содержится начало какой-то программы (или самой оригинальной или вспомогательной).</p>
<p>Хорошо. Это только кусок программы. Сам по себе он бесполезен. Пакер (т.е. Cinfuser) просто обязан потом где-то сесть тихонечко в углу и склеить это все. Где? Нажму F10, чтоб ничего не пропустить. Надо особенно пристальное внимание уделить какой-нибудь функции, название которой будет намекать на сборку ассемблеровского кода&hellip;.</p>
<p><strong>Остановка &ldquo;Пришиваем ноги&rdquo;</strong>.</p>
<p>Одно нажатие кнопки унесло меня прямиком в операционную, где из порезанного на части вредителя будут собирать полноценного с помощью функции <strong>Assembly.Load(smethod_31(array4))</strong>!</p>
<p>Внутри вирутальной машины в одном из &ldquo;кейс&rdquo;-ов вызывается та самая функция, которая кладет все расшифрованное в массив и передает функции Assembly.Load(), которая кладет это уже прямиком в переменную assembly_0.За обработку каждого куска отвечает каждая функция из статичного конструктора</p>
<p>Отлично. Дальше. Падаю сюда, в самое начало. И тут мне стало понятно ещё кое-что: за обработку (расшифровку и представление) каждого куска отвечает каждая отдельная функция статичного конструктора.</p>
<p>То есть, <strong>smethod_38</strong>, <strong>smethod_32, smethod_2 и smethod_0.</strong> Программка до самого конца придерживается свой легенды, что она просто <strong>Firefox.exe</strong> и тут без дурных замыслов. В общем, ладно, с самого начала и так было понятно, что это никакой не <strong>Firefox.exe.</strong></p>
<p><strong>10:00</strong>. Вот, кстати, еще кое-что интересное: постоянно вызывается некий <strong>Marshal</strong>.<strong>Copy()</strong>, и каждый раз он копирует по 8 байт&hellip; Что это за метод? MSDN в помощь! Хм, ок. Допустим, все стало ясно. Главное, понятно, что копирует. А где, собственно, эти данные складируются? Ну-ка посмотрим по-ближе&hellip;</p>
<p>В переменной intptr_0 помещен адрес, куда копировать. Посмотрю что там с памятью у меня на машине. Вот тут и складируются, по адресу <strong>0x00000000013B01D8</strong>. Проверю-ка утилитой Task Explorer из пакета CFF, что же там по этому адресу&hellip;  Ясно видно, что копирование происходит в собственное адресное пространство. Хоть тут не такая мозго-дробилка: кажется, программа готова приступить к своему нехорошему делу&hellip; Если конечно ненароком это и впрямь не Firefox, как знать!</p>
<p><strong>Остановка &ldquo;Сбор данных&rdquo;</strong>.</p>
<p>И вот, наконец-то, после стольких усилий по сборке своего тельца, программа наконец-то начала показывать свое истинное лицо, а именно: собирать данные о системе, в которой она в данный момент гнездуется. Очень подозрительно для <strong>Firefox.exe</strong>&hellip;</p>
<p>В номинации &ldquo;язык без костей&rdquo; побеждает функция <strong>smethod_7()</strong>, которая клеит строки, тем самым сливая ценные данные исследователю.</p>
<p>Картина маслом: симпатичная синяя стрелочка эффектно обличает метод в предательстве с поличным, пока пойманные сообщники ютятся в комнате для допроса локальных переменных. Болтливая функция продолжает признаваться и в частности признается, что ее хозяин ищет это&hellip; Программа проявляет изрядный интерес к серийному номеру жесткого диска. Согласно библиотеке MSDN, это параметр класса <strong>Win32_LogicalDisk</strong> :</p>
<p>Access type: Read-only</p>
<p>Qualifiers: <strong>MappingStrings</strong> (&ldquo;Win32API|File System Functions<strong>GetVolumeInformation</strong>)</p>
<p><strong>Volume serial number of the logical disk.</strong></p>
<p><strong>10:10</strong>. И вот, в первый раз за долгое время отладки наконец-то попадаю в другой класс - в 8-ой, где, по всей видимости, и происходят какие-то загадочные манипуляции с файлами &ldquo;руками&rdquo; <strong>CreateDirectory(path4).</strong> Программа, используя функцию <strong>CreateDirectory(path4)</strong> &ldquo;вьёт себе гнёздышко&rdquo;, чтоб сложить туда все &ldquo;пожитки&rdquo; и позже &ldquo;улететь&rdquo;. &ldquo;Пожитки&rdquo; можно рассмотреть во всей красе сначала в окне локальных переменных, а потом и в директории, которые, как видно из картинки, создаются на компьютере. В одной из своих &ldquo;дневниковых&rdquo; записей уже была мысль, что строки - это, пожалуй основной помощник исследователя. Лучше них вряд ли что-то может поведать, что за чертовщина творится в программе. Вот и тут та же песня: сплошная радость! Какие интересные создаются директории&hellip; И зачем же вдруг <strong>Firefox.exe</strong> полез в папку Chrome? Промышленный шпионаж? Не думаю&hellip;. Собственно, все ясно с вами, мистер &ldquo;<strong>Firefox.exe</strong>&rdquo;!</p>
<p>На скриншоте видно, что программа собирает SQL запрос (конечно, если знать синтаксис SQL языка, тогда видно). Собрав пару запросов, программа сможет получить информацию, которой так жаждет.</p>
<p>И вот тут, вскоре после этого счастливого открытия я зависла. Конкретно так зависла. Какой-то кажущийся для простого смертного вечный цикл, составленный из нескольких функций виртуальной машины. Компилировать этот код не стану ибо я помру от старости прежде чем закончу. Придется менять во время запуска какую-то переменную, чтобы выйти из него, но какую?</p>
<p>Итак, нажимаю паузу и вижу, в чем, собственно, проблема (<strong>Class10</strong>, метод 5). Сколько ни нажимай &ldquo;Пауза&rdquo; и &ldquo;Старт&rdquo;, все равно спотыкаюсь именно на этой строке. И никак не пройду дальше Срочно надо кончать с этим днем сурка!</p>
<p><strong>10:40</strong>. Да уж&hellip; сидела, ковыряла чёртов код, когда надо было просто-напросто взять и использовать опцию, которая есть в каждом уважающем себя отладчике - &ldquo;установить следующую инструкцию&rdquo;! Она позволяет перепрыгнуть проблемный участок, не исполняя его. Вот главное правило - *<strong>знай свой инструментарий*</strong> и все его &ldquo;фишечки&rdquo;! Стало за себя немного стыдно, но с другой стороны, именно в такие моменты мы и учимся больше всего.</p>
<p>&ldquo;Установить следующую инструкцию&rdquo; это словно вместо того, чтобы решать задачку по математике в школе, просто сдать пустую тетрадку. Понятное дело, что задача не решена все равно, но на текущий вечер появятся свободные часы. Безусловно, у этого подхода есть свои минусы, никто не спорит, но в данном случае важно было пройти дальше. Плохо было б, если бы от этой строки что-то дальше сильно зависело, но в моем случае - нет, всё сработало!</p>
<p>Собственно, появилась копия этого файла. Теперь пару раз опять натыкаюсь на ошибки (такое с вирусами бывает нередко) и вот что вижу: этот вредитель шарахается по моим &ldquo;печенькам&rdquo; из разных браузеров.</p>
<p>И вот SQL запросы, которыми программа собирает информацию. Ничего себе! Она не просто собирает &ldquo;печеньки&rdquo; браузеров, так еще и данные кредитных карт! Ай-ай-ай&hellip;</p>
<p><strong>10:20</strong>. Сделаю перерыв. Почитаю &ldquo;Охотники за сокровищами&rdquo; и выпью кофе.</p>
<p><strong>Остановка &ldquo;Соберу вещи и застрелюсь&rdquo;</strong>.</p>
<p><strong>10:40</strong>. Ну что же. Пора. F5 и еду дальше, к конечной. Наконец-то упаковка собранного всего добра за окном пошла. Это значит, что все, что хотели взломщики, все собрали (правильнее &ldquo;собрали бы&rdquo;, хе-хе ). Проверяю и вижу, что ничего не удалось выцепить. Оно и понятно, на виртуальной машине у меня ничего и нет. Уж тем более нет там биткоинов; собственно, их нигде нет (печаль-тоска ). Да даже будь у меня весь комп напичкан до отвала разными валютами, секретными данными и записями компрометирующего содержания, у меня не подключен интернет, так что не судьба, товарищи!</p>
<p>Если обратить внимание, то создается файл .zip формата, а значит, логично предположить, создается архив. Что туда положат? Судя по названию, все что награбили.</p>
<p>Если упаковали, значит, и отправят (иначе смысл вообще все это делать?) Продолжаю отладку по F5, останавливаясь на разных точках останова, но всю информацию опять вываливает болтливая. И после недолгих стараний найден URL!</p>
<p>Поездка завершена. Итак, что же я имею после того, как вирус порылся в моих данных? Созданные папочки, в них аккуратненько собрано награбленное имущество, потом оно все было запаковано и отправлено создателю.</p>
<p>И вот после всех этих извращений с моей бедной виртуально машиной (не с виртуальной машиной конфьюзера! Эти значения не стоит путать) появилась еще какая-то ерунда (информацию по команде можно найти тут):</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="o">@</span><span class="s2">&#34;/C choice /C Y /N /D Y /T 1 &amp; Del &#34;&#34;C:\Users\$herl0ck\AppData\Local\Temp\D09F4560\temp.exe&#34;&#34;&#34;</span>

<span class="s2">&#34;CREATE TABLE cookies (creation_utc INTEGER NOT NULL UNIQUE PRIMARY KEY,host_key TEXT NOT NULL,name TEXT NOT NULL,value TEXT NOT NULL,path TEXT NOT NULL,expires_utc INTEGER NOT NULL,secure INTEGER NOT NULL,httponly INTEGER NOT NULL,last_access_utc INTEGER NOT NULL, has_expires INTEGER NOT NULL DEFAULT 1, persistent INTEGER NOT NULL DEFAULT 1,priority INTEGER NOT NULL DEFAULT 1,encrypted_value BLOB DEFAULT &#34;</span><span class="p">,</span><span class="n">firstpartyonly</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">)</span><span class="s2">&#34;
</span><span class="s2">
</span><span class="s2">&#34;</span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">cookies</span> <span class="p">(</span><span class="n">creation_utc</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">UNIQUE</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span><span class="n">host_key</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span><span class="n">name</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span><span class="n">value</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span><span class="n">path</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span><span class="n">expires_utc</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span><span class="n">secure</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span><span class="n">httponly</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span><span class="n">last_access_utc</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="n">has_expires</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="mi">1</span><span class="p">,</span> <span class="n">persistent</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="mi">1</span><span class="p">,</span><span class="n">priority</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="mi">1</span><span class="p">,</span><span class="n">encrypted_value</span> <span class="nb">BLOB</span> <span class="k">DEFAULT</span> <span class="s2">&#34;,firstpartyonly INTEGER NOT NULL DEFAULT 0)&#34;</span>
                       
<span class="s2">&#34;CREATE TABLE credit_cards (guid VARCHAR PRIMARY KEY, name_on_card VARCHAR, expiration_month INTEGER, expiration_year INTEGER, card_number_encrypted BLOB, date_modified INTEGER NOT NULL DEFAULT 0, origin VARCHAR DEFAULT &#34;</span><span class="p">,</span> <span class="n">use_count</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span> <span class="n">use_date</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span> <span class="n">billing_address_id</span> <span class="nb">VARCHAR</span><span class="p">)</span><span class="s2">&#34; 
</span><span class="s2">
</span><span class="s2">&#34;</span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">credit_cards</span> <span class="p">(</span><span class="n">guid</span> <span class="nb">VARCHAR</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="n">name_on_card</span> <span class="nb">VARCHAR</span><span class="p">,</span> <span class="n">expiration_month</span> <span class="nb">INTEGER</span><span class="p">,</span> <span class="n">expiration_year</span> <span class="nb">INTEGER</span><span class="p">,</span> <span class="n">card_number_encrypted</span> <span class="nb">BLOB</span><span class="p">,</span> <span class="n">date_modified</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span> <span class="n">origin</span> <span class="nb">VARCHAR</span> <span class="k">DEFAULT</span> <span class="s2">&#34;, use_count INTEGER NOT NULL DEFAULT 0, use_date INTEGER NOT NULL DEFAULT 0, billing_address_id VARCHAR)&#34;</span>
<span class="o">@</span><span class="s2">&#34;C:\Users\$herl0ck\AppData\Local\Google\Chrome\User Data\Default\Cookies&#34;</span>
<span class="o">@</span><span class="s2">&#34;C:\Users\$herl0ck\AppData\Local\Google\Chrome\User Data\Default\Cookies&#34;</span>
<span class="o">@</span><span class="s2">&#34;C:\Users\$herl0ck\AppData\Local\Kometa\User Data\Default\Cookies&#34;</span>
<span class="o">@</span><span class="s2">&#34;C:\Users\$herl0ck\AppData\Local\Orbitum\User Data\Default\Cookies&#34;</span>
<span class="o">@</span><span class="s2">&#34;C:\Users\$herl0ck\AppData\Local\Amigo\User\User ...
</span><span class="s2">@&#34;</span><span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\$</span><span class="n">herl0ck</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="k">Local</span><span class="err">\</span><span class="n">Temp</span><span class="err">\</span><span class="o">/</span><span class="n">iszqgdr5hoe</span><span class="p">.</span><span class="n">fv</span><span class="s2">&#34;
</span></code></pre></div><p>Что, собственно происходит? Очевидно: удаление exe-шника (программы) по указанному пути. Все, миссия выполнена, смысл жизни потерян, программа делает себе харакири. Тот кто сидит там, по ту сторону, сегодня не получил свои 0 Bitcoin от $herl0ck. Ну что же, не везет нам обоим.</p>
<p><a href="https://bakerst221buk.wordpress.com/2018/07/10/some-test-post-2/">https://bakerst221buk.wordpress.com/2018/07/10/some-test-post-2/</a></p>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.1237ff71925bb8625c97a9af8db4c54525258bedfd7c47493daaff723bea755e.js"></script>
  

  
  
  
    
  


</body>

</html>
