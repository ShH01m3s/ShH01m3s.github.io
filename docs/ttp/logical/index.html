<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📚 Logical Acquisition - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-ttp 🔍">
      <a href="/docs/ttp">
        <span>TTP 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-artefacts db 🏺">
      <a href="/docs/tools">
        <span>Artefacts DB 🏺</span>
      </a>
    </li>
    
    <li class="menu-item-attacks db ⚔️">
      <a href="/docs/tools">
        <span>Attacks DB ⚔️</span>
      </a>
    </li>
    
    <li class="menu-item-tools db 🛠️">
      <a href="/docs/tools">
        <span>Tools DB 🛠️</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-ttp 🔍">
      <a href="/docs/ttp">
        <span>TTP 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-artefacts db 🏺">
      <a href="/docs/tools">
        <span>Artefacts DB 🏺</span>
      </a>
    </li>
    
    <li class="menu-item-attacks db ⚔️">
      <a href="/docs/tools">
        <span>Attacks DB ⚔️</span>
      </a>
    </li>
    
    <li class="menu-item-tools db 🛠️">
      <a href="/docs/tools">
        <span>Tools DB 🛠️</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/ttp/"> 👈🏼 Back to </br> 🔎 Investigation Tactics Techniques and Procedures </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#checklist">Checklist</a>
      <ul>
        <li><a href="#order-of-volatility">Order of Volatility</a></li>
      </ul>
    </li>
    <li><a href="#windows">Windows</a></li>
    <li><a href="#macos">macOS</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">📚 Logical Acquisition</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      

      
      

      
    </div>
    
    <b>Created:</b> 30.05.2023
    <br />

    

  </header>


  <div class="content" itemprop="articleBody">
    <p><em>This type of acquisition can only happen on a live system. It&rsquo;s quicker and easier than imaging the drive, but you will miss some data. It&rsquo;s sometimes the only way to collect data from a mobile device.</em></p>
<h2 id="checklist">Checklist</h2>
<details>
    <summary>Expand&hellip;</summary>
    <ul>
<li><input disabled="" type="checkbox"> Attach a write blocker or run a software-based one. On the forensic MacBook, you can turn off disk arbitration or use write blockers. To turn off this feature, refer to <a href="https://forensicswiki.xyz/wiki/index.php?title=Disabling_Macintosh_Disk_Arbitration_Daemon">this</a> page. It&rsquo;s needed so the forensic machine won&rsquo;t change the data on the suspect MacBook. For Mac acquisition - follow <a href="https://forensicswiki.xyz/wiki/index.php?title=Acquiring_a_MacOS_System_with_Target_Disk_Mode">these</a> steps.</li>
<li><input disabled="" type="checkbox"> List all drives to get the id of the target.</li>
<li><input disabled="" type="checkbox"> Connect external HDD or SSD</li>
<li><input disabled="" type="checkbox"> Launch some forensic distribution (for example, Paladin). Make an image of the local HDD (❗️ Won&rsquo;t work for M1 Apple devices).</li>
</ul>

</details>
<blockquote>
<p>🧪 <em>What files are changed when something is connected to a Mac (USB or using Thunderbolt)? Is turning off the disk arbitration feature really preventing changes to the target drive?</em></p>
</blockquote>
<h3 id="order-of-volatility">Order of Volatility</h3>
<ul>
<li><input disabled="" type="checkbox"> <strong>Cache</strong>, <strong>registers</strong> (<strong>CPU</strong>). 🛠 Debuggers (OllyDbg, gdb, x64dbg etc)</li>
<li><input disabled="" type="checkbox"> <strong>ARoTa MeKSaPTa</strong>. ARP cache, routing table, memory, kernel statistics, process table. <strong>Mnemonics</strong>: ARoTa MeKSaPTa
<ul>
<li><input disabled="" type="checkbox"> <strong>Routing tables</strong>. Contain the following info: destination IP addresses or networks; the gateway IP address, or interface name if a directly connected resource; the metric, or cost, associated with the route – this enables the most efficient route to be selected; the outgoing interface the machine will use when forwarding a packet.
<ul>
<li><input disabled="" type="checkbox"> Windows <code>route print</code></li>
<li><input disabled="" type="checkbox"> UNIX <code>netstat -rn</code></li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>ARP cache</strong>: <code>arp -a</code></li>
<li><input disabled="" type="checkbox"> <strong>Process table</strong>. The list of processes currently running + metadata.
<ul>
<li><input disabled="" type="checkbox"> UNIX <code>ps</code></li>
<li><input disabled="" type="checkbox"> Windows. Task Manager (GUI) or <code>tasklist</code> (-&gt; <code>csv</code>).</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Kernel stats</strong>. 🛠 RAMMap, part of the Sysinternals suite for Windows, and memmap in the Linux world. Tracks the page usage (physical RAM chunks), mappings of those pages.</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Temporary files</strong>. Malware likes these folders because it&rsquo;s often already full of garbage.
<ul>
<li><input disabled="" type="checkbox"> Linux <code>/tmp</code>.</li>
<li><input disabled="" type="checkbox"> swap (UNIX)</li>
<li><input disabled="" type="checkbox"> pagefile (Windows)</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> <strong>Disk</strong>.</li>
<li><input disabled="" type="checkbox"> <strong>Logs</strong>. Monitoring data and remote logging pertaining to the computer in question. SIEMs and other log storages.</li>
<li><input disabled="" type="checkbox"> Physical <strong>configurations</strong>, network topology.</li>
<li><input disabled="" type="checkbox"> Archival media. CDs, backups, USBs.</li>
</ul>
<h2 id="windows">Windows</h2>
<p>Using 🛠️ <code>Kansa</code>, one can collect a wealth of artefacts from a Windows machine.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Get-NetConnectionProfile</span>
</span></span><span class="line"><span class="cl"><span class="nb">Set-NetConnectionProfile</span> <span class="n">-InterfaceIndex</span> <span class="n">X</span> <span class="n">-NetworkCategory</span> <span class="n">private</span> <span class="c"># requires admin</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">.\</span><span class="n">kansa</span><span class="p">.</span><span class="n">ps1</span> <span class="n">-Pushbin</span> <span class="n">-Target</span> <span class="n">localhost</span> <span class="n">-Credential</span> <span class="n">username</span> <span class="n">-Authentication</span> <span class="n">Negotiate</span>
</span></span></code></pre></div><blockquote>
<p>❗️ On macOS Parallels 18 with Windows 11 running as a VM, you&rsquo;d need to change the password for the user first to provide them in the prompt.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Select-String</span> <span class="s2">&#34;something&#34;</span> <span class="p">*.</span><span class="n">csv</span> <span class="c"># search for something keyword in all csv files in the current directory</span>
</span></span></code></pre></div><p>If the <code>-Analysis</code> option is provided when collecting data, it will generate analysis files following the collection from remote hosts. This script can be used to pull the frequency of autoruns based on ImagePath, LaunchString and MD5 tuple (given that the publisher is not verified): <code>Get-ASEPImagePathLaunchStringMD5UnsignedStack.ps1</code> <a href="https://github.com/davehull/Kansa/blob/master/Analysis/asep/Get-ASEPImagePathLaunchStringMD5UnsignedStack.ps1">https://github.com/davehull/Kansa/blob/master/Analysis/asep/Get-ASEPImagePathLaunchStringMD5UnsignedStack.ps1</a>. Here is the most crucial part of the script, its heart ❤️:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">COUNT</span><span class="p">(</span><span class="n">ImagePath</span><span class="p">,</span><span class="w"> </span><span class="n">LaunchString</span><span class="p">,</span><span class="w"> </span><span class="n">MD5</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ct</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">ImagePath</span><span class="p">,</span><span class="n">LaunchString</span><span class="p">,</span><span class="n">MD5</span><span class="p">,</span><span class="n">Publisher</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="o">*</span><span class="n">autorunsc</span><span class="p">.</span><span class="n">csv</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">WHERE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">Publisher</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;(Verified)%&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="n">ImagePath</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;File not found%&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">ImagePath</span><span class="p">,</span><span class="w"> </span><span class="n">LaunchString</span><span class="p">,</span><span class="w"> </span><span class="n">MD5</span><span class="p">,</span><span class="w"> </span><span class="n">Publisher</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">ct</span><span class="w"> </span><span class="k">ASC</span><span class="w">
</span></span></span></code></pre></div><p>This script accomplishes frequency analysis using <code>Get-Command logparser.exe</code> with the above SQL statement.</p>
<p>Select columns <code>ImagePath, LaunchString, MD5, and Publisher</code> from all CSV files with the names that end with <code>autorunsc.csv</code>. Then use <code>(ImagePath, LaunchString, MD5)</code> as a unique identifier, discard all that have been <code>Verified</code> in the <code>Publisher</code> column and <code>File not found </code>in the <code>ImagePath</code> column. Count unique values, put in the <code>ct</code> column, group by <code>ImagePath, LaunchString, MD5, Publisher</code> and sort in ascending order.</p>
<p>Another tool is 🛠️ <code>Autoruns</code> (comes with Sysinternals), but its focus is various autorun locations.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">autorunsc</span><span class="p">.</span><span class="n">exe</span> <span class="p">/</span><span class="n">accepteula</span> <span class="n">-a</span> <span class="p">*</span> <span class="n">-c</span> <span class="n">-h</span> <span class="n">-s</span> <span class="s1">&#39;*&#39;</span> <span class="n">-nobanner</span>
</span></span></code></pre></div><p><code>a</code> - all artefacts (boot, appinit dlls, explorer addons, sidebar gadgets, image hijacks, IE addons, known dlls, logon startups, WMI, office addons, printerr mon dll, LSA sec providers, autostart services and non-disabled drivres, winlogon entries, scheduled tasks, winlock protocol and net providers).
<code>c</code> - codec
<code>h</code> - hashes
<code>s</code> - verify digital signature
<code>'*'</code> - all user profiles</p>
<p>Something similar to Kansa is KAPE, but looks like it is no longer maintained. It provides the ability to extract artefacts from the mounted drives (be it an image, over network or a loval drive). Here are the files/folders pulled: <a href="https://ericzimmerman.github.io/KapeDocs/#!Pages%5C2.1-Targets.md">https://ericzimmerman.github.io/KapeDocs/#!Pages%5C2.1-Targets.md</a>.</p>
<blockquote>
<p>📝 Some commercial tools like <strong>Cyber Triage</strong> allow analysing the evidence on a live system without imaging drives or dumping memory. The digital footprint is claimed to be minimal. It can be used remotely.</p>
</blockquote>
<h2 id="macos">macOS</h2>
<p>🛠️ <a href="https://github.com/Dead-Simple-Scripts/AutoLLR">AutoLLR</a>. This script was designed for Linux. However, it can be adjusted for macOS. For example, adding <code>system_profiler</code>, <code>sw_vers</code>. Substitute <code>prinenv</code> for <code>env</code>.</p>
<blockquote>
<p>💡 My plan is to review and try running all these commands. This will help understand the type of evidence in the system and make necessary macOS-specific substitutions.</p>
</blockquote>
<blockquote>
<p>💡 Write a macOS triage tool similar to Kansa but bash-based, specifically targeting macOS. Do the same for iOS, Android, Linux, AWS etc. Check Sarah&rsquo;s GitHub to ensure there is nothing of that sort yet. Use <a href="https://github.com/mac4n6/APOLLO">https://github.com/mac4n6/APOLLO</a> to collect DBS,  <a href="https://github.com/mac4n6/macMRU-Parser">https://github.com/mac4n6/macMRU-Parser</a> to collect plists, <a href="https://github.com/mac4n6/Mac-Locations-Scraper">https://github.com/mac4n6/Mac-Locations-Scraper</a> location DBS, <a href="https://github.com/mac4n6/iOS-Frequent-Locations-Dumper">https://github.com/mac4n6/iOS-Frequent-Locations-Dumper</a> frequent locations.</p>
</blockquote>
<h2 id="references">References</h2>
<details>
    <summary>Expand&hellip;</summary>
    Something here
</details>
  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.302a6fc365d5139fb98cf60bdb8f715d96257ea189161d36c190ccfa8182e569.js"></script>
  

  
  
  
    
  


</body>

</html>
