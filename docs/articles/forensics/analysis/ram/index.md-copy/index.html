<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Powershell and Windows Management Instrumentation - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.32b06cb74069d8b26d087fbfd2852fc54428a31ff14ddead5c220eddcb248b07.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home üè°">
      <a href="/">
        <span>Home üè°</span>
      </a>
    </li>
    
    <li class="menu-item-articles üéì">
      <a href="/docs/articles">
        <span>Articles üéì</span>
      </a>
    </li>
    
    <li class="menu-item-blog ‚úçÔ∏è">
      <a href="/docs/blog">
        <span>Blog ‚úçÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit üß∞">
      <a href="/docs/toolkit">
        <span>Toolkit üß∞</span>
      </a>
    </li>
    
    <li class="menu-item-about me üßùüèΩ‚Äç‚ôÄÔ∏è">
      <a href="/docs/about">
        <span>About me üßùüèΩ‚Äç‚ôÄÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-achievements üèÖ">
      <a href="/docs/achievements">
        <span>Achievements üèÖ</span>
      </a>
    </li>
    
    <li class="menu-item-contacts ‚òéÔ∏è">
      <a href="/docs/contact">
        <span>Contacts ‚òéÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-notes üìù">
      <a href="/docs/notes">
        <span>Notes üìù</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home üè°">
      <a href="/">
        <span>Home üè°</span>
      </a>
    </li>
    
    <li class="menu-item-articles üéì">
      <a href="/docs/articles">
        <span>Articles üéì</span>
      </a>
    </li>
    
    <li class="menu-item-blog ‚úçÔ∏è">
      <a href="/docs/blog">
        <span>Blog ‚úçÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit üß∞">
      <a href="/docs/toolkit">
        <span>Toolkit üß∞</span>
      </a>
    </li>
    
    <li class="menu-item-about me üßùüèΩ‚Äç‚ôÄÔ∏è">
      <a href="/docs/about">
        <span>About me üßùüèΩ‚Äç‚ôÄÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-achievements üèÖ">
      <a href="/docs/achievements">
        <span>Achievements üèÖ</span>
      </a>
    </li>
    
    <li class="menu-item-contacts ‚òéÔ∏è">
      <a href="/docs/contact">
        <span>Contacts ‚òéÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-notes üìù">
      <a href="/docs/notes">
        <span>Notes üìù</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/articles/forensics/analysis/ram/"> Back to RAM Forensics üìÜ Section üëàüèº </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#terms">Terms</a></li>
    <li><a href="#privileges">Privileges</a></li>
    <li><a href="#examples">Examples</a></li>
    <li><a href="#resources">Resources</a></li>
  </ul>
</nav>
 </aside>
 </div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Powershell and Windows Management Instrumentation</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      <div class="article-category">domain: 
          
              
                <i class="fas fa-archive"></i>
              
          <a class="category-link" href="/domain/general">general</a>
          
      </div> <br />
      
      <div class="article-category">doctype:
          
            
              
                <i class="fa fa-graduation-cap"></i>
              
          <a class="platform-link" href="/doctype/article">article</a>
          
      </div> <br /><br/>
      
      
      
      
      <div class="article-category">
          
            
              <i class="fab fa-windows"></i>          
            
            
            
            
            
          <a class="platform-link" href="/platforms/windows">windows</a>
          
      </div> <br />
      

      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <h2 id="terms">Terms</h2>
<p><strong>cmdlet</strong> - put certain enhanced operating system functions into effect when usung powershell, example: <code>Get-Help</code>.</p>
<p><strong>WMI</strong> (Windows Management Instrumentation). Some of the functions are available through powershell cmdlets. Use <code>Get-Command -Noun WMI*</code> to get all WMI cmdlets. On my Windows VM (Parallels, Windows insider) I got this result:</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">PS </span><span class="n">C:</span><span class="p">\</span><span class="n">Users</span><span class="p">\</span><span class="n">user</span><span class="p">&gt;</span> <span class="nb">Get-Command</span> <span class="n">-Noun</span> <span class="n">WMI</span><span class="p">*</span>

<span class="n">CommandType</span>     <span class="n">Name</span>                              <span class="n">Version</span>    <span class="n">Source</span>
<span class="p">-----------</span>     <span class="p">----</span>                              <span class="p">-------</span>    <span class="p">------</span>
<span class="n">Cmdlet</span>          <span class="nb">Get-WmiObject</span>          <span class="n">3</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span>    <span class="n">Microsoft</span><span class="p">.</span><span class="n">PowerShell</span><span class="p">.</span><span class="n">Management</span>
<span class="n">Cmdlet</span>          <span class="nb">Invoke-WmiMethod</span>       <span class="n">3</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span>    <span class="n">Microsoft</span><span class="p">.</span><span class="n">PowerShell</span><span class="p">.</span><span class="n">Management</span>
<span class="n">Cmdlet</span>          <span class="nb">Register-WmiEvent</span>      <span class="n">3</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span>    <span class="n">Microsoft</span><span class="p">.</span><span class="n">PowerShell</span><span class="p">.</span><span class="n">Management</span>
<span class="n">Cmdlet</span>          <span class="nb">Remove-WmiObject</span>       <span class="n">3</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span>    <span class="n">Microsoft</span><span class="p">.</span><span class="n">PowerShell</span><span class="p">.</span><span class="n">Management</span>
<span class="n">Cmdlet</span>          <span class="nb">Set-WmiInstance</span>        <span class="n">3</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span>    <span class="n">Microsoft</span><span class="p">.</span><span class="n">PowerShell</span><span class="p">.</span><span class="n">Management</span>
</code></pre></div><p>WIM cmdlets were deprecated accourding to the doc, so the recommendation is to start using CIM (Common Information Model). However, CIM is using WIM under the hood anyway. This is what I&rsquo;ve got on the WinVM:</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">PS </span><span class="n">C:</span><span class="p">\</span><span class="n">Users</span><span class="p">\</span><span class="n">user</span><span class="p">&gt;</span> <span class="nb">Get-Command</span> <span class="n">-Module</span> <span class="n">CimCmdlets</span>

<span class="n">CommandType</span>     <span class="n">Name</span>                                               <span class="n">Version</span>    <span class="n">Source</span>
<span class="p">-----------</span>     <span class="p">----</span>                                               <span class="p">-------</span>    <span class="p">------</span>
<span class="n">Cmdlet</span>          <span class="nb">Export-BinaryMiLog</span>                                 <span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span>    <span class="n">CimCmdlets</span>
<span class="n">Cmdlet</span>          <span class="nb">Get-CimAssociatedInstance</span>                          <span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span>    <span class="n">CimCmdlets</span>
<span class="n">Cmdlet</span>          <span class="nb">Get-CimClass</span>                                       <span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span>    <span class="n">CimCmdlets</span>
<span class="n">Cmdlet</span>          <span class="nb">Get-CimInstance</span>                                    <span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span>    <span class="n">CimCmdlets</span>
<span class="n">Cmdlet</span>          <span class="nb">Get-CimSession</span>                                     <span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span>    <span class="n">CimCmdlets</span>
<span class="n">Cmdlet</span>          <span class="nb">Import-BinaryMiLog</span>                                 <span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span>    <span class="n">CimCmdlets</span>
<span class="n">Cmdlet</span>          <span class="nb">Invoke-CimMethod</span>                                   <span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span>    <span class="n">CimCmdlets</span>
<span class="n">Cmdlet</span>          <span class="nb">New-CimInstance</span>                                    <span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span>    <span class="n">CimCmdlets</span>
<span class="n">Cmdlet</span>          <span class="nb">New-CimSession</span>                                     <span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span>    <span class="n">CimCmdlets</span>
<span class="n">Cmdlet</span>          <span class="nb">New-CimSessionOption</span>                               <span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span>    <span class="n">CimCmdlets</span>
<span class="n">Cmdlet</span>          <span class="nb">Register-CimIndicationEvent</span>                        <span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span>    <span class="n">CimCmdlets</span>
<span class="n">Cmdlet</span>          <span class="nb">Remove-CimInstance</span>                                 <span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span>    <span class="n">CimCmdlets</span>
<span class="n">Cmdlet</span>          <span class="nb">Remove-CimSession</span>                                  <span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span>    <span class="n">CimCmdlets</span>
<span class="n">Cmdlet</span>          <span class="nb">Set-CimInstance</span>                                    <span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span>    <span class="n">CimCmdlets</span>
</code></pre></div><h2 id="privileges">Privileges</h2>
<p>Powershell has the exact same privileges as when you are using GUI. For example, when runnning Powershell as local admin, you might get an &ldquo;access denied üôÖ‚Äç‚ôÄÔ∏è&rdquo; error trying to connect to a remote machine. In this case you have two options:</p>
<ol>
<li>restart Powershell with <em>domain</em> admin privileges (less secure since you&rsquo;d end up using this privileged window to do other non-privileged stuff);</li>
<li>use per-command privilege escalation: ``.</li>
</ol>
<p><img src="images/cim-session-create.png" alt="cim-session-create"></p>
<h2 id="examples">Examples</h2>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># get the serial</span>
<span class="nb">Get-CimInstance</span> <span class="n">-ClassName</span> <span class="n">Win32_BIOS</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-Property</span> <span class="n">SerialNumber</span>

<span class="c"># these two options return the same result:</span>
<span class="c"># 1</span>
<span class="p">(</span><span class="nb">Get-CimInstance</span> <span class="n">-ClassName</span> <span class="n">Win32_BIOS</span> <span class="n">-Property</span> <span class="n">SerialNumber</span><span class="p">).</span><span class="n">SerialNumber</span>
<span class="c"># 2</span>
<span class="nb">Get-CimInstance</span> <span class="n">-ClassName</span> <span class="n">Win32_BIOS</span> <span class="n">-Property</span> <span class="n">SerialNumber</span> <span class="p">|</span>
<span class="nb">Select-Object</span> <span class="n">-ExpandProperty</span> <span class="n">SerialNumber</span>

<span class="c"># query a remote PC</span>
<span class="nb">Get-CimInstance</span> <span class="n">-ComputerName</span> <span class="n">dc01</span> <span class="n">-ClassName</span> <span class="n">Win32_BIOS</span>
<span class="c"># might get an &#34;access denied&#34; error</span>

</code></pre></div><h2 id="resources">Resources</h2>
<p>[<a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/ps101/07-working-with-wmi?view=powershell-7.1">1</a>] Official Docs</p>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.1237ff71925bb8625c97a9af8db4c54525258bedfd7c47493daaff723bea755e.js"></script>
  

  
  
  
    
  


</body>

</html>
