<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Prefetch Forensics - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.32b06cb74069d8b26d087fbfd2852fc54428a31ff14ddead5c220eddcb248b07.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-articles">
      <a href="/docs/articles">
        <span>Articles</span>
      </a>
    </li>
    
    <li class="menu-item-blog">
      <a href="/docs/blog">
        <span>Blog</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit">
      <a href="/docs/toolkit">
        <span>Toolkit</span>
      </a>
    </li>
    
    <li class="menu-item-about me">
      <a href="/docs/about">
        <span>About me</span>
      </a>
    </li>
    
    <li class="menu-item-achievements">
      <a href="/docs/achievements">
        <span>Achievements</span>
      </a>
    </li>
    
    <li class="menu-item-contacts">
      <a href="/docs/contact">
        <span>Contacts</span>
      </a>
    </li>
    
    <li class="menu-item-notes">
      <a href="/docs/notes">
        <span>Notes</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-articles">
      <a href="/docs/articles">
        <span>Articles</span>
      </a>
    </li>
    
    <li class="menu-item-blog">
      <a href="/docs/blog">
        <span>Blog</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit">
      <a href="/docs/toolkit">
        <span>Toolkit</span>
      </a>
    </li>
    
    <li class="menu-item-about me">
      <a href="/docs/about">
        <span>About me</span>
      </a>
    </li>
    
    <li class="menu-item-achievements">
      <a href="/docs/achievements">
        <span>Achievements</span>
      </a>
    </li>
    
    <li class="menu-item-contacts">
      <a href="/docs/contact">
        <span>Contacts</span>
      </a>
    </li>
    
    <li class="menu-item-notes">
      <a href="/docs/notes">
        <span>Notes</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/articles/forensics/artifactsdb/windows-artifacts/materials/"> Back to Materials Section </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#tools">Tools</a>
      <ul>
        <li><a href="#winprefetchview">WinPrefetchView</a></li>
        <li><a href="#fred---forensic-registry-editor">Fred - Forensic Registry Editor</a></li>
        <li><a href="#ftk-imager-lite">FTK Imager Lite</a></li>
        <li><a href="#cdqr">CDQR</a></li>
        <li><a href="#regripper-gui-and-cui">RegRipper (GUI and CUI)</a></li>
        <li><a href="#prefetch-parser">Prefetch parser</a></li>
      </ul>
    </li>
    <li><a href="#intro">Intro</a></li>
    <li><a href="#caveats">Caveats</a></li>
  </ul>
</nav>
 </aside>
 </div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Prefetch Forensics</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      <div class="article-category">domain: 
          
              
                <i class="fas fa-search"></i>
              
          <a class="category-link" href="/domain/forensics">forensics</a>
          
      </div> <br />
      
      <div class="article-category">doctype:
          
            
              
                <i class="fa fa-sticky-note"></i>
              
          <a class="platform-link" href="/doctype/coursenotes">coursenotes</a>
          
      </div> <br /><br/>
      
      
      
      

      
      

      
      <div class="article-tag">
          <i class="fas fa-tag"></i>
          
          
          <a class="tag-link" href="/tags/sdf" rel="tag">sdf</a>
          
           ,  
          <a class="tag-link" href="/tags/prefetch" rel="tag">prefetch</a>
          
      </div> 
      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <p><em>This is my course notes from Prefetch forensics series.</em></p>
<h2 id="tools">Tools</h2>
<h3 id="winprefetchview">WinPrefetchView</h3>
<p>To view pretech files (decompressed as well) in GUI.</p>
<h3 id="fred---forensic-registry-editor">Fred - Forensic Registry Editor</h3>
<p>To view exported hives.</p>
<h3 id="ftk-imager-lite">FTK Imager Lite</h3>
<p>Fairly heavy footprint - 15-16Mb.</p>
<h3 id="cdqr">CDQR</h3>
<p>This tool focuses on the <code>pf</code> intself rather than on a data it contains. It&rsquo;s useful for making timelines.</p>
<h3 id="regripper-gui-and-cui">RegRipper (GUI and CUI)</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">rip.exe -r SYSTEM -p prefetch <span class="c1"># to show whether prefetch is enabled</span>
</code></pre></div><h3 id="prefetch-parser">Prefetch parser</h3>
<p>More info than with WinPrefetchView</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">prefetch.py -c -d -e
prefetch.py -c -d &gt; pf.csv
prefetch.py -f &lt;file_to_parse&gt; &gt; pf.txt
</code></pre></div><p>Columns: last executed, MFT sequence number, MFT record number, executable name, run counter,</p>
<h2 id="intro">Intro</h2>
<p>If collecting prfethc on a live system, run volatile collection tools before that.</p>
<p>Prefetch is for efficiency of starting processes and their resources (movies for media players, spreadsheets for Excel for example). Improves startup time of applications. Filename, Creation time, Modified time, File Size, Process EXE, Process Path, Run Counter, Last Run Time, Missing Process + libraries and resources for each process.</p>
<p>Forensics value - tracks the execution of programs. Central repository of what was run on the system. File size can be used to search for the same process with a different name on a different machine.</p>
<p>C:\Windows\Prefetch.</p>
<p>All prefetch have a signature at offset 4th byte. MAM - compressed and SCCA - plain text.</p>
<table>
<thead>
<tr>
<th>OS</th>
<th>Signature1 (version)</th>
<th>signature2 (type)</th>
</tr>
</thead>
<tbody>
<tr>
<td>WinXP &amp; 2003</td>
<td>0x00000011 or 17</td>
<td>SCCA</td>
</tr>
<tr>
<td>Vista</td>
<td>0x00000023 or 23</td>
<td>SCCA</td>
</tr>
<tr>
<td>W8</td>
<td>0x0000001a or 26</td>
<td>SCCA</td>
</tr>
<tr>
<td>W10</td>
<td>MAM</td>
<td>0x04</td>
</tr>
<tr>
<td>W10</td>
<td>0x0000001e or 30</td>
<td>SCCA</td>
</tr>
</tbody>
</table>
<p>Prefetch can be disabled in registry C:\Windows\System32\config\SYSTEM. Export it and open, for example, in Fred. CurrentControlSet -&gt; SessionManager -&gt; Memory Managment -&gt; Prefetch Parameters -&gt; Enable Prefetcher:</p>
<table>
<thead>
<tr>
<th>key</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0</code></td>
<td>disabled</td>
</tr>
<tr>
<td><code>1</code></td>
<td>enabled for apps only</td>
</tr>
<tr>
<td><code>2</code></td>
<td>enabled for boot only</td>
</tr>
<tr>
<td><code>3</code></td>
<td>boot and app enabled (default)</td>
</tr>
</tbody>
</table>
<p>You can check it with <code>rip.exe</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">rip.exe -r SYSTEM -p prefetch <span class="c1"># to show whether prefetch is enabled</span>
</code></pre></div><h2 id="caveats">Caveats</h2>
<p>On servers is usually turned off. And starting with Win10 - compressed. For systems with solid state drives it&rsquo;s also disabled. With Win8 - additional run times recorded. Also, there is latency issue - some apps are not closed upon clicking X, but remain running in background. Hence, the last time run might be different.</p>
<blockquote>
<p>If the app was deleted and then reinstalled? What the firtst run time will be?</p>
<p>What if I rename an executable?</p>
<p>If the exe is substitued?</p>
</blockquote>
<p>If the same exe was run from different locations - different <code>.pf</code> files. If the application was deleted, the info remains in prefetch.</p>
<blockquote>
<p>Write a sctipt to determine deleted files</p>
</blockquote>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.1237ff71925bb8625c97a9af8db4c54525258bedfd7c47493daaff723bea755e.js"></script>
  

  
  
  
    
  


</body>

</html>
