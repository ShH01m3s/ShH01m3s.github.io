<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>File Systems - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.32b06cb74069d8b26d087fbfd2852fc54428a31ff14ddead5c220eddcb248b07.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-articles">
      <a href="/docs/articles">
        <span>Articles</span>
      </a>
    </li>
    
    <li class="menu-item-blog">
      <a href="/docs/blog">
        <span>Blog</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit">
      <a href="/docs/toolkit">
        <span>Toolkit</span>
      </a>
    </li>
    
    <li class="menu-item-about me">
      <a href="/docs/about">
        <span>About me</span>
      </a>
    </li>
    
    <li class="menu-item-achievements">
      <a href="/docs/achievements">
        <span>Achievements</span>
      </a>
    </li>
    
    <li class="menu-item-contacts">
      <a href="/docs/contact">
        <span>Contacts</span>
      </a>
    </li>
    
    <li class="menu-item-notes">
      <a href="/docs/notes">
        <span>Notes</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-articles">
      <a href="/docs/articles">
        <span>Articles</span>
      </a>
    </li>
    
    <li class="menu-item-blog">
      <a href="/docs/blog">
        <span>Blog</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit">
      <a href="/docs/toolkit">
        <span>Toolkit</span>
      </a>
    </li>
    
    <li class="menu-item-about me">
      <a href="/docs/about">
        <span>About me</span>
      </a>
    </li>
    
    <li class="menu-item-achievements">
      <a href="/docs/achievements">
        <span>Achievements</span>
      </a>
    </li>
    
    <li class="menu-item-contacts">
      <a href="/docs/contact">
        <span>Contacts</span>
      </a>
    </li>
    
    <li class="menu-item-notes">
      <a href="/docs/notes">
        <span>Notes</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/articles/fundamentals/code/"> Back to Reverse Engineering and Low Level Stuff Section </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#data-structures-and-flags">Data structures and Flags</a></li>
      </ul>
    </li>
    <li><a href="#bootcode-and-booting-process">Bootcode and Booting Process</a></li>
    <li><a href="#partition-tables">Partition tables</a></li>
    <li><a href="#mbr">MBR</a></li>
    <li><a href="#gpt">GPT</a></li>
    <li><a href="#file-systems">File Systems</a></li>
    <li><a href="#apfs">APFS</a></li>
    <li><a href="#ntfs">NTFS</a></li>
  </ul>
</nav>
 </aside>
 </div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">File Systems</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      <div class="article-category">domain: 
          
              
                <i class="fas fa-archive"></i>
              
          <a class="category-link" href="/domain/general">general</a>
          
      </div> <br />
      
      <div class="article-category">doctype:
          
            
              
                <i class="fa fa-graduation-cap"></i>
              
          <a class="platform-link" href="/doctype/article">article</a>
          
      </div> <br /><br/>
      
      
      
      

      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <p>There are: file name, file metadata and the contents of the file itself. They are not in the same place. File metadata contains filename and also a ptr to the sector, where the file&rsquo;s contents starts and size of data. Theoretically, we could change the file metadata to make it point to another cluster&hellip; ü§î</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Cluster</th>
<th>size</th>
<th>last accessed</th>
</tr>
</thead>
<tbody>
<tr>
<td>malware.txt</td>
<td>654</td>
<td>80</td>
<td>October 13, 2020</td>
</tr>
</tbody>
</table>
<p><strong>Essential</strong> data - can be trusted and <strong>non</strong>-<strong>essential</strong> cannot. But if ptr to cluster is called essential data, how we can trust it? Well, it&rsquo;s much harder to tamper with.</p>
<p><a href="https://apple.stackexchange.com/questions/321406/extract-hfs-hfsx-volume-from-dmg-file">https://apple.stackexchange.com/questions/321406/extract-hfs-hfsx-volume-from-dmg-file</a></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">open <span class="o">[</span>path/to/dmg<span class="o">]</span>
dd <span class="k">if</span><span class="o">=</span><span class="s2">&#34;/dev/disk[number]&#34;</span> <span class="nv">of</span><span class="o">=</span><span class="s2">&#34;/extract/path/file.img&#34;</span>
fdisk -l file.img
dd <span class="k">if</span><span class="o">=</span><span class="s2">&#34;path/to/file.img&#34;</span> <span class="nv">bs</span><span class="o">=</span>sector_size <span class="nv">skip</span><span class="o">=</span>sectors <span class="nv">count</span><span class="o">=</span>sectors &gt;&gt; output.hfs
</code></pre></div><h3 id="data-structures-and-flags">Data structures and Flags</h3>
<p>First, there must be some data structure identifier so that the CPU could know, how to read the subsequent data. For example, if we have the following:</p>
<p><code>1001 1000 1001 1110 1010 1100 1000 101</code></p>
<p>For example, the first 4 bits <code>0101</code> tell the CPU that the next bits should be interpreted as an image. Then, for example, there are other 4 bits <code>0011</code> that are 4 flags. Flag is a 1-bit value, indicating either <code>true</code> or <code>false</code>, or either <code>exists</code> or <code>doesn't</code>. This are flags, for example, that indicate: wether it&rsquo;s black-and-white (<code>0</code>) or colored (<code>1</code>); wether the image is editable <code>1</code> or <code>0</code> etc. And then the file contents.</p>
<p>Consider the above binary sequence. To make it more compressed, convert it to hex: <code>4c 4f 56 45</code>. What is this? That depends. If you tell CPU that it&rsquo;s machine instructions, then it&rsquo;s see this:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">dec esp
dec edi
push esi
inc ebp
</code></pre></div><p>But what if you tell that it&rsquo;s text? Then CPU sees&hellip; check out <a href="https://www.rapidtables.com/convert/number/ascii-to-hex.html">here</a>.</p>
<h2 id="bootcode-and-booting-process">Bootcode and Booting Process</h2>
<h2 id="partition-tables">Partition tables</h2>
<p>Partitioning is the address range where the volume with a file system can sit. You create a partition, then you format it to create a volume with a file system. So, <em>partition</em> and <em>volume</em> are not interchangable terms. Usually, a volume occupies the whole partition, but that&rsquo;s not always the case. Sometimes, some little address sapce might be left out of the volume, so that this volume would not occupy the whole partition.</p>
<h2 id="mbr">MBR</h2>
<p>Primary partitions (bootable). Can have at most 4 bootable partitions. We can look at offset 440 to see which volumes are maped to which drive letter in the registry.</p>
<h2 id="gpt">GPT</h2>
<p>Up to a 128 partitions, all of them can be set as bootable. Will still have a dummy MBR at sector 0 and it&rsquo;s there for backwards compatibility.</p>
<h2 id="file-systems">File Systems</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Partition size (min/max)</th>
<th>Cluster size (min/max)</th>
</tr>
</thead>
<tbody>
<tr>
<td>FAT16</td>
<td>16Mb/2Gb</td>
<td>2Kb/32Kb</td>
</tr>
<tr>
<td>FAT32</td>
<td>260Mb/32Gb üîç</td>
<td>2Kb/32Kb</td>
</tr>
<tr>
<td>NTFS 1.1</td>
<td>500Mb/8Gb üîç</td>
<td>512B/8Kb</td>
</tr>
<tr>
<td>NTFS 3.0</td>
<td>500Mb/16EB</td>
<td>512B/64Kb</td>
</tr>
<tr>
<td>HFS</td>
<td></td>
<td></td>
</tr>
<tr>
<td>HFS+</td>
<td></td>
<td></td>
</tr>
<tr>
<td>APFS</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>üîç - this is from M. Graves' book &ldquo;Digital Archeaology&rdquo; book. I have not found any other information about max partition size on NTFS 1.1 and FAT32 max partition size is claimed to be 2,048 Gb, which doesn&rsquo;t correlate with other resources.</p>
<h2 id="apfs">APFS</h2>
<p>Apple üçè. 2006 PowerPC -&gt; Intel. They also moved to GUID partitioning (GPT). GPT replaces MPT at the end of MBR. The main difference between them is that MPT can only define 4 primary partitions, while GPT can have</p>
<p>Partitions and volumes are slightly different than for other FS. When we see a APFS disk, think in terms of volumes.</p>
<p>There  are five entries (raws) there. One of them, the first, is most likely a general, main container. The other 4 are volumes: MacHD, Preboot, Recovery, VM (standard, but MacHD is usually named Macintosh HD).</p>
<p>The first one - container GUID. All the volumes have the same container GUID. Container GUID is similar to disk signature or the serial number that we find at offset 440 of the MBR when we are looking at HDDs from a Windows system.</p>
<p>APFS volumes are not fixed in size. Share space within a container. Unallocated space is pooled to all the volumes within. That&rsquo;s why when analysing volumes there is no way to tell, which volume this unallocated space originated from (unlike on Win).</p>
<ul>
<li><input disabled="" type="checkbox"> <a href="https://eclecticlight.co/2019/12/18/making-sense-of-disk-utility-and-disk-structure-in-macos-10-13-10-15/">Making sense of Disk Utility and disk structure in macOS 10.13-10.15</a></li>
</ul>
<h2 id="ntfs">NTFS</h2>
<p>Windows OS file system for 27 years.</p>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.1237ff71925bb8625c97a9af8db4c54525258bedfd7c47493daaff723bea755e.js"></script>
  

  
  
  
    
  


</body>

</html>
