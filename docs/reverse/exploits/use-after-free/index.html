<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👉🏼 Use-After-Free - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/reverse/exploits/"> 👈🏼 Back to </br> ⚙️ Exploits </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#mechanics">Mechanics</a></li>
    <li><a href="#pseudocode">Pseudocode</a></li>
    <li><a href="#examples">Examples</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">👉🏼 Use-After-Free</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      

      
      

      
    </div>
    
    <b>Created:</b> 11.05.2023
    <br />

    

  </header>


  <div class="content" itemprop="articleBody">
    <p><em>This article is about use-after-free vulnerability, its mechanics and how it can be used for evil things. Several things could be done by using this vulnerability, for example, reading sensitive info or arbitrary code execution. The exploitation often requires the presence of some other vulnerability as well, for example, buffer overflow (not always).</em></p>
<h2 id="mechanics">Mechanics</h2>
<p>Computer stores data in either of two places: heap or stack. The stack is relatively small, so only a little is stored there (although it does not mean any less valuable). While buffer overflow is more of a concern for the stack, this vulnerability is the heap&rsquo;s 💩 headache.</p>
<p>So, imagine you have a pointer 🌻 pointing to some 🌴 object on the heap 💩 that will say, <code>start doing good</code>. Some address space is allocated for this data structure, all good.</p>
<p><img src="images/use-after-free-1.png" alt="img">
Now, the program thinks it doesn&rsquo;t need that object anymore and says to the OS: <em>&ldquo;Hey, OS, you can choke on that address space, I don&rsquo;t need it&rdquo;</em>. But the OS is not made of flimsy material and just says, <em>&ldquo;Eh, whatever, I am busy. Five minutes.&rdquo;</em>.</p>
<p><img src="https://media.giphy.com/media/AhvmkDdoQd8rM1CcI0/giphy.gif" alt="img"></p>
<p>So, it just puts the broom 🧹 by the address space and forgets about it (<em>&ldquo;Why bother? when the space is needed, I will overwrite it&rdquo;, it thinks.</em>)</p>
<p><img src="images/use-after-free-2.png" alt="img">
Now, another object is created, a 🥀 beautiful rose. It carries a message <em>&ldquo;Cease doing good, start doing evil.&rdquo;</em>. The developer doesn&rsquo;t intend to use its horrible and distructive function, but he only needs its petals. As it does for any other object, OS allocates new space for that 🥀 object. But remember, it&rsquo;s lazy. It doesn&rsquo;t go far. What&rsquo;s the last memory freed and thus the closest?</p>
<p><img src="https://media.giphy.com/media/kNh9VzboALXt6/giphy.gif" alt="img"></p>
<p><img src="images/use-after-free-3.png" alt="img"></p>
<p><img src="images/use-after-free-4.png" alt="img"></p>
<p><img src="images/use-after-free-5.png" alt="img"></p>
<h2 id="pseudocode">Pseudocode</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">class</span> <span class="err">🌻</span> <span class="n">UserSunflowerData</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	 <span class="kt">char</span> <span class="n">seeds</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	 <span class="n">public</span> <span class="kt">void</span> <span class="nf">bloom</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">		 <span class="cp"># some code
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>	 <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">class</span> <span class="err">🥀</span> <span class="n">UserRoseData</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">petals</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="n">public</span> <span class="kt">void</span> <span class="nf">loose_petals</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">		 <span class="cp"># some code
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>	 <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="err">🌻</span> <span class="n">sunflower</span> <span class="o">=</span> <span class="n">new</span> <span class="err">🌻</span> <span class="n">UserSunflowerData</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="err">🌻</span> <span class="n">sunflower</span><span class="o">-&gt;</span><span class="n">bloom</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">free</span><span class="p">(</span><span class="err">🌻</span> <span class="n">sunflower</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="err">🥀</span> <span class="n">username</span> <span class="o">=</span> <span class="n">new</span> <span class="err">🥀</span> <span class="n">UserRoseData</span><span class="p">(</span><span class="n">input</span><span class="p">(</span><span class="s">&#34;What&#39;s your username, pal?&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="err">🌻</span> <span class="n">sunflower</span><span class="o">-&gt;</span><span class="n">bloom</span><span class="p">();</span> <span class="c1">// expected to run bloom, but might run 🥀 UserRoseData-&gt;loose_petals() instead if the same memory location was reused.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>Now, imagine that the attacker has control over the <code>🥀 username</code>. For example, they are prompted to enter their desired username. Now, imagine that data is physically located exactly in the same place where the <code>🌻sunflower</code> used to be. One would expect to see the 🌻 sunflower-&gt;bloom, but will instead see <code>🥀 rose-&gt;loose_petals</code>.</p>
<h2 id="examples">Examples</h2>
<p>Microsoft Explorer had this vulnerability long time ago.</p>
<h2 id="references">References</h2>
<details>
    <summary>Expand&hellip;</summary>
    Something here
</details>
  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.302a6fc365d5139fb98cf60bdb8f715d96257ea189161d36c190ccfa8182e569.js"></script>
  

  
  
  
    
  


</body>

</html>
