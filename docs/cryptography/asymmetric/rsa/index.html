<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RSA - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.fdbd9d5cb0cf0052278919e6215fcb4d1e74fc19130407295de2bbe2ee68d0d0.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
    <li class="menu-item-notes 📝">
      <a href="/docs/notes">
        <span>Notes 📝</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home 🏡">
      <a href="/">
        <span>Home 🏡</span>
      </a>
    </li>
    
    <li class="menu-item-blog ✍️">
      <a href="/docs/blog">
        <span>Blog ✍️</span>
      </a>
    </li>
    
    <li class="menu-item-dfir 🔍">
      <a href="/docs/dfir">
        <span>DFIR 🔍</span>
      </a>
    </li>
    
    <li class="menu-item-crypto 🗝️">
      <a href="/docs/cryptography">
        <span>Crypto 🗝️</span>
      </a>
    </li>
    
    <li class="menu-item-reverse 🔧">
      <a href="/docs/reverse">
        <span>Reverse 🔧</span>
      </a>
    </li>
    
    <li class="menu-item-toolkit 🧰">
      <a href="/docs/toolkit">
        <span>Toolkit 🧰</span>
      </a>
    </li>
    
    <li class="menu-item-threat hunting 🪤">
      <a href="/docs/thunting">
        <span>Threat Hunting 🪤</span>
      </a>
    </li>
    
    <li class="menu-item-about me 🧝🏽‍♀️">
      <a href="/docs/about">
        <span>About me 🧝🏽‍♀️</span>
      </a>
    </li>
    
    <li class="menu-item-tech reference 📚">
      <a href="/docs/reference">
        <span>Tech Reference 📚</span>
      </a>
    </li>
    
    <li class="menu-item-notes 📝">
      <a href="/docs/notes">
        <span>Notes 📝</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/cryptography/asymmetric/"> 👈🏼 Back to </br> Assymetric Algorithms </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#the-story-of-klutzy">The Story of Klutzy</a></li>
    <li><a href="#locking-the-message">Locking the Message</a>
      <ul>
        <li><a href="#step-1-cragting-a-lock">Step 1. Cragting a Lock</a></li>
        <li><a href="#step-2-crafting-the-key">Step 2. Crafting the Key</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
 </div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">RSA</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      <div class="article-category">domain: 
          
              
                <i class="fa fa-magic"></i>
              
          <a class="category-link" href="/domain/crypto">crypto</a>
          
      </div> <br />
      
      <div class="article-category">doctype:
          
            
              
                <i class="fa fa-graduation-cap"></i>
              
          <a class="platform-link" href="/doctype/article">article</a>
          
      </div> <br /><br/>
      
      
      
      

      
      

      
    </div>
  </header>


  <div class="content" itemprop="articleBody">
    <p><em>To my utter embarrassment I had to admit that I&rsquo;ve recently realized I didn&rsquo;t remember how the RSA worked&hellip;. What I though to be RSA turned out to be Diffie-Hellman algorithm&hellip; Oops 😬. So, I&rsquo;ve rewatched Khan&rsquo;s video about RSA and was surprised I could every confuse the two. This article and another one about Diffie-Hellman is my way of explaining cryptographic notions: visual representation, verbal explanation and&hellip; code. Thanks to Python 🐍.</em></p>
<p><img src="images/angry-cat.jpeg" alt="_109474861_angrycat-index-getty3-3"></p>
<p>Diffie Hellman key exchange 🗝️ is based on the following mathmetical laws and theorems:</p>
<ol>
<li>Modular arithmetics (the one with % sign). It&rsquo;s also called &ldquo;clock&rdquo; arithmetic, I think. You can read about it in <a href="https://en.wikipedia.org/wiki/Modular_arithmetic">wikipedia</a>. May be later I will write some article but not soon, that&rsquo;s for sure.</li>
<li>Prime numbers (7, 73 etc). Some might remember Sheldon Cooper from the Big Bang Theory being excited about number 73 (watch <a href="https://youtu.be/TIYMmbHik08">here</a>). In short, these numbers can only be divided by 1 and itself. These numbers are still enigmas for the modern scientist and have some peculiar properties so useful for asymmetric cryptography.</li>
<li>Raising to power. This is pretty simple I think. When we multiply a number by itself many times (for example, 2*2*2), we could rewrite it like this 2^3 and we say <em>&ldquo;Two to the power three&rdquo;</em>.</li>
</ol>
<p>This algorithm is <strong>not</strong> encrypting anything! It&rsquo;s used to generate the same key 🗝️ without sending it over the network in order to use symmetric encryption algorithm. So, basically, it&rsquo;s assymmetric algo for symmetric algo 😳. Why using symmetric encryption at all, if asymmetric is so sweet and safe? Well, it&rsquo;s also a slowpoke. This is not evident when it&rsquo;s being used for small data, but it becomes a very big problem for bigger portions.</p>
<p>RSA is based on several mathematical &hellip; things:</p>
<ol>
<li>Modular exponantiation (as in Diffie Hellman&rsquo;s algo).</li>
<li>Prime factorization and Phi. Diffie Hellman does use factorization as well, but doesn&rsquo;t use Phi of numbers. What&rsquo;s Phi? We&rsquo;ll see later on.</li>
<li>Raising to power (as in Diffie Hellman&rsquo;s algo).</li>
<li>Extended Euclidean algorithm (this one is also RSA unique stuff).</li>
</ol>
<p>It <strong>is</strong> used to encrypt the message. Only assymetric algo is used, only <del>hardcode</del> hardcore!</p>
<p>Probably because these two guys share some basic principles which they are both relying on, I&rsquo;ve been confusing them. When I was trying to untangle them from one another, I&rsquo;ve found it very helpful to write down code while listening the explanation. It&rsquo;s because when I am practicing I am learning better. Writing code requires full understanding of an algorithm in order to run it. When I thought I&rsquo;ve got the main idea and started writing code, I&rsquo;ve realised, that I was wrong&hellip;. It was still a long way to go, too many gaps. I also tried to explain it to my husband and it turned out to be even harder. And as the intro to this site states, you don&rsquo;t understand a subject if you can&rsquo;t explain it to a 6 year old. Not that mu husband is 6 yo, of course, but that means, I suck even more at understanding this algo. I obvously could not get this to an IT person approximately 30 yo (5 times older than my &ldquo;debug&rdquo; readership).</p>
<p>Well, I&rsquo;ll be trying to explain it as easy as I can and since 6 year old are unlikely to read this article anyway, I&rsquo;m going to raise the age of my target audience to at least 17-20 year olds (when people might start do some coding). To make it easier to understand and easier to code, I&rsquo;m going to use very small numbers. I&rsquo;ll be giving a small coding task along the way in order to keep the reader follow my chain of thoughs as well as to make sure it&rsquo;s absolutely clear. A good starting analogy for this algorithm was given in the video on Khan academy: while other cryptography algorithms (symmetric ones) use a key both to lock and unlock the &ldquo;message box&rdquo;, this one uses a lock 🔒 to encrypt the message and a key 🗝️ to decrypt. What does it mean? I&rsquo;ll try to explain this using what seems to be a very realistic example.</p>
<h2 id="the-story-of-klutzy">The Story of Klutzy</h2>
<p>Let&rsquo;s imagine an adminstrator in the Stormgrad&rsquo;s palace (why not? 😂), an intern going by the name Klutzy 💂, who has lost his keys 🗝️ on duty. These keys were then picked up by a rogue Lunair (a hacker 🥷). Well, may be not &ldquo;picked&rdquo; but rather <em>pickpocketed</em>. That can result in a massive damage to the palace 🤑 because this rogue has stolen a decent amount of jewls and gems that can let her prosper for a very long period of time. The ruler of Stormgrad, 🤴 Anduin, was very angry about that, since this money is needed for some important royal 👑 things.  Anduin man 🤴  turned out to be a hard nut 🌰 and has given a quest for 3000px to a fellow prist (detective in this case) 🧝‍♀️, an elf going by the name Targara to help find this dummy and see what the possible damage can be. She is going to use all her powers to dive into the past and unveil the mystery. But she refuses to come to the palace, since she has a baby and none to babysit for now. That&rsquo;s why they agreed to exchange messages with doves 🕊, a tool, that can be easily sniffed by Klutzy 💂. Klutzy may screw up a lot, but he is not a total dummy. He is going to intercept the messages in order to protect himself from panishment. Targarra 🧝‍♀️ has overseen this and suggested using locked boxes with messages in them. Anduin would have a lock, which he sends to Targarra. She will write down an update and put the message in a box 🗳 and lock it with the Anduin&rsquo;s lock 🔒. Keep in mind, that Anduin 🤴 is only sending an open lock🔓. As soon as Targarra 🧝‍♀️ locks it, even she will not be able to unlock it again since only Anduin has the key 🗝️ for this lock. Everything was good, Anduin sending locks and Targarra locking the messages with them until they have realized, that the guilty party could have (and was apparently doing it for quite a time) opened the box by the means of other tools 🛠.</p>
<p><img src="https://media.giphy.com/media/QUM4JXVTq1V2yTKJBW/giphy.gif" alt="hammer"></p>
<p>Besides, the doves got too tired carrying havy shippings. That&rsquo;s why Targarra came up with another plan, based on the previous one. She suggested using mathmetical locks instead of the real ones. She called it RSA. Oh, poor Klutzy&hellip; . Let&rsquo;s examine his chances of decrypting <em>these</em> messages.</p>
<h2 id="locking-the-message">Locking the Message</h2>
<p>Targarra 🧝‍♀️ came up with a series of small numbers that represent some particular message. Why size matters? Well, for this I&rsquo;ve posted a separete small article <a href="/docs/articles/datahiding/cryptography/symmetric-vs-asymmetric">here</a>. They have assigned different codes for all the possible outcomes:</p>
<ul>
<li>1 = suspect</li>
<li>2 = innocent for sure</li>
<li>3 = guilty</li>
<li>4 = no new yet</li>
<li>and every living person in the palace was assigned a number in order to identify them. For example,  a message <code>1 54</code> would mean &ldquo;Got a suspect, major Ryan.&rdquo; and <code>3 54</code> would mean &ldquo;Major Ryan is guilty, bad boy&rdquo;.</li>
</ul>
<p>By some means unknow to anyone (sarcasm, since 🛠 is still with him), Klutzy has aquired this cheatsheet of codes. He knows, that his number is <code>29</code> and that when he intercepts a message <code>3 29</code>, he needs to change it to <code>2 29</code>. Let the game begin!</p>
<p>Anduin and Targarra 🧝‍♀️ don&rsquo;t have any keys 🔐 and locks yet. They need to generate them and then may be exchange&hellip; (a little spoiler, yes and no). But how are they going to do so over the network which they both suspect to be sniffed by the person responsible for the data breach 💔? Keep in mind Klutzy 💂  covered with sweat 😓 and pigeon poop 💩 from head to toe, sitting in the dovecote 🕊 behind the closet and waiting for the messages from Targarra🧝‍♀️ to arrive with these dreadful numbers <code>3 29</code>.  He will try to decrypt the messages that are exchanged by Targarra and Anduin or at least determine whether the message contains his name or not.</p>
<p>So, Targarra 🧝‍♀️ want&rsquo;s to let Anduin 🤴🏽‍💼 that there is a new suspect, poor major Ryan with his number <code>54</code>. She writes down a message <code>1 54</code>.</p>
<blockquote>
<p>Just a note a little off topic. They could have used letters instead of numbers, but they would have to convert them into digits anyway. Any letter, digit or a symbol can be converted into a number (computers, binary and stuff), a message &ldquo;Nothing yet&rdquo; would look like this in binary: <code>01001110 01101111 01110100 01101000 01101001 01101110 01100111 00100000 01111001 01100101 01110100</code> and since data is hard for a human to operate with, this is a nicer hex (16 base integers): <code>0x4e 0x6f 0x74 0x68 0x69 0x6e 0x67 0x20 0x79 0x65 0x74</code>. That&rsquo;s why &ldquo;convert&rdquo; is not a good word for that, since all strings, numbers and characters are already digits for a PC.</p>
</blockquote>
<p>Try to write down some code that takes an array of digits (this message as an input) and generates an array of  integers <code>secret</code> as an output. Express it in your prefered language, I&rsquo;ll use my beloved Python 🐍:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">message_str</span> <span class="o">=</span> <span class="s2">&#34;Nothing yet&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">message_int</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">secret_message</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  	<span class="c1"># this piece of code takes each char and converts</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># it into its hex ASCII representation, </span>
</span></span><span class="line"><span class="cl">    <span class="c1"># so for example &#39;A&#39; becomes 0x41</span>
</span></span><span class="line"><span class="cl">    <span class="n">message_int</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># the following line is optional, but useful for this demo</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The message from Targarra to Anduin is </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message_int</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># I could, por supuesto, write print(&#34;The message from Veronica to Anduin is&#34; + str(message_int)), but I won&#39;t :) Learning to write safe and easy to read code</span>
</span></span></code></pre></div><p>At this point Targarra has a message she needs to encrypt. According to this algorithm, Anduin 🤴 now needs to give Targarra 🧝‍♀️  some open lock 🔓 which only he can unlock later with his key 🗝️ that hopefully neither Klutzy 💂, nor Lunair 🥷 can get their hands to this time with their primeval tools. Targarra 🧝‍♀️  will use this lock to encrypt (aka <em>close</em>) the message she wants to send.</p>
<h3 id="step-1-cragting-a-lock">Step 1. Cragting a Lock</h3>
<p>Anduin 🤴  chooses two prime numbers 🧙🧙. Write some piece of code that checks whether two given integers are primes and choose two primes. Below is my python version:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># this code is from https://www.geeksforgeeks.org/python-program-to-check-whether-a-number-is-prime-or-not/</span>
</span></span><span class="line"><span class="cl"><span class="c1"># a simple solution would be to divide a number by all numbers between 2 and the number previous to the one being checked</span>
</span></span><span class="line"><span class="cl"><span class="c1"># but this solution is optimized</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">isPrime</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:</span> 
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">:</span> 
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="c1"># This is checked so that we can skip  </span>
</span></span><span class="line"><span class="cl">    <span class="c1"># middle five numbers in below loop </span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">:</span> 
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">)</span> <span class="p">:</span> 
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">:</span> 
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">prime1</span> <span class="o">=</span> <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="n">prime2</span> <span class="o">=</span> <span class="mi">19</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">isPrime</span><span class="p">(</span><span class="n">prime1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">isPrime</span><span class="p">(</span><span class="n">prime2</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The chosen numbers are both primes. Good choice!&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>Then multiply the chosen numbers:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">public_number</span> <span class="o">=</span> <span class="n">prime1</span> <span class="o">*</span> <span class="n">prime2</span>
</span></span></code></pre></div><p>This is how he gets his <em>public number</em>.</p>
<p>Then, he chooses another prime number 🧙, that is not equal to the previous ones, is odd and doesn&rsquo;t share any common factors with φ(<em>public number</em>) (read about this in the next section). That&rsquo;s his <em>public exponent</em>.</p>
<p>These numbers (<em>public number</em> and a <em>public exponent</em>) are going to be Anduin&rsquo;s  🤴 open lock 🤴🔓, i.e. he&rsquo;s sending it just like that to Targarra 🧝‍♀️. Keep in mind that Klutzy 💂 is still there, he is going to make a copy of the lock (two numbers).</p>
<p>How exactly does the lock🔓 look like, mathematically?</p>
<p><img src="images/lock.png" alt="lock"></p>
<blockquote>
<p>This sign ≡ means &ldquo;congruent&rdquo;. It&rsquo;s better to read about modular arithmetics first to get it. But in short, it means that the number from the left can be divided by <code>mod</code> number several or many times to get some remainder (some number less than this <code>mod</code> number). In this case, 1 is the remainder.</p>
</blockquote>
<p>The part of the above formula in orange is Anduin&rsquo;s mathmetical lock! Everything esle I hope is pretty self-explanatory.</p>
<p>It&rsquo;s time to introduce our parties in code 🙂. Code three classes and instanciate them: Detective, King and Klutzy.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Detective</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;Targarra&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">__prime1</span> <span class="o">=</span> <span class="mi">7</span>
</span></span><span class="line"><span class="cl">  <span class="n">__prime2</span> <span class="o">=</span> <span class="mi">19</span>
</span></span><span class="line"><span class="cl">  <span class="n">public_number</span> <span class="o">=</span> <span class="n">__prime1</span> <span class="o">*</span> <span class="n">__prime2</span> <span class="c1"># 133</span>
</span></span><span class="line"><span class="cl">  <span class="n">public_exponent</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">King</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;Anduin&#34;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Liar</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;Klutzy&#34;</span>  
</span></span></code></pre></div><p>I&rsquo;m not bothered with beautiful coding 🦋  and perfect architecture, I&rsquo;m using this code to show, which information which class has.</p>
<p>Class <code>King</code> has a name <code>Anduin</code> (just to make it more fun), <em>public exponent</em> <code>5</code> and a <em>public number</em> <code>133</code> and two primes (secret ones) that were used to calculate the public number <code>133</code>.</p>
<p>Since Anduin&rsquo;s <code>public_number</code> and <code>public_exponent</code> were sent to Targarra using doves controlled by Klutzy as well, everyone in this play has these <code>public_number</code> and <code>public_exponent</code>.  Therefore, classes <code>Detective</code> and <code>Liar</code> also have these properties plus their names hardcoded.</p>
<p>Let&rsquo;s express it in code as well:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Detective</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;Targarra&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">public_exponent</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">  <span class="n">anduins_public_number</span> <span class="o">=</span> <span class="mi">133</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Director</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;Anduin&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">__prime1</span> <span class="o">=</span> <span class="mi">7</span>
</span></span><span class="line"><span class="cl">  <span class="n">__prime2</span> <span class="o">=</span> <span class="mi">19</span>
</span></span><span class="line"><span class="cl">  <span class="n">public_number</span> <span class="o">=</span> <span class="n">__prime1</span> <span class="o">*</span> <span class="n">__prime2</span> <span class="c1"># 133</span>
</span></span><span class="line"><span class="cl">  <span class="n">public_exponent</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Liar</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;Klutzy&#34;</span> 
</span></span><span class="line"><span class="cl">  <span class="n">anduins_public_number</span> <span class="o">=</span> <span class="mi">133</span>
</span></span><span class="line"><span class="cl">  <span class="n">public_exponent</span> <span class="o">=</span> <span class="mi">5</span>
</span></span></code></pre></div><p>Now, since we know the formula and the numbers, we can finally encrypt the message. Let&rsquo;s edit the <code>Detective</code> class now:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Detective</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;Veronica&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">message</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">  <span class="n">cipher</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">  <span class="n">public_exponent</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">  <span class="n">anduins_public_number</span> <span class="o">=</span> <span class="mi">133</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="nf">lock_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">public_exponent</span><span class="p">,</span> <span class="n">anduins_public_number</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    	<span class="n">cipher_int</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">letter</span> <span class="o">**</span> <span class="n">public_exponent</span><span class="p">)</span> <span class="o">%</span> <span class="n">anduins_public_number</span><span class="p">)</span> 
</span></span></code></pre></div><h3 id="step-2-crafting-the-key">Step 2. Crafting the Key</h3>
<p>Why <em>a</em> lock, but <em>the</em> key? Well, a lock can be <em>any</em> number of the King&rsquo;s choosing while the key is derived from the lock and is <em>unique</em> for this particular lock. Otherwise, why bother so much with this algorithm and stuff.</p>
<p>This step is private for Anduin. He needs to craft a key 🗝️ to unlock the lock 🔓 so that he could read the messages that are encrypted with his &ldquo;lock&rdquo;. So, it should be some operation that let&rsquo;s him reverse the operation Targarra 🧝‍♀️ applied to the message using some information he knows but no one else does. What information could that be?</p>
<p>Did you wonder, why we needed to choose two primes first, multiply them and then share the result? And why both of them are marked as <code>private</code> in code above while the derived number is not <code>private</code>? (in Python 🐍, an underscore <code>_</code> put before an attribute name means <code>private</code>, so when you instanciate the class you can&rsquo;t get or set the value of these variables directly, but only using some public function of this class).</p>
<p>The answer is that these two primes are needed to craft the key 🗝️. If the attacker gained access to these numbers, he could have crafted the key and decrypted the message. These two prime numbers were used to craft the <em>public key</em>, which is one part of the 🔓 open lock. So, these two primes 🧙‍♀️ 🧙‍♀️ are its <em>prime factorisation</em>, i.e. its prime numbers that it can be smoothly divided by.</p>
<p>How would this key 🗝️ look like mathematically? Let&rsquo;s get back to the lock 🔒 first:</p>
<p><img src="images/lock.png" alt="lock"></p>
<p>Targarra 🧝‍♀️ needs to raise her message to the power of Anduin&rsquo;s 🤴 <em>public exponent</em> and divide the result by his <em>public number</em> many times until she get&rsquo;s a number less than his <em>public number</em> (<code>mod</code> operation). This is her cipher text ㊙️.</p>
<p>Now, to reverse this operation Anduin 🤴 needs to raise Targarra&rsquo;s 🧝‍♀️ cipher text  ㊙️ to some power, than divide the result by <em>public number</em> many times until she get&rsquo;s a number less than his <em>public number</em> (<code>mod</code> operation) to get the original Targarra&rsquo;s message. This power that Anduin 🤴 needs to raise Targarra&rsquo;s 🧝‍♀️ cipher text to should reverse his <em>public exponent</em>&rsquo;s power. So, for his <em>public exponent</em> and his <em>public number</em> there exists some number, that can undo the encryption. This is the key 🗝️. It&rsquo;s called <em>private</em>, since it is supposed to be kept secret 🤫. This is how it looks like pseudo-mathmetically:</p>
<p><img src="images/key.png" alt="key"></p>
<p>Now, the problem for the scientists was to find the formula for this <em>private key</em>. In order to understand that algorithm, we going to acquire some important mathmetical prerequisites.</p>
<p><strong>Step 1. Get Phi of the <em>public number</em>.</strong></p>
<p>A <em>phi</em> φ (or totient function) of a number (in this case, of the public number N), also called Euler&rsquo;s totient function [<a href="https://mathworld.wolfram.com/TotientFunction.html">1</a>] is a number (amount) of positive numbers that are relatively prime to this number (in this case, of the public number N). <em>Relatively prime</em> doesn&rsquo;t mean, that they  may be prime or may be not, who cares. It means that they don&rsquo;t share with N any common factors i.e. numbers that they can be both divided by without remainder (apart from <code>1</code>, since any number can be divided by <code>1</code>). This means, that <em>&ldquo;phi measures the breakability of a number&rdquo;</em> [<a href="https://www.khanacademy.org/computing/computer-science/cryptography/modern-crypt/v/euler-s-totient-function-phi-function">3</a>].</p>
<p>It was not very easy for me to get, but a simple example from the Khan Academy has described it very nicely and clearly [<a href="https://www.khanacademy.org/computing/computer-science/cryptography/modern-crypt/v/euler-s-totient-function-phi-function">3</a>]. Let&rsquo;s find a φ(8). We write down all positive numbers (integers) that are less than or equal to <code>8</code>: 1, 2, 3, 4, 5, 6, 7, 8. Then, we choose those numbers that don&rsquo;t share common factors with <code>8</code>. For that we first need to know 8&rsquo;s factors: 2, 4, 1, 8. Since 1 has finger in a lot of pies 🥧 (all numbers can be divided by 1), we will always count it . Also, it&rsquo;s obvious that 8 and 8 share common factors since these are the same numbers. So, we are left with <code>1</code>,  <code>2</code> and <code>4</code>.</p>
<p>Now, let&rsquo;s interrogate 🕵️‍♀️  each number to find out, whether it has factors 2 or 4 (we are only interested in factors greater than 1)? If no, we increment our counter of relative primes.</p>
<p>1? Always yes. 2 (can be divided by 2)? No. 3 (prime number, 1 and 3 are only factors)? Yes! 👍 4 (can be divided by 2)? No. 5 (prime number, 1 and 5 are only factors)? Yes! 👍 6 (shares common factor 2 with 8)? No. 7 (prime number, 1 and 7 are only factors)? 8? (no comments) No. We have 1, 3, 5 and 7 that do not share any common factors with 8. So, there are 4 such numbers and <code>φ(8) = 4</code>.</p>
<p>Calculating phi is hard for bigger numbers, except one case&hellip; . Guess, what case that is! Right (I can&rsquo;t know what you were thinking about, of course, but I find it reassuring when someone says &ldquo;You are right&rdquo;, so, enjoy ☺️). Well, right, this only case is our case i.e. prime numbers.</p>
<p>There are several laws of primes and other mathematical laws as well, that play a crucial part in this matter. Let&rsquo;s get them one by one.</p>
<p><strong>Property 1. <code>φ(prime number)</code> always equals to <code>prime number - 1</code></strong>. It&rsquo;s because every integer less than this prime do not share any common factors with it other than <code>1</code> and there are <code>prime-1</code> such integers. Take 7 as an example. There are 6 integers (all) less than 7 that do not share any factors with 7 <code>φ(7)</code> would be <code>7-1</code> and equals to <code>6</code>.</p>
<p><strong>Property 2. φ function is multiplicative</strong>. That means that we can get φ of a number if we get φ numbers of its factors. For example, to get <code>φ(8)</code>, we could find the product of <code>φ(2)</code> and <code>φ(4)</code> and still get the same result: <code>φ(8) = φ(2) * φ(4)</code>.</p>
<p>Now, let&rsquo;s get back to Anduin&rsquo;s <em>public number</em> that is composed of two huge prime numbers (not huge in our case, but in real life they are supposed to be very large). We can get φ of this number using the above mentioned mathematical properties and two primes 🧙‍♀️ 🧙‍♀️ that Anduin 🤴 has already come up with:</p>
<p><code>φ(public number) = (7-1) * (19 - 1)</code></p>
<p>Now, what does all this have to do with the key? <code>φ(public number)</code> is something, that only Anduin can calculate. But how to use it to decrypt the message? Here is where exponentiation comes into play. You can watch about Euler&rsquo;s theorem on Khan Academy [<a href="https://www.khanacademy.org/computing/computer-science/cryptography/modern-crypt/v/rsa-encryption-part-4">4</a>]:</p>
<p><strong>Property 3. <code>m ^ φ(n) mod n ≡ 1 </code>.</strong> That means if we pick two numbers <code>m</code> and <code>n</code> that don&rsquo;t share common factors, then raise <code>m</code> to the power of <code>φ(n)</code> and finally divide by <code>n</code> itself many times until we get a number less than <code>n</code>, we will always get <code>1</code>. For example, take numbers <code>m=5</code> and <code>n=8</code>:</p>
<ol>
<li><code>φ(8) = 4</code> (as we have already found out)</li>
<li><code>5 ^ 4 ≡ 625</code></li>
<li><code>mod n</code>, i.e. divide by <code>n</code> until you get a number less than <code>n</code> left: <code>625/8/8/8/8/8/8/8...</code>. <code>625</code> number <code>78</code> times divided by <code>8</code> gives us <code>1</code>.</li>
</ol>
<blockquote>
<p>They should not share a common factor (m and n). e should not share a common factor with F(n) and should be odd. m and N should not share a factor. So, 3 and 15 or 5 and 15 don&rsquo;t work.</p>
</blockquote>
<p><strong>Property 4. 1 raised to any power is always <code>1</code>.</strong> What is multiplication? Repated addition. So, 7 * 5 means  <code>1^1</code>, <code>1^7</code>, <code>1^2132131313</code> is always <code>1</code>. That&rsquo;s why we can modify the formula above to <code>m ^ φ(n)*k ≡ 1 mod n</code> (raising m to the power of <code>φ(n)*k</code> instead of <code>φ(n)</code>) and still get <code>1</code>.</p>
<p><strong>Property 5. Any number multiplied by 1 equals itself.</strong> <code>1*7=7</code>, <code>1*9=9</code>, <code>1*13413421=13413421</code>. If it&rsquo;s true (and it&rsquo;s true), then we can modify our equasion once again: <code>m * m ^ (φ(n)*k) ≡ m mod n</code> (adding <code>m</code> to the both sides of it) and still get <code>1</code>. Don&rsquo;t fret, we are almost there.</p>
<p><strong>Property 6. The <a href="https://en.wikipedia.org/wiki/Associative_property">associativity</a> of multiplication</strong>.  When we multiply the same integers raised to different powers, we can instead get the sum of these powers and then raise this integer to that power. Example: <code>2^6 * 2^9 = 2 ^ (6 + 9)</code>. That&rsquo;s why we can simplify our equation a bit: <code>m^1*m^(φ(n)*k)≡m mod n</code> = <code>m ^ (k*φ(n) + 1) ≡ m mod n</code>.</p>
<p>Now, if we raise Targarra&rsquo;s message to the power of <code>k*φ(n) + 1</code>, we get that message back.</p>
<p><img src="images/decryption.png" alt="decryption"></p>
<p>So, <code>k*φ(n) + 1</code> is something that is comprised of <em>public number</em> and <em>private key</em>.  <img src="images/compliment.png" alt="compliment"></p>
<p>Looks good. Anduid 🤴 has chosen some <em>public exponent</em> already, it&rsquo;s <code>5</code>,  and public number is also known, so we can put these values into the formula below:</p>
<p><img src="images/compliment2.png" alt="compliment2"></p>
<p>It&rsquo;s pretty easy now to get the <em>private key</em> 🗝️ using primitive mathematical laws:</p>
<p><img src="images/key2.png" alt="key2"></p>
<p>That&rsquo;s called the <em>trap door</em> [<a href="https://en.wikipedia.org/wiki/Trapdoor_function">5</a>].</p>
<blockquote>
<p>A <strong>trapdoor function</strong> is a <a href="https://en.wikipedia.org/wiki/Function_(mathematics)">function</a> that is easy to compute in one direction, yet difficult to compute in the opposite direction (finding its <a href="https://en.wikipedia.org/wiki/Inverse_function">inverse</a>) without special information, called the &ldquo;trapdoor&rdquo;. Trapdoor functions are widely used in <a href="https://en.wikipedia.org/wiki/Cryptography">cryptography</a>.</p>
</blockquote>
<p>Now, what the hell is <code>k</code> and where did it come from? It&rsquo;s some coefficient, that&rsquo;s making this all so difficult. Now, how to find this <em>private key</em>? We don&rsquo;t know this k coefficient.</p>
<p><img src="images/decryption.png" alt="decryption"></p>
<p>For the above equation to work, <code>public exponent * private key</code> product is  supposed to be congruent to 1, becase a number can only be equal to itself after exponentiation if and only if it was raised to the power of 1 [<a href="https://www.di-mgt.com.au/rsa_alg.html">7</a>]:</p>
<blockquote>
<p>Compute d such that ed ≡ 1 (mod phi)
i.e. compute d = (1/e) mod phi = (1/3) mod 20
i.e. find a value for d such that phi divides (ed-1)
i.e. find d such that 20 divides 3d-1.
Simple testing (d = 1, 2, &hellip;) gives d = 7
Check: ed-1 = 3.7 - 1 = 20, which is divisible by phi.</p>
</blockquote>
<p><code>e * d mod φ(n) ≡ 1</code>. So, calculating <em>private key</em> in this case is trivial and comes down to the inversing the modulo, to be precise, <em>modular inverse function</em>. There are different ways to find it, the simplest one (especially in our case of small numbers) is to bruteforce. This method is called <em>naive</em>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">modinverse_naive</span><span class="p">(</span><span class="n">public_exponent</span><span class="p">,</span> <span class="n">phi_of_public_number</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">phi_of_public_number</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">public_exponent</span> <span class="o">*</span> <span class="n">i</span> <span class="o">%</span> <span class="n">phi_of_public_number</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">i</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span></span></code></pre></div><p>Another approach involves quite complex (at least, for me) mathematical calculations using <strong>g</strong>reatest <strong>c</strong>ommon <strong>d</strong>ivisor (gcd) and can be calculated in one line in python using <code>libnum.invmod()</code> function:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">libnum</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">decryption_key</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">invmod</span><span class="p">(</span><span class="n">public_exponent</span><span class="p">,</span><span class="n">phi_of_public_number</span><span class="p">)</span>
</span></span></code></pre></div><p>This is the hardest part, but the key 🗝️ is created and ready to be used and cherished. The most important for Anduin 🤴 at this stage is not to screw up and show it to no one.</p>
<h2 id="references">References</h2>
<p><a href="https://www.youtube.com/watch?v=6KmhCKxFWOs">https://www.youtube.com/watch?v=6KmhCKxFWOs</a></p>
<p><a href="https://ccom.uprrp.edu/~humberto/very-small-rsa-example.html">https://ccom.uprrp.edu/~humberto/very-small-rsa-example.html</a></p>
<p><a href="https://www.khanacademy.org/computing/computer-science/cryptography/modarithmetic/a/the-euclidean-algorithm">https://www.khanacademy.org/computing/computer-science/cryptography/modarithmetic/a/the-euclidean-algorithm</a></p>
<p><a href="https://www.khanacademy.org/computing/computer-science/cryptography/modarithmetic/a/modular-inverses">https://www.khanacademy.org/computing/computer-science/cryptography/modarithmetic/a/modular-inverses</a></p>
<p><a href="https://www.geeksforgeeks.org/python-program-for-basic-and-extended-euclidean-algorithms-2/">https://www.geeksforgeeks.org/python-program-for-basic-and-extended-euclidean-algorithms-2/</a></p>
<p><a href="https://en.wikibooks.org/wiki/Algorithm_Implementation/Mathematics/Extended_Euclidean_algorithm#Python">https://en.wikibooks.org/wiki/Algorithm_Implementation/Mathematics/Extended_Euclidean_algorithm#Python</a></p>
<p><a href="https://stackoverflow.com/questions/4798654/modular-multiplicative-inverse-function-in-python">https://stackoverflow.com/questions/4798654/modular-multiplicative-inverse-function-in-python</a></p>
<p>[<a href="https://mathworld.wolfram.com/TotientFunction.html">1</a>] [<a href="https://www.khanacademy.org/computing/computer-science/cryptography/modern-crypt/v/euler-s-totient-function-phi-function">3</a>] About Euler&rsquo;s totient function (phi)</p>
<p>[<a href="https://www.khanacademy.org/computing/computer-science/cryptography/modern-crypt/v/rsa-encryption-step-3">2</a>] Khan Academy Crypto course is making a fabulous job explaining RSA, Diffie-Hellman and other crypto stuff.</p>
<p>[<a href="https://www.khanacademy.org/computing/computer-science/cryptography/modern-crypt/v/rsa-encryption-part-4">4</a>] Khan Academy about Euler&rsquo;s theorem</p>
<p>[<a href="https://en.wikipedia.org/wiki/Trapdoor_function">5</a>] Wikipedia, Trapdoor function</p>
<p>[<a href="https://crypto.stackexchange.com/questions/109/rsa-with-small-exponents">6</a>] When small public exponents are used, things can go wrong.</p>
<p>[<a href="https://www.di-mgt.com.au/rsa_alg.html">7</a>] An article about RSA with a very good simple example.</p>

  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.bafc052229b4b40bf03c477d31c5cdd9352ece8afbadf35ab97ed14495098fc9.js"></script>
  

  
  
  
    
  


</body>

</html>
